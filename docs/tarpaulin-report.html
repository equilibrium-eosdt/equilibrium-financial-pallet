<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
}

.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","rotor","work","src","polka","financial-pallet","common","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse core::slice::Iter;\nuse frame_support::codec::{Decode, Encode};\n#[cfg(feature = \"std\")]\nuse serde::{Deserialize, Serialize};\nuse financial_primitives::IntoTypeIterator;\nuse sp_std::vec;\n\n#[derive(Encode, Decode, Debug, PartialEq, Eq, Clone, Copy, Hash)]\n#[cfg_attr(feature = \"std\", derive(Serialize, Deserialize))]\npub enum Asset {\n    Unknown,\n    Usd,\n    Eq,\n    Eth,\n    Btc,\n    Eos,\n}\n\nimpl Default for Asset {\n    fn default() -\u003e Asset {\n        Asset::Unknown\n    }\n}\n\nimpl Asset {\n    pub fn iterator() -\u003e Iter\u003c'static, Asset\u003e {\n        static ASSETS: [Asset; 5] = [Asset::Usd, Asset::Eq, Asset::Eth, Asset::Btc, Asset::Eos];\n        ASSETS.iter()\n    }\n}\n\nimpl IntoTypeIterator for Asset {\n    type Iterator = sp_std::vec::IntoIter\u003cSelf\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator {\n        vec![\n            Asset::Usd,\n            Asset::Eq,\n            Asset::Eth,\n            Asset::Btc,\n            Asset::Eos,\n        ].into_iter()\n    }\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","rotor","work","src","polka","financial-pallet","financial-primitives","src","capvec.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse frame_support::codec::{Decode, Encode};\nuse sp_std::prelude::Vec;\n\n#[derive(Encode, Decode, Clone, Default)]\npub struct CapVec\u003cT\u003e {\n    head_index: u32,\n    len_cap: u32,\n\titems: Vec\u003cT\u003e,\n}\n\nimpl \u003cT\u003e CapVec\u003cT\u003e {\n\tpub fn new(length: u32) -\u003e CapVec\u003cT\u003e {\n\t\tCapVec {\n            head_index: 0,\n            len_cap: length,\n\t\t\titems: Vec::new(),\n\t\t}\n\t}\n\n\tpub fn push(\u0026mut self, item: T) {\n        if self.items.len() \u003c (self.len_cap as usize) {\n            self.items.push(item);\n        } else {\n            self.items[self.head_index as usize] = item;\n            self.head_index = (self.head_index + 1) % (self.items.len() as u32);\n        }\n\t}\n\n\tpub fn iter(\u0026self) -\u003e impl Iterator\u003cItem = \u0026T\u003e {\n\t\tlet head = self.head_index as usize;\n\t\tlet first_part = self.items[head..].iter();\n\t\tlet last_part = self.items[..head].iter();\n\n\t\tfirst_part.chain(last_part)\n    }\n    \n    pub fn len_cap(\u0026self) -\u003e u32 {\n        self.len_cap\n    }\n\n    pub fn last(\u0026self) -\u003e Option\u003c\u0026 T\u003e {\n        let len = self.items.len();\n\n        if len == 0 {\n            None\n        } else if len \u003c (self.len_cap as usize) {\n            Some(\u0026self.items[len - 1])\n        } else {\n            let index = (self.len_cap + self.head_index - 1) % (self.len_cap);\n            Some(\u0026self.items[index as usize])\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_empty() {\n        let capvec = CapVec::\u003cu32\u003e::new(5);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_not_capped() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![1, 2, 3];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_capped() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n        capvec.push(4);\n        capvec.push(5);\n        capvec.push(6);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![2, 3, 4, 5, 6];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_last_empty() {\n        let capvec = CapVec::\u003cu32\u003e::new(5);\n\n        let actual = capvec.last();\n        let expected = None;\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_last_non_empty() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n        capvec.push(4);\n        capvec.push(5);\n        capvec.push(6);\n\n        let actual = capvec.last();\n        let expected = Some(\u00266);\n\n        assert_eq!(actual, expected);\n    }\n}","traces":[{"line":27,"address":[4379136],"length":1,"stats":{"Line":5},"fn_name":"new\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":31,"address":[4379147],"length":1,"stats":{"Line":5},"fn_name":null},{"line":35,"address":[4379952,4380016],"length":1,"stats":{"Line":5},"fn_name":"push\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":36,"address":[4379974,4380117,4380033],"length":1,"stats":{"Line":15},"fn_name":null},{"line":37,"address":[4380090],"length":1,"stats":{"Line":5},"fn_name":null},{"line":39,"address":[4380048,4380119,4380237,4380298],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[4380126,4380342,4380259],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[4379232],"length":1,"stats":{"Line":2},"fn_name":"iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":45,"address":[4379254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[4379268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[4379383],"length":1,"stats":{"Line":3},"fn_name":null},{"line":49,"address":[4379480],"length":1,"stats":{"Line":3},"fn_name":null},{"line":52,"address":[4380416],"length":1,"stats":{"Line":1},"fn_name":"len_cap\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":53,"address":[4380421],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[4379504],"length":1,"stats":{"Line":3},"fn_name":"last\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":57,"address":[4379513],"length":1,"stats":{"Line":3},"fn_name":null},{"line":59,"address":[4379581,4379812,4379544],"length":1,"stats":{"Line":7},"fn_name":null},{"line":60,"address":[4379572],"length":1,"stats":{"Line":2},"fn_name":null},{"line":61,"address":[4379555,4379694],"length":1,"stats":{"Line":4},"fn_name":null},{"line":62,"address":[4379824,4379625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[4379854,4379591,4379700],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[4379781],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":22,"coverable":22},{"path":["/","home","rotor","work","src","polka","financial-pallet","financial-primitives","src","lib.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n//#![warn(missing_docs)]\n#![cfg_attr(not(feature = \"std\"), no_std)]\n\npub mod capvec;\n\nuse frame_support::dispatch::DispatchError;\nuse sp_std::iter::Iterator;\n\npub struct Asset;\n\npub trait OnPriceSet {\n    type Asset;\n    type Price;\n\n    fn on_price_set(asset: Self::Asset, value: Self::Price) -\u003e Result\u003c(), DispatchError\u003e;\n}\n\npub trait IntoTypeIterator: Sized {\n    type Iterator: Iterator\u003cItem = Self\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","integration-testing-macro","src","lib.rs"],"content":"extern crate proc_macro;\n\nuse proc_macro::{Literal, TokenStream, TokenTree};\nuse quote::quote;\nuse syn::parse::{Parse, ParseStream};\nuse syn::parse_macro_input;\nuse syn::punctuated::Punctuated;\nuse syn::{Expr, Token};\n\nstruct Input {\n    name: syn::Ident,\n    args: Punctuated\u003cExpr, Token![,]\u003e,\n}\n\nimpl Parse for Input {\n    fn parse(input: ParseStream) -\u003e syn::parse::Result\u003cSelf\u003e {\n        let name = input.parse()?;\n        input.parse::\u003csyn::Token![,]\u003e()?;\n        let args = Punctuated::\u003cExpr, Token![,]\u003e::parse_terminated(input)?;\n        Ok(Input { name, args })\n    }\n}\n\nfn tuple_read(name: syn::Ident, num: usize) -\u003e syn::Expr {\n    let num = Literal::usize_unsuffixed(num);\n    let num: TokenTree = num.into();\n    let num: TokenStream = num.into();\n    let num: syn::Lit = syn::parse(num).unwrap();\n    let gen = quote! {\n        #name.#num\n    };\n\n    let tokens: TokenStream = gen.into();\n\n    syn::parse(tokens).unwrap()\n}\n\n#[proc_macro]\npub fn tuple_to_vec(tokens: TokenStream) -\u003e TokenStream {\n    let input = parse_macro_input!(tokens as Input);\n    let name = input.name;\n\n    let vec_args: Punctuated\u003csyn::Expr, Token![,]\u003e = input\n        .args\n        .into_iter()\n        .enumerate()\n        .map(|(i, _)| tuple_read(name.clone(), i))\n        .collect();\n\n    let gen = quote! {\n        vec!(#vec_args)\n    };\n\n    gen.into()\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","key.rs"],"content":"use crate::keyring::{KeyPair, Nonces, PubKey};\nuse arraystring::{error, typenum::U10, ArrayString};\nuse serde::ser::{Serialize, SerializeStruct, SerializeTupleVariant, Serializer};\nuse sp_core::crypto::Pair as CryptoPair;\nuse sp_core::sr25519::Pair;\nuse sp_runtime::traits::AccountIdConversion;\nuse sp_runtime::{AccountId32, ModuleId};\nuse std::cmp::Ordering;\nuse std::collections::HashMap;\n\n#[derive(Copy, Clone, Debug, Eq, PartialEq, Hash)]\npub enum AccountKey {\n    Keyring(sp_keyring::sr25519::Keyring),\n    Str(\u0026'static str),\n    Random(ArrayString10),\n}\n\nimpl AccountKey {\n    /// Constructs account key from random seed string.\n    pub fn generate_random() -\u003e Self {\n        let seed = generate_random_array_string().expect(\"should be short random string\");\n        AccountKey::Random(seed)\n    }\n\n    fn to_num(\u0026self) -\u003e usize {\n        match self {\n            \u0026AccountKey::Keyring(_) =\u003e 0,\n            \u0026AccountKey::Str(_) =\u003e 1,\n            \u0026AccountKey::Random(_) =\u003e 2,\n        }\n    }\n}\n\n/// Represents fixed-capacity string for testing AccountKey.\ntype ArrayString10 = ArrayString\u003cU10\u003e;\n\n/// Generates random array string with fixed length, otherwise returns an error.\n/// ```rust\n/// let s = generate_random_array_string();\n/// ```\nfn generate_random_array_string() -\u003e Result\u003cArrayString10, error::OutOfBounds\u003e {\n    use rand::{distributions::Alphanumeric, Rng};\n    let s: String = rand::thread_rng()\n        .sample_iter(\u0026Alphanumeric)\n        .take(10)\n        .collect();\n    ArrayString10::try_from_str(s)\n}\n\nfn keyring_to_string(keyring: sp_keyring::sr25519::Keyring) -\u003e \u0026'static str {\n    keyring.into()\n}\n\nimpl PartialOrd for AccountKey {\n    fn partial_cmp(\u0026self, other: \u0026AccountKey) -\u003e Option\u003cOrdering\u003e {\n        Some(self.cmp(other))\n    }\n}\n\nimpl Serialize for AccountKey {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self {\n            \u0026AccountKey::Keyring(kr) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"AccountKey\", 0, \"Keyring\", 1)?;\n                state.serialize_field(keyring_to_string(kr))?;\n                state.end()\n            }\n            \u0026AccountKey::Str(s) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountKey\", 1, \"Str\", 1)?;\n                state.serialize_field(s)?;\n                state.end()\n            }\n            \u0026AccountKey::Random(s) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountKey\", 2, \"Random\", 1)?;\n                state.serialize_field(s.as_str())?;\n                state.end()\n            }\n        }\n    }\n}\n\nimpl Ord for AccountKey {\n    fn cmp(\u0026self, other: \u0026AccountKey) -\u003e Ordering {\n        let num_ord = self.to_num().cmp(\u0026other.to_num());\n\n        if num_ord != Ordering::Equal {\n            num_ord\n        } else {\n            match (self, other) {\n                (\u0026AccountKey::Keyring(a), \u0026AccountKey::Keyring(b)) =\u003e {\n                    keyring_to_string(a).cmp(keyring_to_string(b))\n                }\n                (\u0026AccountKey::Str(a), \u0026AccountKey::Str(b)) =\u003e a.cmp(b),\n                _ =\u003e panic!(\"Not meant to be there\"),\n            }\n        }\n    }\n}\n\nimpl From\u003csp_keyring::sr25519::Keyring\u003e for AccountKey {\n    fn from(x: sp_keyring::sr25519::Keyring) -\u003e AccountKey {\n        AccountKey::Keyring(x)\n    }\n}\n\nimpl From\u003c\u0026'static str\u003e for AccountKey {\n    fn from(x: \u0026'static str) -\u003e AccountKey {\n        AccountKey::Str(x)\n    }\n}\n\nimpl PubKey for AccountKey {\n    type AccountId = AccountId32;\n\n    fn acc_id(\u0026self) -\u003e Self::AccountId {\n        match self {\n            \u0026AccountKey::Keyring(k) =\u003e k.to_account_id(),\n            \u0026AccountKey::Str(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s), None)\n                .unwrap()\n                .public()\n                .into(),\n            \u0026AccountKey::Random(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s.as_str()), None)\n                .unwrap()\n                .public()\n                .into(),\n        }\n    }\n}\n\nimpl KeyPair for AccountKey {\n    fn key_pair(\u0026self) -\u003e sp_core::sr25519::Pair {\n        match self {\n            \u0026AccountKey::Keyring(k) =\u003e k.pair(),\n            \u0026AccountKey::Str(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s), None).unwrap(),\n            \u0026AccountKey::Random(s) =\u003e {\n                Pair::from_string(\u0026ensure_canonical_seed(s.as_str()), None).unwrap()\n            }\n        }\n    }\n}\n\npub type DevNonces = Nonces\u003cAccountKey\u003e;\n\n#[derive(Clone, Copy, Debug, Eq, PartialEq, Hash, Ord, PartialOrd)]\npub enum DevPubKeyId {\n    ModuleId([u8; 8]),\n    AccKey(AccountKey),\n    External(u32),\n    WellKnown(\u0026'static str),\n}\n\nimpl DevPubKeyId {\n    pub fn is_internal(\u0026self) -\u003e bool {\n        match self {\n            \u0026DevPubKeyId::External(_) =\u003e false,\n            _ =\u003e true,\n        }\n    }\n}\n\nimpl serde::Serialize for DevPubKeyId {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self {\n            \u0026DevPubKeyId::ModuleId(bs) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 0, \"ModuleId\", 1)?;\n                state.serialize_field(\u0026String::from_utf8_lossy(\u0026bs))?;\n                state.end()\n            }\n            \u0026DevPubKeyId::AccKey(k) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 1, \"AccKey\", 1)?;\n                state.serialize_field(\u0026k)?;\n                state.end()\n            }\n            \u0026DevPubKeyId::External(e) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 2, \"External\", 1)?;\n                state.serialize_field(\u0026e)?;\n                state.end()\n            }\n            \u0026DevPubKeyId::WellKnown(s) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 3, \"WellKnown\", 1)?;\n                state.serialize_field(s)?;\n                state.end()\n            }\n        }\n    }\n}\n\n#[derive(Clone, Debug)]\npub struct DevPubKey {\n    id: DevPubKeyId,\n    acc_id: AccountId32,\n}\n\nimpl Serialize for DevPubKey {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        let mut state = serializer.serialize_struct(\"DevPubKey\", 2)?;\n        state.serialize_field(\"id\", \u0026self.id)?;\n        state.serialize_field(\"acc_id\", \u0026self.acc_id.to_string())?;\n        state.end()\n    }\n}\n\nimpl DevPubKey {\n    pub fn well_known(name: \u0026'static str, acc_id: AccountId32) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::WellKnown(name),\n            acc_id,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e DevPubKeyId {\n        self.id\n    }\n}\n\nimpl PubKey for DevPubKey {\n    type AccountId = AccountId32;\n\n    fn acc_id(\u0026self) -\u003e Self::AccountId {\n        self.acc_id.clone()\n    }\n}\n\nimpl From\u003cModuleId\u003e for DevPubKey {\n    fn from(x: ModuleId) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::ModuleId(x.0),\n            acc_id: x.into_account(),\n        }\n    }\n}\n\nimpl From\u003cAccountKey\u003e for DevPubKey {\n    fn from(x: AccountKey) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::AccKey(x),\n            acc_id: x.acc_id(),\n        }\n    }\n}\n\n#[derive(Eq, PartialEq)]\npub enum PubKeyStoreRegisterResult {\n    AddedNew,\n    ExistsNotModified,\n    ExistsReplaced,\n}\n\n#[derive(Debug)]\npub struct PubKeyStore {\n    items: HashMap\u003cAccountId32, DevPubKeyId\u003e,\n    next_id: u32,\n}\n\nimpl PubKeyStore {\n    pub fn new() -\u003e PubKeyStore {\n        PubKeyStore {\n            items: HashMap::new(),\n            next_id: 0,\n        }\n    }\n\n    pub fn register(\u0026mut self, pub_key: DevPubKey) -\u003e PubKeyStoreRegisterResult {\n        let DevPubKey { id, acc_id } = pub_key;\n        let item = self.items.get(\u0026acc_id);\n\n        if let Some(existing_id) = item {\n            match (existing_id, id) {\n                (_, DevPubKeyId::External(_)) =\u003e PubKeyStoreRegisterResult::ExistsNotModified,\n                _ =\u003e PubKeyStoreRegisterResult::ExistsReplaced,\n            }\n        } else {\n            self.items.insert(acc_id, id);\n            PubKeyStoreRegisterResult::AddedNew\n        }\n    }\n\n    pub fn register_external(\u0026mut self, acc_id: AccountId32) {\n        let id = DevPubKeyId::External(self.next_id);\n        let result = self.register(DevPubKey { id, acc_id });\n\n        if result == PubKeyStoreRegisterResult::AddedNew\n            || result == PubKeyStoreRegisterResult::ExistsReplaced\n        {\n            self.next_id = self.next_id + 1;\n        }\n    }\n\n    pub fn get_id(\u0026self, acc_id: \u0026AccountId32) -\u003e Option\u003cDevPubKeyId\u003e {\n        self.items.get(acc_id).map(|\u0026x| x)\n    }\n\n    pub fn dump(\u0026self) -\u003e Vec\u003cDevPubKey\u003e {\n        let mut items: Vec\u003c_\u003e = self\n            .items\n            .iter()\n            .map(|(acc_id, \u0026id)| DevPubKey {\n                id,\n                acc_id: acc_id.clone(),\n            })\n            .collect();\n\n        items.sort_by(|a, b| a.id.cmp(\u0026b.id));\n\n        items\n    }\n}\n\n/// Prepends \"//\" to the string if absent.\nfn ensure_canonical_seed(s: \u0026str) -\u003e String {\n    if !s.starts_with(\"//\") {\n        format!(\"//{}\", s)\n    } else {\n        String::from(s)\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":294,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":303,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":116},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","keyring.rs"],"content":"use std::fmt::Debug;\nuse std::collections::HashMap;\nuse std::cmp::Eq;\nuse std::hash::Hash;\n\npub trait PubKey {\n    type AccountId;\n    fn acc_id(\u0026self) -\u003e Self::AccountId;\n}\n\npub trait KeyPair: PubKey {\n    fn key_pair(\u0026self) -\u003e sp_core::sr25519::Pair;\n}\n\npub struct Nonces\u003cK\u003e {\n    nonces: HashMap\u003cK, u32\u003e,\n}\n\nimpl \u003cK\u003e Nonces\u003cK\u003e {\n    pub fn new() -\u003e Nonces\u003cK\u003e {\n        Nonces {\n            nonces: HashMap::\u003cK, u32\u003e::new(),\n        }\n    }\n}\n\npub trait NonceManager {\n    type AccountKey: Copy + Debug;\n\n    fn is_initialized(\u0026self, key: Self::AccountKey) -\u003e bool;\n    fn init_nonce(\u0026mut self, key: Self::AccountKey, nonce: u32);\n    fn get_nonce_and_inc(\u0026mut self, key: Self::AccountKey) -\u003e u32;\n}\n\nimpl \u003cAccountKey: Copy + Debug + Eq + Hash\u003e NonceManager for Nonces\u003cAccountKey\u003e {\n    type AccountKey = AccountKey;\n\n    fn is_initialized(\u0026self, key: Self::AccountKey) -\u003e bool {\n        self.nonces.get(\u0026key).is_some()\n    }\n\n    fn init_nonce(\u0026mut self, key: Self::AccountKey, nonce: u32) {\n        if self.nonces.insert(key, nonce).is_some() {\n            panic!(\"nonce for key {:?} has already been initialized\", key);\n        }\n    }\n\n    fn get_nonce_and_inc(\u0026mut self, key: Self::AccountKey) -\u003e u32 {\n        let value = self.nonces.get_mut(\u0026key);\n\n        if let Some(value) = value {\n            let curr_nonce = *value;\n            *value = *value + 1;\n            curr_nonce\n        } else {\n            panic!(\"nonce for key {:?} is not initialized\", key);\n        }\n\n    }\n}","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":14},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","main.rs"],"content":"#![recursion_limit = \"256\"]\n\npub mod key;\npub mod keyring;\npub mod oracle;\npub mod requester;\npub mod runtime;\npub mod test;\npub mod test_context;\npub mod test_scripts;\npub mod timestamp;\n\nuse crate::key::DevNonces;\nuse futures::lock::Mutex;\nuse log::{Level, Metadata, Record};\nuse log::{LevelFilter, SetLoggerError};\nuse runtime::TestRuntime;\nuse std::sync::Arc;\nuse substrate_subxt::ClientBuilder;\n#[allow(unused_imports)]\nuse test_scripts::test_financial::test_financial;\n\npub const ONE: u64 = 1_000_000_000;\n\n#[macro_use]\nextern crate lazy_static;\n\nstruct SimpleLogger;\nimpl log::Log for SimpleLogger {\n    fn enabled(\u0026self, metadata: \u0026Metadata) -\u003e bool {\n        metadata.level() \u003c= Level::Info\n    }\n\n    fn log(\u0026self, record: \u0026Record) {\n        if self.enabled(record.metadata()) {\n            println!(\"{} - {}\", record.level(), record.args());\n        }\n    }\n\n    fn flush(\u0026self) {}\n}\n\nstatic LOGGER: SimpleLogger = SimpleLogger;\n\npub fn init() -\u003e Result\u003c(), SetLoggerError\u003e {\n    log::set_logger(\u0026LOGGER).map(|()| log::set_max_level(LevelFilter::Info))\n}\n\n#[async_std::main]\nasync fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    //init();\n    let client = ClientBuilder::\u003cTestRuntime\u003e::new()\n        .set_page_size(1)\n        .set_url(\"ws://localhost:9944/\")\n        .build()\n        .await?;\n    let nonces = Arc::new(Mutex::new(DevNonces::new()));\n\n    // Node state dependent test;\n    println!(\"\\n\\nRunning financial test \\n\\n\");\n    test_financial(\u0026client, nonces).await?; // WARN - with 6s blocks test goes on for ~8 mins\n\n    Ok(())\n}\n","traces":[{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","oracle.rs"],"content":"use codec::{Codec, Encode};\nuse core::marker::PhantomData;\nuse common::Asset;\nuse sp_runtime::traits::Member;\nuse std::fmt::Debug;\nuse substrate_subxt::system::{System, SystemEventsDecoder};\nuse substrate_subxt_proc_macro::{module, Call, Store};\nuse substrate_fixed::types::I64F64;\n\npub type Price = I64F64;\n\n#[module]\npub trait Oracle: System {\n    type Asset: Default + Codec + Member;\n    type Price: Default + Codec + Member;\n}\n\n#[derive(Clone, Debug, Eq, PartialEq, Store, Encode)]\npub struct PricePointsStore\u003cT: Oracle\u003e {\n    #[store(returns = Price)]\n    pub asset: Asset,\n    pub _runtime: PhantomData\u003cT\u003e,\n}\n\n#[derive(Clone, Debug, PartialEq, Call, Encode)]\npub struct SetPriceCall\u003cT: Oracle\u003e {\n    pub asset: Asset,\n    pub value: Price,\n    pub _runtime: PhantomData\u003cT\u003e,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","requester.rs"],"content":"use super::TestRuntime;\nuse crate::key::{AccountKey, DevNonces};\nuse crate::keyring::{KeyPair, NonceManager};\nuse crate::runtime::{AccountId, Balance};\nuse core::marker::PhantomData;\nuse futures::lock::Mutex;\nuse pallet_transaction_payment_rpc_runtime_api::RuntimeDispatchInfo;\nuse sp_keyring::AccountKeyring;\nuse std::collections::HashMap;\nuse std::sync::Arc;\nuse substrate_subxt::ExtrinsicSuccessWithFee;\nuse substrate_subxt::{sudo::SudoCall, Call, Client, PairSigner};\n\nlazy_static! {\n    pub static ref FEES: HashMap\u003cString, u64\u003e = vec![\n        (String::from(\"transfer_and_watch\"), 125_000_146),\n        (String::from(\"register_bailsman_and_watch\"), 125_000_105),\n        (String::from(\"unregister_bailsman_and_watch\"), 125_000_105),\n        (String::from(\"register_whitelist_and_watch\"), 125_000_139),\n        (String::from(\"unregister_whitelist_and_watch\"), 125_000_139),\n        (String::from(\"set_price_and_watch\"), 125_000_114),\n    ]\n    .into_iter()\n    .collect();\n}\n\npub struct Requester {\n    pub client: Client\u003csuper::TestRuntime\u003e,\n    nonces: HashMap\u003csuper::runtime::AccountId, u32\u003e,\n}\n\nimpl Requester {\n    pub fn new(client: Client\u003cTestRuntime\u003e) -\u003e Self {\n        Requester {\n            client,\n            nonces: HashMap::new(),\n        }\n    }\n\n    pub async fn with_sudo\u003cC: Call\u003cTestRuntime\u003e\u003e(\n        \u0026mut self,\n        call: C,\n    ) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n        let alice = AccountKeyring::Alice;\n        let mut signer = PairSigner::new(alice.pair()); //hardcode Alice as sudo signer\n        let sudo_nonce = self\n            .increment_nonce(AccountKeyring::Alice.to_account_id())\n            .await?;\n\n        signer.set_nonce(sudo_nonce);\n        let encoded = self.client.encode(call)?;\n        let sudo = SudoCall {\n            call: \u0026encoded,\n            _runtime: PhantomData,\n        };\n        let extrinsic = self.client.watch(sudo, \u0026signer).await?;\n        println!(\"with_sudo extrinsic {:?}\", extrinsic);\n        Ok(())\n    }\n\n    pub async fn increment_nonce(\n        \u0026mut self,\n        who: AccountId,\n    ) -\u003e Result\u003cu32, Box\u003cdyn std::error::Error\u003e\u003e {\n        let nonce = self\n            .nonces\n            .entry(who.clone())\n            .and_modify(|a| *a += 1)\n            .or_insert(\n                self.client\n                    .fetch_or_default(\n                        \u0026substrate_subxt::system::AccountStore { account_id: \u0026who },\n                        None,\n                    )\n                    .await\n                    .unwrap()\n                    .nonce,\n            );\n        println!(\"new nonce is {}\", nonce);\n        Ok(*nonce)\n    }\n}\n\npub type ChainCallSuccess = ExtrinsicSuccessWithFee\u003cTestRuntime, (AccountKey, Balance)\u003e;\npub type ChainCallResult = Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e;\n\npub async fn call_chain\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    account_key: AccountKey,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let nonce = { nonces.lock().await.get_nonce_and_inc(account_key) };\n    println!(\"Current nonce for {:?} is {}\", account_key, nonce);\n\n    let mut signer = PairSigner::new(account_key.key_pair());\n    signer.set_nonce(nonce);\n    let extrinsic = client.create_signed(call, \u0026signer).await?;\n    let decoder = TestRuntime::create_decoder(client.metadata().clone());\n    let success = client\n        .submit_and_watch_extrinsic_with_fee::\u003cBalance\u003e(extrinsic, decoder)\n        .await?;\n    let fee = success\n        .dispatch_info\n        .as_ref()\n        .map(|x| x.partial_fee)\n        .unwrap_or(0);\n\n    println!(\"incoming fee for {:?}: {}\", account_key, fee);\n\n    Ok(vec![ExtrinsicSuccessWithFee {\n        block: success.block,\n        extrinsic: success.extrinsic,\n        events: success.events,\n        dispatch_info: success.dispatch_info.map(|x| RuntimeDispatchInfo {\n            weight: x.weight,\n            class: x.class,\n            partial_fee: (account_key, x.partial_fee),\n        }),\n    }])\n}\n\npub async fn sudo_call_chain\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let encoded = client.encode(call)?;\n    let sudo_call = SudoCall {\n        call: \u0026encoded,\n        _runtime: PhantomData,\n    };\n\n    call_chain(client, nonces, AccountKeyring::Alice.into(), sudo_call).await\n}\n\npub async fn call_chain_unsigned\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let extrinsic = client.create_unsigned(call)?;\n    let decoder = TestRuntime::create_decoder(client.metadata().clone());\n    let success = client\n        .submit_and_watch_extrinsic(extrinsic, decoder)\n        .await?;\n\n    Ok(vec![ExtrinsicSuccessWithFee {\n        block: success.block,\n        extrinsic: success.extrinsic,\n        events: success.events,\n        dispatch_info: Option::None,\n    }])\n}\n\n#[macro_export]\nmacro_rules! join_chain_calls {\n    ( $($tokens:tt)* ) =\u003e {{\n        let join_result = try_join!($($tokens)*)?;\n\n        let vec_vec = tuple_to_vec!(join_result, $($tokens)*);\n\n        let flatten: Vec\u003c_\u003e = vec_vec.into_iter().flatten().collect();\n\n        flatten\n    }};\n}\n","traces":[{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","runtime.rs"],"content":"use super::{oracle, timestamp};\nuse crate::oracle::OracleEventsDecoder;\nuse crate::timestamp::TimestampEventsDecoder;\nuse common::Asset;\nuse sp_runtime::traits::{BlakeTwo256, IdentifyAccount, Verify};\nuse sp_runtime::{generic, MultiSignature, OpaqueExtrinsic};\nuse substrate_subxt::{\n    balances::{Balances, AccountData, BalancesEventsDecoder}, // needed for sign extra\n    extrinsic::DefaultExtra,\n    sudo::Sudo,\n    system::{System, SystemEventsDecoder},\n    EventsDecoder,\n    Metadata,\n    Runtime,\n};\nuse substrate_fixed::types::I64F64;\n\n#[derive(Clone, PartialEq, Debug)]\npub struct TestRuntime;\n\nimpl TestRuntime {\n    pub fn create_decoder(metadata: Metadata) -\u003e EventsDecoder\u003cTestRuntime\u003e {\n        let mut decoder = EventsDecoder::\u003cTestRuntime\u003e::new(metadata);\n        decoder.with_system();\n        decoder.with_balances();\n        decoder.with_oracle();\n        decoder.with_timestamp();\n\n        decoder\n    }\n}\n\nimpl Eq for TestRuntime {}\n\ntype Signature = MultiSignature;\n\nimpl Runtime for TestRuntime {\n    type Signature = Signature;\n    type Extra = DefaultExtra\u003cSelf\u003e;\n}\n\npub type AccountId = \u003c\u003cMultiSignature as Verify\u003e::Signer as IdentifyAccount\u003e::AccountId;\n\npub type Address = AccountId;\n\npub type FixedNumber = I64F64;\n\nimpl System for TestRuntime {\n    type Index = u32;\n    type BlockNumber = u32;\n    type Hash = sp_core::H256;\n    type Hashing = BlakeTwo256;\n    type AccountId = AccountId;\n    type Address = Self::AccountId;\n    type Header = generic::Header\u003cSelf::BlockNumber, BlakeTwo256\u003e;\n    type Extrinsic = OpaqueExtrinsic;\n    type AccountData = AccountData\u003c\u003cSelf as Balances\u003e::Balance\u003e;\n}\n\npub type Balance = u128;\n\nimpl Balances for TestRuntime {\n    type Balance = Balance;\n}\n\nimpl timestamp::Timestamp for TestRuntime {\n    type Moment = u64;\n}\n\nimpl Sudo for TestRuntime {}\n\nimpl oracle::Oracle for TestRuntime {\n    type Asset = Asset;\n    type Price = FixedNumber;\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test.rs"],"content":"use crate::key::{AccountKey, DevNonces};\nuse crate::runtime::TestRuntime;\nuse crate::keyring::{NonceManager, PubKey};\nuse futures::lock::Mutex;\nuse sp_arithmetic::FixedI64;\nuse std::sync::Arc;\nuse substrate_subxt::Client;\n\npub fn i128_to_u64(n: i128) -\u003e Option\u003cu64\u003e {\n    if n \u003c 0 || n \u003e u64::MAX as i128 {\n        return None;\n    }\n    Some(n as u64)\n}\n\npub fn i128_to_fixedi64(n: i128) -\u003e Option\u003cFixedI64\u003e {\n    if n \u003c i64::MIN as i128 || n \u003e i64::MAX as i128 {\n        return None;\n    }\n\n    Some(FixedI64::from_inner(n as i64))\n}\n\npub async fn init_nonce(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    account_key: AccountKey,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let mut nonces = nonces.lock().await;\n\n    if nonces.is_initialized(account_key) {\n        Ok(())\n    } else {\n        let id = account_key.acc_id();\n        let initial_nonce = client\n            .fetch_or_default(\n                \u0026substrate_subxt::system::AccountStore { account_id: \u0026id },\n                None,\n            )\n            .await\n            .unwrap()\n            .nonce;\n\n        nonces.init_nonce(account_key, initial_nonce);\n\n        println!(\"Initial nonce for {:?} is {}\", account_key, initial_nonce);\n\n        Ok(())\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_context.rs"],"content":"use super::runtime::AccountId;\nuse crate::key::{AccountKey, DevPubKey, DevPubKeyId, PubKeyStore};\nuse crate::oracle::PricePointsStoreExt;\nuse crate::runtime::{TestRuntime, FixedNumber};\nuse common::Asset;\nuse serde::ser::SerializeTupleVariant;\nuse serde::{Serialize, Serializer};\nuse sp_keyring::sr25519::Keyring;\nuse sp_runtime::{AccountId32, ModuleId};\nuse std::collections::HashMap;\nuse std::fmt::Debug;\nuse std::{cell::RefCell, hash::Hash, str::FromStr};\nuse substrate_subxt::Client;\n\n// Used for selfless traits implementations\nthread_local! {\n    static SAVED_TD: RefCell\u003cOption\u003cTestData\u003e\u003e = RefCell::new(Option::None)\n}\n\n#[derive(Debug, PartialEq, Eq, Ord, PartialOrd)]\npub enum AccountName {\n    Id(DevPubKeyId),\n    Unknown(AccountId),\n}\n\nimpl Serialize for AccountName {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self.clone() {\n            AccountName::Id(id) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountName\", 0, \"Id\", 1)?;\n                state.serialize_field(\u0026id)?;\n                state.end()\n            }\n            AccountName::Unknown(u) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"AccountName\", 1, \"Unknown\", 1)?;\n                state.serialize_field(\u0026u)?;\n                state.end()\n            }\n        }\n    }\n}\n\n#[derive(Debug, PartialEq, Serialize)]\npub struct MyTestData {\n    pub price_points: Vec\u003c(Asset, FixedNumber)\u003e,\n}\n\npub fn register_common_pub_keys(pub_key_store: \u0026mut PubKeyStore) {\n    for k in Keyring::iter() {\n        let acc_key = AccountKey::from(k);\n        pub_key_store.register(acc_key.into());\n    }\n\n    let known_modules: Vec\u003c_\u003e = vec![b\"eq/trsry\", b\"eq/prcho\", b\"eq/vestn\"]\n        .into_iter()\n        .map(|\u0026x| DevPubKey::from(ModuleId(x)))\n        .collect();\n\n    for m in known_modules {\n        pub_key_store.register(m);\n    }\n\n    let known_pub_keys: Vec\u003c_\u003e = vec![(\n        \"Alice//stash\",\n        \"0xbe5ddb1579b72e84524fc29e78609e3caf42e85aa118ebfe0b0ad404b5bdd25f\",\n    )]\n    .into_iter()\n    .map(|(name, acc_id_str)| {\n        DevPubKey::well_known(name, AccountId32::from_str(acc_id_str).unwrap())\n    })\n    .collect();\n\n    for k in known_pub_keys {\n        pub_key_store.register(k);\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct TestData {\n    pub price_points: HashMap\u003cAsset, FixedNumber\u003e,\n}\n\nimpl TestData {\n    pub fn new() -\u003e Self {\n        TestData {\n            price_points: HashMap::new(),\n        }\n    }\n\n    pub fn clear(\u0026mut self) {\n        self.price_points.clear();\n    }\n\n    pub fn to_static(\u0026self) {\n        SAVED_TD.with(|td_ref| {\n            td_ref.replace(Some(self.clone()));\n        });\n    }\n\n    pub fn get_static() -\u003e Self {\n        SAVED_TD.with(|td_ref| {\n            let result = td_ref.borrow().clone();\n            match result {\n                Some(td) =\u003e td,\n                None =\u003e panic!(\"Error during attempt to access LTS TestData - no data\"),\n            }\n        })\n    }\n}\n\npub const EPS: i64 = 1_0;\n\npub trait EqWithEps {\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool;\n}\n\nimpl EqWithEps for u64 {\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool {\n        (*self as i64 - *other as i64).abs() \u003c EPS\n    }\n}\n\nimpl\u003cK, V\u003e EqWithEps for HashMap\u003cK, V\u003e\nwhere\n    K: Eq + Hash,\n    V: EqWithEps,\n{\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool {\n        self.len() == other.len()\n            \u0026\u0026 self\n                .iter()\n                .all(|(k, v)| (*other).get(k).map_or(false, |v2| v.eq_with_eps(v2)))\n    }\n}\n\npub struct TestContext {}\n\nimpl TestContext {\n    pub async fn read_storage(\n        client: \u0026Client\u003cTestRuntime\u003e,\n    ) -\u003e Result\u003cTestData, Box\u003cdyn std::error::Error\u003e\u003e {\n        let mut data = TestData::new();\n\n        for asset in Asset::iterator() {\n            let price_points = client.price_points(*asset, Option::None).await;\n            data.price_points.insert(*asset, price_points.unwrap());\n        }\n        Ok(data)\n    }\n}\n","traces":[{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":36},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_scripts","mod.rs"],"content":"pub use super::*;\n\npub mod test_financial;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_scripts","test_financial.rs"],"content":"use super::DevNonces;\nuse crate::key::AccountKey;\nuse crate::oracle::SetPriceCall;\nuse crate::test::init_nonce;\nuse crate::test_context::TestContext;\nuse crate::{join_chain_calls, requester::call_chain, TestRuntime};\nuse crate::runtime::FixedNumber;\nuse common::Asset;\nuse futures::{lock::Mutex, try_join};\nuse integration_testing_macro::tuple_to_vec;\nuse sp_keyring::AccountKeyring;\nuse std::{marker::PhantomData, sync::Arc};\nuse substrate_subxt::Client;\n\npub async fn test_financial(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let alice_key = AccountKey::from(AccountKeyring::Alice);\n    init_nonce(client, nonces.clone(), alice_key).await?;\n\n    let btc_price = FixedNumber::from_num(20_000);\n    let eth_price = FixedNumber::from_num(250);\n    let eq_price = FixedNumber::from_num(25);\n    let eos_price = FixedNumber::from_num(3);\n\n    // ---------------------------------- Setting initial prices ----------------------------------\n\n    println!(\"Initial price set\");\n    join_chain_calls!(\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Btc,\n                value: btc_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eth,\n                value: eth_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eq,\n                value: eq_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eos,\n                value: eos_price,\n                _runtime: PhantomData,\n            },\n        ),\n    );\n\n    let initial_state = TestContext::read_storage(client).await?;\n    let curr_btc = initial_state.price_points.get(\u0026Asset::Btc).unwrap();\n    let curr_eth = initial_state.price_points.get(\u0026Asset::Eth).unwrap();\n    let curr_eq = initial_state.price_points.get(\u0026Asset::Eq).unwrap();\n    let curr_eos = initial_state.price_points.get(\u0026Asset::Eos).unwrap();\n\n    assert!(curr_btc == \u0026btc_price);\n    assert!(curr_eth == \u0026eth_price);\n    assert!(curr_eq == \u0026eq_price);\n    assert!(curr_eos == \u0026eos_price);\n\n    // -------------------------------- Iteratively changing prices --------------------------------\n\n    let iterations: i64 = 30;\n\n    for i in 1..=iterations {\n        // price_q slowly increases from ~1 to 1.5\n        let price_q = FixedNumber::from_num(1)\n            + (FixedNumber::from_num(i) / FixedNumber::from_num(iterations * 2));\n\n        println!(\"Setting prices, iteration #{}\", i);\n        join_chain_calls!(\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Btc,\n                    value: btc_price * price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eth,\n                    value: eth_price / price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eq,\n                    value: eq_price * price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eos,\n                    value: eos_price / price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n        );\n\n        let iteration_state = TestContext::read_storage(client).await?;\n        let curr_btc = iteration_state.price_points.get(\u0026Asset::Btc).unwrap();\n        let curr_eth = iteration_state.price_points.get(\u0026Asset::Eth).unwrap();\n        let curr_eq = iteration_state.price_points.get(\u0026Asset::Eq).unwrap();\n        let curr_eos = iteration_state.price_points.get(\u0026Asset::Eos).unwrap();\n    \n        assert!(curr_btc == \u0026(btc_price * price_q));\n        assert!(curr_eth == \u0026(eth_price / price_q));\n        assert!(curr_eq == \u0026(eq_price * price_q));\n        assert!(curr_eos == \u0026(eos_price / price_q));\n    }\n\n    // -----------------------------------  -----------------------------------\n\n    println!(\"Assertion successful, test passed\");\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","timestamp.rs"],"content":"use codec::Encode;\nuse core::marker::PhantomData;\nuse frame_support::Parameter;\nuse sp_runtime::traits::{AtLeast32Bit, Member, Scale};\nuse std::fmt::Debug;\nuse substrate_subxt::system::{System, SystemEventsDecoder};\nuse substrate_subxt_proc_macro::{module, Store};\n\n#[module]\npub trait Timestamp: System {\n    type Moment: Parameter\n        + Default\n        + AtLeast32Bit\n        + Member\n        + Scale\u003cSelf::BlockNumber, Output = Self::Moment\u003e\n        + Copy;\n}\n\n#[derive(Clone, Debug, Eq, PartialEq, Store, Encode)]\npub struct NowStore\u003cT: Timestamp\u003e {\n    #[store(returns = T::Moment)]\n    /// Runtime marker.\n    pub _runtime: PhantomData\u003cT\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","build.rs"],"content":"use substrate_build_script_utils::{generate_cargo_keys, rerun_if_git_head_changed};\n\nfn main() {\n\tgenerate_cargo_keys();\n\n\trerun_if_git_head_changed();\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","chain_spec.rs"],"content":"use sp_core::{Pair, Public, sr25519};\nuse node_template_runtime::{\n\tAccountId, AuraConfig, BalancesConfig, GenesisConfig, GrandpaConfig,\n\tSudoConfig, SystemConfig, WASM_BINARY, Signature, OracleConfig,\n\tFixedNumber, FinancialConfig,\n};\nuse sp_consensus_aura::sr25519::AuthorityId as AuraId;\nuse sp_finality_grandpa::AuthorityId as GrandpaId;\nuse sp_runtime::traits::{Verify, IdentifyAccount};\nuse sc_service::ChainType;\nuse common::Asset;\nuse substrate_fixed::traits::LossyFrom;\n\n// The URL for the telemetry server.\n// const STAGING_TELEMETRY_URL: \u0026str = \"wss://telemetry.polkadot.io/submit/\";\n\n/// Specialized `ChainSpec`. This is a specialization of the general Substrate ChainSpec type.\npub type ChainSpec = sc_service::GenericChainSpec\u003cGenesisConfig\u003e;\n\n/// Generate a crypto pair from seed.\npub fn get_from_seed\u003cTPublic: Public\u003e(seed: \u0026str) -\u003e \u003cTPublic::Pair as Pair\u003e::Public {\n\tTPublic::Pair::from_string(\u0026format!(\"//{}\", seed), None)\n\t\t.expect(\"static values are valid; qed\")\n\t\t.public()\n}\n\ntype AccountPublic = \u003cSignature as Verify\u003e::Signer;\n\n/// Generate an account ID from seed.\npub fn get_account_id_from_seed\u003cTPublic: Public\u003e(seed: \u0026str) -\u003e AccountId where\n\tAccountPublic: From\u003c\u003cTPublic::Pair as Pair\u003e::Public\u003e\n{\n\tAccountPublic::from(get_from_seed::\u003cTPublic\u003e(seed)).into_account()\n}\n\n/// Generate an Aura authority key.\npub fn authority_keys_from_seed(s: \u0026str) -\u003e (AuraId, GrandpaId) {\n\t(\n\t\tget_from_seed::\u003cAuraId\u003e(s),\n\t\tget_from_seed::\u003cGrandpaId\u003e(s),\n\t)\n}\n\npub fn development_config() -\u003e Result\u003cChainSpec, String\u003e {\n\tlet wasm_binary = WASM_BINARY.ok_or(\"Development wasm binary not available\".to_string())?;\n\n\tOk(ChainSpec::from_genesis(\n\t\t// Name\n\t\t\"Development\",\n\t\t// ID\n\t\t\"dev\",\n\t\tChainType::Development,\n\t\tmove || testnet_genesis(\n\t\t\twasm_binary,\n\t\t\t// Initial PoA authorities\n\t\t\tvec![\n\t\t\t\tauthority_keys_from_seed(\"Alice\"),\n\t\t\t],\n\t\t\t// Sudo account\n\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t// Pre-funded accounts\n\t\t\tvec![\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob//stash\"),\n\t\t\t],\n\t\t\ttrue,\n\t\t\tvec![\n\t\t\t\t(Asset::Usd, 1),\n\t\t\t\t(Asset::Eq, 25),\n\t\t\t\t(Asset::Eth, 250),\n\t\t\t\t(Asset::Btc, 10_000),\n\t\t\t\t(Asset::Eos, 3),\n\t\t\t].into_iter().map(|(a, x)| (a, FixedNumber::lossy_from(x))).collect(),\n\t\t),\n\t\t// Bootnodes\n\t\tvec![],\n\t\t// Telemetry\n\t\tNone,\n\t\t// Protocol ID\n\t\tNone,\n\t\t// Properties\n\t\tNone,\n\t\t// Extensions\n\t\tNone,\n\t))\n}\n\npub fn local_testnet_config() -\u003e Result\u003cChainSpec, String\u003e {\n\tlet wasm_binary = WASM_BINARY.ok_or(\"Development wasm binary not available\".to_string())?;\n\n\tOk(ChainSpec::from_genesis(\n\t\t// Name\n\t\t\"Local Testnet\",\n\t\t// ID\n\t\t\"local_testnet\",\n\t\tChainType::Local,\n\t\tmove || testnet_genesis(\n\t\t\twasm_binary,\n\t\t\t// Initial PoA authorities\n\t\t\tvec![\n\t\t\t\tauthority_keys_from_seed(\"Alice\"),\n\t\t\t\tauthority_keys_from_seed(\"Bob\"),\n\t\t\t],\n\t\t\t// Sudo account\n\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t// Pre-funded accounts\n\t\t\tvec![\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Charlie\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Dave\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Eve\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Ferdie\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Charlie//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Dave//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Eve//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Ferdie//stash\"),\n\t\t\t],\n\t\t\ttrue,\n\t\t\tvec![\n\t\t\t\t(Asset::Usd, 1),\n\t\t\t\t(Asset::Eq, 25),\n\t\t\t\t(Asset::Eth, 250),\n\t\t\t\t(Asset::Btc, 10_000),\n\t\t\t\t(Asset::Eos, 3),\n\t\t\t].into_iter().map(|(a, x)| (a, FixedNumber::lossy_from(x))).collect(),\n\t\t),\n\t\t// Bootnodes\n\t\tvec![],\n\t\t// Telemetry\n\t\tNone,\n\t\t// Protocol ID\n\t\tNone,\n\t\t// Properties\n\t\tNone,\n\t\t// Extensions\n\t\tNone,\n\t))\n}\n\n/// Configure initial storage state for FRAME modules.\nfn testnet_genesis(\n\twasm_binary: \u0026[u8],\n\tinitial_authorities: Vec\u003c(AuraId, GrandpaId)\u003e,\n\troot_key: AccountId,\n\tendowed_accounts: Vec\u003cAccountId\u003e,\n\t_enable_println: bool,\n\tprices: Vec\u003c(Asset, FixedNumber)\u003e,\n) -\u003e GenesisConfig {\n\tGenesisConfig {\n\t\tframe_system: Some(SystemConfig {\n\t\t\t// Add Wasm runtime to storage.\n\t\t\tcode: wasm_binary.to_vec(),\n\t\t\tchanges_trie_config: Default::default(),\n\t\t}),\n\t\tpallet_balances: Some(BalancesConfig {\n\t\t\t// Configure endowed accounts with initial balance of 1 \u003c\u003c 60.\n\t\t\tbalances: endowed_accounts.iter().cloned().map(|k|(k, 1 \u003c\u003c 60)).collect(),\n\t\t}),\n\t\tpallet_aura: Some(AuraConfig {\n\t\t\tauthorities: initial_authorities.iter().map(|x| (x.0.clone())).collect(),\n\t\t}),\n\t\tpallet_grandpa: Some(GrandpaConfig {\n\t\t\tauthorities: initial_authorities.iter().map(|x| (x.1.clone(), 1)).collect(),\n\t\t}),\n\t\tpallet_sudo: Some(SudoConfig {\n\t\t\t// Assign network admin rights.\n\t\t\tkey: root_key,\n\t\t}),\n\t\toracle: Some(OracleConfig {\n\t\t\tprices: prices.iter().cloned().collect(),\n\t\t}),\n\t\tfinancial_pallet: Some(FinancialConfig {\n\t\t\tprices: prices.iter().cloned().map(|(a, p)| (a, vec![p])).collect(),\n\t\t}),\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","cli.rs"],"content":"use sc_cli::{RunCmd, Subcommand};\nuse structopt::StructOpt;\n\n#[derive(Debug, StructOpt)]\npub struct Cli {\n\t#[structopt(subcommand)]\n\tpub subcommand: Option\u003cSubcommand\u003e,\n\n\t#[structopt(flatten)]\n\tpub run: RunCmd,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","command.rs"],"content":"// This file is part of Substrate.\n\n// Copyright (C) 2017-2020 Parity Technologies (UK) Ltd.\n// SPDX-License-Identifier: Apache-2.0\n\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// \thttp://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::chain_spec;\nuse crate::cli::Cli;\nuse crate::service;\nuse sc_cli::{SubstrateCli, RuntimeVersion, Role, ChainSpec};\nuse sc_service::PartialComponents;\nuse crate::service::new_partial;\n\nimpl SubstrateCli for Cli {\n\tfn impl_name() -\u003e String {\n\t\t\"Substrate Node\".into()\n\t}\n\n\tfn impl_version() -\u003e String {\n\t\tenv!(\"SUBSTRATE_CLI_IMPL_VERSION\").into()\n\t}\n\n\tfn description() -\u003e String {\n\t\tenv!(\"CARGO_PKG_DESCRIPTION\").into()\n\t}\n\n\tfn author() -\u003e String {\n\t\tenv!(\"CARGO_PKG_AUTHORS\").into()\n\t}\n\n\tfn support_url() -\u003e String {\n\t\t\"support.anonymous.an\".into()\n\t}\n\n\tfn copyright_start_year() -\u003e i32 {\n\t\t2017\n\t}\n\n\tfn load_spec(\u0026self, id: \u0026str) -\u003e Result\u003cBox\u003cdyn sc_service::ChainSpec\u003e, String\u003e {\n\t\tOk(match id {\n\t\t\t\"dev\" =\u003e Box::new(chain_spec::development_config()?),\n\t\t\t\"\" | \"local\" =\u003e Box::new(chain_spec::local_testnet_config()?),\n\t\t\tpath =\u003e Box::new(chain_spec::ChainSpec::from_json_file(\n\t\t\t\tstd::path::PathBuf::from(path),\n\t\t\t)?),\n\t\t})\n\t}\n\n\tfn native_runtime_version(_: \u0026Box\u003cdyn ChainSpec\u003e) -\u003e \u0026'static RuntimeVersion {\n\t\t\u0026node_template_runtime::VERSION\n\t}\n}\n\n/// Parse and run command line arguments\npub fn run() -\u003e sc_cli::Result\u003c()\u003e {\n\tlet cli = Cli::from_args();\n\n\tmatch cli.subcommand {\n\t\tSome(ref subcommand) =\u003e {\n\t\t\tlet runner = cli.create_runner(subcommand)?;\n\t\t\trunner.run_subcommand(subcommand, |config| {\n\t\t\t\tlet PartialComponents { client, backend, task_manager, import_queue, .. }\n\t\t\t\t\t= new_partial(\u0026config)?;\n\t\t\t\tOk((client, backend, import_queue, task_manager))\n\t\t\t})\n\t\t}\n\t\tNone =\u003e {\n\t\t\tlet runner = cli.create_runner(\u0026cli.run)?;\n\t\t\trunner.run_node_until_exit(|config| match config.role {\n\t\t\t\tRole::Light =\u003e service::new_light(config),\n\t\t\t\t_ =\u003e service::new_full(config),\n\t\t\t})\n\t\t}\n\t}\n}\n","traces":[{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":20},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","lib.rs"],"content":"pub mod chain_spec;\npub mod service;\npub mod rpc;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","main.rs"],"content":"//! Substrate Node Template CLI library.\n#![warn(missing_docs)]\n\nmod chain_spec;\n#[macro_use]\nmod service;\nmod cli;\nmod command;\nmod rpc;\n\nfn main() -\u003e sc_cli::Result\u003c()\u003e {\n\tcommand::run()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","rpc.rs"],"content":"//! A collection of node-specific RPC methods.\n//! Substrate provides the `sc-rpc` crate, which defines the core RPC layer\n//! used by Substrate nodes. This file extends those RPC definitions with\n//! capabilities that are specific to this project's runtime configuration.\n\n#![warn(missing_docs)]\n\nuse std::sync::Arc;\n\nuse node_template_runtime::{opaque::Block, AccountId, Balance, Index};\nuse sp_api::ProvideRuntimeApi;\nuse sp_blockchain::{Error as BlockChainError, HeaderMetadata, HeaderBackend};\nuse sp_block_builder::BlockBuilder;\npub use sc_rpc_api::DenyUnsafe;\nuse sp_transaction_pool::TransactionPool;\n\n\n/// Full client dependencies.\npub struct FullDeps\u003cC, P\u003e {\n\t/// The client instance to use.\n\tpub client: Arc\u003cC\u003e,\n\t/// Transaction pool instance.\n\tpub pool: Arc\u003cP\u003e,\n\t/// Whether to deny unsafe calls\n\tpub deny_unsafe: DenyUnsafe,\n}\n\n/// Instantiate all full RPC extensions.\npub fn create_full\u003cC, P\u003e(\n\tdeps: FullDeps\u003cC, P\u003e,\n) -\u003e jsonrpc_core::IoHandler\u003csc_rpc::Metadata\u003e where\n\tC: ProvideRuntimeApi\u003cBlock\u003e,\n\tC: HeaderBackend\u003cBlock\u003e + HeaderMetadata\u003cBlock, Error=BlockChainError\u003e + 'static,\n\tC: Send + Sync + 'static,\n\tC::Api: substrate_frame_rpc_system::AccountNonceApi\u003cBlock, AccountId, Index\u003e,\n\tC::Api: pallet_transaction_payment_rpc::TransactionPaymentRuntimeApi\u003cBlock, Balance\u003e,\n\tC::Api: BlockBuilder\u003cBlock\u003e,\n\tP: TransactionPool + 'static,\n{\n\tuse substrate_frame_rpc_system::{FullSystem, SystemApi};\n\tuse pallet_transaction_payment_rpc::{TransactionPayment, TransactionPaymentApi};\n\n\tlet mut io = jsonrpc_core::IoHandler::default();\n\tlet FullDeps {\n\t\tclient,\n\t\tpool,\n\t\tdeny_unsafe,\n\t} = deps;\n\n\tio.extend_with(\n\t\tSystemApi::to_delegate(FullSystem::new(client.clone(), pool, deny_unsafe))\n\t);\n\n\tio.extend_with(\n\t\tTransactionPaymentApi::to_delegate(TransactionPayment::new(client.clone()))\n\t);\n\n\t// Extend this RPC with a custom API by using the following syntax.\n\t// `YourRpcStruct` should have a reference to a client, which is needed\n\t// to call into the runtime.\n\t// `io.extend_with(YourRpcTrait::to_delegate(YourRpcStruct::new(ReferenceToClient, ...)));`\n\n\tio\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","service.rs"],"content":"//! Service and ServiceFactory implementation. Specialized wrapper over substrate service.\n\nuse std::sync::Arc;\nuse std::time::Duration;\nuse sc_client_api::{ExecutorProvider, RemoteBackend};\nuse node_template_runtime::{self, opaque::Block, RuntimeApi};\nuse sc_service::{error::Error as ServiceError, Configuration, TaskManager};\nuse sp_inherents::InherentDataProviders;\nuse sc_executor::native_executor_instance;\npub use sc_executor::NativeExecutor;\nuse sp_consensus_aura::sr25519::{AuthorityPair as AuraPair};\nuse sc_finality_grandpa::{FinalityProofProvider as GrandpaFinalityProofProvider, SharedVoterState};\n\n// Our native executor instance.\nnative_executor_instance!(\n\tpub Executor,\n\tnode_template_runtime::api::dispatch,\n\tnode_template_runtime::native_version,\n);\n\ntype FullClient = sc_service::TFullClient\u003cBlock, RuntimeApi, Executor\u003e;\ntype FullBackend = sc_service::TFullBackend\u003cBlock\u003e;\ntype FullSelectChain = sc_consensus::LongestChain\u003cFullBackend, Block\u003e;\n\npub fn new_partial(config: \u0026Configuration) -\u003e Result\u003csc_service::PartialComponents\u003c\n\tFullClient, FullBackend, FullSelectChain,\n\tsp_consensus::DefaultImportQueue\u003cBlock, FullClient\u003e,\n\tsc_transaction_pool::FullPool\u003cBlock, FullClient\u003e,\n\t(\n\t\tsc_consensus_aura::AuraBlockImport\u003c\n\t\t\tBlock,\n\t\t\tFullClient,\n\t\t\tsc_finality_grandpa::GrandpaBlockImport\u003cFullBackend, Block, FullClient, FullSelectChain\u003e,\n\t\t\tAuraPair\n\t\t\u003e,\n\t\tsc_finality_grandpa::LinkHalf\u003cBlock, FullClient, FullSelectChain\u003e\n\t)\n\u003e, ServiceError\u003e {\n\tlet inherent_data_providers = sp_inherents::InherentDataProviders::new();\n\n\tlet (client, backend, keystore, task_manager) =\n\t\tsc_service::new_full_parts::\u003cBlock, RuntimeApi, Executor\u003e(\u0026config)?;\n\tlet client = Arc::new(client);\n\n\tlet select_chain = sc_consensus::LongestChain::new(backend.clone());\n\n\tlet transaction_pool = sc_transaction_pool::BasicPool::new_full(\n\t\tconfig.transaction_pool.clone(),\n\t\tconfig.prometheus_registry(),\n\t\ttask_manager.spawn_handle(),\n\t\tclient.clone(),\n\t);\n\n\tlet (grandpa_block_import, grandpa_link) = sc_finality_grandpa::block_import(\n\t\tclient.clone(), \u0026(client.clone() as Arc\u003c_\u003e), select_chain.clone(),\n\t)?;\n\n\tlet aura_block_import = sc_consensus_aura::AuraBlockImport::\u003c_, _, _, AuraPair\u003e::new(\n\t\tgrandpa_block_import.clone(), client.clone(),\n\t);\n\n\tlet import_queue = sc_consensus_aura::import_queue::\u003c_, _, _, AuraPair, _, _\u003e(\n\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\taura_block_import.clone(),\n\t\tSome(Box::new(grandpa_block_import.clone())),\n\t\tNone,\n\t\tclient.clone(),\n\t\tinherent_data_providers.clone(),\n\t\t\u0026task_manager.spawn_handle(),\n\t\tconfig.prometheus_registry(),\n\t\tsp_consensus::CanAuthorWithNativeVersion::new(client.executor().clone()),\n\t)?;\n\n\tOk(sc_service::PartialComponents {\n\t\tclient, backend, task_manager, import_queue, keystore, select_chain, transaction_pool,\n\t\tinherent_data_providers,\n\t\tother: (aura_block_import, grandpa_link),\n\t})\n}\n\n/// Builds a new service for a full client.\npub fn new_full(config: Configuration) -\u003e Result\u003cTaskManager, ServiceError\u003e {\n\tlet sc_service::PartialComponents {\n\t\tclient, backend, mut task_manager, import_queue, keystore, select_chain, transaction_pool,\n\t\tinherent_data_providers,\n\t\tother: (block_import, grandpa_link),\n\t} = new_partial(\u0026config)?;\n\n\tlet finality_proof_provider =\n\t\tGrandpaFinalityProofProvider::new_for_service(backend.clone(), client.clone());\n\n\tlet (network, network_status_sinks, system_rpc_tx, network_starter) =\n\t\tsc_service::build_network(sc_service::BuildNetworkParams {\n\t\t\tconfig: \u0026config,\n\t\t\tclient: client.clone(),\n\t\t\ttransaction_pool: transaction_pool.clone(),\n\t\t\tspawn_handle: task_manager.spawn_handle(),\n\t\t\timport_queue,\n\t\t\ton_demand: None,\n\t\t\tblock_announce_validator_builder: None,\n\t\t\tfinality_proof_request_builder: None,\n\t\t\tfinality_proof_provider: Some(finality_proof_provider.clone()),\n\t\t})?;\n\n\tif config.offchain_worker.enabled {\n\t\tsc_service::build_offchain_workers(\n\t\t\t\u0026config, backend.clone(), task_manager.spawn_handle(), client.clone(), network.clone(),\n\t\t);\n\t}\n\n\tlet role = config.role.clone();\n\tlet force_authoring = config.force_authoring;\n\tlet name = config.network.node_name.clone();\n\tlet enable_grandpa = !config.disable_grandpa;\n\tlet prometheus_registry = config.prometheus_registry().cloned();\n\tlet telemetry_connection_sinks = sc_service::TelemetryConnectionSinks::default();\n\n\tlet rpc_extensions_builder = {\n\t\tlet client = client.clone();\n\t\tlet pool = transaction_pool.clone();\n\n\t\tBox::new(move |deny_unsafe, _| {\n\t\t\tlet deps = crate::rpc::FullDeps {\n\t\t\t\tclient: client.clone(),\n\t\t\t\tpool: pool.clone(),\n\t\t\t\tdeny_unsafe,\n\t\t\t};\n\n\t\t\tcrate::rpc::create_full(deps)\n\t\t})\n\t};\n\n\tsc_service::spawn_tasks(sc_service::SpawnTasksParams {\n\t\tnetwork: network.clone(),\n\t\tclient: client.clone(),\n\t\tkeystore: keystore.clone(),\n\t\ttask_manager: \u0026mut task_manager,\n\t\ttransaction_pool: transaction_pool.clone(),\n\t\ttelemetry_connection_sinks: telemetry_connection_sinks.clone(),\n\t\trpc_extensions_builder: rpc_extensions_builder,\n\t\ton_demand: None,\n\t\tremote_blockchain: None,\n\t\tbackend, network_status_sinks, system_rpc_tx, config,\n\t})?;\n\n\tif role.is_authority() {\n\t\tlet proposer = sc_basic_authorship::ProposerFactory::new(\n\t\t\tclient.clone(),\n\t\t\ttransaction_pool,\n\t\t\tprometheus_registry.as_ref(),\n\t\t);\n\n\t\tlet can_author_with =\n\t\t\tsp_consensus::CanAuthorWithNativeVersion::new(client.executor().clone());\n\n\t\tlet aura = sc_consensus_aura::start_aura::\u003c_, _, _, _, _, AuraPair, _, _, _\u003e(\n\t\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\t\tclient.clone(),\n\t\t\tselect_chain,\n\t\t\tblock_import,\n\t\t\tproposer,\n\t\t\tnetwork.clone(),\n\t\t\tinherent_data_providers.clone(),\n\t\t\tforce_authoring,\n\t\t\tkeystore.clone(),\n\t\t\tcan_author_with,\n\t\t)?;\n\n\t\t// the AURA authoring task is considered essential, i.e. if it\n\t\t// fails we take down the service with it.\n\t\ttask_manager.spawn_essential_handle().spawn_blocking(\"aura\", aura);\n\t}\n\n\t// if the node isn't actively participating in consensus then it doesn't\n\t// need a keystore, regardless of which protocol we use below.\n\tlet keystore = if role.is_authority() {\n\t\tSome(keystore as sp_core::traits::BareCryptoStorePtr)\n\t} else {\n\t\tNone\n\t};\n\n\tlet grandpa_config = sc_finality_grandpa::Config {\n\t\t// FIXME #1578 make this available through chainspec\n\t\tgossip_duration: Duration::from_millis(333),\n\t\tjustification_period: 512,\n\t\tname: Some(name),\n\t\tobserver_enabled: false,\n\t\tkeystore,\n\t\tis_authority: role.is_network_authority(),\n\t};\n\n\tif enable_grandpa {\n\t\t// start the full GRANDPA voter\n\t\t// NOTE: non-authorities could run the GRANDPA observer protocol, but at\n\t\t// this point the full voter should provide better guarantees of block\n\t\t// and vote data availability than the observer. The observer has not\n\t\t// been tested extensively yet and having most nodes in a network run it\n\t\t// could lead to finality stalls.\n\t\tlet grandpa_config = sc_finality_grandpa::GrandpaParams {\n\t\t\tconfig: grandpa_config,\n\t\t\tlink: grandpa_link,\n\t\t\tnetwork,\n\t\t\tinherent_data_providers,\n\t\t\ttelemetry_on_connect: Some(telemetry_connection_sinks.on_connect_stream()),\n\t\t\tvoting_rule: sc_finality_grandpa::VotingRulesBuilder::default().build(),\n\t\t\tprometheus_registry,\n\t\t\tshared_voter_state: SharedVoterState::empty(),\n\t\t};\n\n\t\t// the GRANDPA voter task is considered infallible, i.e.\n\t\t// if it fails we take down the service with it.\n\t\ttask_manager.spawn_essential_handle().spawn_blocking(\n\t\t\t\"grandpa-voter\",\n\t\t\tsc_finality_grandpa::run_grandpa_voter(grandpa_config)?\n\t\t);\n\t} else {\n\t\tsc_finality_grandpa::setup_disabled_grandpa(\n\t\t\tclient,\n\t\t\t\u0026inherent_data_providers,\n\t\t\tnetwork,\n\t\t)?;\n\t}\n\n\tnetwork_starter.start_network();\n\tOk(task_manager)\n}\n\n/// Builds a new service for a light client.\npub fn new_light(config: Configuration) -\u003e Result\u003cTaskManager, ServiceError\u003e {\n\tlet (client, backend, keystore, mut task_manager, on_demand) =\n\t\tsc_service::new_light_parts::\u003cBlock, RuntimeApi, Executor\u003e(\u0026config)?;\n\n\tlet transaction_pool = Arc::new(sc_transaction_pool::BasicPool::new_light(\n\t\tconfig.transaction_pool.clone(),\n\t\tconfig.prometheus_registry(),\n\t\ttask_manager.spawn_handle(),\n\t\tclient.clone(),\n\t\ton_demand.clone(),\n\t));\n\n\tlet grandpa_block_import = sc_finality_grandpa::light_block_import(\n\t\tclient.clone(), backend.clone(), \u0026(client.clone() as Arc\u003c_\u003e),\n\t\tArc::new(on_demand.checker().clone()) as Arc\u003c_\u003e,\n\t)?;\n\tlet finality_proof_import = grandpa_block_import.clone();\n\tlet finality_proof_request_builder =\n\t\tfinality_proof_import.create_finality_proof_request_builder();\n\n\tlet import_queue = sc_consensus_aura::import_queue::\u003c_, _, _, AuraPair, _, _\u003e(\n\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\tgrandpa_block_import,\n\t\tNone,\n\t\tSome(Box::new(finality_proof_import)),\n\t\tclient.clone(),\n\t\tInherentDataProviders::new(),\n\t\t\u0026task_manager.spawn_handle(),\n\t\tconfig.prometheus_registry(),\n\t\tsp_consensus::NeverCanAuthor,\n\t)?;\n\n\tlet finality_proof_provider =\n\t\tGrandpaFinalityProofProvider::new_for_service(backend.clone(), client.clone());\n\n\tlet (network, network_status_sinks, system_rpc_tx, network_starter) =\n\t\tsc_service::build_network(sc_service::BuildNetworkParams {\n\t\t\tconfig: \u0026config,\n\t\t\tclient: client.clone(),\n\t\t\ttransaction_pool: transaction_pool.clone(),\n\t\t\tspawn_handle: task_manager.spawn_handle(),\n\t\t\timport_queue,\n\t\t\ton_demand: Some(on_demand.clone()),\n\t\t\tblock_announce_validator_builder: None,\n\t\t\tfinality_proof_request_builder: Some(finality_proof_request_builder),\n\t\t\tfinality_proof_provider: Some(finality_proof_provider),\n\t\t})?;\n\n\tif config.offchain_worker.enabled {\n\t\tsc_service::build_offchain_workers(\n\t\t\t\u0026config, backend.clone(), task_manager.spawn_handle(), client.clone(), network.clone(),\n\t\t);\n\t}\n\n\tsc_service::spawn_tasks(sc_service::SpawnTasksParams {\n\t\tremote_blockchain: Some(backend.remote_blockchain()),\n\t\ttransaction_pool,\n\t\ttask_manager: \u0026mut task_manager,\n\t\ton_demand: Some(on_demand),\n\t\trpc_extensions_builder: Box::new(|_, _| ()),\n\t\ttelemetry_connection_sinks: sc_service::TelemetryConnectionSinks::default(),\n\t\tconfig,\n\t\tclient,\n\t\tkeystore,\n\t\tbackend,\n\t\tnetwork,\n\t\tnetwork_status_sinks,\n\t\tsystem_rpc_tx,\n\t })?;\n\n\t network_starter.start_network();\n\n\t Ok(task_manager)\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","lib.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n//! # Financial Pallet Module\n//! ## Overview\n//!\n//! Equilibrium's Financial Pallet is an open-source substrate module that subscribes to external\n//! price feed/oracle, gathers asset prices and calculates financial metrics based on the\n//! information collected.\n//!\n//! ## Genesis Config\n//! \n//! You can provide initial price logs for the assets using [`GenesisConfig`](./struct.GenesisConfig.html).\n\n#![warn(missing_docs)]\n#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse frame_support::{decl_module, decl_storage, decl_event, decl_error, ensure, dispatch};\nuse frame_support::traits::{Get, UnixTime};\nuse frame_support::codec::{Codec, Decode, Encode};\nuse frame_support::dispatch::{DispatchError, Parameter};\nuse frame_system::ensure_signed;\nuse financial_primitives::capvec::CapVec;\nuse financial_primitives::{OnPriceSet, IntoTypeIterator};\nuse core::time::Duration;\nuse sp_std::cmp::min;\nuse sp_std::prelude::Vec;\nuse sp_std::convert::TryInto;\nuse sp_std::iter::Iterator;\nuse sp_std::vec;\nuse substrate_fixed::transcendental::sqrt;\nuse substrate_fixed::traits::{FixedSigned, ToFixed};\nuse core::ops::{AddAssign, BitOrAssign, ShlAssign};\nuse math::{ConstType, MathError, MathResult, diff, squared, decay, last_recurrent_ewma, exp_vola, calc_return_func, calc_return_iter, sum, mean, demeaned, regular_vola, mul, regular_corr, exp_corr};\n\npub use math::{CalcReturnType, CalcVolatilityType, CalcCorrelationType};\n\nmod math;\n\n#[cfg(test)]\nmod mock;\n\n#[cfg(test)]\nmod tests;\n\n/// The module configuration trait.\npub trait Trait: frame_system::Trait {\n    /// The overarching event type.\n\ttype Event: From\u003cEvent\u003cSelf\u003e\u003e + Into\u003c\u003cSelf as frame_system::Trait\u003e::Event\u003e;\n    /// Implementation for the current unix timestamp provider. The \n    /// [`pallet_timestamp`](https://crates.parity.io/pallet_timestamp/index.html) is\n    /// right choice in most cases.\n\ttype UnixTime: UnixTime;\n    /// Number of price data points stored and used for calculations.\n\ttype PriceCount: Get\u003cu32\u003e;\n    /// The period of the collected prices in minutes.\n\ttype PricePeriod: Get\u003cu32\u003e;\n    /// System wide type for representing various assets such as BTC, ETH, EOS, etc.\n\ttype Asset: Parameter + Copy + IntoTypeIterator;\n    /// Primitive integer type that [`FixedNumber`](#associatedtype.FixedNumber) based on.\n\ttype FixedNumberBits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign;\n    /// Fixed point data type with a required precision that used for all financial calculations.\n\ttype FixedNumber: Clone + Copy + Codec + FixedSigned\u003cBits = Self::FixedNumberBits\u003e + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e;\n    /// System wide type for representing price values. It must be convertable to and\n    /// from [`FixedNumber`](#associatedtype.FixedNumber).\n\ttype Price: Parameter + Clone + From\u003cSelf::FixedNumber\u003e + Into\u003cSelf::FixedNumber\u003e;\n}\n\n/// Information about latest price update.\n#[derive(Encode, Decode, Clone, Default, PartialEq, Eq, Debug)]\npub struct PriceUpdate\u003cP\u003e {\n    /// Timestamp of the price period start for the latest price received.\n\tpub period_start: Duration,\n    /// Latest price timestamp.\n\tpub time: Duration,\n    /// Latest price value.\n\tpub price: P,\n}\n\nimpl\u003cP\u003e PriceUpdate\u003cP\u003e {\n\t#[cfg(test)]\n\tfn new(period_start: Duration, time: Duration, price: P) -\u003e PriceUpdate\u003cP\u003e {\n\t\tPriceUpdate {\n\t\t\tperiod_start,\n\t\t\ttime,\n\t\t\tprice,\n\t\t}\n\t}\n}\n\n/// Financial metrics for asset\n#[derive(Encode, Decode, Clone, Default, PartialEq, Eq, Debug)]\npub struct FinancialMetrics\u003cA, P\u003e {\n    /// Timestamp of when last data point was updated\n    timestamp: Duration,\n    /// Log returns\n    log_returns: Vec\u003cP\u003e,\n    /// Volatility\n    volatility: P,\n    /// Correlations for all assets\n    correlations: Vec\u003c(A, P)\u003e,\n}\n\ndecl_storage! {\n\ttrait Store for Module\u003cT: Trait\u003e as FinancialModule {\n        /// Latest price updates on per asset basis.\n\t\tUpdates get(fn updates): map hasher(blake2_128_concat) T::Asset =\u003e Option\u003cPriceUpdate\u003cT::FixedNumber\u003e\u003e;\n        /// Price log on per asset basis.\n\t\tPrices get(fn prices): map hasher(blake2_128_concat) T::Asset =\u003e CapVec\u003cT::FixedNumber\u003e;\n        /// Financial metrics on per asset basis.\n\t\tMetrics get(fn metrics): map hasher(blake2_128_concat) T::Asset =\u003e Option\u003cFinancialMetrics\u003cT::Asset, T::Price\u003e\u003e;\n\t}\n\n\tadd_extra_genesis {\n        /// Initial price logs on per asset basis.\n\t\tconfig(prices): Vec\u003c(T::Asset, Vec\u003cT::Price\u003e)\u003e;\n\n\t\tbuild(|config| {\n\t\t\tlet price_count = T::PriceCount::get();\n\n\t\t\tfor (asset, values) in config.prices.iter() {\n\t\t\t\tlet mut prices = CapVec::\u003cT::FixedNumber\u003e::new(price_count);\n\n\t\t\t\tfor v in values.iter() {\n\t\t\t\t\tprices.push(v.clone().into());\n\t\t\t\t}\n\n\t\t\t\tPrices::\u003cT\u003e::insert(asset, prices);\n\t\t\t}\n\t\t});\n\t}\n}\n\ndecl_event!(\n\tpub enum Event\u003cT\u003e where Asset = \u003cT as Trait\u003e::Asset {\n        /// Financial parameters for the specified asset have been recalculeted\n\t\tRecalculated(Asset),\n\t}\n);\n\ndecl_error! {\n    /// Error for the Financial Pallet module.\n\tpub enum Error for Module\u003cT: Trait\u003e {\n        /// Timestamp of the received price is in the past.\n\t\tPeriodIsInThePast,\n        /// Overflow occured during financial calculation process.\n\t\tOverflow,\n        /// Division by zero occured during financial calculation process.\n\t\tDivisionByZero,\n        /// Price log is not long enough to calculate required value.\n\t\tNotEnoughPoints,\n        /// Required functionality is not implemented.\n\t\tNotImplemented,\n        /// Storage of the pallet is in an unexpected state.\n\t\tInvalidStorage,\n        /// Specified period start timestamp is invalid for current\n        /// [`PricePeriod`](./trait.Trait.html#associatedtype.PricePeriod) value.\n\t\tInvalidPeriodStart,\n        /// An invalid argument was passed to the transcendental function (i.e. log, sqrt, etc.)\n        /// during financial calculation process.\n\t\tTranscendental,\n\t}\n}\n\ndecl_module! {\n    /// Financial Pallet module declaration.\n\tpub struct Module\u003cT: Trait\u003e for enum Call where origin: T::Origin {\n\t\ttype Error = Error\u003cT\u003e;\n\n\t\tfn deposit_event() = default;\n\n\t\tconst PriceCount: u32 = T::PriceCount::get();\n\t\tconst PricePeriod: u32 = T::PricePeriod::get();\n\n        /// Recalculates financial metrics for a given asset\n\t\t#[weight = 10_000 + T::DbWeight::get().writes(1)]\n        pub fn recalc(origin, asset: T::Asset) -\u003e dispatch::DispatchResult {\n\t\t\tensure_signed(origin)?;\n\n            let update = Self::updates(asset);\n\t\t\tensure!(update.is_some(), Error::\u003cT\u003e::NotEnoughPoints);\n            let update = update.unwrap();\n\n            let timestamp = update.time;\n\n            let return_type = CalcReturnType::Log;\n            let log_returns = \u003cModule\u003cT\u003e as Financial\u003e::calc_return(return_type, asset)?;\n            let volatility = \u003cModule\u003cT\u003e as Financial\u003e::calc_vol(return_type, CalcVolatilityType::Regular, asset)?;\n\n            let mut correlations = vec![];\n\n            for asset2 in T::Asset::into_type_iter() {\n                let correlation = \u003cModule\u003cT\u003e as Financial\u003e::calc_corr(return_type, CalcCorrelationType::Regular, asset, asset2)?;\n                correlations.push((asset2, correlation));\n            }\n\n            Metrics::\u003cT\u003e::mutate(\u0026asset, |metrics| {\n                *metrics = Some(FinancialMetrics {\n                    timestamp,\n                    log_returns,\n                    volatility,\n                    correlations,\n                });\n            });\n\n            Ok(())\n        }\n\t}\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum PeriodAction {\n\tRemainsUnchanged,\n\tStartedNew(u32),\n}\n\n#[derive(Debug, Eq, PartialEq)]\nstruct PeriodChange {\n\tperiod_start: Duration,\n\taction: PeriodAction,\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum PricePeriodError {\n\tDivisionByZero,\n\tOverflow,\n\tPeriodIsInThePast,\n\tInvalidPeriodStart,\n}\n\nstruct PricePeriod(u32);\n\nimpl PricePeriod {\n\tfn get_period_id(\u0026self, now: Duration) -\u003e Result\u003cu64, PricePeriodError\u003e {\n\t\tlet seconds = now.as_secs();\n\t\tlet period = self.0 as u64;\n\n\t\tseconds.checked_div(60).and_then(|x| x.checked_div(period)).ok_or(PricePeriodError::DivisionByZero)\n\t}\n\n\tfn get_period_id_start(\u0026self, period_id: u64) -\u003e Result\u003cDuration, PricePeriodError\u003e {\n\t\tlet period = self.0 as u64;\n\t\tlet seconds: Result\u003c_, PricePeriodError\u003e = period_id.checked_mul(60).and_then(|x| x.checked_mul(period)).ok_or(PricePeriodError::Overflow);\n\n\t\tOk(Duration::from_secs(seconds?))\n\t}\n\n\tfn get_period_start(\u0026self, now: Duration) -\u003e Result\u003cDuration, PricePeriodError\u003e {\n\t\tself.get_period_id_start(self.get_period_id(now)?)\n\t}\n\n\tfn get_curr_period_info(\u0026self, prev_start: Duration, now: Duration) -\u003e Result\u003c(Duration, i32), PricePeriodError\u003e {\n\t\tlet prev_period_id = self.get_period_id(prev_start)?;\n\t\tlet curr_period_id = self.get_period_id(now)?;\n\n\t\tlet prev: i32 = prev_period_id.try_into().map_err(|_| PricePeriodError::Overflow)?;\n\t\tlet curr: i32 = curr_period_id.try_into().map_err(|_| PricePeriodError::Overflow)?;\n\t\tlet delta: Result\u003c_, PricePeriodError\u003e = curr.checked_sub(prev).ok_or(PricePeriodError::Overflow);\n\t\tOk((self.get_period_id_start(curr_period_id)?, delta?))\n\t}\n\n\tfn get_period_change(\u0026self, period_start: Option\u003cDuration\u003e, now: Duration) -\u003e Result\u003cPeriodChange, PricePeriodError\u003e {\n\t\tif let Some(period_start) = period_start {\n\t\t\tensure!(period_start == self.get_period_start(period_start)?, PricePeriodError::InvalidPeriodStart);\n\t\t}\n\n\t\tmatch period_start {\n\t\t\tNone =\u003e {\n\t\t\t\tlet period_start = self.get_period_start(now)?;\n\n\t\t\t\tOk(PeriodChange {\n\t\t\t\t\tperiod_start,\n\t\t\t\t\taction: PeriodAction::StartedNew(0),\n\t\t\t\t})\n\t\t\t},\n\t\t\tSome(last_start) =\u003e {\n\t\t\t\tlet (current_start, periods_elapsed) = self.get_curr_period_info(last_start, now)?;\n\n\t\t\t\tif periods_elapsed \u003c 0 {\n\t\t\t\t\t// Current period is in the past\n\n\t\t\t\t\tErr(PricePeriodError::PeriodIsInThePast)\n\t\t\t\t} else if periods_elapsed == 0 {\n\t\t\t\t\t// Period is not changed\n\n\t\t\t\t\tOk(PeriodChange {\n\t\t\t\t\t\tperiod_start: last_start,\n\t\t\t\t\t\taction: PeriodAction::RemainsUnchanged,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\t// Period is changed\n\t\t\t\t\t\n\t\t\t\t\tlet empty_periods = (periods_elapsed - 1) as u32;\n\n\t\t\t\t\tOk(PeriodChange {\n\t\t\t\t\t\tperiod_start: current_start,\n\t\t\t\t\t\taction: PeriodAction::StartedNew(empty_periods),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e From\u003cPricePeriodError\u003e for Error\u003cT\u003e {\n\tfn from(error: PricePeriodError) -\u003e Self {\n\t\tmatch error {\n\t\t\tPricePeriodError::DivisionByZero =\u003e Error::\u003cT\u003e::DivisionByZero,\n\t\t\tPricePeriodError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t\tPricePeriodError::PeriodIsInThePast =\u003e Error::\u003cT\u003e::PeriodIsInThePast,\n\t\t\tPricePeriodError::InvalidPeriodStart =\u003e Error::\u003cT\u003e::InvalidPeriodStart,\n\t\t}\n\t}\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum GetNewPricesError {\n\tOverflow,\n}\n\nfn get_new_prices\u003cP: Clone\u003e(last_price: Option\u003cP\u003e, new_price: P, empty_periods: u32, max_periods: u32) -\u003e Result\u003cVec\u003cP\u003e, GetNewPricesError\u003e {\n\tmatch last_price {\n\t\tNone =\u003e {\n\t\t\tOk(vec![new_price])\n\t\t},\n\t\tSome(last_price) =\u003e {\n\t\t\t// Calculate how many values to pre-populate the array with\n\t\t\t// We will pre-fill up to `max_periods` elements (leaving out one for the new price)\n\t\t\tlet prices_size = min(empty_periods, max_periods.checked_sub(1).ok_or(GetNewPricesError::Overflow)?) as usize;\n\n\t\t\t// Init the vector filled with last_price\n\t\t\tlet mut new_prices = vec![last_price.clone(); prices_size];\n\n\t\t\tnew_prices.push(new_price);\n\n\t\t\tOk(new_prices)\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e From\u003cGetNewPricesError\u003e for Error\u003cT\u003e {\n\tfn from(error: GetNewPricesError) -\u003e Self {\n\t\tmatch error {\n\t\t\tGetNewPricesError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e OnPriceSet for Module\u003cT\u003e {\n\ttype Asset = T::Asset;\n\ttype Price = T::Price;\n\n\tfn on_price_set(asset: T::Asset, value: T::Price) -\u003e Result\u003c(), DispatchError\u003e {\n\t\tlet value: T::FixedNumber = value.into();\n\t\tlet now = T::UnixTime::now();\n\t\tlet price_count = T::PriceCount::get();\n\n\t\tlet update = Self::updates(asset);\n\t\tlet prices = Self::prices(asset);\n\n\t\tensure!(prices.len_cap() == 0 || prices.len_cap() == price_count, Error::\u003cT\u003e::InvalidStorage);\n\t\tlet init_prices = prices.len_cap() == 0;\n\n\t\tlet period_start = update.map(|x| x.period_start);\n\t\tlet price_period = PricePeriod(T::PricePeriod::get());\n\t\tlet period_change = price_period.get_period_change(period_start, now).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tlet period_start = period_change.period_start;\n\n\t\tmatch period_change.action {\n\t\t\tPeriodAction::RemainsUnchanged =\u003e {\n\t\t\t\tUpdates::\u003cT\u003e::mutate(\u0026asset, |update| {\n\t\t\t\t\t*update = Some(PriceUpdate {\n\t\t\t\t\t\tperiod_start: period_start,\n\t\t\t\t\t\ttime: now,\n\t\t\t\t\t\tprice: value,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tPeriodAction::StartedNew(empty_periods) =\u003e {\n\t\t\t\tlet new_prices = get_new_prices(prices.last().cloned(), value, empty_periods, price_count).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\t\t\tUpdates::\u003cT\u003e::mutate(\u0026asset, |update| {\n\t\t\t\t\t*update = Some(PriceUpdate {\n\t\t\t\t\t\tperiod_start: period_start,\n\t\t\t\t\t\ttime: now,\n\t\t\t\t\t\tprice: value,\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tPrices::\u003cT\u003e::mutate(\u0026asset, |prices| {\n\t\t\t\t\tif init_prices {\n\t\t\t\t\t\t*prices = CapVec::\u003cT::FixedNumber\u003e::new(price_count);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor p in new_prices {\n\t\t\t\t\t\tprices.push(p);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tOk(())\n\t}\n}\n\n/// Important financial functions that uses [`prices`](./struct.Module.html#method.prices) as a data source.\npub trait Financial {\n    /// System wide type for representing various assets such as BTC, ETH, EOS, etc.\n\ttype Asset;\n    /// System wide type for representing price values.\n\ttype Price;\n    /// System wide type for representing account id.\n\ttype AccountId;\n\n    /// Calculates return.\n\tfn calc_return(return_type: CalcReturnType, asset: Self::Asset) -\u003e Result\u003cVec\u003cSelf::Price\u003e, DispatchError\u003e;\n    /// Calculates volatility.\n\tfn calc_vol(return_type: CalcReturnType, volatility_type: CalcVolatilityType, asset: Self::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates pairwise correlation between two specified assets.\n\tfn calc_corr(return_type: CalcReturnType, correlation_type: CalcCorrelationType, asset1: Self::Asset, asset2: Self::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates portfolio volatility.\n\tfn calc_portf_vol(account_id: Self::AccountId) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates portfolio value at risk.\n\tfn calc_portf_var(account_id: Self::AccountId, return_type: CalcReturnType, z_score: u32) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n}\n\nfn calc_volatility\u003cF\u003e(return_type: CalcReturnType, volatility_type: CalcVolatilityType, prices: \u0026[F]) -\u003e MathResult\u003cF\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n    match volatility_type {\n        CalcVolatilityType::Regular =\u003e {\n            let return_func = calc_return_func(return_type);\n            let returns: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices, return_func).collect();\n            let returns = returns?;\n\n            let mean_return: F = mean(\u0026returns)?;\n\n            let demeaned_return = demeaned(returns.iter(), mean_return);\n            let squared_demeaned_return = squared(demeaned_return);\n\n            let volatility: F = sqrt(regular_vola(returns.len(), sum(squared_demeaned_return)?)?).map_err(|_| MathError::Transcendental)?;\n\n            Ok(volatility)\n        },\n        CalcVolatilityType::Exponential(ewma_length) =\u003e {\n            let diffs = diff(prices);\n            let squared_diffs = squared(diffs);\n            let decay = decay(ewma_length)?;\n            let var = last_recurrent_ewma(squared_diffs, decay)?;\n            let last_price = prices.last().copied().ok_or(MathError::NotEnoughPoints)?;\n            let vola = exp_vola(var, last_price)?;\n\n            Ok(vola)\n        }\n    }\n}\n\nfn calc_correlation\u003cF\u003e(return_type: CalcReturnType, correlation_type: CalcCorrelationType, prices1: \u0026[F], prices2: \u0026[F]) -\u003e MathResult\u003cF\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tlet return_func = calc_return_func(return_type);\n\n\tlet returns1: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices1, return_func).collect();\n\tlet returns1 = returns1?;\n\n\tlet returns2: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices2, return_func).collect();\n\tlet returns2 = returns2?;\n\n\tlet mean_return1: F = mean(\u0026returns1)?;\n\tlet mean_return2: F = mean(\u0026returns2)?;\n\n\tlet demeaned_returns1: MathResult\u003cVec\u003cF\u003e\u003e = demeaned(returns1.iter(), mean_return1).collect();\n\tlet demeaned_returns1 = demeaned_returns1?;\n\tlet demeaned_returns2: MathResult\u003cVec\u003cF\u003e\u003e = demeaned(returns2.iter(), mean_return2).collect();\n\tlet demeaned_returns2 = demeaned_returns2?;\n\n\tlet demeaned_returns_product = mul(demeaned_returns1.iter().copied(), demeaned_returns2.iter().copied());\n\n    let squared_demeaned_returns1 = squared(demeaned_returns1.iter().map(|\u0026x| Ok(x)));\n    let squared_demeaned_returns2 = squared(demeaned_returns2.iter().map(|\u0026x| Ok(x)));\n\n    let volatility1: F = sqrt(regular_vola(returns1.len(), sum(squared_demeaned_returns1)?)?).map_err(|_| MathError::Transcendental)?;\n    let volatility2: F = sqrt(regular_vola(returns2.len(), sum(squared_demeaned_returns2)?)?).map_err(|_| MathError::Transcendental)?;\n\n    match correlation_type {\n        CalcCorrelationType::Regular =\u003e {\n            let products_sum = sum(demeaned_returns_product)?;\n            let products_len = min(returns1.len(), returns2.len());\n            let result = regular_corr(products_len, products_sum, volatility1, volatility2)?;\n            Ok(result)\n        },\n        CalcCorrelationType::Exponential(ewma_length) =\u003e {\n            let decay = decay(ewma_length)?;\n            let last_covar = last_recurrent_ewma(demeaned_returns_product, decay)?;\n            let result = exp_corr(last_covar, volatility1, volatility2)?;\n            Ok(result)\n        },\n    }\n}\n\nimpl\u003cT: Trait\u003e From\u003cMathError\u003e for Error\u003cT\u003e {\n\tfn from(error: MathError) -\u003e Self {\n\t\tmatch error {\n\t\t\tMathError::NotEnoughPoints =\u003e Error::\u003cT\u003e::NotEnoughPoints,\n\t\t\tMathError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t\tMathError::DivisionByZero =\u003e Error::\u003cT\u003e::DivisionByZero,\n\t\t\tMathError::Transcendental =\u003e Error::\u003cT\u003e::Transcendental,\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e Financial for Module\u003cT\u003e {\n\ttype Asset = T::Asset;\n\ttype Price = T::Price;\n\ttype AccountId = \u003cT as frame_system::Trait\u003e::AccountId;\n\n\tfn calc_return(return_type: CalcReturnType, asset: T::Asset) -\u003e Result\u003cVec\u003cT::Price\u003e, DispatchError\u003e {\n\t\tlet prices: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset).iter().cloned().collect();\n\n\t\tlet result: MathResult\u003cVec\u003cT::Price\u003e\u003e = calc_return_iter(\u0026prices, calc_return_func(return_type)).map(|x| x.map(|y| y.into())).collect();\n        let result = result.map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n        if result.len() == 0 {\n            Err(Error::\u003cT\u003e::NotEnoughPoints.into())\n        } else {\n            Ok(result)\n        }\n\t}\n\n\tfn calc_vol(return_type: CalcReturnType, volatility_type: CalcVolatilityType, asset: T::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tlet prices: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset).iter().cloned().collect();\n\n\t\tlet result = calc_volatility::\u003cT::FixedNumber\u003e(return_type, volatility_type, \u0026prices).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tOk(result.into())\n\t}\n\n\tfn calc_corr(return_type: CalcReturnType, correlation_type: CalcCorrelationType, asset1: T::Asset, asset2: T::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tlet prices1: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset1).iter().cloned().collect();\n\t\tlet prices2: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset2).iter().cloned().collect();\n\n\t\tlet result = calc_correlation::\u003cT::FixedNumber\u003e(return_type, correlation_type, \u0026prices1, \u0026prices2).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tOk(result.into())\n\t}\n\n\tfn calc_portf_vol(_account_id: Self::AccountId) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tErr(Error::\u003cT\u003e::NotImplemented.into())\n\t}\n\n\tfn calc_portf_var(_account_id: Self::AccountId, _return_type: CalcReturnType, _z_score: u32) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tErr(Error::\u003cT\u003e::NotImplemented.into())\n\t}\n}\n","traces":[{"line":94,"address":[4418384],"length":1,"stats":{"Line":1},"fn_name":"new\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":116,"address":[4434560,4433377,4434592,4434780,4434528,4434448,4433425,4433473,4434455,4433408,4434352,4434272,4434564,4434672,4433456,4434540,4434695,4434688,4434800,4434880,4434432,4433360,4434321,4434768,4434807],"length":1,"stats":{"Line":52},"fn_name":"updates\u003cfinancial_pallet::mock::Test,financial_pallet::mock::Asset\u003e"},{"line":130,"address":[4434284,4433520,4433580],"length":1,"stats":{"Line":10},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":131,"address":[4433543],"length":1,"stats":{"Line":5},"fn_name":null},{"line":133,"address":[4433775,4433603,4434203],"length":1,"stats":{"Line":10},"fn_name":null},{"line":134,"address":[4433826],"length":1,"stats":{"Line":5},"fn_name":null},{"line":136,"address":[4434190,4434084,4433869],"length":1,"stats":{"Line":10},"fn_name":null},{"line":137,"address":[4434118],"length":1,"stats":{"Line":5},"fn_name":null},{"line":140,"address":[4434024],"length":1,"stats":{"Line":5},"fn_name":null},{"line":246,"address":[5323120],"length":1,"stats":{"Line":1},"fn_name":"get_period_id"},{"line":247,"address":[5323141],"length":1,"stats":{"Line":1},"fn_name":null},{"line":248,"address":[5323184],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[4418478,4418464],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":253,"address":[5323296],"length":1,"stats":{"Line":2},"fn_name":"get_period_id_start"},{"line":254,"address":[5323322],"length":1,"stats":{"Line":1},"fn_name":null},{"line":255,"address":[4418528,4418542],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}"},{"line":257,"address":[5323429,5323564],"length":1,"stats":{"Line":3},"fn_name":null},{"line":260,"address":[5323600],"length":1,"stats":{"Line":1},"fn_name":"get_period_start"},{"line":261,"address":[5323621,5323753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[5323776],"length":1,"stats":{"Line":4},"fn_name":"get_curr_period_info"},{"line":265,"address":[5323964,5324016,5323825],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[5324117,5323930,5324028],"length":1,"stats":{"Line":5},"fn_name":null},{"line":268,"address":[4418592,4418603,4418596],"length":1,"stats":{"Line":5},"fn_name":"{{closure}}"},{"line":269,"address":[4418608,4418612,4418619],"length":1,"stats":{"Line":7},"fn_name":"{{closure}}"},{"line":270,"address":[5324552,5324473],"length":1,"stats":{"Line":6},"fn_name":null},{"line":271,"address":[5324586,5324906],"length":1,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[5324960],"length":1,"stats":{"Line":1},"fn_name":"get_period_change"},{"line":275,"address":[5325257,5324994],"length":1,"stats":{"Line":2},"fn_name":null},{"line":276,"address":[5325259,5325056,5325235],"length":1,"stats":{"Line":6},"fn_name":null},{"line":279,"address":[5325617,5325391,5326213],"length":1,"stats":{"Line":4},"fn_name":null},{"line":280,"address":[5325295],"length":1,"stats":{"Line":1},"fn_name":null},{"line":281,"address":[5325393,5325622],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[5325530],"length":1,"stats":{"Line":3},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[5325508],"length":1,"stats":{"Line":3},"fn_name":null},{"line":288,"address":[5325310],"length":1,"stats":{"Line":4},"fn_name":null},{"line":289,"address":[5325672,5325875,5325332],"length":1,"stats":{"Line":2},"fn_name":null},{"line":291,"address":[5326211,5325855,5325948],"length":1,"stats":{"Line":6},"fn_name":null},{"line":294,"address":[5325941],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[5325929,5326084],"length":1,"stats":{"Line":2},"fn_name":null},{"line":298,"address":[5325992],"length":1,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[5325976],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[5325957,5326218,5326248,5326089],"length":1,"stats":{"Line":2},"fn_name":null},{"line":307,"address":[5326119],"length":1,"stats":{"Line":1},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[5326096],"length":1,"stats":{"Line":3},"fn_name":null},{"line":318,"address":[4418624],"length":1,"stats":{"Line":1},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":319,"address":[4418678,4418669,4418685],"length":1,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[4418673,4418633],"length":1,"stats":{"Line":1},"fn_name":null},{"line":321,"address":[4418680],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[4418687],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[4418664],"length":1,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[4418704,4418917,4419456,4419686],"length":1,"stats":{"Line":6},"fn_name":"get_new_prices\u003cu32\u003e"},{"line":334,"address":[4419754,4419364,4418979,4420146,4419624,4418837],"length":1,"stats":{"Line":6},"fn_name":null},{"line":335,"address":[4419513,4418745],"length":1,"stats":{"Line":5},"fn_name":null},{"line":336,"address":[4419717,4419636,4418844,4418948],"length":1,"stats":{"Line":7},"fn_name":null},{"line":338,"address":[4418799,4419571],"length":1,"stats":{"Line":3},"fn_name":null},{"line":341,"address":[4418819,4419792,4418992,4419909,4419134,4419017,4419606,4419160,4419767,4419935],"length":1,"stats":{"Line":12},"fn_name":null},{"line":344,"address":[4419185,4419960],"length":1,"stats":{"Line":2},"fn_name":null},{"line":346,"address":[4420005,4419224],"length":1,"stats":{"Line":2},"fn_name":null},{"line":348,"address":[4420038,4419255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":354,"address":[4420240],"length":1,"stats":{"Line":0},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":355,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[4420244],"length":1,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[4420348,4420272],"length":1,"stats":{"Line":1},"fn_name":"on_price_set\u003cfinancial_pallet::mock::Test\u003e"},{"line":366,"address":[4420307],"length":1,"stats":{"Line":1},"fn_name":null},{"line":367,"address":[4420363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":368,"address":[4420377],"length":1,"stats":{"Line":1},"fn_name":null},{"line":370,"address":[4420389],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[4420411],"length":1,"stats":{"Line":1},"fn_name":null},{"line":373,"address":[4420539,4420441,4420613,4420569],"length":1,"stats":{"Line":2},"fn_name":null},{"line":374,"address":[4420558,4420672],"length":1,"stats":{"Line":2},"fn_name":null},{"line":376,"address":[4421808,4421809,4420682],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":377,"address":[4420769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":378,"address":[4420791,4421041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":380,"address":[4420993],"length":1,"stats":{"Line":3},"fn_name":null},{"line":382,"address":[4421206,4421142],"length":1,"stats":{"Line":1},"fn_name":null},{"line":383,"address":[4421023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[4421152,4421824],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":385,"address":[4421871],"length":1,"stats":{"Line":1},"fn_name":null},{"line":386,"address":[4421846,4421839],"length":1,"stats":{"Line":2},"fn_name":null},{"line":387,"address":[4421842,4421853],"length":1,"stats":{"Line":2},"fn_name":null},{"line":388,"address":[4421860],"length":1,"stats":{"Line":1},"fn_name":null},{"line":392,"address":[4421104],"length":1,"stats":{"Line":3},"fn_name":null},{"line":393,"address":[4421130,4421568,4421504,4421216],"length":1,"stats":{"Line":5},"fn_name":null},{"line":395,"address":[4421450,4422000],"length":1,"stats":{"Line":5},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":396,"address":[4422047],"length":1,"stats":{"Line":1},"fn_name":null},{"line":397,"address":[4422015,4422022],"length":1,"stats":{"Line":4},"fn_name":null},{"line":398,"address":[4422018,4422029],"length":1,"stats":{"Line":7},"fn_name":null},{"line":399,"address":[4422036],"length":1,"stats":{"Line":1},"fn_name":null},{"line":402,"address":[4422671,4422176,4421592],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":403,"address":[4422666,4422191],"length":1,"stats":{"Line":4},"fn_name":null},{"line":404,"address":[4422232,4422584],"length":1,"stats":{"Line":4},"fn_name":null},{"line":407,"address":[4422265,4422421,4422571,4422487],"length":1,"stats":{"Line":8},"fn_name":null},{"line":408,"address":[4422558],"length":1,"stats":{"Line":4},"fn_name":null},{"line":414,"address":[4421697],"length":1,"stats":{"Line":4},"fn_name":null},{"line":439,"address":[4422882,4422784],"length":1,"stats":{"Line":1},"fn_name":"calc_volatility\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":444,"address":[4425187,4422952,4424348],"length":1,"stats":{"Line":3},"fn_name":null},{"line":445,"address":[4422839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4422961],"length":1,"stats":{"Line":2},"fn_name":null},{"line":447,"address":[4422990],"length":1,"stats":{"Line":2},"fn_name":null},{"line":448,"address":[4423310,4423252,4423048],"length":1,"stats":{"Line":2},"fn_name":null},{"line":450,"address":[4423518,4423593,4423229,4423374],"length":1,"stats":{"Line":4},"fn_name":null},{"line":452,"address":[4423614,4423495],"length":1,"stats":{"Line":4},"fn_name":null},{"line":453,"address":[4423684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":455,"address":[4423747,4425296,4424289,4425307,4425300],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":457,"address":[4424263],"length":1,"stats":{"Line":2},"fn_name":null},{"line":459,"address":[4422897],"length":1,"stats":{"Line":1},"fn_name":null},{"line":460,"address":[4422911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":461,"address":[4424353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":462,"address":[4424422,4424604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":463,"address":[4424530,4424659,4424785],"length":1,"stats":{"Line":2},"fn_name":null},{"line":464,"address":[4424747,4425025,4424845],"length":1,"stats":{"Line":2},"fn_name":null},{"line":465,"address":[4425080,4425010,4425192],"length":1,"stats":{"Line":2},"fn_name":null},{"line":467,"address":[4425176],"length":1,"stats":{"Line":1},"fn_name":null},{"line":472,"address":[4425312,4425446],"length":1,"stats":{"Line":2},"fn_name":"calc_correlation\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":477,"address":[4425398],"length":1,"stats":{"Line":2},"fn_name":null},{"line":479,"address":[4425461],"length":1,"stats":{"Line":2},"fn_name":null},{"line":480,"address":[4425731,4425790,4425519],"length":1,"stats":{"Line":2},"fn_name":null},{"line":482,"address":[4425692,4425846],"length":1,"stats":{"Line":4},"fn_name":null},{"line":483,"address":[4426024,4426099,4425853],"length":1,"stats":{"Line":2},"fn_name":null},{"line":485,"address":[4426001,4426367,4426146,4426290],"length":1,"stats":{"Line":4},"fn_name":null},{"line":486,"address":[4426267,4426540,4426396],"length":1,"stats":{"Line":4},"fn_name":null},{"line":488,"address":[4426623,4426517],"length":1,"stats":{"Line":4},"fn_name":null},{"line":489,"address":[4426716,4426890],"length":1,"stats":{"Line":2},"fn_name":null},{"line":490,"address":[4426991,4426867],"length":1,"stats":{"Line":4},"fn_name":null},{"line":491,"address":[4427258,4427084,4427335],"length":1,"stats":{"Line":2},"fn_name":null},{"line":493,"address":[4427374,4427235],"length":1,"stats":{"Line":4},"fn_name":null},{"line":495,"address":[4430704,4427632,4430688],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":496,"address":[4430752,4430768,4427844],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":498,"address":[4430820,4428056,4428632,4430827,4428283,4430816],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":499,"address":[4428617,4428721,4429208,4430832,4430836,4430843],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":501,"address":[4429301,4429787,4430389],"length":1,"stats":{"Line":2},"fn_name":null},{"line":502,"address":[4429180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":503,"address":[4429303,4429494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":504,"address":[4429563,4429482],"length":1,"stats":{"Line":2},"fn_name":null},{"line":505,"address":[4429792,4429614],"length":1,"stats":{"Line":1},"fn_name":null},{"line":506,"address":[4429776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":508,"address":[4429267],"length":1,"stats":{"Line":1},"fn_name":null},{"line":509,"address":[4430015,4429867,4429289],"length":1,"stats":{"Line":2},"fn_name":null},{"line":510,"address":[4429941,4430092,4430219],"length":1,"stats":{"Line":2},"fn_name":null},{"line":511,"address":[4430296,4430391,4430166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":512,"address":[4430378],"length":1,"stats":{"Line":1},"fn_name":null},{"line":518,"address":[4430848],"length":1,"stats":{"Line":0},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":519,"address":[4430902,4430893,4430909],"length":1,"stats":{"Line":0},"fn_name":null},{"line":520,"address":[4430897,4430857],"length":1,"stats":{"Line":0},"fn_name":null},{"line":521,"address":[4430904],"length":1,"stats":{"Line":0},"fn_name":null},{"line":522,"address":[4430911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":523,"address":[4430888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":533,"address":[4431015,4430928],"length":1,"stats":{"Line":1},"fn_name":"calc_return\u003cfinancial_pallet::mock::Test\u003e"},{"line":534,"address":[4430963,4431046],"length":1,"stats":{"Line":3},"fn_name":null},{"line":536,"address":[4431980,4431920,4431934,4431968,4431137],"length":1,"stats":{"Line":15},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":537,"address":[4431555,4431468,4431530,4431274],"length":1,"stats":{"Line":3},"fn_name":null},{"line":539,"address":[4431456,4431779,4431698,4431588],"length":1,"stats":{"Line":12},"fn_name":null},{"line":540,"address":[4431700],"length":1,"stats":{"Line":0},"fn_name":null},{"line":542,"address":[4431594],"length":1,"stats":{"Line":4},"fn_name":null},{"line":546,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":551,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":554,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":555,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":560,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":563,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":564,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":567,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":143,"coverable":170},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","math.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse substrate_fixed::transcendental::{sqrt, ln};\nuse substrate_fixed::traits::{Fixed, FixedSigned, ToFixed};\nuse substrate_fixed::types::I9F23;\nuse core::ops::{AddAssign, BitOrAssign, ShlAssign};\n\n// Type of constants for transcendental operations declared in substrate_fixed crate\npub type ConstType = I9F23;\n\n#[derive(Debug, Eq, PartialEq, Clone, Copy)]\npub enum MathError {\n\tOverflow,\n\tDivisionByZero,\n\tTranscendental,\n\tNotEnoughPoints,\n}\n\npub type MathResult\u003cT\u003e = Result\u003cT, MathError\u003e;\n\n/// Indicates what returns will be used in calculations of volatilities, correlations, and value at\n/// risk: `Regular` or `Log` returns.\n///\n/// The choice of return type also governs the method for Value at Risk (VAR) calculation: \n/// * `Regular` type should be used when arithmetic returns are used and are assumed to be normally\n/// distributed; \n/// * `Log` normal type should be used when geometric returns (log returns) are used\n/// and are assumed to be normally distributed.\n///\n/// We suggest using the latter approach, as it doesn't\n/// lead to losses greater than a portfolio value unlike the normal VaR.\n#[derive(Copy, Clone)]\npub enum CalcReturnType {\n\n    /// Regular returns.\n\tRegular,\n\n    /// Log returns.\n\tLog,\n}\n\n/// Indicates the method for calculating volatility: `Regular` or `Exponential`.\n#[derive(Copy, Clone)]\npub enum CalcVolatilityType {\n\n    /// Regular type is a standard statistical approach of calculating standard deviation of\n    /// returns using simple average.\n\tRegular,\n\n    /// Exponentially weighted type gives more weight to most recent data given the decay value or\n    /// period of exponentially weighted moving average.\n\tExponential(u32),\n}\n\n/// Indicates the method for calculating correlations: `Regular` or `Exponential`.\n///\n/// * `Regular` type is a standard statistical approach of calculating Pearson correlation coefficient between\n/// two return series;\n/// * `Exponential` type uses exponentially weighted moving average\n/// to give more weights to most recent observations of pair of returns.\n///\n/// Note: correlations on lower periods are more susceptible to data noise and reflect actual\n/// dependencies between returns poorly. For robustness we recommend to use daily or weekly periods\n/// for correlations.\n#[derive(Copy, Clone)]\npub enum CalcCorrelationType {\n    /// Regular correlation type.\n\tRegular,\n    /// Exponentially weighted correlation type.\n\tExponential(u32),\n}\n\npub fn calc_return\u003cF: Fixed\u003e(x1: F, x2: F) -\u003e Result\u003cF, MathError\u003e {\n\tlet ratio = x2.checked_div(x1).ok_or(MathError::DivisionByZero)?;\n\n\tratio.checked_sub(F::from_num(1)).ok_or(MathError::Overflow)\n}\n\npub fn calc_log_return\u003cF\u003e(x1: F, x2: F) -\u003e Result\u003cF, MathError\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tlet ratio = x2.checked_div(x1).ok_or(MathError::DivisionByZero)?;\n\tln(ratio).map_err(|_| MathError::Transcendental)\n}\n\npub fn calc_return_func\u003cF\u003e(return_type: CalcReturnType) -\u003e impl Fn(F, F) -\u003e MathResult\u003cF\u003e + Copy\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tmatch return_type {\n\t\tCalcReturnType::Regular =\u003e calc_return,\n\t\tCalcReturnType::Log =\u003e calc_log_return,\n\t}\n}\n\npub fn calc_return_iter\u003c'a, T: Copy, F: 'a + Fn(T, T) -\u003e MathResult\u003cT\u003e\u003e(items: \u0026'a [T], return_func: F) -\u003e impl Iterator\u003cItem = MathResult\u003cT\u003e\u003e + 'a {\n\titems.windows(2).map(move |x| return_func(x[0], x[1]))\n}\n\npub fn diff\u003c'a, T: Fixed\u003e(items: \u0026'a [T]) -\u003e impl Iterator\u003cItem = MathResult\u003cT\u003e\u003e + 'a {\n\titems.windows(2).map(move |x| x[1].checked_sub(x[0]).ok_or(MathError::Overflow))\n}\n\npub fn decay\u003cF: Fixed\u003e(ewma_length: u32) -\u003e MathResult\u003cF\u003e {\n    let nom = F::from_num(2);\n    let denom = F::from_num(1).checked_add(F::from_num(ewma_length)).ok_or(MathError::Overflow)?;\n    \n    nom.checked_div(denom).ok_or(MathError::DivisionByZero)\n}\n\nfn recurrent_ewma_step\u003cF: Fixed\u003e(diff: MathResult\u003cF\u003e, decay: F, prev_var: MathResult\u003cF\u003e) -\u003e MathResult\u003cF\u003e {\n    let diff = diff?;\n    let prev_var = prev_var?;\n\n    let a = diff.checked_mul(decay).ok_or(MathError::Overflow)?;\n    let b = F::from_num(1).checked_sub(decay).ok_or(MathError::Overflow)?;\n    let c = b.checked_mul(prev_var).ok_or(MathError::Overflow)?;\n\n    a.checked_add(c).ok_or(MathError::Overflow)\n}\n\npub fn last_recurrent_ewma\u003cF: Fixed, I: Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(diffs: I, decay: F) -\u003e MathResult\u003cF\u003e {\n    diffs.fold(None, move |state, diff| {\n        if let Some(prev_var) = state {\n            let var = recurrent_ewma_step(diff, decay, prev_var);\n            Some(var)\n        } else {\n            Some(diff)\n        }\n    }).ok_or(MathError::NotEnoughPoints).and_then(|x| x)\n}\n\npub fn sum\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(mut iter: I) -\u003e MathResult\u003cF\u003e {\n\tOk(iter.try_fold(F::from_num(0), |acc, x| {let x = x?; acc.checked_add(x).ok_or(MathError::Overflow)})?)\n}\n\npub fn mean\u003cF: Fixed\u003e(items: \u0026[F]) -\u003e MathResult\u003cF\u003e {\n\tlet sum = sum(items.iter().map(|\u0026x| Ok(x)))?;\n\tsum.checked_div(F::from_num(items.len())).ok_or(MathError::DivisionByZero)\n}\n\npub fn demeaned\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = \u0026'a F\u003e\u003e(iter: I, mean: F) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer.map(move |\u0026x| x.checked_sub(mean).ok_or(MathError::Overflow))\n}\n\npub fn squared\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(iter: I) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer.map(|x| x.and_then(|y| y.checked_mul(y).ok_or(MathError::Overflow)))\n}\n\npub fn regular_vola\u003cF: Fixed\u003e(n: usize, sum: F) -\u003e MathResult\u003cF\u003e {\n\tlet a = n.checked_sub(1).ok_or(MathError::Overflow)?;\n\tlet b = F::from_num(1).checked_div(F::from_num(a)).ok_or(MathError::DivisionByZero)?;\n\tlet c = b.checked_mul(sum).ok_or(MathError::Overflow)?;\n\tOk(c)\n}\n\npub fn exp_vola\u003cF\u003e(var: F, price: F) -\u003e MathResult\u003cF\u003e\nwhere\n    F: Fixed + PartialOrd\u003cConstType\u003e,\n{\n    let a: F = sqrt(var).map_err(|_| MathError::Transcendental)?;\n    a.checked_div(price).ok_or(MathError::DivisionByZero)\n}\n\npub fn mul\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = F\u003e\u003e(iter1: I, iter2: I) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer1.zip(iter2).map(|(x1, x2)| x1.checked_mul(x2).ok_or(MathError::Overflow))\n}\n\npub fn regular_corr\u003cF: Fixed\u003e(n: usize, sum: F, vol1: F, vol2: F) -\u003e MathResult\u003cF\u003e {\n\tlet a = n.checked_sub(1).ok_or(MathError::Overflow)?;\n\tlet b = F::from_num(1).checked_div(F::from_num(a)).ok_or(MathError::DivisionByZero)?;\n\tlet c = b.checked_mul(sum).ok_or(MathError::Overflow)?;\n\tlet d = c.checked_div(vol1).ok_or(MathError::DivisionByZero)?;\n\tlet e = d.checked_div(vol2).ok_or(MathError::DivisionByZero)?;\n\tOk(e)\n}\n\npub fn exp_corr\u003cF: Fixed\u003e(covariance: F, vol1: F, vol2: F) -\u003e MathResult\u003cF\u003e {\n\tlet d = covariance.checked_div(vol1).ok_or(MathError::DivisionByZero)?;\n\tlet e = d.checked_div(vol2).ok_or(MathError::DivisionByZero)?;\n\tOk(e)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use substrate_fixed::types::I64F64;\n    use frame_support::assert_ok;\n    use substrate_fixed::traits::LossyInto;\n    use approx::assert_abs_diff_eq;\n\n    pub type FixedNumber = I64F64;\n\n    #[test]\n    fn diff_example() {\n        let prices: Vec\u003c_\u003e = vec![\n            7_117.21, 7_429.72, 7_550.90, 7_569.94, 7_679.87, 7_795.60, 7_807.06, 8_801.04, 8_658.55, 8_864.77, 8_988.60, 8_897.47, 8_912.65, 9_003.07, 9_268.76, 9_951.52, 9_842.67, 9_593.90, 8_756.43, 8_601.80, 8_804.48, 9_269.99, 9_733.72, 9_328.20, 9_377.01, 9_670.74, 9_726.57, 9_729.04, 9_522.98, 9_081.76,\n        ].into_iter().map(FixedNumber::from_num).collect();\n\n        let actual: MathResult\u003cVec\u003c_\u003e\u003e = diff(\u0026prices).collect();\n        assert_ok!(\u0026actual);\n        let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n        let expected: Vec\u003c_\u003e = vec![\n            312.51, 121.18, 19.04, 109.93, 115.73, 11.46, 993.98, -142.49, 206.22, 123.83, -91.13, 15.18, 90.42, 265.69, 682.76, -108.85, -248.77, -837.47, -154.63, 202.68, 465.51, 463.73, -405.52, 48.81, 293.73, 55.83, 2.47, -206.06, -441.22,\n        ];\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n    }\n\n    #[test]\n    fn squared_example() {\n        let diffs: Vec\u003c_\u003e = vec![\n            312.51, 121.18, 19.04, 109.93, 115.73, 11.46, 993.98, -142.49, 206.22, 123.83, -91.13, 15.18, 90.42, 265.69, 682.76, -108.85, -248.77, -837.47, -154.63, 202.68, 465.51, 463.73, -405.52, 48.81, 293.73, 55.83, 2.47, -206.06, -441.22,\n        ].into_iter().map(|x| Ok(FixedNumber::from_num(x))).collect();\n\n        let actual: MathResult\u003cVec\u003c_\u003e\u003e = squared(diffs.into_iter()).collect();\n        assert_ok!(\u0026actual);\n        let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n        let expected: Vec\u003c_\u003e = vec![\n            97662.5001000001, 14684.5923999999, 362.5216000000, 12084.6049000001, 13393.4329000001, 131.3316000000, 987996.2404000010, 20303.4001000005, 42526.6884000005, 15333.8689000000, 8304.6769000002, 230.4324000000, 8175.7764000000, 70591.1761000003, 466161.2176000000, 11848.3225000001, 61886.5129000002, 701356.0008999990, 23910.4369000003, 41079.1824000001, 216699.5601000000, 215045.5129000000, 164446.4703999990, 2382.4161000000, 86277.3128999997, 3116.9889000000, 6.1009000000, 42460.7236000005, 194675.0883999990,\n        ];\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n    }\n\n    #[test]\n    fn decay_expample() {\n        let actual = decay(36);\n        assert_ok!(actual);\n        let actual: FixedNumber = actual.unwrap();\n        let actual: f64 = actual.lossy_into();\n        let expected = 0.05405405405;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn last_recurrent_ewma_example() {\n        let squared_diffs: Vec\u003c_\u003e = vec![\n            97662.50010000010000, 14684.59239999990000, 362.52159999999900, 12084.60490000010000, 13393.43290000010000, 131.33160000000100, 987996.24040000100000, 20303.40010000050000, 42526.68840000050000, 15333.86890000000000, 8304.67690000019000, 230.43240000000900, 8175.77640000001000, 70591.17610000030000, 466161.21760000000000, 11848.32250000010000, 61886.51290000020000, 701356.00089999900000, 23910.43690000030000, 41079.18240000010000, 216699.56010000000000, 215045.51290000000000, 164446.47039999900000, 2382.41609999995000, 86277.31289999970000, 3116.98889999999000, 6.10090000000575, 42460.72360000050000, 194675.08839999900000,\n        ].into_iter().map(|x| Ok(FixedNumber::from_num(x))).collect();\n        let decay = FixedNumber::from_num(0.0540540540540541);\n\n        let actual = last_recurrent_ewma(squared_diffs.into_iter(), decay);\n        assert_ok!(\u0026actual);\n        let actual: f64 = actual.unwrap().lossy_into();\n\n        let expected = 114954.3177623650;\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn recurrent_ewma_step_example() {\n        let diff = Ok(FixedNumber::from_num(14684.59239999990000));\n        let decay = FixedNumber::from_num(0.0540540540540541);\n        let prev_var = Ok(FixedNumber::from_num(97662.5001000001));\n        let actual = recurrent_ewma_step(diff, decay, prev_var);\n        assert_ok!(\u0026actual);\n        let actual: f64 = actual.unwrap().lossy_into();\n        let expected = 93177.2077918920;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn exp_vola_expample() {\n        let variance = FixedNumber::from_num(114954.3177623650);\n        let price = FixedNumber::from_num(9_081.76);\n        let actual = exp_vola(variance, price);\n        assert_ok!(actual);\n        let actual: FixedNumber = actual.unwrap();\n        let actual: f64 = actual.lossy_into();\n        let expected = 0.0373329770530381;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[cfg(test)]\n    mod calc_return {\n        use super::super::*;\n        use super::FixedNumber;\n        use substrate_fixed::traits::LossyInto;\n        use approx::assert_abs_diff_eq;\n        use frame_support::assert_ok;\n\n        #[test]\n        fn calc_return_valid() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_return(x1, x2);\n            let expected = Ok(FixedNumber::from_num(-0.25));\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_valid_positive() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(10);\n            let actual = calc_return(x1, x2);\n            let expected = Ok(FixedNumber::from_num(0.25));\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_x1_is_zero() {\n            let x1 = FixedNumber::from_num(0);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_return(x1, x2);\n            let expected = Err(MathError::DivisionByZero);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_log_return_valid() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(6);\n            let actual: f64 = calc_log_return(x1, x2).unwrap().lossy_into();\n            let expected = -0.287682072452;\n\n            assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n        }\n\n        #[test]\n        fn calc_log_return_x1_is_zero() {\n            let x1 = FixedNumber::from_num(0);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_log_return(x1, x2);\n            let expected = Err(MathError::DivisionByZero);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_log_return_x1_is_negative() {\n            let x1 = FixedNumber::from_num(-3);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_log_return(x1, x2);\n            let expected = Err(MathError::Transcendental);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_iter_empty() {\n            let prices: Vec\u003cFixedNumber\u003e = Vec::new();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            let expected = Ok(vec![]);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_vec_one_item() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![1.5].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            let expected = Ok(vec![]);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_vec_regular_valid() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![\n                7_117.21,\n                7_429.72,\n                7_550.90,\n                7_569.94,\n                7_679.87,\n                7_795.60,\n                7_807.06,\n                8_801.04,\n                8_658.55,\n                8_864.77,\n            ].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            assert_ok!(\u0026actual);\n            let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n            let expected: Vec\u003cf64\u003e = vec![\n                0.04390906,\n                0.01631017,\n                0.00252155,\n                0.01452191,\n                0.01506927,\n                0.00147006,\n                0.12731809,\n                -0.01619013,\n                0.02381692,\n            ];\n\n            assert_eq!(actual.len(), expected.len());\n            for (a, e) in actual.into_iter().zip(expected.into_iter()) {\n                assert_abs_diff_eq!(a, e, epsilon = 1e-8);\n            }\n        }\n\n        #[test]\n        fn calc_return_vec_log_valid() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![\n                7_117.21,\n                7_429.72,\n                7_550.90,\n                7_569.94,\n                7_679.87,\n                7_795.60,\n                7_807.06,\n                8_801.04,\n                8_658.55,\n                8_864.77,\n            ].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Log);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            assert_ok!(\u0026actual);\n            let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n            let expected: Vec\u003cf64\u003e = vec![\n                0.042972378,\n                0.016178588,\n                0.002518380,\n                0.014417479,\n                0.014956852,\n                0.001468981,\n                0.119841444,\n                -0.016322624,\n                0.023537722,\n            ];\n\n            assert_eq!(actual.len(), expected.len());\n            for (a, e) in actual.into_iter().zip(expected.into_iter()) {\n                assert_abs_diff_eq!(a, e, epsilon = 1e-8);\n            }\n        }\n    }\n}\n","traces":[{"line":86,"address":[4959136],"length":1,"stats":{"Line":3},"fn_name":"calc_return\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":87,"address":[4959391,4959183,4959443],"length":1,"stats":{"Line":4},"fn_name":null},{"line":89,"address":[4959359,4959473],"length":1,"stats":{"Line":4},"fn_name":null},{"line":92,"address":[4959536],"length":1,"stats":{"Line":2},"fn_name":"calc_log_return\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":97,"address":[4959769,4959818,4959583],"length":1,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[4959741,4959860,4959867,4959848,4959856],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":101,"address":[4959872],"length":1,"stats":{"Line":1},"fn_name":"calc_return_func\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":106,"address":[4959911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[4959885,4959915],"length":1,"stats":{"Line":7},"fn_name":null},{"line":108,"address":[4959899],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[4960022,4959952],"length":1,"stats":{"Line":3},"fn_name":"calc_return_iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,fn(substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e) -\u003e core::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e"},{"line":113,"address":[4960034,4960140,4959974,4960112],"length":1,"stats":{"Line":12},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,fn(substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e) -\u003e core::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e"},{"line":116,"address":[4960384],"length":1,"stats":{"Line":1},"fn_name":"diff\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":117,"address":[4960401,4960464,4960486],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":120,"address":[4960720],"length":1,"stats":{"Line":1},"fn_name":"decay\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":121,"address":[4960750],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[4961031,4960798,4961086],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[4961006,4961125],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[4961136],"length":1,"stats":{"Line":1},"fn_name":"recurrent_ewma_step\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":128,"address":[4961413,4961477,4961162],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[4961339,4961641,4961489],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[4961599,4961862,4961737],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[4962126,4961943,4961830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[4962207,4962335,4962082],"length":1,"stats":{"Line":4},"fn_name":null},{"line":135,"address":[4962310,4962414],"length":1,"stats":{"Line":4},"fn_name":null},{"line":138,"address":[4962432,4962624,4962800],"length":1,"stats":{"Line":3},"fn_name":"last_recurrent_ewma\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::zip::Zip\u003ccore::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e, core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":139,"address":[4963744,4962976,4962458,4962650,4962826,4963360],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::zip::Zip\u003ccore::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e, core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":140,"address":[4963768,4963000,4963900,4963384,4963132,4963516],"length":1,"stats":{"Line":6},"fn_name":null},{"line":141,"address":[4963164,4963932,4963548],"length":1,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[4963254,4963638,4964022],"length":1,"stats":{"Line":3},"fn_name":null},{"line":144,"address":[4963057,4963441,4963825],"length":1,"stats":{"Line":3},"fn_name":null},{"line":146,"address":[4964160,4964192,4964132,4964164,4963730,4963338,4964128,4963346,4963722,4964196,4964114,4964106],"length":1,"stats":{"Line":9},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,alloc::vec::IntoIter\u003ccore::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e\u003e"},{"line":149,"address":[4964275,4964736,4965248,4964480,4964782,4964531,4965294,4964224,4964992,4965043],"length":1,"stats":{"Line":9},"fn_name":"sum\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-1\u003e, closure-0\u003e\u003e"},{"line":150,"address":[4965412,4966368,4965094,4964439,4964393,4964582,4965161,4965326,4964251,4965075,4964326,4964649,4966687,4964814,4965504,4965535,4964900,4965345,4966080,4966399,4965019,4964563,4964946,4964695,4965458,4965792,4964753,4965207,4964507,4966111,4966656,4964307,4964833,4965823,4965265],"length":1,"stats":{"Line":45},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-0\u003e, closure-0\u003e\u003e"},{"line":153,"address":[4966944],"length":1,"stats":{"Line":2},"fn_name":"mean\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":154,"address":[4966978,4967182,4967360,4967237,4967344],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":155,"address":[4967252,4967170],"length":1,"stats":{"Line":4},"fn_name":null},{"line":158,"address":[4967408],"length":1,"stats":{"Line":2},"fn_name":"demeaned\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e"},{"line":159,"address":[4967488,4967505,4967435],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e"},{"line":162,"address":[4967888,4967616,4967664,4967728,4967808],"length":1,"stats":{"Line":8},"fn_name":"squared\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":163,"address":[4967735,4968780,4968704,4967936,4967958,4968448,4968844,4967902,4967671,4968320,4968652,4968716,4968768,4968832,4968192,4967815,4968214,4967630,4968470,4968086,4968576,4968064,4968342,4968640,4968588],"length":1,"stats":{"Line":40},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,alloc::vec::IntoIter\u003ccore::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e\u003e"},{"line":166,"address":[4968896],"length":1,"stats":{"Line":2},"fn_name":"regular_vola\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":167,"address":[4969098,4969153,4968938],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[4969071,4969391,4969170],"length":1,"stats":{"Line":4},"fn_name":null},{"line":169,"address":[4969347,4969589,4969472],"length":1,"stats":{"Line":4},"fn_name":null},{"line":170,"address":[4969573],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[4969648],"length":1,"stats":{"Line":1},"fn_name":"exp_vola\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":177,"address":[4969921,4969979,4969695,4969968,4969972,4969872],"length":1,"stats":{"Line":1},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":178,"address":[4969957,4969834],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[4969984],"length":1,"stats":{"Line":2},"fn_name":"mul\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e"},{"line":182,"address":[4970011,4970064,4970096],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e"},{"line":185,"address":[4970208],"length":1,"stats":{"Line":1},"fn_name":"regular_corr\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":186,"address":[4970282,4970498,4970562],"length":1,"stats":{"Line":1},"fn_name":null},{"line":187,"address":[4970582,4970462,4970815],"length":1,"stats":{"Line":2},"fn_name":null},{"line":188,"address":[4970771,4970896,4971033],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[4971117,4970989,4971254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":190,"address":[4971210,4971338,4971455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[4971439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[4971520],"length":1,"stats":{"Line":1},"fn_name":"exp_corr\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":195,"address":[4971829,4971591,4971780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":196,"address":[4971984,4971870,4971742],"length":1,"stats":{"Line":2},"fn_name":null},{"line":197,"address":[4971968],"length":1,"stats":{"Line":1},"fn_name":null},{"line":211,"address":[4874288,4873504],"length":1,"stats":{"Line":3},"fn_name":"diff_example"},{"line":212,"address":[4873516,4874303],"length":1,"stats":{"Line":2},"fn_name":null},{"line":216,"address":[4874374,4874462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":217,"address":[4874477,4874681],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[4874819,4874600],"length":1,"stats":{"Line":4},"fn_name":null},{"line":220,"address":[4875381,4874890],"length":1,"stats":{"Line":2},"fn_name":null},{"line":223,"address":[4875389,4875641],"length":1,"stats":{"Line":1},"fn_name":null},{"line":224,"address":[4876498,4877485,4875575,4876224,4876010,4876259],"length":1,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[4876341,4876503],"length":1,"stats":{"Line":1},"fn_name":null},{"line":230,"address":[4877648,4878398],"length":1,"stats":{"Line":3},"fn_name":"squared_example"},{"line":231,"address":[4877660,4878413],"length":1,"stats":{"Line":2},"fn_name":null},{"line":235,"address":[4878476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[4878799,4878595],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[4436016,4436035],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":239,"address":[4879499,4879008],"length":1,"stats":{"Line":2},"fn_name":null},{"line":242,"address":[4879507,4879759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":243,"address":[4879693,4880128,4880342,4880377,4880616,4881584],"length":1,"stats":{"Line":4},"fn_name":null},{"line":244,"address":[4880621,4880459],"length":1,"stats":{"Line":1},"fn_name":null},{"line":249,"address":[4436064,4436069],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":250,"address":[4881742],"length":1,"stats":{"Line":1},"fn_name":null},{"line":251,"address":[4882012,4881760],"length":1,"stats":{"Line":1},"fn_name":null},{"line":252,"address":[4881909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[4882169],"length":1,"stats":{"Line":1},"fn_name":null},{"line":254,"address":[4882191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":256,"address":[4882381,4882200],"length":1,"stats":{"Line":1},"fn_name":null},{"line":260,"address":[4883008,4883734],"length":1,"stats":{"Line":3},"fn_name":"last_recurrent_ewma_example"},{"line":261,"address":[4883749,4883020],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[4883828],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[4883883],"length":1,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[4884189,4883985],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[4884108,4884327],"length":1,"stats":{"Line":2},"fn_name":null},{"line":270,"address":[4884371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[4884387,4884565],"length":1,"stats":{"Line":1},"fn_name":null},{"line":275,"address":[4436208,4436213],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":276,"address":[4885478],"length":1,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[4885547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":278,"address":[4885598],"length":1,"stats":{"Line":1},"fn_name":null},{"line":279,"address":[4885659],"length":1,"stats":{"Line":1},"fn_name":null},{"line":280,"address":[4885800,4886020],"length":1,"stats":{"Line":1},"fn_name":null},{"line":281,"address":[4885927,4886177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":282,"address":[4886199],"length":1,"stats":{"Line":1},"fn_name":null},{"line":284,"address":[4886389,4886208],"length":1,"stats":{"Line":1},"fn_name":null},{"line":288,"address":[4436245,4436240],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":289,"address":[4887046],"length":1,"stats":{"Line":1},"fn_name":null},{"line":290,"address":[4887097],"length":1,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[4887180],"length":1,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[4887185,4887437],"length":1,"stats":{"Line":1},"fn_name":null},{"line":293,"address":[4887334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":294,"address":[4887594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[4887616],"length":1,"stats":{"Line":1},"fn_name":null},{"line":297,"address":[4887806,4887625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":309,"address":[4796448,4796453],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":310,"address":[5328556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":311,"address":[5328601],"length":1,"stats":{"Line":1},"fn_name":null},{"line":312,"address":[5328669],"length":1,"stats":{"Line":1},"fn_name":null},{"line":313,"address":[5328682],"length":1,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[5328731,5328835],"length":1,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[4796480,4796485],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":320,"address":[5329148],"length":1,"stats":{"Line":1},"fn_name":null},{"line":321,"address":[5329193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[5329261],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[5329274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[5329323,5329427],"length":1,"stats":{"Line":1},"fn_name":null},{"line":329,"address":[4796517,4796512],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":330,"address":[5329737],"length":1,"stats":{"Line":1},"fn_name":null},{"line":331,"address":[5329779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[5329841],"length":1,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[5329846],"length":1,"stats":{"Line":1},"fn_name":null},{"line":335,"address":[5329862,5329966],"length":1,"stats":{"Line":1},"fn_name":null},{"line":339,"address":[4796544,4796549],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":340,"address":[5330275],"length":1,"stats":{"Line":1},"fn_name":null},{"line":341,"address":[5330323],"length":1,"stats":{"Line":1},"fn_name":null},{"line":342,"address":[5330406],"length":1,"stats":{"Line":1},"fn_name":null},{"line":343,"address":[5330488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":345,"address":[5330678,5330497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":349,"address":[4796576,4796581],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":350,"address":[5331321],"length":1,"stats":{"Line":1},"fn_name":null},{"line":351,"address":[5331363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":352,"address":[5331425],"length":1,"stats":{"Line":1},"fn_name":null},{"line":353,"address":[5331430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":355,"address":[5331446,5331550],"length":1,"stats":{"Line":1},"fn_name":null},{"line":359,"address":[4796608,4796613],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":360,"address":[5331852],"length":1,"stats":{"Line":1},"fn_name":null},{"line":361,"address":[5331894],"length":1,"stats":{"Line":1},"fn_name":null},{"line":362,"address":[5331956],"length":1,"stats":{"Line":1},"fn_name":null},{"line":363,"address":[5331961],"length":1,"stats":{"Line":1},"fn_name":null},{"line":365,"address":[5331977,5332081],"length":1,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[4796640,4796645],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":370,"address":[5332375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[5332404],"length":1,"stats":{"Line":1},"fn_name":null},{"line":373,"address":[5332434,5332486],"length":1,"stats":{"Line":2},"fn_name":null},{"line":374,"address":[5332524],"length":1,"stats":{"Line":1},"fn_name":null},{"line":376,"address":[5332579,5332725,5332684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":380,"address":[4796672,4796677],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":381,"address":[5333212,5333143],"length":1,"stats":{"Line":2},"fn_name":null},{"line":382,"address":[5333274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[5333304,5333359],"length":1,"stats":{"Line":2},"fn_name":null},{"line":385,"address":[5333397],"length":1,"stats":{"Line":1},"fn_name":null},{"line":387,"address":[5333452,5333557,5333598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":391,"address":[4796704,4796709],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":392,"address":[5334012,5334233],"length":1,"stats":{"Line":2},"fn_name":null},{"line":404,"address":[5334298],"length":1,"stats":{"Line":1},"fn_name":null},{"line":406,"address":[5334410,5334337],"length":1,"stats":{"Line":2},"fn_name":null},{"line":407,"address":[5334652,5334448],"length":1,"stats":{"Line":1},"fn_name":null},{"line":408,"address":[4796736,4796755],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":410,"address":[5334861,5335033],"length":1,"stats":{"Line":2},"fn_name":null},{"line":422,"address":[5335041,5335293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":423,"address":[5337137,5335662,5336150,5335876,5335911,5335227],"length":1,"stats":{"Line":4},"fn_name":null},{"line":424,"address":[5335993,5336155],"length":1,"stats":{"Line":1},"fn_name":null},{"line":429,"address":[4796789,4796784],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":430,"address":[5337529,5337308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":442,"address":[5337597],"length":1,"stats":{"Line":1},"fn_name":null},{"line":444,"address":[5337636,5337709],"length":1,"stats":{"Line":2},"fn_name":null},{"line":445,"address":[5337951,5337747],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4796816,4796835],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":448,"address":[5338160,5338332],"length":1,"stats":{"Line":2},"fn_name":null},{"line":460,"address":[5338340,5338592],"length":1,"stats":{"Line":1},"fn_name":null},{"line":461,"address":[5338526,5340436,5338961,5339210,5339449,5339175],"length":1,"stats":{"Line":4},"fn_name":null},{"line":462,"address":[5339454,5339292],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":181,"coverable":181},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","mock.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::{Module, Trait};\nuse sp_core::H256;\nuse frame_support::{impl_outer_origin, parameter_types, weights::Weight};\nuse frame_support::traits::UnixTime;\nuse frame_support::codec::{Decode, Encode};\nuse sp_runtime::{\n\ttraits::{BlakeTwo256, IdentityLookup}, testing::Header, Perbill,\n};\nuse frame_system as system;\nuse core::time::Duration;\nuse substrate_fixed::types::I64F64;\nuse std::cell::RefCell;\nuse financial_primitives::IntoTypeIterator;\n\nimpl_outer_origin! {\n\tpub enum Origin for Test {}\n}\n\nthread_local! {\n\tpub static NOW: RefCell\u003cDuration\u003e = RefCell::new(Duration::from_secs(0));\n}\n\npub fn set_now(now: Duration) {\n\tNOW.with(|n| *n.borrow_mut() = now);\n}\n\n#[derive(Clone, Eq, PartialEq)]\npub struct Test;\nparameter_types! {\n\tpub const BlockHashCount: u64 = 250;\n\tpub const MaximumBlockWeight: Weight = 1024;\n\tpub const MaximumBlockLength: u32 = 2 * 1024;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n}\n\nimpl system::Trait for Test {\n\ttype BaseCallFilter = ();\n\ttype Origin = Origin;\n\ttype Call = ();\n\ttype Index = u64;\n\ttype BlockNumber = u64;\n\ttype Hash = H256;\n\ttype Hashing = BlakeTwo256;\n\ttype AccountId = u64;\n\ttype Lookup = IdentityLookup\u003cSelf::AccountId\u003e;\n\ttype Header = Header;\n\ttype Event = ();\n\ttype BlockHashCount = BlockHashCount;\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\ttype DbWeight = ();\n\ttype BlockExecutionWeight = ();\n\ttype ExtrinsicBaseWeight = ();\n\ttype MaximumExtrinsicWeight = MaximumBlockWeight;\n\ttype MaximumBlockLength = MaximumBlockLength;\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\ttype Version = ();\n\ttype ModuleToIndex = ();\n\ttype AccountData = ();\n\ttype OnNewAccount = ();\n\ttype OnKilledAccount = ();\n\ttype SystemWeightInfo = ();\n}\n\npub type FixedNumber = I64F64;\n\nparameter_types! {\n\tpub const PriceCount: u32 = 10;\n\tpub const PricePeriod: u32 = 60;\n}\n\npub struct TestUnixTime;\n\nimpl UnixTime for TestUnixTime {\n\tfn now() -\u003e Duration {\n\t\tNOW.with(|n| *n.borrow())\n\t}\n}\n\nimpl Trait for Test {\n\ttype Event = ();\n\ttype PriceCount = PriceCount;\n\ttype PricePeriod = PricePeriod;\n\ttype UnixTime = TestUnixTime;\n\ttype Asset = Asset;\n\ttype FixedNumberBits = i128;\n\ttype FixedNumber = FixedNumber;\n\ttype Price = FixedNumber;\n}\n\npub type FinancialModule = Module\u003cTest\u003e;\n\n#[derive(Clone, Copy, Debug, Eq, PartialEq, Encode, Decode)]\npub enum Asset {\n\tBtc,\n\tEos,\n}\n\nimpl IntoTypeIterator for Asset {\n    type Iterator = sp_std::vec::IntoIter\u003cSelf\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator {\n        vec![\n            Asset::Btc,\n            Asset::Eos,\n        ].into_iter()\n    }\n}\n\npub fn initial_btc_prices() -\u003e Vec\u003cf64\u003e {\n\tvec![\n\t\t7_117.21,\n\t\t7_429.72,\n\t\t7_550.90,\n\t\t7_569.94,\n\t\t7_679.87,\n\t\t7_795.60,\n\t\t7_807.06,\n\t\t8_801.04,\n\t\t8_658.55,\n\t\t8_864.77,\n\t]\n}\n\npub fn initial_eos_prices() -\u003e Vec\u003cf64\u003e {\n\tvec![\n\t\t2.62,\n\t\t2.67,\n\t\t2.72,\n\t\t2.72,\n\t\t2.74,\n\t\t2.75,\n\t\t2.78,\n\t\t3.02,\n\t\t2.83,\n\t\t2.89,\n\t]\n}\n\npub fn new_test_ext() -\u003e sp_io::TestExternalities {\n\tlet mut t = system::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap();\n\n\tcrate::GenesisConfig::\u003cTest\u003e {\n\t\tprices: vec![\n\t\t\t(Asset::Btc, initial_btc_prices().into_iter().map(FixedNumber::from_num).collect()),\n\t\t\t(Asset::Eos, initial_eos_prices().into_iter().map(FixedNumber::from_num).collect()),\n\t\t],\n\t}\n\t\t.assimilate_storage(\u0026mut t)\n\t\t.unwrap();\n\n\tt.into()\n}\n\npub fn new_test_ext_empty_storage() -\u003e sp_io::TestExternalities {\n\tsystem::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap().into()\n}\n","traces":[{"line":30,"address":[4248065,4248032,4248103],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[4859792],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4855696],"length":1,"stats":{"Line":1},"fn_name":"set_now"},{"line":39,"address":[4247696,4247710],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":48,"address":[4860017],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[4855744],"length":1,"stats":{"Line":1},"fn_name":"now"},{"line":90,"address":[4247840,4247849],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":116,"address":[4855792],"length":1,"stats":{"Line":0},"fn_name":"into_type_iter"},{"line":117,"address":[4855799],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[4855888],"length":1,"stats":{"Line":5},"fn_name":"initial_btc_prices"},{"line":125,"address":[4855895],"length":1,"stats":{"Line":5},"fn_name":null},{"line":139,"address":[4856096],"length":1,"stats":{"Line":5},"fn_name":"initial_eos_prices"},{"line":140,"address":[4856103],"length":1,"stats":{"Line":5},"fn_name":null},{"line":154,"address":[4856288,4856335],"length":1,"stats":{"Line":5},"fn_name":"new_test_ext"},{"line":155,"address":[4856298,4856363],"length":1,"stats":{"Line":10},"fn_name":null},{"line":158,"address":[4856447,4856726,4857077,4856599],"length":1,"stats":{"Line":10},"fn_name":null},{"line":166,"address":[4856924],"length":1,"stats":{"Line":5},"fn_name":null},{"line":169,"address":[4857239,4857200],"length":1,"stats":{"Line":2},"fn_name":"new_test_ext_empty_storage"},{"line":170,"address":[4857324,4857210,4857267],"length":1,"stats":{"Line":6},"fn_name":null}],"covered":15,"coverable":21},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","tests.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::mock::*;\nuse frame_support::assert_ok;\nuse frame_support::dispatch::DispatchError;\nuse crate::{Financial, CalcReturnType, CalcVolatilityType, CalcCorrelationType, PriceUpdate, Error};\nuse crate::{calc_volatility, calc_correlation};\nuse financial_primitives::OnPriceSet;\nuse approx::assert_abs_diff_eq;\nuse substrate_fixed::traits::LossyInto;\nuse chrono::prelude::*;\nuse core::time::Duration;\n\nfn create_duration(year: i32, month: u32, day: u32, hour: u32, minute: u32, second: u32) -\u003e Duration {\n\tlet timestamp = Utc.ymd(year, month, day).and_hms(hour, minute, second).timestamp();\n\tDuration::from_secs(timestamp as u64)\n}\n\n#[cfg(test)]\nmod price_period {\n\tuse crate::*;\n\tuse crate::tests::create_duration;\n\n\t#[test]\n\tfn period_id_are_same_within_period() {\n\t\tlet time1 = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet time2 = create_duration(2020, 9, 14, 12, 54, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet period_id_1 = period.get_period_id(time1);\n\t\tlet period_id_2 = period.get_period_id(time2);\n\n\t\tassert!(period_id_1.is_ok());\n\t\tassert!(period_id_2.is_ok());\n\t\tassert_eq!(period_id_1, period_id_2);\n\t}\n\n\t#[test]\n\tfn period_id_are_different_for_different_periods() {\n\t\tlet time1 = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet time2 = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet period_id_1 = period.get_period_id(time1);\n\t\tlet period_id_2 = period.get_period_id(time2);\n\n\t\tassert!(period_id_1.is_ok());\n\t\tassert!(period_id_2.is_ok());\n\t\tassert!(period_id_1 != period_id_2);\n\t}\n\n\t#[test]\n\tfn info_for_neighbour_periods() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_curr_period_info(period_start, now);\n\t\tlet expected = Ok((create_duration(2020, 9, 14, 13, 0, 0), 1));\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn info_for_distant_periods() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_curr_period_info(period_start, now);\n\t\tlet expected = Ok((create_duration(2020, 9, 15, 7, 0, 0), 19));\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn invalid_period_start() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 42, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::InvalidPeriodStart);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_remains_unchanged() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 42, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start,\n\t\t\taction: PeriodAction::RemainsUnchanged,\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_changed_slightly() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start: create_duration(2020, 9, 14, 13, 0, 0),\n\t\t\taction: PeriodAction::StartedNew(0),\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_changed_significantly() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start: create_duration(2020, 9, 15, 7, 0, 0),\n\t\t\taction: PeriodAction::StartedNew(18),\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_is_in_the_past() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 12, 16, 27, 10);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::PeriodIsInThePast);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn zero_period() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(0);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::DivisionByZero);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn elapsed_period_count_is_too_large() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = Duration::from_secs(u64::MAX);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::Overflow);\n\n\t\tassert_eq!(actual, expected);\n\t}\n}\n\n#[cfg(test)]\nmod new_prices {\n\tuse crate::*;\n\n\t#[test]\n\tfn no_last_price_no_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(None, 123, 0, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn no_last_price_some_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(None, 123, 3, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_no_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 0, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_less_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 3, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_equal_to_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 4, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_slightly_more_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 5, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_significantly_more_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 27, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn max_periods_is_zero() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 27, 0);\n\t\tlet expected = Err(GetNewPricesError::Overflow);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn max_periods_is_one() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 3, 1);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n}\n\n#[test]\nfn calc_linear_return_for_btc_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.04390906,\n\t\t\t0.01631017,\n\t\t\t0.00252155,\n\t\t\t0.01452191,\n\t\t\t0.01506927,\n\t\t\t0.00147006,\n\t\t\t0.12731809,\n\t\t\t-0.01619013,\n\t\t\t0.02381692,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_log_return_for_btc_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Log, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.042972378,\n\t\t\t0.016178588,\n\t\t\t0.002518380,\n\t\t\t0.014417479,\n\t\t\t0.014956852,\n\t\t\t0.001468981,\n\t\t\t0.119841444,\n\t\t\t-0.016322624,\n\t\t\t0.023537722,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_linear_return_for_eos_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Eos)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.01908397,\n\t\t\t0.01872659,\n\t\t\t0.00000000,\n\t\t\t0.00735294,\n\t\t\t0.00364964,\n\t\t\t0.01090909,\n\t\t\t0.08633094,\n\t\t\t-0.06291391,\n\t\t\t0.02120141,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_log_return_for_eos_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Log, Asset::Eos)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.018904155,\n\t\t\t0.018553408,\n\t\t\t0.000000000,\n\t\t\t0.007326040,\n\t\t\t0.003642991,\n\t\t\t0.010850016,\n\t\t\t0.082805904,\n\t\t\t-0.064980120,\n\t\t\t0.020979790,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_linear_return_for_btc_using_some_oracle_prices() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet prices: Vec\u003c_\u003e = vec![\n\t\t\t8_988.60,\n\t\t\t8_897.47,\n\t\t\t8_912.65,\n\t\t\t9_003.07,\n\t\t].into_iter().map(FixedNumber::from_num).collect();\n \n\t\tlet mut now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tfor p in prices.into_iter() {\n\t\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(Asset::Btc, p);\n\n\t\t\tassert_ok!(result);\n\n\t\t\tnow = now + Duration::from_secs(60 * 60);\n\t\t\tset_now(now);\n\t\t}\n\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.01506927,\n\t\t\t0.00147006,\n\t\t\t0.12731809,\n\t\t\t-0.01619013,\n\t\t\t0.02381692,\n\t\t\t0.01396878,\n\t\t\t-0.01013840,\n\t\t\t0.00170610,\n\t\t\t0.01014513,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn initial_prices_state_with_empty_genesis() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = None;\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = 0;\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn initial_prices_state_with_nonempty_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = None;\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = initial_btc_prices()\n\t\t\t.into_iter().map(FixedNumber::from_num).collect();\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn first_price_with_empty_genesis() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(period_start, now, price));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_the_past() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet past_price = FixedNumber::from_num(7_300);\n\t\tlet past_now = create_duration(2020, 9, 13, 0, 3, 0);\n\t\tset_now(past_now);\n\n\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, past_price);\n\t\tlet expected_result: Result\u003c(), DispatchError\u003e = Err(Error::\u003cTest\u003e::PeriodIsInThePast.into());\n\t\tassert_eq!(result, expected_result);\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(period_start, now, price));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_current_period() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet same_period_price = FixedNumber::from_num(9_100);\n\t\tlet same_period_now = create_duration(2020, 9, 14, 12, 48, 0);\n\t\tset_now(same_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, same_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tperiod_start,\n\t\t\tsame_period_now,\n\t\t\tsame_period_price\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_next_period() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet next_period_start = create_duration(2020, 9, 14, 13, 0, 0);\n\t\tlet next_period_price = FixedNumber::from_num(9_100);\n\t\tlet next_period_now = create_duration(2020, 9, 14, 13, 27, 0);\n\t\tset_now(next_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, next_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnext_period_start,\n\t\t\tnext_period_now,\n\t\t\tnext_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price, next_period_price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_a_few_periods_ahead() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet new_period_start = create_duration(2020, 9, 14, 16, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(9_100);\n\t\tlet new_period_now = create_duration(2020, 9, 14, 16, 27, 0);\n\t\tset_now(new_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnew_period_now,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tnew_period_price,\n\t\t];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_many_periods_ahead() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet new_period_start = create_duration(2020, 10, 3, 22, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(9_100);\n\t\tlet new_period_now = create_duration(2020, 10, 3, 22, 27, 0);\n\t\tset_now(new_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnew_period_now,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet mut expected_prices: Vec\u003cFixedNumber\u003e = vec![price; PriceCount::get() as usize - 1];\n\t\texpected_prices.push(new_period_price);\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn wrong_now_in_the_distant_future() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet distant_future_price = FixedNumber::from_num(9_100);\n\t\tlet distant_future_now = Duration::from_secs(u64::MAX);\n\t\tset_now(distant_future_now);\n\n\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, distant_future_price);\n\t\tlet expected_result: Result\u003c(), DispatchError\u003e = Err(Error::\u003cTest\u003e::Overflow.into());\n\t\tassert_eq!(result, expected_result);\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tperiod_start,\n\t\t\tnow,\n\t\t\tprice,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_has_arravied_while_prices_countainer_is_full() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet prices: Vec\u003c_\u003e = vec![\n\t\t\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10,\n\t\t].into_iter().map(FixedNumber::from_num).collect();\n \n\t\tlet mut now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tfor \u0026p in prices.iter() {\n\t\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, p);\n\n\t\t\tassert_ok!(result);\n\n\t\t\tnow = now + Duration::from_secs(60 * 60);\n\t\t\tset_now(now);\n\t\t}\n\n\t\tlet new_period_start = create_duration(2020, 9, 14, 22, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(11);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnow,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet actual_prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet mut expected_prices: Vec\u003c_\u003e = prices[1..].iter().copied().collect();\n\t\texpected_prices.push(new_period_price);\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(actual_prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\nfn btc_prices() -\u003e Vec\u003cFixedNumber\u003e {\n    vec![\n        7_117.21, 7_429.72, 7_550.90, 7_569.94, 7_679.87, 7_795.60, 7_807.06, 8_801.04, 8_658.55, 8_864.77, 8_988.60, 8_897.47, 8_912.65, 9_003.07, 9_268.76, 9_951.52, 9_842.67, 9_593.90, 8_756.43, 8_601.80, 8_804.48, 9_269.99, 9_733.72, 9_328.20, 9_377.01, 9_670.74, 9_726.57, 9_729.04, 9_522.98, 9_081.76,\n    ].into_iter().map(FixedNumber::from_num).collect()\n}\n\n#[test]\nfn calc_volatility_btc_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Regular;\n    let prices = btc_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.03897272754;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\nfn eos_prices() -\u003e Vec\u003cFixedNumber\u003e {\n    vec![\n        2.62, 2.67, 2.72, 2.72, 2.74, 2.75, 2.78, 3.02, 2.83, 2.89, 2.95, 2.84, 2.78, 2.77, 2.69, 2.76, 2.76, 2.76, 2.45, 2.41, 2.44, 2.53, 2.61, 2.59, 2.63, 2.62, 2.66, 2.63, 2.6, 2.47,\n    ].into_iter().map(FixedNumber::from_num).collect()\n}\n\n#[test]\nfn calc_volatility_eos_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Regular;\n    let prices = eos_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.03608986052;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_correlation_btc_eos_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let corr_type = CalcCorrelationType::Regular;\n    let btc_prices = btc_prices();\n    let eos_prices = eos_prices();\n\n    let actual = calc_correlation(return_type, corr_type, \u0026btc_prices, \u0026eos_prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.83127977977;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_volatility_btc_log_exponential() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Exponential(36);\n    let prices = btc_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.0373329770530;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_correlation_btc_eos_log_exponential() {\n    let return_type = CalcReturnType::Log;\n    let corr_type = CalcCorrelationType::Exponential(36);\n    let btc_prices = btc_prices();\n    let eos_prices = eos_prices();\n\n    let actual = calc_correlation(return_type, corr_type, \u0026btc_prices, \u0026eos_prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.726633137678748;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n","traces":[{"line":27,"address":[4920752],"length":1,"stats":{"Line":1},"fn_name":"create_duration"},{"line":28,"address":[4920783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4920904],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4628416],"length":1,"stats":{"Line":3},"fn_name":"period_id_are_same_within_period"},{"line":39,"address":[4628426],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[4628484],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[4628539],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[4628547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[4628571],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[4628641,4628598],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[4628675,4628769,4628622],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4628817,4628803,4628681],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4629104],"length":1,"stats":{"Line":3},"fn_name":"period_id_are_different_for_different_periods"},{"line":55,"address":[4629111],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[4629163],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[4629212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[4629220],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[4629244],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[4629308,4629268],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[4629369,4629292,4629342],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[4629414,4629403,4629444,4629348],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[4629456],"length":1,"stats":{"Line":3},"fn_name":"info_for_neighbour_periods"},{"line":71,"address":[4629466],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[4629527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[4629582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[4629593],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[4629638],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[4629769,4629873],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[4630160],"length":1,"stats":{"Line":3},"fn_name":"info_for_distant_periods"},{"line":85,"address":[4630170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[4630231],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[4630286],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[4630297],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[4630342],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[4630577,4630473],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[4630864],"length":1,"stats":{"Line":3},"fn_name":"invalid_period_start"},{"line":99,"address":[4630874],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[4630932],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[4630987],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[4631000],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[4631073],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[4631089,4631196],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[4631488],"length":1,"stats":{"Line":3},"fn_name":"period_remains_unchanged"},{"line":113,"address":[4631497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[4631555],"length":1,"stats":{"Line":1},"fn_name":null},{"line":117,"address":[4631610],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[4631623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[4631712],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[4631696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[4631815,4631919],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[4632208],"length":1,"stats":{"Line":3},"fn_name":"period_changed_slightly"},{"line":130,"address":[4632217],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[4632278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":134,"address":[4632333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[4632352],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[4632497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[4632430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[4632470],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[4632704,4632600],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[4632992],"length":1,"stats":{"Line":3},"fn_name":"period_changed_significantly"},{"line":147,"address":[4633001],"length":1,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[4633062],"length":1,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[4633117],"length":1,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[4633136],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[4633281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":155,"address":[4633214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":156,"address":[4633254],"length":1,"stats":{"Line":1},"fn_name":null},{"line":159,"address":[4633384,4633488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":163,"address":[4633776],"length":1,"stats":{"Line":3},"fn_name":"period_is_in_the_past"},{"line":164,"address":[4633785],"length":1,"stats":{"Line":1},"fn_name":null},{"line":165,"address":[4633840],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[4633901],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[4633914],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[4633987],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[4634110,4634003],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[4634400],"length":1,"stats":{"Line":3},"fn_name":"zero_period"},{"line":178,"address":[4634409],"length":1,"stats":{"Line":1},"fn_name":null},{"line":179,"address":[4634467],"length":1,"stats":{"Line":1},"fn_name":null},{"line":182,"address":[4634522],"length":1,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[4634535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[4634608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":187,"address":[4634731,4634624],"length":1,"stats":{"Line":1},"fn_name":null},{"line":191,"address":[4635024],"length":1,"stats":{"Line":3},"fn_name":"elapsed_period_count_is_too_large"},{"line":192,"address":[4635033],"length":1,"stats":{"Line":1},"fn_name":null},{"line":193,"address":[4635088],"length":1,"stats":{"Line":1},"fn_name":null},{"line":196,"address":[4635124],"length":1,"stats":{"Line":1},"fn_name":null},{"line":198,"address":[4635137],"length":1,"stats":{"Line":1},"fn_name":null},{"line":199,"address":[4635210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":201,"address":[4635333,4635226],"length":1,"stats":{"Line":1},"fn_name":null},{"line":210,"address":[5304672,5304721],"length":1,"stats":{"Line":3},"fn_name":"no_last_price_no_empty_periods"},{"line":211,"address":[5304682],"length":1,"stats":{"Line":1},"fn_name":null},{"line":212,"address":[5304741,5304797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":214,"address":[5304965,5304834],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[5305380,5305328],"length":1,"stats":{"Line":3},"fn_name":"no_last_price_some_empty_periods"},{"line":219,"address":[5305335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":220,"address":[5305400,5305456],"length":1,"stats":{"Line":2},"fn_name":null},{"line":222,"address":[5305624,5305493],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[5306057,5306000],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_no_empty_periods"},{"line":227,"address":[5306010],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[5306077,5306133],"length":1,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[5306301,5306170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":234,"address":[5306732,5306672],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_less_than_max"},{"line":235,"address":[5306679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[5306836,5306757],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[5306873,5307004],"length":1,"stats":{"Line":1},"fn_name":null},{"line":242,"address":[5307376,5307436],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_equal_to_max"},{"line":243,"address":[5307383],"length":1,"stats":{"Line":1},"fn_name":null},{"line":244,"address":[5307461,5307539],"length":1,"stats":{"Line":2},"fn_name":null},{"line":246,"address":[5307576,5307707],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[5308080,5308139],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_slightly_more_than_max"},{"line":251,"address":[5308087],"length":1,"stats":{"Line":1},"fn_name":null},{"line":252,"address":[5308164,5308242],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[5308279,5308410],"length":1,"stats":{"Line":1},"fn_name":null},{"line":258,"address":[5308844,5308784],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_significantly_more_than_max"},{"line":259,"address":[5308791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":260,"address":[5308869,5308947],"length":1,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[5308984,5309115],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[5309545,5309488],"length":1,"stats":{"Line":3},"fn_name":"max_periods_is_zero"},{"line":267,"address":[5309498],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[5309560],"length":1,"stats":{"Line":1},"fn_name":null},{"line":270,"address":[5309577,5309720],"length":1,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[5310156,5310096],"length":1,"stats":{"Line":3},"fn_name":"max_periods_is_one"},{"line":275,"address":[5310103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[5310232,5310176],"length":1,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[5310400,5310269],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[4586005,4586000],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":284,"address":[4586080,4586137],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":285,"address":[4586094,4586159],"length":1,"stats":{"Line":2},"fn_name":null},{"line":286,"address":[4586051,4586246,4586032],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":287,"address":[4586264,4586436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":299,"address":[4586444,4586696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[4587553,4588467,4587314,4587065,4586630,4587279],"length":1,"stats":{"Line":4},"fn_name":null},{"line":301,"address":[4587558,4587396],"length":1,"stats":{"Line":1},"fn_name":null},{"line":307,"address":[4588597,4588592],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":308,"address":[4588730,4588672],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":309,"address":[4588686,4588752],"length":1,"stats":{"Line":2},"fn_name":null},{"line":310,"address":[4588839,4588643,4588624],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":311,"address":[4589029,4588857],"length":1,"stats":{"Line":2},"fn_name":null},{"line":323,"address":[4589289,4589037],"length":1,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[4589223,4589658,4589872,4589907,4591060,4590146],"length":1,"stats":{"Line":4},"fn_name":null},{"line":325,"address":[4590151,4589989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":331,"address":[4591184,4591189],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":332,"address":[4591322,4591264],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":333,"address":[4591278,4591344],"length":1,"stats":{"Line":2},"fn_name":null},{"line":334,"address":[4591235,4591216,4591431],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":335,"address":[4591615,4591449],"length":1,"stats":{"Line":2},"fn_name":null},{"line":347,"address":[4591623,4591875],"length":1,"stats":{"Line":1},"fn_name":null},{"line":348,"address":[4592493,4593646,4592244,4591809,4592732,4592458],"length":1,"stats":{"Line":4},"fn_name":null},{"line":349,"address":[4592737,4592575],"length":1,"stats":{"Line":1},"fn_name":null},{"line":355,"address":[4593760,4593765],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":356,"address":[4593900,4593840],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":357,"address":[4593852,4593922],"length":1,"stats":{"Line":2},"fn_name":null},{"line":358,"address":[4593792,4593811,4594009],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":359,"address":[4594027,4594193],"length":1,"stats":{"Line":2},"fn_name":null},{"line":371,"address":[4594453,4594201],"length":1,"stats":{"Line":1},"fn_name":null},{"line":372,"address":[4596224,4594822,4595036,4595071,4594387,4595310],"length":1,"stats":{"Line":4},"fn_name":null},{"line":373,"address":[4595153,4595315],"length":1,"stats":{"Line":1},"fn_name":null},{"line":379,"address":[4596336,4596341],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":380,"address":[4596416,4596552],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":381,"address":[4596428,4596567],"length":1,"stats":{"Line":2},"fn_name":null},{"line":386,"address":[4596630],"length":1,"stats":{"Line":1},"fn_name":null},{"line":388,"address":[4596667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":389,"address":[4596719],"length":1,"stats":{"Line":1},"fn_name":null},{"line":391,"address":[4596956,4597031,4597584,4596741],"length":1,"stats":{"Line":3},"fn_name":null},{"line":392,"address":[4597107],"length":1,"stats":{"Line":1},"fn_name":null},{"line":394,"address":[4597354,4597121],"length":1,"stats":{"Line":1},"fn_name":null},{"line":396,"address":[4597476,4597283],"length":1,"stats":{"Line":2},"fn_name":null},{"line":397,"address":[4597562],"length":1,"stats":{"Line":1},"fn_name":null},{"line":400,"address":[4597599],"length":1,"stats":{"Line":1},"fn_name":null},{"line":401,"address":[4596368,4596387,4597709],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":402,"address":[4597899,4597727],"length":1,"stats":{"Line":2},"fn_name":null},{"line":414,"address":[4597907,4598159],"length":1,"stats":{"Line":1},"fn_name":null},{"line":415,"address":[4599016,4599984,4598093,4598528,4598742,4598777],"length":1,"stats":{"Line":4},"fn_name":null},{"line":416,"address":[4599021,4598859],"length":1,"stats":{"Line":1},"fn_name":null},{"line":422,"address":[4600144,4600149],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":423,"address":[4600176,4600208],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":424,"address":[4600185],"length":1,"stats":{"Line":1},"fn_name":null},{"line":426,"address":[4600193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":427,"address":[4600225],"length":1,"stats":{"Line":1},"fn_name":null},{"line":429,"address":[4600237],"length":1,"stats":{"Line":1},"fn_name":null},{"line":430,"address":[4600375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":432,"address":[4600392,4600443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":433,"address":[4600480],"length":1,"stats":{"Line":1},"fn_name":null},{"line":435,"address":[4600707,4600499],"length":1,"stats":{"Line":1},"fn_name":null},{"line":436,"address":[4600612,4601187,4601074],"length":1,"stats":{"Line":2},"fn_name":null},{"line":437,"address":[4601523,4601080],"length":1,"stats":{"Line":1},"fn_name":null},{"line":442,"address":[4601952,4601957],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":443,"address":[4602016,4601984],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":444,"address":[4601993],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4602001],"length":1,"stats":{"Line":1},"fn_name":null},{"line":447,"address":[4602033],"length":1,"stats":{"Line":1},"fn_name":null},{"line":449,"address":[4602045],"length":1,"stats":{"Line":1},"fn_name":null},{"line":450,"address":[4602183],"length":1,"stats":{"Line":1},"fn_name":null},{"line":453,"address":[4602269,4602323],"length":1,"stats":{"Line":2},"fn_name":null},{"line":454,"address":[4602360],"length":1,"stats":{"Line":1},"fn_name":null},{"line":456,"address":[4602396,4602604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":457,"address":[4603084,4602509,4602971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":458,"address":[4603414,4602977],"length":1,"stats":{"Line":1},"fn_name":null},{"line":463,"address":[4603840,4603845],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":464,"address":[4603872,4603937],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":465,"address":[4603879],"length":1,"stats":{"Line":1},"fn_name":null},{"line":467,"address":[4603892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":469,"address":[4603954],"length":1,"stats":{"Line":1},"fn_name":null},{"line":470,"address":[4604018],"length":1,"stats":{"Line":1},"fn_name":null},{"line":471,"address":[4604094],"length":1,"stats":{"Line":1},"fn_name":null},{"line":473,"address":[4604279,4604134],"length":1,"stats":{"Line":1},"fn_name":null},{"line":475,"address":[4604253],"length":1,"stats":{"Line":1},"fn_name":null},{"line":476,"address":[4604420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":478,"address":[4604545],"length":1,"stats":{"Line":1},"fn_name":null},{"line":479,"address":[4604695],"length":1,"stats":{"Line":1},"fn_name":null},{"line":481,"address":[4604756,4604810],"length":1,"stats":{"Line":2},"fn_name":null},{"line":482,"address":[4604847],"length":1,"stats":{"Line":1},"fn_name":null},{"line":484,"address":[4604883,4605091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":485,"address":[4604996,4605458,4605571],"length":1,"stats":{"Line":2},"fn_name":null},{"line":486,"address":[4605913,4605464],"length":1,"stats":{"Line":1},"fn_name":null},{"line":491,"address":[4606336,4606341],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":492,"address":[4606368,4606433],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":493,"address":[4606375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":495,"address":[4606388],"length":1,"stats":{"Line":1},"fn_name":null},{"line":497,"address":[4606450],"length":1,"stats":{"Line":1},"fn_name":null},{"line":498,"address":[4606514],"length":1,"stats":{"Line":1},"fn_name":null},{"line":499,"address":[4606590],"length":1,"stats":{"Line":1},"fn_name":null},{"line":501,"address":[4606808,4606630],"length":1,"stats":{"Line":1},"fn_name":null},{"line":503,"address":[4606752],"length":1,"stats":{"Line":1},"fn_name":null},{"line":504,"address":[4606951],"length":1,"stats":{"Line":1},"fn_name":null},{"line":505,"address":[4607027],"length":1,"stats":{"Line":1},"fn_name":null},{"line":507,"address":[4607067],"length":1,"stats":{"Line":1},"fn_name":null},{"line":508,"address":[4607072],"length":1,"stats":{"Line":1},"fn_name":null},{"line":509,"address":[4607138,4607269],"length":1,"stats":{"Line":1},"fn_name":null},{"line":511,"address":[4607251],"length":1,"stats":{"Line":1},"fn_name":null},{"line":512,"address":[4607604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":514,"address":[4607729],"length":1,"stats":{"Line":1},"fn_name":null},{"line":515,"address":[4607879],"length":1,"stats":{"Line":1},"fn_name":null},{"line":517,"address":[4607940,4607994],"length":1,"stats":{"Line":2},"fn_name":null},{"line":518,"address":[4608031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":520,"address":[4608067,4608275],"length":1,"stats":{"Line":1},"fn_name":null},{"line":521,"address":[4608642,4608180,4608755],"length":1,"stats":{"Line":2},"fn_name":null},{"line":522,"address":[4608648,4609091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":527,"address":[4609525,4609520],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":528,"address":[4609552,4609617],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":529,"address":[4609559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":531,"address":[4609572],"length":1,"stats":{"Line":1},"fn_name":null},{"line":533,"address":[4609634],"length":1,"stats":{"Line":1},"fn_name":null},{"line":534,"address":[4609698],"length":1,"stats":{"Line":1},"fn_name":null},{"line":535,"address":[4609774],"length":1,"stats":{"Line":1},"fn_name":null},{"line":537,"address":[4609814,4609992],"length":1,"stats":{"Line":1},"fn_name":null},{"line":539,"address":[4609936],"length":1,"stats":{"Line":1},"fn_name":null},{"line":540,"address":[4610136],"length":1,"stats":{"Line":1},"fn_name":null},{"line":541,"address":[4610212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":543,"address":[4610252,4610397],"length":1,"stats":{"Line":1},"fn_name":null},{"line":545,"address":[4610371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":546,"address":[4610538],"length":1,"stats":{"Line":1},"fn_name":null},{"line":552,"address":[4610663],"length":1,"stats":{"Line":1},"fn_name":null},{"line":553,"address":[4610813],"length":1,"stats":{"Line":1},"fn_name":null},{"line":555,"address":[4610874,4610928],"length":1,"stats":{"Line":2},"fn_name":null},{"line":556,"address":[4610965],"length":1,"stats":{"Line":1},"fn_name":null},{"line":558,"address":[4611001,4611209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":559,"address":[4611576,4611114,4611689],"length":1,"stats":{"Line":2},"fn_name":null},{"line":560,"address":[4611582,4612031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":565,"address":[4612464,4612469],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":566,"address":[4612496,4612561],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":567,"address":[4612503],"length":1,"stats":{"Line":1},"fn_name":null},{"line":569,"address":[4612516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":571,"address":[4612579],"length":1,"stats":{"Line":1},"fn_name":null},{"line":572,"address":[4612655],"length":1,"stats":{"Line":1},"fn_name":null},{"line":574,"address":[4612695,4612888],"length":1,"stats":{"Line":1},"fn_name":null},{"line":576,"address":[4612814],"length":1,"stats":{"Line":1},"fn_name":null},{"line":577,"address":[4613034],"length":1,"stats":{"Line":1},"fn_name":null},{"line":578,"address":[4613080],"length":1,"stats":{"Line":1},"fn_name":null},{"line":579,"address":[4613156],"length":1,"stats":{"Line":1},"fn_name":null},{"line":581,"address":[4613196,4613341],"length":1,"stats":{"Line":1},"fn_name":null},{"line":583,"address":[4613315],"length":1,"stats":{"Line":1},"fn_name":null},{"line":584,"address":[4613482],"length":1,"stats":{"Line":1},"fn_name":null},{"line":590,"address":[4613607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":591,"address":[4613757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":593,"address":[4613842,4613896],"length":1,"stats":{"Line":2},"fn_name":null},{"line":594,"address":[4613933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":596,"address":[4614177,4613969],"length":1,"stats":{"Line":1},"fn_name":null},{"line":597,"address":[4614544,4614082,4614657],"length":1,"stats":{"Line":2},"fn_name":null},{"line":598,"address":[4614999,4614550],"length":1,"stats":{"Line":1},"fn_name":null},{"line":603,"address":[4615429,4615424],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":604,"address":[4615456,4615521],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":605,"address":[4615463],"length":1,"stats":{"Line":1},"fn_name":null},{"line":607,"address":[4615476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":609,"address":[4615539],"length":1,"stats":{"Line":1},"fn_name":null},{"line":610,"address":[4615615],"length":1,"stats":{"Line":1},"fn_name":null},{"line":612,"address":[4615655,4615848],"length":1,"stats":{"Line":1},"fn_name":null},{"line":614,"address":[4615774],"length":1,"stats":{"Line":1},"fn_name":null},{"line":615,"address":[4615994],"length":1,"stats":{"Line":1},"fn_name":null},{"line":616,"address":[4616040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":617,"address":[4616116],"length":1,"stats":{"Line":1},"fn_name":null},{"line":619,"address":[4616156,4616301],"length":1,"stats":{"Line":1},"fn_name":null},{"line":621,"address":[4616275],"length":1,"stats":{"Line":1},"fn_name":null},{"line":622,"address":[4616442],"length":1,"stats":{"Line":1},"fn_name":null},{"line":628,"address":[4616567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":629,"address":[4616717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":637,"address":[4616880,4616826],"length":1,"stats":{"Line":2},"fn_name":null},{"line":638,"address":[4616917],"length":1,"stats":{"Line":1},"fn_name":null},{"line":640,"address":[4616953,4617161],"length":1,"stats":{"Line":1},"fn_name":null},{"line":641,"address":[4617528,4617066,4617641],"length":1,"stats":{"Line":2},"fn_name":null},{"line":642,"address":[4617534,4617983],"length":1,"stats":{"Line":1},"fn_name":null},{"line":647,"address":[4618421,4618416],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":648,"address":[4618513,4618448],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":649,"address":[4618455],"length":1,"stats":{"Line":1},"fn_name":null},{"line":651,"address":[4618468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":653,"address":[4618531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":654,"address":[4618607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":656,"address":[4618647,4618840],"length":1,"stats":{"Line":1},"fn_name":null},{"line":658,"address":[4618766],"length":1,"stats":{"Line":1},"fn_name":null},{"line":659,"address":[4618986],"length":1,"stats":{"Line":1},"fn_name":null},{"line":660,"address":[4619032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":661,"address":[4619108],"length":1,"stats":{"Line":1},"fn_name":null},{"line":663,"address":[4619148,4619293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":665,"address":[4619267],"length":1,"stats":{"Line":1},"fn_name":null},{"line":666,"address":[4619434],"length":1,"stats":{"Line":1},"fn_name":null},{"line":672,"address":[4619559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":673,"address":[4621363,4619699],"length":1,"stats":{"Line":1},"fn_name":null},{"line":674,"address":[4619816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":676,"address":[4619833,4619866],"length":1,"stats":{"Line":2},"fn_name":null},{"line":677,"address":[4619924],"length":1,"stats":{"Line":1},"fn_name":null},{"line":679,"address":[4619960,4620168],"length":1,"stats":{"Line":1},"fn_name":null},{"line":680,"address":[4620073,4620535,4620648],"length":1,"stats":{"Line":2},"fn_name":null},{"line":681,"address":[4620984,4620541],"length":1,"stats":{"Line":1},"fn_name":null},{"line":686,"address":[4621440,4621445],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":687,"address":[4621472,4621537],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":688,"address":[4621479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":690,"address":[4621492],"length":1,"stats":{"Line":1},"fn_name":null},{"line":692,"address":[4621554],"length":1,"stats":{"Line":1},"fn_name":null},{"line":693,"address":[4621618],"length":1,"stats":{"Line":1},"fn_name":null},{"line":694,"address":[4621694],"length":1,"stats":{"Line":1},"fn_name":null},{"line":696,"address":[4621912,4621734],"length":1,"stats":{"Line":1},"fn_name":null},{"line":698,"address":[4621856],"length":1,"stats":{"Line":1},"fn_name":null},{"line":699,"address":[4622053],"length":1,"stats":{"Line":1},"fn_name":null},{"line":700,"address":[4622110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":702,"address":[4622150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":703,"address":[4622155],"length":1,"stats":{"Line":1},"fn_name":null},{"line":704,"address":[4622221,4622352],"length":1,"stats":{"Line":1},"fn_name":null},{"line":706,"address":[4622334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":707,"address":[4622687],"length":1,"stats":{"Line":1},"fn_name":null},{"line":713,"address":[4622812],"length":1,"stats":{"Line":1},"fn_name":null},{"line":714,"address":[4622962],"length":1,"stats":{"Line":1},"fn_name":null},{"line":716,"address":[4623077,4623023],"length":1,"stats":{"Line":2},"fn_name":null},{"line":717,"address":[4623114],"length":1,"stats":{"Line":1},"fn_name":null},{"line":719,"address":[4623358,4623150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":720,"address":[4623838,4623263,4623725],"length":1,"stats":{"Line":2},"fn_name":null},{"line":721,"address":[4623731,4624174],"length":1,"stats":{"Line":1},"fn_name":null},{"line":726,"address":[4624608,4624613],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":727,"address":[4624640,4624765],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":728,"address":[4624647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":730,"address":[4624780,4624655],"length":1,"stats":{"Line":2},"fn_name":null},{"line":734,"address":[4624872],"length":1,"stats":{"Line":1},"fn_name":null},{"line":735,"address":[4624924],"length":1,"stats":{"Line":1},"fn_name":null},{"line":737,"address":[4625222,4625761,4624972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":738,"address":[4625281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":740,"address":[4625298,4625531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":742,"address":[4625460,4625653],"length":1,"stats":{"Line":2},"fn_name":null},{"line":743,"address":[4625739],"length":1,"stats":{"Line":1},"fn_name":null},{"line":746,"address":[4625191,4625789],"length":1,"stats":{"Line":2},"fn_name":null},{"line":747,"address":[4625831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":749,"address":[4625896,4626049],"length":1,"stats":{"Line":1},"fn_name":null},{"line":751,"address":[4626031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":752,"address":[4626187],"length":1,"stats":{"Line":1},"fn_name":null},{"line":754,"address":[4626171],"length":1,"stats":{"Line":1},"fn_name":null},{"line":758,"address":[4626316],"length":1,"stats":{"Line":1},"fn_name":null},{"line":759,"address":[4626443],"length":1,"stats":{"Line":1},"fn_name":null},{"line":760,"address":[4626619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":762,"address":[4626636,4626669],"length":1,"stats":{"Line":2},"fn_name":null},{"line":763,"address":[4626727],"length":1,"stats":{"Line":1},"fn_name":null},{"line":765,"address":[4626971,4626763],"length":1,"stats":{"Line":1},"fn_name":null},{"line":766,"address":[4627338,4627451,4626876],"length":1,"stats":{"Line":2},"fn_name":null},{"line":767,"address":[4627787,4627344],"length":1,"stats":{"Line":1},"fn_name":null},{"line":771,"address":[4920944],"length":1,"stats":{"Line":3},"fn_name":"btc_prices"},{"line":772,"address":[4920954],"length":1,"stats":{"Line":3},"fn_name":null},{"line":778,"address":[4628261,4628256],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":779,"address":[4923772],"length":1,"stats":{"Line":1},"fn_name":null},{"line":780,"address":[4923780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":781,"address":[4923791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":783,"address":[4923821],"length":1,"stats":{"Line":1},"fn_name":null},{"line":784,"address":[4923948,4924181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":785,"address":[4924100,4924319],"length":1,"stats":{"Line":2},"fn_name":null},{"line":787,"address":[4924363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":789,"address":[4924554,4924379],"length":1,"stats":{"Line":1},"fn_name":null},{"line":792,"address":[4921696],"length":1,"stats":{"Line":2},"fn_name":"eos_prices"},{"line":793,"address":[4921706],"length":1,"stats":{"Line":2},"fn_name":null},{"line":799,"address":[4628288,4628293],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":800,"address":[4925420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":801,"address":[4925428],"length":1,"stats":{"Line":1},"fn_name":null},{"line":802,"address":[4925439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":804,"address":[4925469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":805,"address":[4925829,4925596],"length":1,"stats":{"Line":1},"fn_name":null},{"line":806,"address":[4925967,4925748],"length":1,"stats":{"Line":2},"fn_name":null},{"line":808,"address":[4926011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":810,"address":[4926202,4926027],"length":1,"stats":{"Line":1},"fn_name":null},{"line":814,"address":[4628320,4628325],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":815,"address":[4927068],"length":1,"stats":{"Line":1},"fn_name":null},{"line":816,"address":[4927076],"length":1,"stats":{"Line":1},"fn_name":null},{"line":817,"address":[4927087],"length":1,"stats":{"Line":1},"fn_name":null},{"line":818,"address":[4927125],"length":1,"stats":{"Line":1},"fn_name":null},{"line":820,"address":[4927246,4927284,4927132],"length":1,"stats":{"Line":3},"fn_name":null},{"line":821,"address":[4927607,4927374],"length":1,"stats":{"Line":1},"fn_name":null},{"line":822,"address":[4927526,4927745],"length":1,"stats":{"Line":2},"fn_name":null},{"line":824,"address":[4927789],"length":1,"stats":{"Line":1},"fn_name":null},{"line":826,"address":[4927805,4927980],"length":1,"stats":{"Line":1},"fn_name":null},{"line":830,"address":[4628357,4628352],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":831,"address":[4928892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":832,"address":[4928900],"length":1,"stats":{"Line":1},"fn_name":null},{"line":833,"address":[4928922],"length":1,"stats":{"Line":1},"fn_name":null},{"line":835,"address":[4928952],"length":1,"stats":{"Line":1},"fn_name":null},{"line":836,"address":[4929079,4929312],"length":1,"stats":{"Line":1},"fn_name":null},{"line":837,"address":[4929450,4929231],"length":1,"stats":{"Line":2},"fn_name":null},{"line":839,"address":[4929494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":841,"address":[4929685,4929510],"length":1,"stats":{"Line":1},"fn_name":null},{"line":845,"address":[4628384,4628389],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":846,"address":[4930556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":847,"address":[4930564],"length":1,"stats":{"Line":1},"fn_name":null},{"line":848,"address":[4930586],"length":1,"stats":{"Line":1},"fn_name":null},{"line":849,"address":[4930624],"length":1,"stats":{"Line":1},"fn_name":null},{"line":851,"address":[4930631,4930745,4930783],"length":1,"stats":{"Line":3},"fn_name":null},{"line":852,"address":[4930873,4931106],"length":1,"stats":{"Line":1},"fn_name":null},{"line":853,"address":[4931244,4931025],"length":1,"stats":{"Line":2},"fn_name":null},{"line":855,"address":[4931288],"length":1,"stats":{"Line":1},"fn_name":null},{"line":857,"address":[4931304,4931479],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":422,"coverable":422},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse financial_primitives::OnPriceSet;\nuse frame_support::{decl_error, decl_event, decl_module, decl_storage, dispatch, traits::Get};\nuse frame_system::ensure_signed;\nuse frame_support::codec::Codec;\nuse frame_support::dispatch::Parameter;\n\n#[cfg(test)]\nmod mock;\n\n#[cfg(test)]\nmod tests;\n\npub trait Trait: frame_system::Trait {\n\ttype Event: From\u003cEvent\u003cSelf\u003e\u003e + Into\u003c\u003cSelf as frame_system::Trait\u003e::Event\u003e;\n\ttype Asset: Codec + Parameter + Default + Copy;\n\ttype Price: Codec + Parameter + Default + Copy;\n\ttype OnPriceSet: OnPriceSet\u003cPrice = Self::Price, Asset = Self::Asset\u003e;\n}\n\ndecl_storage! {\n\ttrait Store for Module\u003cT: Trait\u003e as OracleModule {\n\t\tPricePoints get(fn price_points): map hasher(identity) T::Asset =\u003e T::Price;\n\t}\n\tadd_extra_genesis {\n\t\tconfig(prices): Vec\u003c(T::Asset, T::Price)\u003e;\n\n        build(|config| {\n            for \u0026(asset, value) in config.prices.iter() {\n                PricePoints::\u003cT\u003e::insert(asset, value);\n            }\n        });\n    }\n}\n\ndecl_event!(\n\tpub enum Event\u003cT\u003e\n\twhere\n\t\tAccountId = \u003cT as frame_system::Trait\u003e::AccountId,\n\t\tAsset = \u003cT as Trait\u003e::Asset,\n\t\tPrice = \u003cT as Trait\u003e::Price,\n\t{\n\t\tPriceSet(Asset, Price, AccountId),\n\t}\n);\n\ndecl_error! {\n    pub enum Error for Module\u003cT: Trait\u003e {}\n}\n\ndecl_module! {\n    pub struct Module\u003cT: Trait\u003e for enum Call where origin: T::Origin {\n        type Error = Error\u003cT\u003e;\n\n        fn deposit_event() = default;\n\n\t\t#[weight = 10_000 + T::DbWeight::get().writes(1)]\n\t\tpub fn set_price(origin, asset: T::Asset, value: T::Price) -\u003e dispatch::DispatchResult {\n\t\t\tlet who = ensure_signed(origin)?;\n\n\t\t\tPricePoints::\u003cT\u003e::insert(asset, value);\n\n\t\t\tlet _ = T::OnPriceSet::on_price_set(asset, value);\n\t\t\tSelf::deposit_event(RawEvent::PriceSet(asset, value, who));\n\t\t\tOk(())\n\t\t}\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","mock.rs"],"content":"use crate::{Module, Trait};\nuse sp_core::H256;\nuse frame_support::{impl_outer_origin, parameter_types, weights::Weight};\nuse sp_runtime::{\n\ttraits::{BlakeTwo256, IdentityLookup}, testing::Header, Perbill,\n};\nuse frame_system as system;\nuse common::Asset;\nuse financial_primitives::OnPriceSet;\nuse frame_support::dispatch::DispatchError;\n\nimpl_outer_origin! {\n\tpub enum Origin for Test {}\n}\n\n// Configure a mock runtime to test the pallet.\n\n#[derive(Clone, Eq, PartialEq)]\npub struct Test;\nparameter_types! {\n\tpub const BlockHashCount: u64 = 250;\n\tpub const MaximumBlockWeight: Weight = 1024;\n\tpub const MaximumBlockLength: u32 = 2 * 1024;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n}\n\nimpl system::Trait for Test {\n\ttype BaseCallFilter = ();\n\ttype Origin = Origin;\n\ttype Call = ();\n\ttype Index = u64;\n\ttype BlockNumber = u64;\n\ttype Hash = H256;\n\ttype Hashing = BlakeTwo256;\n\ttype AccountId = u64;\n\ttype Lookup = IdentityLookup\u003cSelf::AccountId\u003e;\n\ttype Header = Header;\n\ttype Event = ();\n\ttype BlockHashCount = BlockHashCount;\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\ttype DbWeight = ();\n\ttype BlockExecutionWeight = ();\n\ttype ExtrinsicBaseWeight = ();\n\ttype MaximumExtrinsicWeight = MaximumBlockWeight;\n\ttype MaximumBlockLength = MaximumBlockLength;\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\ttype Version = ();\n\ttype ModuleToIndex = ();\n\ttype AccountData = ();\n\ttype OnNewAccount = ();\n\ttype OnKilledAccount = ();\n\ttype SystemWeightInfo = ();\n}\n\nimpl Trait for Test {\n\ttype Event = ();\n\ttype Asset = Asset;\n\ttype Price = u32;\n\ttype OnPriceSet = TestOnPriceSet;\n}\n\npub struct TestOnPriceSet;\n\nimpl OnPriceSet for TestOnPriceSet {\n\ttype Asset = Asset;\n\ttype Price = u32;\n\tfn on_price_set(_asset: Asset, _value: u32) -\u003e Result\u003c(), DispatchError\u003e {\n\t\tOk(())\n\t}\n}\n\npub type OracleModule = Module\u003cTest\u003e;\n\n// Build genesis storage according to the mock runtime.\npub fn new_test_ext() -\u003e sp_io::TestExternalities {\n\tsystem::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap().into()\n}\n","traces":[{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":2},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","tests.rs"],"content":"use crate::mock::*;\nuse frame_support::{assert_ok};\nuse common::Asset;\n\n#[test]\nfn set_price_is_visible_through_storage() {\n\tnew_test_ext().execute_with(|| {\n\t\tassert_ok!(OracleModule::set_price(Origin::signed(1), Asset::Btc, 42));\n\t\tassert_eq!(OracleModule::price_points(Asset::Btc), 42);\n\t});\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","runtime","build.rs"],"content":"use wasm_builder_runner::WasmBuilder;\n\nfn main() {\n\tWasmBuilder::new()\n\t\t.with_current_project()\n\t\t.with_wasm_builder_from_crates(\"2.0.0\")\n\t\t.export_heap_base()\n\t\t.import_memory()\n\t\t.build()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","runtime","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n// `construct_runtime!` does a lot of recursion and requires us to increase the limit to 256.\n#![recursion_limit=\"256\"]\n\n// Make the WASM binary available.\n#[cfg(feature = \"std\")]\ninclude!(concat!(env!(\"OUT_DIR\"), \"/wasm_binary.rs\"));\n\nuse sp_std::prelude::*;\nuse sp_core::{crypto::KeyTypeId, OpaqueMetadata};\nuse sp_runtime::{\n\tApplyExtrinsicResult, generic, create_runtime_str, impl_opaque_keys, MultiSignature,\n\ttransaction_validity::{TransactionValidity, TransactionSource},\n};\nuse sp_runtime::traits::{\n\tBlakeTwo256, Block as BlockT, IdentityLookup, Verify, IdentifyAccount, NumberFor, Saturating,\n};\nuse sp_api::impl_runtime_apis;\nuse sp_consensus_aura::sr25519::AuthorityId as AuraId;\nuse pallet_grandpa::{AuthorityId as GrandpaId, AuthorityList as GrandpaAuthorityList};\nuse pallet_grandpa::fg_primitives;\nuse sp_version::RuntimeVersion;\n#[cfg(feature = \"std\")]\nuse sp_version::NativeVersion;\nuse common::Asset;\n\n// A few exports that help ease life for downstream crates.\n#[cfg(any(feature = \"std\", test))]\npub use sp_runtime::BuildStorage;\npub use pallet_timestamp::Call as TimestampCall;\npub use pallet_balances::Call as BalancesCall;\npub use sp_runtime::{Permill, Perbill};\npub use frame_support::{\n\tconstruct_runtime, parameter_types, StorageValue,\n\ttraits::{KeyOwnerProofSystem, Randomness},\n\tweights::{\n\t\tWeight, IdentityFee,\n\t\tconstants::{BlockExecutionWeight, ExtrinsicBaseWeight, RocksDbWeight, WEIGHT_PER_SECOND},\n\t},\n};\n\n/// Import the financial pallet.\npub use financial_pallet;\n\n/// Import the oracle pallet.\npub use oracle;\n\n/// An index to a block.\npub type BlockNumber = u32;\n\n/// Alias to 512-bit hash when used in the context of a transaction signature on the chain.\npub type Signature = MultiSignature;\n\n/// Some way of identifying an account on the chain. We intentionally make it equivalent\n/// to the public key of our transaction signing scheme.\npub type AccountId = \u003c\u003cSignature as Verify\u003e::Signer as IdentifyAccount\u003e::AccountId;\n\n/// The type for looking up accounts. We don't expect more than 4 billion of them, but you\n/// never know...\npub type AccountIndex = u32;\n\n/// Balance of an account.\npub type Balance = u128;\n\n/// Index of a transaction in the chain.\npub type Index = u32;\n\n/// A hash of some data used by the chain.\npub type Hash = sp_core::H256;\n\n/// Digest item type.\npub type DigestItem = generic::DigestItem\u003cHash\u003e;\n\n/// Opaque types. These are used by the CLI to instantiate machinery that don't need to know\n/// the specifics of the runtime. They can then be made to be agnostic over specific formats\n/// of data like extrinsics, allowing for them to continue syncing the network through upgrades\n/// to even the core data structures.\npub mod opaque {\n\tuse super::*;\n\n\tpub use sp_runtime::OpaqueExtrinsic as UncheckedExtrinsic;\n\n\t/// Opaque block header type.\n\tpub type Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n\t/// Opaque block type.\n\tpub type Block = generic::Block\u003cHeader, UncheckedExtrinsic\u003e;\n\t/// Opaque block identifier type.\n\tpub type BlockId = generic::BlockId\u003cBlock\u003e;\n\n\timpl_opaque_keys! {\n\t\tpub struct SessionKeys {\n\t\t\tpub aura: Aura,\n\t\t\tpub grandpa: Grandpa,\n\t\t}\n\t}\n}\n\npub const VERSION: RuntimeVersion = RuntimeVersion {\n\tspec_name: create_runtime_str!(\"node-template\"),\n\timpl_name: create_runtime_str!(\"node-template\"),\n\tauthoring_version: 1,\n\tspec_version: 1,\n\timpl_version: 1,\n\tapis: RUNTIME_API_VERSIONS,\n\ttransaction_version: 1,\n};\n\npub const MILLISECS_PER_BLOCK: u64 = 6000;\n\npub const SLOT_DURATION: u64 = MILLISECS_PER_BLOCK;\n\n// Time is measured by number of blocks.\npub const MINUTES: BlockNumber = 60_000 / (MILLISECS_PER_BLOCK as BlockNumber);\npub const HOURS: BlockNumber = MINUTES * 60;\npub const DAYS: BlockNumber = HOURS * 24;\n\n/// The version information used to identify this runtime when compiled natively.\n#[cfg(feature = \"std\")]\npub fn native_version() -\u003e NativeVersion {\n\tNativeVersion {\n\t\truntime_version: VERSION,\n\t\tcan_author_with: Default::default(),\n\t}\n}\n\nparameter_types! {\n\tpub const BlockHashCount: BlockNumber = 2400;\n\t/// We allow for 2 seconds of compute with a 6 second average block time.\n\tpub const MaximumBlockWeight: Weight = 2 * WEIGHT_PER_SECOND;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n\t/// Assume 10% of weight for average on_initialize calls.\n\tpub MaximumExtrinsicWeight: Weight = AvailableBlockRatio::get()\n\t\t.saturating_sub(Perbill::from_percent(10)) * MaximumBlockWeight::get();\n\tpub const MaximumBlockLength: u32 = 5 * 1024 * 1024;\n\tpub const Version: RuntimeVersion = VERSION;\n}\n\n// Configure FRAME pallets to include in runtime.\n\nimpl frame_system::Trait for Runtime {\n\t/// The basic call filter to use in dispatchable.\n\ttype BaseCallFilter = ();\n\t/// The identifier used to distinguish between accounts.\n\ttype AccountId = AccountId;\n\t/// The aggregated dispatch type that is available for extrinsics.\n\ttype Call = Call;\n\t/// The lookup mechanism to get account ID from whatever is passed in dispatchers.\n\ttype Lookup = IdentityLookup\u003cAccountId\u003e;\n\t/// The index type for storing how many extrinsics an account has signed.\n\ttype Index = Index;\n\t/// The index type for blocks.\n\ttype BlockNumber = BlockNumber;\n\t/// The type for hashing blocks and tries.\n\ttype Hash = Hash;\n\t/// The hashing algorithm used.\n\ttype Hashing = BlakeTwo256;\n\t/// The header type.\n\ttype Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n\t/// The ubiquitous event type.\n\ttype Event = Event;\n\t/// The ubiquitous origin type.\n\ttype Origin = Origin;\n\t/// Maximum number of block number to block hash mappings to keep (oldest pruned first).\n\ttype BlockHashCount = BlockHashCount;\n\t/// Maximum weight of each block.\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\t/// The weight of database operations that the runtime can invoke.\n\ttype DbWeight = RocksDbWeight;\n\t/// The weight of the overhead invoked on the block import process, independent of the\n\t/// extrinsics included in that block.\n\ttype BlockExecutionWeight = BlockExecutionWeight;\n\t/// The base weight of any extrinsic processed by the runtime, independent of the\n\t/// logic of that extrinsic. (Signature verification, nonce increment, fee, etc...)\n\ttype ExtrinsicBaseWeight = ExtrinsicBaseWeight;\n\t/// The maximum weight that a single extrinsic of `Normal` dispatch class can have,\n\t/// idependent of the logic of that extrinsics. (Roughly max block weight - average on\n\t/// initialize cost).\n\ttype MaximumExtrinsicWeight = MaximumExtrinsicWeight;\n\t/// Maximum size of all encoded transactions (in bytes) that are allowed in one block.\n\ttype MaximumBlockLength = MaximumBlockLength;\n\t/// Portion of the block weight that is available to all normal transactions.\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\t/// Version of the runtime.\n\ttype Version = Version;\n\t/// Converts a module to the index of the module in `construct_runtime!`.\n\t///\n\t/// This type is being generated by `construct_runtime!`.\n\ttype ModuleToIndex = ModuleToIndex;\n\t/// What to do if a new account is created.\n\ttype OnNewAccount = ();\n\t/// What to do if an account is fully reaped from the system.\n\ttype OnKilledAccount = ();\n\t/// The data to be stored in an account.\n\ttype AccountData = pallet_balances::AccountData\u003cBalance\u003e;\n\t/// Weight information for the extrinsics of this pallet.\n\ttype SystemWeightInfo = ();\n}\n\nimpl pallet_aura::Trait for Runtime {\n\ttype AuthorityId = AuraId;\n}\n\nimpl pallet_grandpa::Trait for Runtime {\n\ttype Event = Event;\n\ttype Call = Call;\n\n\ttype KeyOwnerProofSystem = ();\n\n\ttype KeyOwnerProof =\n\t\t\u003cSelf::KeyOwnerProofSystem as KeyOwnerProofSystem\u003c(KeyTypeId, GrandpaId)\u003e\u003e::Proof;\n\n\ttype KeyOwnerIdentification = \u003cSelf::KeyOwnerProofSystem as KeyOwnerProofSystem\u003c(\n\t\tKeyTypeId,\n\t\tGrandpaId,\n\t)\u003e\u003e::IdentificationTuple;\n\n\ttype HandleEquivocation = ();\n}\n\nparameter_types! {\n\tpub const MinimumPeriod: u64 = SLOT_DURATION / 2;\n}\n\nimpl pallet_timestamp::Trait for Runtime {\n\t/// A timestamp: milliseconds since the unix epoch.\n\ttype Moment = u64;\n\ttype OnTimestampSet = Aura;\n\ttype MinimumPeriod = MinimumPeriod;\n\ttype WeightInfo = ();\n}\n\nparameter_types! {\n\tpub const ExistentialDeposit: u128 = 500;\n}\n\nimpl pallet_balances::Trait for Runtime {\n\t/// The type for recording an account's balance.\n\ttype Balance = Balance;\n\t/// The ubiquitous event type.\n\ttype Event = Event;\n\ttype DustRemoval = ();\n\ttype ExistentialDeposit = ExistentialDeposit;\n\ttype AccountStore = System;\n\ttype WeightInfo = ();\n}\n\nparameter_types! {\n\tpub const TransactionByteFee: Balance = 1;\n}\n\nimpl pallet_transaction_payment::Trait for Runtime {\n\ttype Currency = Balances;\n\ttype OnTransactionPayment = ();\n\ttype TransactionByteFee = TransactionByteFee;\n\ttype WeightToFee = IdentityFee\u003cBalance\u003e;\n\ttype FeeMultiplierUpdate = ();\n}\n\nimpl pallet_sudo::Trait for Runtime {\n\ttype Event = Event;\n\ttype Call = Call;\n}\n\nparameter_types! {\n\tpub const PriceCount: u32 = 30;\n\tpub const PricePeriod: u32 = 1440;\n}\n\npub type FixedNumber = substrate_fixed::types::I64F64;\n\n/// Configure the pallet financial in pallets/financial.\nimpl financial_pallet::Trait for Runtime {\n\ttype Event = Event;\n\ttype UnixTime = pallet_timestamp::Module\u003cRuntime\u003e;\n\ttype PriceCount = PriceCount;\n\ttype PricePeriod = PricePeriod;\n\ttype FixedNumberBits = i128;\n\ttype FixedNumber = FixedNumber;\n\ttype Price = FixedNumber;\n\ttype Asset = Asset;\n}\n\n/// Configure the pallet oracle in pallets/oracle.\nimpl oracle::Trait for Runtime {\n\ttype Event = Event;\n\ttype Price = FixedNumber;\n\ttype OnPriceSet = financial_pallet::Module\u003cRuntime\u003e;\n\ttype Asset = Asset;\n}\n\n// Create the runtime by composing the FRAME pallets that were previously configured.\nconstruct_runtime!(\n\tpub enum Runtime where\n\t\tBlock = Block,\n\t\tNodeBlock = opaque::Block,\n\t\tUncheckedExtrinsic = UncheckedExtrinsic\n\t{\n\t\tSystem: frame_system::{Module, Call, Config, Storage, Event\u003cT\u003e},\n\t\tRandomnessCollectiveFlip: pallet_randomness_collective_flip::{Module, Call, Storage},\n\t\tTimestamp: pallet_timestamp::{Module, Call, Storage, Inherent},\n\t\tAura: pallet_aura::{Module, Config\u003cT\u003e, Inherent},\n\t\tGrandpa: pallet_grandpa::{Module, Call, Storage, Config, Event},\n\t\tBalances: pallet_balances::{Module, Call, Storage, Config\u003cT\u003e, Event\u003cT\u003e},\n\t\tTransactionPayment: pallet_transaction_payment::{Module, Storage},\n\t\tSudo: pallet_sudo::{Module, Call, Config\u003cT\u003e, Storage, Event\u003cT\u003e},\n\n\t\tFinancial: financial_pallet::{Module, Call, Storage, Event\u003cT\u003e, Config\u003cT\u003e},\n\t\tOracle: oracle::{Module, Call, Storage, Event\u003cT\u003e, Config\u003cT\u003e},\n\t}\n);\n\n/// The address format for describing accounts.\npub type Address = AccountId;\n/// Block header type as expected by this runtime.\npub type Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n/// Block type as expected by this runtime.\npub type Block = generic::Block\u003cHeader, UncheckedExtrinsic\u003e;\n/// A Block signed with a Justification\npub type SignedBlock = generic::SignedBlock\u003cBlock\u003e;\n/// BlockId type as expected by this runtime.\npub type BlockId = generic::BlockId\u003cBlock\u003e;\n/// The SignedExtension to the basic transaction logic.\npub type SignedExtra = (\n\tframe_system::CheckSpecVersion\u003cRuntime\u003e,\n\tframe_system::CheckTxVersion\u003cRuntime\u003e,\n\tframe_system::CheckGenesis\u003cRuntime\u003e,\n\tframe_system::CheckEra\u003cRuntime\u003e,\n\tframe_system::CheckNonce\u003cRuntime\u003e,\n\tframe_system::CheckWeight\u003cRuntime\u003e,\n\tpallet_transaction_payment::ChargeTransactionPayment\u003cRuntime\u003e\n);\n/// Unchecked extrinsic type as expected by this runtime.\npub type UncheckedExtrinsic = generic::UncheckedExtrinsic\u003cAddress, Call, Signature, SignedExtra\u003e;\n/// Extrinsic type that has already been checked.\npub type CheckedExtrinsic = generic::CheckedExtrinsic\u003cAccountId, Call, SignedExtra\u003e;\n/// Executive: handles dispatch to the various modules.\npub type Executive = frame_executive::Executive\u003c\n\tRuntime,\n\tBlock,\n\tframe_system::ChainContext\u003cRuntime\u003e,\n\tRuntime,\n\tAllModules,\n\u003e;\n\nimpl_runtime_apis! {\n\timpl sp_api::Core\u003cBlock\u003e for Runtime {\n\t\tfn version() -\u003e RuntimeVersion {\n\t\t\tVERSION\n\t\t}\n\n\t\tfn execute_block(block: Block) {\n\t\t\tExecutive::execute_block(block)\n\t\t}\n\n\t\tfn initialize_block(header: \u0026\u003cBlock as BlockT\u003e::Header) {\n\t\t\tExecutive::initialize_block(header)\n\t\t}\n\t}\n\n\timpl sp_api::Metadata\u003cBlock\u003e for Runtime {\n\t\tfn metadata() -\u003e OpaqueMetadata {\n\t\t\tRuntime::metadata().into()\n\t\t}\n\t}\n\n\timpl sp_block_builder::BlockBuilder\u003cBlock\u003e for Runtime {\n\t\tfn apply_extrinsic(extrinsic: \u003cBlock as BlockT\u003e::Extrinsic) -\u003e ApplyExtrinsicResult {\n\t\t\tExecutive::apply_extrinsic(extrinsic)\n\t\t}\n\n\t\tfn finalize_block() -\u003e \u003cBlock as BlockT\u003e::Header {\n\t\t\tExecutive::finalize_block()\n\t\t}\n\n\t\tfn inherent_extrinsics(data: sp_inherents::InherentData) -\u003e Vec\u003c\u003cBlock as BlockT\u003e::Extrinsic\u003e {\n\t\t\tdata.create_extrinsics()\n\t\t}\n\n\t\tfn check_inherents(\n\t\t\tblock: Block,\n\t\t\tdata: sp_inherents::InherentData,\n\t\t) -\u003e sp_inherents::CheckInherentsResult {\n\t\t\tdata.check_extrinsics(\u0026block)\n\t\t}\n\n\t\tfn random_seed() -\u003e \u003cBlock as BlockT\u003e::Hash {\n\t\t\tRandomnessCollectiveFlip::random_seed()\n\t\t}\n\t}\n\n\timpl sp_transaction_pool::runtime_api::TaggedTransactionQueue\u003cBlock\u003e for Runtime {\n\t\tfn validate_transaction(\n\t\t\tsource: TransactionSource,\n\t\t\ttx: \u003cBlock as BlockT\u003e::Extrinsic,\n\t\t) -\u003e TransactionValidity {\n\t\t\tExecutive::validate_transaction(source, tx)\n\t\t}\n\t}\n\n\timpl sp_offchain::OffchainWorkerApi\u003cBlock\u003e for Runtime {\n\t\tfn offchain_worker(header: \u0026\u003cBlock as BlockT\u003e::Header) {\n\t\t\tExecutive::offchain_worker(header)\n\t\t}\n\t}\n\n\timpl sp_consensus_aura::AuraApi\u003cBlock, AuraId\u003e for Runtime {\n\t\tfn slot_duration() -\u003e u64 {\n\t\t\tAura::slot_duration()\n\t\t}\n\n\t\tfn authorities() -\u003e Vec\u003cAuraId\u003e {\n\t\t\tAura::authorities()\n\t\t}\n\t}\n\n\timpl sp_session::SessionKeys\u003cBlock\u003e for Runtime {\n\t\tfn generate_session_keys(seed: Option\u003cVec\u003cu8\u003e\u003e) -\u003e Vec\u003cu8\u003e {\n\t\t\topaque::SessionKeys::generate(seed)\n\t\t}\n\n\t\tfn decode_session_keys(\n\t\t\tencoded: Vec\u003cu8\u003e,\n\t\t) -\u003e Option\u003cVec\u003c(Vec\u003cu8\u003e, KeyTypeId)\u003e\u003e {\n\t\t\topaque::SessionKeys::decode_into_raw_public_keys(\u0026encoded)\n\t\t}\n\t}\n\n\timpl fg_primitives::GrandpaApi\u003cBlock\u003e for Runtime {\n\t\tfn grandpa_authorities() -\u003e GrandpaAuthorityList {\n\t\t\tGrandpa::grandpa_authorities()\n\t\t}\n\n\t\tfn submit_report_equivocation_unsigned_extrinsic(\n\t\t\t_equivocation_proof: fg_primitives::EquivocationProof\u003c\n\t\t\t\t\u003cBlock as BlockT\u003e::Hash,\n\t\t\t\tNumberFor\u003cBlock\u003e,\n\t\t\t\u003e,\n\t\t\t_key_owner_proof: fg_primitives::OpaqueKeyOwnershipProof,\n\t\t) -\u003e Option\u003c()\u003e {\n\t\t\tNone\n\t\t}\n\n\t\tfn generate_key_ownership_proof(\n\t\t\t_set_id: fg_primitives::SetId,\n\t\t\t_authority_id: GrandpaId,\n\t\t) -\u003e Option\u003cfg_primitives::OpaqueKeyOwnershipProof\u003e {\n\t\t\t// NOTE: this is the only implementation possible since we've\n\t\t\t// defined our key owner proof type as a bottom type (i.e. a type\n\t\t\t// with no values).\n\t\t\tNone\n\t\t}\n\t}\n\t\n\timpl frame_system_rpc_runtime_api::AccountNonceApi\u003cBlock, AccountId, Index\u003e for Runtime {\n\t\tfn account_nonce(account: AccountId) -\u003e Index {\n\t\t\tSystem::account_nonce(account)\n\t\t}\n\t}\n\n\timpl pallet_transaction_payment_rpc_runtime_api::TransactionPaymentApi\u003cBlock, Balance\u003e for Runtime {\n\t\tfn query_info(\n\t\t\tuxt: \u003cBlock as BlockT\u003e::Extrinsic,\n\t\t\tlen: u32,\n\t\t) -\u003e pallet_transaction_payment_rpc_runtime_api::RuntimeDispatchInfo\u003cBalance\u003e {\n\t\t\tTransactionPayment::query_info(uxt, len)\n\t\t}\n\t}\n}\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = {"files":[{"path":["/","home","rotor","work","src","polka","financial-pallet","common","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse core::slice::Iter;\nuse frame_support::codec::{Decode, Encode};\n#[cfg(feature = \"std\")]\nuse serde::{Deserialize, Serialize};\nuse financial_primitives::IntoTypeIterator;\nuse sp_std::vec;\n\n#[derive(Encode, Decode, Debug, PartialEq, Eq, Clone, Copy, Hash)]\n#[cfg_attr(feature = \"std\", derive(Serialize, Deserialize))]\npub enum Asset {\n    Unknown,\n    Usd,\n    Eq,\n    Eth,\n    Btc,\n    Eos,\n}\n\nimpl Default for Asset {\n    fn default() -\u003e Asset {\n        Asset::Unknown\n    }\n}\n\nimpl Asset {\n    pub fn iterator() -\u003e Iter\u003c'static, Asset\u003e {\n        static ASSETS: [Asset; 5] = [Asset::Usd, Asset::Eq, Asset::Eth, Asset::Btc, Asset::Eos];\n        ASSETS.iter()\n    }\n}\n\nimpl IntoTypeIterator for Asset {\n    type Iterator = sp_std::vec::IntoIter\u003cSelf\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator {\n        vec![\n            Asset::Usd,\n            Asset::Eq,\n            Asset::Eth,\n            Asset::Btc,\n            Asset::Eos,\n        ].into_iter()\n    }\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","rotor","work","src","polka","financial-pallet","financial-primitives","src","capvec.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse frame_support::codec::{Decode, Encode};\nuse sp_std::prelude::Vec;\n\n#[derive(Encode, Decode, Clone, Default)]\npub struct CapVec\u003cT\u003e {\n    head_index: u32,\n    len_cap: u32,\n\titems: Vec\u003cT\u003e,\n}\n\nimpl \u003cT\u003e CapVec\u003cT\u003e {\n\tpub fn new(length: u32) -\u003e CapVec\u003cT\u003e {\n\t\tCapVec {\n            head_index: 0,\n            len_cap: length,\n\t\t\titems: Vec::new(),\n\t\t}\n\t}\n\n\tpub fn push(\u0026mut self, item: T) {\n        if self.items.len() \u003c (self.len_cap as usize) {\n            self.items.push(item);\n        } else {\n            self.items[self.head_index as usize] = item;\n            self.head_index = (self.head_index + 1) % (self.items.len() as u32);\n        }\n\t}\n\n\tpub fn iter(\u0026self) -\u003e impl Iterator\u003cItem = \u0026T\u003e {\n\t\tlet head = self.head_index as usize;\n\t\tlet first_part = self.items[head..].iter();\n\t\tlet last_part = self.items[..head].iter();\n\n\t\tfirst_part.chain(last_part)\n    }\n    \n    pub fn len_cap(\u0026self) -\u003e u32 {\n        self.len_cap\n    }\n\n    pub fn last(\u0026self) -\u003e Option\u003c\u0026 T\u003e {\n        let len = self.items.len();\n\n        if len == 0 {\n            None\n        } else if len \u003c (self.len_cap as usize) {\n            Some(\u0026self.items[len - 1])\n        } else {\n            let index = (self.len_cap + self.head_index - 1) % (self.len_cap);\n            Some(\u0026self.items[index as usize])\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_empty() {\n        let capvec = CapVec::\u003cu32\u003e::new(5);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_not_capped() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![1, 2, 3];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_capped() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n        capvec.push(4);\n        capvec.push(5);\n        capvec.push(6);\n\n        let actual: Vec\u003c_\u003e = capvec.iter().cloned().collect();\n        let expected: Vec\u003cu32\u003e = vec![2, 3, 4, 5, 6];\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_last_empty() {\n        let capvec = CapVec::\u003cu32\u003e::new(5);\n\n        let actual = capvec.last();\n        let expected = None;\n\n        assert_eq!(actual, expected);\n    }\n\n    #[test]\n    fn test_last_non_empty() {\n        let mut capvec = CapVec::\u003cu32\u003e::new(5);\n        capvec.push(1);\n        capvec.push(2);\n        capvec.push(3);\n        capvec.push(4);\n        capvec.push(5);\n        capvec.push(6);\n\n        let actual = capvec.last();\n        let expected = Some(\u00266);\n\n        assert_eq!(actual, expected);\n    }\n}","traces":[{"line":27,"address":[4379136],"length":1,"stats":{"Line":1},"fn_name":"new\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":31,"address":[4379147],"length":1,"stats":{"Line":4},"fn_name":null},{"line":35,"address":[4380016,4379952],"length":1,"stats":{"Line":1},"fn_name":"push\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":36,"address":[4380117,4380033,4379974],"length":1,"stats":{"Line":6},"fn_name":null},{"line":37,"address":[4380090],"length":1,"stats":{"Line":4},"fn_name":null},{"line":39,"address":[4380119,4380237,4380048,4380298],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[4380126,4380342,4380259],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[4379232],"length":1,"stats":{"Line":2},"fn_name":"iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":45,"address":[4379254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":46,"address":[4379268],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[4379383],"length":1,"stats":{"Line":3},"fn_name":null},{"line":49,"address":[4379480],"length":1,"stats":{"Line":3},"fn_name":null},{"line":52,"address":[4380416],"length":1,"stats":{"Line":1},"fn_name":"len_cap\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":53,"address":[4380421],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[4379504],"length":1,"stats":{"Line":5},"fn_name":"last\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":57,"address":[4379513],"length":1,"stats":{"Line":5},"fn_name":null},{"line":59,"address":[4379581,4379812,4379544],"length":1,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[4379572],"length":1,"stats":{"Line":4},"fn_name":null},{"line":61,"address":[4379555,4379694],"length":1,"stats":{"Line":4},"fn_name":null},{"line":62,"address":[4379824,4379625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[4379591,4379854,4379700],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[4379781],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":22,"coverable":22},{"path":["/","home","rotor","work","src","polka","financial-pallet","financial-primitives","src","lib.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n//#![warn(missing_docs)]\n#![cfg_attr(not(feature = \"std\"), no_std)]\n\npub mod capvec;\n\nuse frame_support::dispatch::DispatchError;\nuse sp_std::iter::Iterator;\n\npub struct Asset;\n\npub trait OnPriceSet {\n    type Asset;\n    type Price;\n\n    fn on_price_set(asset: Self::Asset, value: Self::Price) -\u003e Result\u003c(), DispatchError\u003e;\n}\n\npub trait IntoTypeIterator: Sized {\n    type Iterator: Iterator\u003cItem = Self\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","integration-testing-macro","src","lib.rs"],"content":"extern crate proc_macro;\n\nuse proc_macro::{Literal, TokenStream, TokenTree};\nuse quote::quote;\nuse syn::parse::{Parse, ParseStream};\nuse syn::parse_macro_input;\nuse syn::punctuated::Punctuated;\nuse syn::{Expr, Token};\n\nstruct Input {\n    name: syn::Ident,\n    args: Punctuated\u003cExpr, Token![,]\u003e,\n}\n\nimpl Parse for Input {\n    fn parse(input: ParseStream) -\u003e syn::parse::Result\u003cSelf\u003e {\n        let name = input.parse()?;\n        input.parse::\u003csyn::Token![,]\u003e()?;\n        let args = Punctuated::\u003cExpr, Token![,]\u003e::parse_terminated(input)?;\n        Ok(Input { name, args })\n    }\n}\n\nfn tuple_read(name: syn::Ident, num: usize) -\u003e syn::Expr {\n    let num = Literal::usize_unsuffixed(num);\n    let num: TokenTree = num.into();\n    let num: TokenStream = num.into();\n    let num: syn::Lit = syn::parse(num).unwrap();\n    let gen = quote! {\n        #name.#num\n    };\n\n    let tokens: TokenStream = gen.into();\n\n    syn::parse(tokens).unwrap()\n}\n\n#[proc_macro]\npub fn tuple_to_vec(tokens: TokenStream) -\u003e TokenStream {\n    let input = parse_macro_input!(tokens as Input);\n    let name = input.name;\n\n    let vec_args: Punctuated\u003csyn::Expr, Token![,]\u003e = input\n        .args\n        .into_iter()\n        .enumerate()\n        .map(|(i, _)| tuple_read(name.clone(), i))\n        .collect();\n\n    let gen = quote! {\n        vec!(#vec_args)\n    };\n\n    gen.into()\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","key.rs"],"content":"use crate::keyring::{KeyPair, Nonces, PubKey};\nuse arraystring::{error, typenum::U10, ArrayString};\nuse serde::ser::{Serialize, SerializeStruct, SerializeTupleVariant, Serializer};\nuse sp_core::crypto::Pair as CryptoPair;\nuse sp_core::sr25519::Pair;\nuse sp_runtime::traits::AccountIdConversion;\nuse sp_runtime::{AccountId32, ModuleId};\nuse std::cmp::Ordering;\nuse std::collections::HashMap;\n\n#[derive(Copy, Clone, Debug, Eq, PartialEq, Hash)]\npub enum AccountKey {\n    Keyring(sp_keyring::sr25519::Keyring),\n    Str(\u0026'static str),\n    Random(ArrayString10),\n}\n\nimpl AccountKey {\n    /// Constructs account key from random seed string.\n    pub fn generate_random() -\u003e Self {\n        let seed = generate_random_array_string().expect(\"should be short random string\");\n        AccountKey::Random(seed)\n    }\n\n    fn to_num(\u0026self) -\u003e usize {\n        match self {\n            \u0026AccountKey::Keyring(_) =\u003e 0,\n            \u0026AccountKey::Str(_) =\u003e 1,\n            \u0026AccountKey::Random(_) =\u003e 2,\n        }\n    }\n}\n\n/// Represents fixed-capacity string for testing AccountKey.\ntype ArrayString10 = ArrayString\u003cU10\u003e;\n\n/// Generates random array string with fixed length, otherwise returns an error.\n/// ```rust\n/// let s = generate_random_array_string();\n/// ```\nfn generate_random_array_string() -\u003e Result\u003cArrayString10, error::OutOfBounds\u003e {\n    use rand::{distributions::Alphanumeric, Rng};\n    let s: String = rand::thread_rng()\n        .sample_iter(\u0026Alphanumeric)\n        .take(10)\n        .collect();\n    ArrayString10::try_from_str(s)\n}\n\nfn keyring_to_string(keyring: sp_keyring::sr25519::Keyring) -\u003e \u0026'static str {\n    keyring.into()\n}\n\nimpl PartialOrd for AccountKey {\n    fn partial_cmp(\u0026self, other: \u0026AccountKey) -\u003e Option\u003cOrdering\u003e {\n        Some(self.cmp(other))\n    }\n}\n\nimpl Serialize for AccountKey {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self {\n            \u0026AccountKey::Keyring(kr) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"AccountKey\", 0, \"Keyring\", 1)?;\n                state.serialize_field(keyring_to_string(kr))?;\n                state.end()\n            }\n            \u0026AccountKey::Str(s) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountKey\", 1, \"Str\", 1)?;\n                state.serialize_field(s)?;\n                state.end()\n            }\n            \u0026AccountKey::Random(s) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountKey\", 2, \"Random\", 1)?;\n                state.serialize_field(s.as_str())?;\n                state.end()\n            }\n        }\n    }\n}\n\nimpl Ord for AccountKey {\n    fn cmp(\u0026self, other: \u0026AccountKey) -\u003e Ordering {\n        let num_ord = self.to_num().cmp(\u0026other.to_num());\n\n        if num_ord != Ordering::Equal {\n            num_ord\n        } else {\n            match (self, other) {\n                (\u0026AccountKey::Keyring(a), \u0026AccountKey::Keyring(b)) =\u003e {\n                    keyring_to_string(a).cmp(keyring_to_string(b))\n                }\n                (\u0026AccountKey::Str(a), \u0026AccountKey::Str(b)) =\u003e a.cmp(b),\n                _ =\u003e panic!(\"Not meant to be there\"),\n            }\n        }\n    }\n}\n\nimpl From\u003csp_keyring::sr25519::Keyring\u003e for AccountKey {\n    fn from(x: sp_keyring::sr25519::Keyring) -\u003e AccountKey {\n        AccountKey::Keyring(x)\n    }\n}\n\nimpl From\u003c\u0026'static str\u003e for AccountKey {\n    fn from(x: \u0026'static str) -\u003e AccountKey {\n        AccountKey::Str(x)\n    }\n}\n\nimpl PubKey for AccountKey {\n    type AccountId = AccountId32;\n\n    fn acc_id(\u0026self) -\u003e Self::AccountId {\n        match self {\n            \u0026AccountKey::Keyring(k) =\u003e k.to_account_id(),\n            \u0026AccountKey::Str(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s), None)\n                .unwrap()\n                .public()\n                .into(),\n            \u0026AccountKey::Random(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s.as_str()), None)\n                .unwrap()\n                .public()\n                .into(),\n        }\n    }\n}\n\nimpl KeyPair for AccountKey {\n    fn key_pair(\u0026self) -\u003e sp_core::sr25519::Pair {\n        match self {\n            \u0026AccountKey::Keyring(k) =\u003e k.pair(),\n            \u0026AccountKey::Str(s) =\u003e Pair::from_string(\u0026ensure_canonical_seed(s), None).unwrap(),\n            \u0026AccountKey::Random(s) =\u003e {\n                Pair::from_string(\u0026ensure_canonical_seed(s.as_str()), None).unwrap()\n            }\n        }\n    }\n}\n\npub type DevNonces = Nonces\u003cAccountKey\u003e;\n\n#[derive(Clone, Copy, Debug, Eq, PartialEq, Hash, Ord, PartialOrd)]\npub enum DevPubKeyId {\n    ModuleId([u8; 8]),\n    AccKey(AccountKey),\n    External(u32),\n    WellKnown(\u0026'static str),\n}\n\nimpl DevPubKeyId {\n    pub fn is_internal(\u0026self) -\u003e bool {\n        match self {\n            \u0026DevPubKeyId::External(_) =\u003e false,\n            _ =\u003e true,\n        }\n    }\n}\n\nimpl serde::Serialize for DevPubKeyId {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self {\n            \u0026DevPubKeyId::ModuleId(bs) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 0, \"ModuleId\", 1)?;\n                state.serialize_field(\u0026String::from_utf8_lossy(\u0026bs))?;\n                state.end()\n            }\n            \u0026DevPubKeyId::AccKey(k) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 1, \"AccKey\", 1)?;\n                state.serialize_field(\u0026k)?;\n                state.end()\n            }\n            \u0026DevPubKeyId::External(e) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 2, \"External\", 1)?;\n                state.serialize_field(\u0026e)?;\n                state.end()\n            }\n            \u0026DevPubKeyId::WellKnown(s) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"DevPubKeyId\", 3, \"WellKnown\", 1)?;\n                state.serialize_field(s)?;\n                state.end()\n            }\n        }\n    }\n}\n\n#[derive(Clone, Debug)]\npub struct DevPubKey {\n    id: DevPubKeyId,\n    acc_id: AccountId32,\n}\n\nimpl Serialize for DevPubKey {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        let mut state = serializer.serialize_struct(\"DevPubKey\", 2)?;\n        state.serialize_field(\"id\", \u0026self.id)?;\n        state.serialize_field(\"acc_id\", \u0026self.acc_id.to_string())?;\n        state.end()\n    }\n}\n\nimpl DevPubKey {\n    pub fn well_known(name: \u0026'static str, acc_id: AccountId32) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::WellKnown(name),\n            acc_id,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e DevPubKeyId {\n        self.id\n    }\n}\n\nimpl PubKey for DevPubKey {\n    type AccountId = AccountId32;\n\n    fn acc_id(\u0026self) -\u003e Self::AccountId {\n        self.acc_id.clone()\n    }\n}\n\nimpl From\u003cModuleId\u003e for DevPubKey {\n    fn from(x: ModuleId) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::ModuleId(x.0),\n            acc_id: x.into_account(),\n        }\n    }\n}\n\nimpl From\u003cAccountKey\u003e for DevPubKey {\n    fn from(x: AccountKey) -\u003e DevPubKey {\n        DevPubKey {\n            id: DevPubKeyId::AccKey(x),\n            acc_id: x.acc_id(),\n        }\n    }\n}\n\n#[derive(Eq, PartialEq)]\npub enum PubKeyStoreRegisterResult {\n    AddedNew,\n    ExistsNotModified,\n    ExistsReplaced,\n}\n\n#[derive(Debug)]\npub struct PubKeyStore {\n    items: HashMap\u003cAccountId32, DevPubKeyId\u003e,\n    next_id: u32,\n}\n\nimpl PubKeyStore {\n    pub fn new() -\u003e PubKeyStore {\n        PubKeyStore {\n            items: HashMap::new(),\n            next_id: 0,\n        }\n    }\n\n    pub fn register(\u0026mut self, pub_key: DevPubKey) -\u003e PubKeyStoreRegisterResult {\n        let DevPubKey { id, acc_id } = pub_key;\n        let item = self.items.get(\u0026acc_id);\n\n        if let Some(existing_id) = item {\n            match (existing_id, id) {\n                (_, DevPubKeyId::External(_)) =\u003e PubKeyStoreRegisterResult::ExistsNotModified,\n                _ =\u003e PubKeyStoreRegisterResult::ExistsReplaced,\n            }\n        } else {\n            self.items.insert(acc_id, id);\n            PubKeyStoreRegisterResult::AddedNew\n        }\n    }\n\n    pub fn register_external(\u0026mut self, acc_id: AccountId32) {\n        let id = DevPubKeyId::External(self.next_id);\n        let result = self.register(DevPubKey { id, acc_id });\n\n        if result == PubKeyStoreRegisterResult::AddedNew\n            || result == PubKeyStoreRegisterResult::ExistsReplaced\n        {\n            self.next_id = self.next_id + 1;\n        }\n    }\n\n    pub fn get_id(\u0026self, acc_id: \u0026AccountId32) -\u003e Option\u003cDevPubKeyId\u003e {\n        self.items.get(acc_id).map(|\u0026x| x)\n    }\n\n    pub fn dump(\u0026self) -\u003e Vec\u003cDevPubKey\u003e {\n        let mut items: Vec\u003c_\u003e = self\n            .items\n            .iter()\n            .map(|(acc_id, \u0026id)| DevPubKey {\n                id,\n                acc_id: acc_id.clone(),\n            })\n            .collect();\n\n        items.sort_by(|a, b| a.id.cmp(\u0026b.id));\n\n        items\n    }\n}\n\n/// Prepends \"//\" to the string if absent.\nfn ensure_canonical_seed(s: \u0026str) -\u003e String {\n    if !s.starts_with(\"//\") {\n        format!(\"//{}\", s)\n    } else {\n        String::from(s)\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":294,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":303,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":116},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","keyring.rs"],"content":"use std::fmt::Debug;\nuse std::collections::HashMap;\nuse std::cmp::Eq;\nuse std::hash::Hash;\n\npub trait PubKey {\n    type AccountId;\n    fn acc_id(\u0026self) -\u003e Self::AccountId;\n}\n\npub trait KeyPair: PubKey {\n    fn key_pair(\u0026self) -\u003e sp_core::sr25519::Pair;\n}\n\npub struct Nonces\u003cK\u003e {\n    nonces: HashMap\u003cK, u32\u003e,\n}\n\nimpl \u003cK\u003e Nonces\u003cK\u003e {\n    pub fn new() -\u003e Nonces\u003cK\u003e {\n        Nonces {\n            nonces: HashMap::\u003cK, u32\u003e::new(),\n        }\n    }\n}\n\npub trait NonceManager {\n    type AccountKey: Copy + Debug;\n\n    fn is_initialized(\u0026self, key: Self::AccountKey) -\u003e bool;\n    fn init_nonce(\u0026mut self, key: Self::AccountKey, nonce: u32);\n    fn get_nonce_and_inc(\u0026mut self, key: Self::AccountKey) -\u003e u32;\n}\n\nimpl \u003cAccountKey: Copy + Debug + Eq + Hash\u003e NonceManager for Nonces\u003cAccountKey\u003e {\n    type AccountKey = AccountKey;\n\n    fn is_initialized(\u0026self, key: Self::AccountKey) -\u003e bool {\n        self.nonces.get(\u0026key).is_some()\n    }\n\n    fn init_nonce(\u0026mut self, key: Self::AccountKey, nonce: u32) {\n        if self.nonces.insert(key, nonce).is_some() {\n            panic!(\"nonce for key {:?} has already been initialized\", key);\n        }\n    }\n\n    fn get_nonce_and_inc(\u0026mut self, key: Self::AccountKey) -\u003e u32 {\n        let value = self.nonces.get_mut(\u0026key);\n\n        if let Some(value) = value {\n            let curr_nonce = *value;\n            *value = *value + 1;\n            curr_nonce\n        } else {\n            panic!(\"nonce for key {:?} is not initialized\", key);\n        }\n\n    }\n}","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":14},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","main.rs"],"content":"#![recursion_limit = \"256\"]\n\npub mod key;\npub mod keyring;\npub mod oracle;\npub mod requester;\npub mod runtime;\npub mod test;\npub mod test_context;\npub mod test_scripts;\npub mod timestamp;\n\nuse crate::key::DevNonces;\nuse futures::lock::Mutex;\nuse log::{Level, Metadata, Record};\nuse log::{LevelFilter, SetLoggerError};\nuse runtime::TestRuntime;\nuse std::sync::Arc;\nuse substrate_subxt::ClientBuilder;\n#[allow(unused_imports)]\nuse test_scripts::test_financial::test_financial;\n\npub const ONE: u64 = 1_000_000_000;\n\n#[macro_use]\nextern crate lazy_static;\n\nstruct SimpleLogger;\nimpl log::Log for SimpleLogger {\n    fn enabled(\u0026self, metadata: \u0026Metadata) -\u003e bool {\n        metadata.level() \u003c= Level::Info\n    }\n\n    fn log(\u0026self, record: \u0026Record) {\n        if self.enabled(record.metadata()) {\n            println!(\"{} - {}\", record.level(), record.args());\n        }\n    }\n\n    fn flush(\u0026self) {}\n}\n\nstatic LOGGER: SimpleLogger = SimpleLogger;\n\npub fn init() -\u003e Result\u003c(), SetLoggerError\u003e {\n    log::set_logger(\u0026LOGGER).map(|()| log::set_max_level(LevelFilter::Info))\n}\n\n#[async_std::main]\nasync fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    //init();\n    let client = ClientBuilder::\u003cTestRuntime\u003e::new()\n        .set_page_size(1)\n        .set_url(\"ws://localhost:9944/\")\n        .build()\n        .await?;\n    let nonces = Arc::new(Mutex::new(DevNonces::new()));\n\n    // Node state dependent test;\n    println!(\"\\n\\nRunning financial test \\n\\n\");\n    test_financial(\u0026client, nonces).await?; // WARN - with 6s blocks test goes on for ~8 mins\n\n    Ok(())\n}\n","traces":[{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","oracle.rs"],"content":"use codec::{Codec, Encode};\nuse core::marker::PhantomData;\nuse common::Asset;\nuse sp_runtime::traits::Member;\nuse std::fmt::Debug;\nuse substrate_subxt::system::{System, SystemEventsDecoder};\nuse substrate_subxt_proc_macro::{module, Call, Store};\nuse substrate_fixed::types::I64F64;\n\npub type Price = I64F64;\n\n#[module]\npub trait Oracle: System {\n    type Asset: Default + Codec + Member;\n    type Price: Default + Codec + Member;\n}\n\n#[derive(Clone, Debug, Eq, PartialEq, Store, Encode)]\npub struct PricePointsStore\u003cT: Oracle\u003e {\n    #[store(returns = Price)]\n    pub asset: Asset,\n    pub _runtime: PhantomData\u003cT\u003e,\n}\n\n#[derive(Clone, Debug, PartialEq, Call, Encode)]\npub struct SetPriceCall\u003cT: Oracle\u003e {\n    pub asset: Asset,\n    pub value: Price,\n    pub _runtime: PhantomData\u003cT\u003e,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","requester.rs"],"content":"use super::TestRuntime;\nuse crate::key::{AccountKey, DevNonces};\nuse crate::keyring::{KeyPair, NonceManager};\nuse crate::runtime::{AccountId, Balance};\nuse core::marker::PhantomData;\nuse futures::lock::Mutex;\nuse pallet_transaction_payment_rpc_runtime_api::RuntimeDispatchInfo;\nuse sp_keyring::AccountKeyring;\nuse std::collections::HashMap;\nuse std::sync::Arc;\nuse substrate_subxt::ExtrinsicSuccessWithFee;\nuse substrate_subxt::{sudo::SudoCall, Call, Client, PairSigner};\n\nlazy_static! {\n    pub static ref FEES: HashMap\u003cString, u64\u003e = vec![\n        (String::from(\"transfer_and_watch\"), 125_000_146),\n        (String::from(\"register_bailsman_and_watch\"), 125_000_105),\n        (String::from(\"unregister_bailsman_and_watch\"), 125_000_105),\n        (String::from(\"register_whitelist_and_watch\"), 125_000_139),\n        (String::from(\"unregister_whitelist_and_watch\"), 125_000_139),\n        (String::from(\"set_price_and_watch\"), 125_000_114),\n    ]\n    .into_iter()\n    .collect();\n}\n\npub struct Requester {\n    pub client: Client\u003csuper::TestRuntime\u003e,\n    nonces: HashMap\u003csuper::runtime::AccountId, u32\u003e,\n}\n\nimpl Requester {\n    pub fn new(client: Client\u003cTestRuntime\u003e) -\u003e Self {\n        Requester {\n            client,\n            nonces: HashMap::new(),\n        }\n    }\n\n    pub async fn with_sudo\u003cC: Call\u003cTestRuntime\u003e\u003e(\n        \u0026mut self,\n        call: C,\n    ) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n        let alice = AccountKeyring::Alice;\n        let mut signer = PairSigner::new(alice.pair()); //hardcode Alice as sudo signer\n        let sudo_nonce = self\n            .increment_nonce(AccountKeyring::Alice.to_account_id())\n            .await?;\n\n        signer.set_nonce(sudo_nonce);\n        let encoded = self.client.encode(call)?;\n        let sudo = SudoCall {\n            call: \u0026encoded,\n            _runtime: PhantomData,\n        };\n        let extrinsic = self.client.watch(sudo, \u0026signer).await?;\n        println!(\"with_sudo extrinsic {:?}\", extrinsic);\n        Ok(())\n    }\n\n    pub async fn increment_nonce(\n        \u0026mut self,\n        who: AccountId,\n    ) -\u003e Result\u003cu32, Box\u003cdyn std::error::Error\u003e\u003e {\n        let nonce = self\n            .nonces\n            .entry(who.clone())\n            .and_modify(|a| *a += 1)\n            .or_insert(\n                self.client\n                    .fetch_or_default(\n                        \u0026substrate_subxt::system::AccountStore { account_id: \u0026who },\n                        None,\n                    )\n                    .await\n                    .unwrap()\n                    .nonce,\n            );\n        println!(\"new nonce is {}\", nonce);\n        Ok(*nonce)\n    }\n}\n\npub type ChainCallSuccess = ExtrinsicSuccessWithFee\u003cTestRuntime, (AccountKey, Balance)\u003e;\npub type ChainCallResult = Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e;\n\npub async fn call_chain\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    account_key: AccountKey,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let nonce = { nonces.lock().await.get_nonce_and_inc(account_key) };\n    println!(\"Current nonce for {:?} is {}\", account_key, nonce);\n\n    let mut signer = PairSigner::new(account_key.key_pair());\n    signer.set_nonce(nonce);\n    let extrinsic = client.create_signed(call, \u0026signer).await?;\n    let decoder = TestRuntime::create_decoder(client.metadata().clone());\n    let success = client\n        .submit_and_watch_extrinsic_with_fee::\u003cBalance\u003e(extrinsic, decoder)\n        .await?;\n    let fee = success\n        .dispatch_info\n        .as_ref()\n        .map(|x| x.partial_fee)\n        .unwrap_or(0);\n\n    println!(\"incoming fee for {:?}: {}\", account_key, fee);\n\n    Ok(vec![ExtrinsicSuccessWithFee {\n        block: success.block,\n        extrinsic: success.extrinsic,\n        events: success.events,\n        dispatch_info: success.dispatch_info.map(|x| RuntimeDispatchInfo {\n            weight: x.weight,\n            class: x.class,\n            partial_fee: (account_key, x.partial_fee),\n        }),\n    }])\n}\n\npub async fn sudo_call_chain\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let encoded = client.encode(call)?;\n    let sudo_call = SudoCall {\n        call: \u0026encoded,\n        _runtime: PhantomData,\n    };\n\n    call_chain(client, nonces, AccountKeyring::Alice.into(), sudo_call).await\n}\n\npub async fn call_chain_unsigned\u003cC: Call\u003cTestRuntime\u003e + Send + Sync\u003e(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    call: C,\n) -\u003e Result\u003cVec\u003cChainCallSuccess\u003e, Box\u003cdyn std::error::Error\u003e\u003e {\n    let extrinsic = client.create_unsigned(call)?;\n    let decoder = TestRuntime::create_decoder(client.metadata().clone());\n    let success = client\n        .submit_and_watch_extrinsic(extrinsic, decoder)\n        .await?;\n\n    Ok(vec![ExtrinsicSuccessWithFee {\n        block: success.block,\n        extrinsic: success.extrinsic,\n        events: success.events,\n        dispatch_info: Option::None,\n    }])\n}\n\n#[macro_export]\nmacro_rules! join_chain_calls {\n    ( $($tokens:tt)* ) =\u003e {{\n        let join_result = try_join!($($tokens)*)?;\n\n        let vec_vec = tuple_to_vec!(join_result, $($tokens)*);\n\n        let flatten: Vec\u003c_\u003e = vec_vec.into_iter().flatten().collect();\n\n        flatten\n    }};\n}\n","traces":[{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","runtime.rs"],"content":"use super::{oracle, timestamp};\nuse crate::oracle::OracleEventsDecoder;\nuse crate::timestamp::TimestampEventsDecoder;\nuse common::Asset;\nuse sp_runtime::traits::{BlakeTwo256, IdentifyAccount, Verify};\nuse sp_runtime::{generic, MultiSignature, OpaqueExtrinsic};\nuse substrate_subxt::{\n    balances::{Balances, AccountData, BalancesEventsDecoder}, // needed for sign extra\n    extrinsic::DefaultExtra,\n    sudo::Sudo,\n    system::{System, SystemEventsDecoder},\n    EventsDecoder,\n    Metadata,\n    Runtime,\n};\nuse substrate_fixed::types::I64F64;\n\n#[derive(Clone, PartialEq, Debug)]\npub struct TestRuntime;\n\nimpl TestRuntime {\n    pub fn create_decoder(metadata: Metadata) -\u003e EventsDecoder\u003cTestRuntime\u003e {\n        let mut decoder = EventsDecoder::\u003cTestRuntime\u003e::new(metadata);\n        decoder.with_system();\n        decoder.with_balances();\n        decoder.with_oracle();\n        decoder.with_timestamp();\n\n        decoder\n    }\n}\n\nimpl Eq for TestRuntime {}\n\ntype Signature = MultiSignature;\n\nimpl Runtime for TestRuntime {\n    type Signature = Signature;\n    type Extra = DefaultExtra\u003cSelf\u003e;\n}\n\npub type AccountId = \u003c\u003cMultiSignature as Verify\u003e::Signer as IdentifyAccount\u003e::AccountId;\n\npub type Address = AccountId;\n\npub type FixedNumber = I64F64;\n\nimpl System for TestRuntime {\n    type Index = u32;\n    type BlockNumber = u32;\n    type Hash = sp_core::H256;\n    type Hashing = BlakeTwo256;\n    type AccountId = AccountId;\n    type Address = Self::AccountId;\n    type Header = generic::Header\u003cSelf::BlockNumber, BlakeTwo256\u003e;\n    type Extrinsic = OpaqueExtrinsic;\n    type AccountData = AccountData\u003c\u003cSelf as Balances\u003e::Balance\u003e;\n}\n\npub type Balance = u128;\n\nimpl Balances for TestRuntime {\n    type Balance = Balance;\n}\n\nimpl timestamp::Timestamp for TestRuntime {\n    type Moment = u64;\n}\n\nimpl Sudo for TestRuntime {}\n\nimpl oracle::Oracle for TestRuntime {\n    type Asset = Asset;\n    type Price = FixedNumber;\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test.rs"],"content":"use crate::key::{AccountKey, DevNonces};\nuse crate::runtime::TestRuntime;\nuse crate::keyring::{NonceManager, PubKey};\nuse futures::lock::Mutex;\nuse sp_arithmetic::FixedI64;\nuse std::sync::Arc;\nuse substrate_subxt::Client;\n\npub fn i128_to_u64(n: i128) -\u003e Option\u003cu64\u003e {\n    if n \u003c 0 || n \u003e u64::MAX as i128 {\n        return None;\n    }\n    Some(n as u64)\n}\n\npub fn i128_to_fixedi64(n: i128) -\u003e Option\u003cFixedI64\u003e {\n    if n \u003c i64::MIN as i128 || n \u003e i64::MAX as i128 {\n        return None;\n    }\n\n    Some(FixedI64::from_inner(n as i64))\n}\n\npub async fn init_nonce(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n    account_key: AccountKey,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let mut nonces = nonces.lock().await;\n\n    if nonces.is_initialized(account_key) {\n        Ok(())\n    } else {\n        let id = account_key.acc_id();\n        let initial_nonce = client\n            .fetch_or_default(\n                \u0026substrate_subxt::system::AccountStore { account_id: \u0026id },\n                None,\n            )\n            .await\n            .unwrap()\n            .nonce;\n\n        nonces.init_nonce(account_key, initial_nonce);\n\n        println!(\"Initial nonce for {:?} is {}\", account_key, initial_nonce);\n\n        Ok(())\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_context.rs"],"content":"use super::runtime::AccountId;\nuse crate::key::{AccountKey, DevPubKey, DevPubKeyId, PubKeyStore};\nuse crate::oracle::PricePointsStoreExt;\nuse crate::runtime::{TestRuntime, FixedNumber};\nuse common::Asset;\nuse serde::ser::SerializeTupleVariant;\nuse serde::{Serialize, Serializer};\nuse sp_keyring::sr25519::Keyring;\nuse sp_runtime::{AccountId32, ModuleId};\nuse std::collections::HashMap;\nuse std::fmt::Debug;\nuse std::{cell::RefCell, hash::Hash, str::FromStr};\nuse substrate_subxt::Client;\n\n// Used for selfless traits implementations\nthread_local! {\n    static SAVED_TD: RefCell\u003cOption\u003cTestData\u003e\u003e = RefCell::new(Option::None)\n}\n\n#[derive(Debug, PartialEq, Eq, Ord, PartialOrd)]\npub enum AccountName {\n    Id(DevPubKeyId),\n    Unknown(AccountId),\n}\n\nimpl Serialize for AccountName {\n    fn serialize\u003cS\u003e(\u0026self, serializer: S) -\u003e Result\u003cS::Ok, S::Error\u003e\n    where\n        S: Serializer,\n    {\n        match self.clone() {\n            AccountName::Id(id) =\u003e {\n                let mut state = serializer.serialize_tuple_variant(\"AccountName\", 0, \"Id\", 1)?;\n                state.serialize_field(\u0026id)?;\n                state.end()\n            }\n            AccountName::Unknown(u) =\u003e {\n                let mut state =\n                    serializer.serialize_tuple_variant(\"AccountName\", 1, \"Unknown\", 1)?;\n                state.serialize_field(\u0026u)?;\n                state.end()\n            }\n        }\n    }\n}\n\n#[derive(Debug, PartialEq, Serialize)]\npub struct MyTestData {\n    pub price_points: Vec\u003c(Asset, FixedNumber)\u003e,\n}\n\npub fn register_common_pub_keys(pub_key_store: \u0026mut PubKeyStore) {\n    for k in Keyring::iter() {\n        let acc_key = AccountKey::from(k);\n        pub_key_store.register(acc_key.into());\n    }\n\n    let known_modules: Vec\u003c_\u003e = vec![b\"eq/trsry\", b\"eq/prcho\", b\"eq/vestn\"]\n        .into_iter()\n        .map(|\u0026x| DevPubKey::from(ModuleId(x)))\n        .collect();\n\n    for m in known_modules {\n        pub_key_store.register(m);\n    }\n\n    let known_pub_keys: Vec\u003c_\u003e = vec![(\n        \"Alice//stash\",\n        \"0xbe5ddb1579b72e84524fc29e78609e3caf42e85aa118ebfe0b0ad404b5bdd25f\",\n    )]\n    .into_iter()\n    .map(|(name, acc_id_str)| {\n        DevPubKey::well_known(name, AccountId32::from_str(acc_id_str).unwrap())\n    })\n    .collect();\n\n    for k in known_pub_keys {\n        pub_key_store.register(k);\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct TestData {\n    pub price_points: HashMap\u003cAsset, FixedNumber\u003e,\n}\n\nimpl TestData {\n    pub fn new() -\u003e Self {\n        TestData {\n            price_points: HashMap::new(),\n        }\n    }\n\n    pub fn clear(\u0026mut self) {\n        self.price_points.clear();\n    }\n\n    pub fn to_static(\u0026self) {\n        SAVED_TD.with(|td_ref| {\n            td_ref.replace(Some(self.clone()));\n        });\n    }\n\n    pub fn get_static() -\u003e Self {\n        SAVED_TD.with(|td_ref| {\n            let result = td_ref.borrow().clone();\n            match result {\n                Some(td) =\u003e td,\n                None =\u003e panic!(\"Error during attempt to access LTS TestData - no data\"),\n            }\n        })\n    }\n}\n\npub const EPS: i64 = 1_0;\n\npub trait EqWithEps {\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool;\n}\n\nimpl EqWithEps for u64 {\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool {\n        (*self as i64 - *other as i64).abs() \u003c EPS\n    }\n}\n\nimpl\u003cK, V\u003e EqWithEps for HashMap\u003cK, V\u003e\nwhere\n    K: Eq + Hash,\n    V: EqWithEps,\n{\n    fn eq_with_eps(\u0026self, other: \u0026Self) -\u003e bool {\n        self.len() == other.len()\n            \u0026\u0026 self\n                .iter()\n                .all(|(k, v)| (*other).get(k).map_or(false, |v2| v.eq_with_eps(v2)))\n    }\n}\n\npub struct TestContext {}\n\nimpl TestContext {\n    pub async fn read_storage(\n        client: \u0026Client\u003cTestRuntime\u003e,\n    ) -\u003e Result\u003cTestData, Box\u003cdyn std::error::Error\u003e\u003e {\n        let mut data = TestData::new();\n\n        for asset in Asset::iterator() {\n            let price_points = client.price_points(*asset, Option::None).await;\n            data.price_points.insert(*asset, price_points.unwrap());\n        }\n        Ok(data)\n    }\n}\n","traces":[{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":36},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_scripts","mod.rs"],"content":"pub use super::*;\n\npub mod test_financial;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","test_scripts","test_financial.rs"],"content":"use super::DevNonces;\nuse crate::key::AccountKey;\nuse crate::oracle::SetPriceCall;\nuse crate::test::init_nonce;\nuse crate::test_context::TestContext;\nuse crate::{join_chain_calls, requester::call_chain, TestRuntime};\nuse crate::runtime::FixedNumber;\nuse common::Asset;\nuse futures::{lock::Mutex, try_join};\nuse integration_testing_macro::tuple_to_vec;\nuse sp_keyring::AccountKeyring;\nuse std::{marker::PhantomData, sync::Arc};\nuse substrate_subxt::Client;\n\npub async fn test_financial(\n    client: \u0026Client\u003cTestRuntime\u003e,\n    nonces: Arc\u003cMutex\u003cDevNonces\u003e\u003e,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let alice_key = AccountKey::from(AccountKeyring::Alice);\n    init_nonce(client, nonces.clone(), alice_key).await?;\n\n    let btc_price = FixedNumber::from_num(20_000);\n    let eth_price = FixedNumber::from_num(250);\n    let eq_price = FixedNumber::from_num(25);\n    let eos_price = FixedNumber::from_num(3);\n\n    // ---------------------------------- Setting initial prices ----------------------------------\n\n    println!(\"Initial price set\");\n    join_chain_calls!(\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Btc,\n                value: btc_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eth,\n                value: eth_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eq,\n                value: eq_price,\n                _runtime: PhantomData,\n            },\n        ),\n        call_chain(\n            client,\n            nonces.clone(),\n            alice_key,\n            SetPriceCall {\n                asset: Asset::Eos,\n                value: eos_price,\n                _runtime: PhantomData,\n            },\n        ),\n    );\n\n    let initial_state = TestContext::read_storage(client).await?;\n    let curr_btc = initial_state.price_points.get(\u0026Asset::Btc).unwrap();\n    let curr_eth = initial_state.price_points.get(\u0026Asset::Eth).unwrap();\n    let curr_eq = initial_state.price_points.get(\u0026Asset::Eq).unwrap();\n    let curr_eos = initial_state.price_points.get(\u0026Asset::Eos).unwrap();\n\n    assert!(curr_btc == \u0026btc_price);\n    assert!(curr_eth == \u0026eth_price);\n    assert!(curr_eq == \u0026eq_price);\n    assert!(curr_eos == \u0026eos_price);\n\n    // -------------------------------- Iteratively changing prices --------------------------------\n\n    let iterations: i64 = 30;\n\n    for i in 1..=iterations {\n        // price_q slowly increases from ~1 to 1.5\n        let price_q = FixedNumber::from_num(1)\n            + (FixedNumber::from_num(i) / FixedNumber::from_num(iterations * 2));\n\n        println!(\"Setting prices, iteration #{}\", i);\n        join_chain_calls!(\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Btc,\n                    value: btc_price * price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eth,\n                    value: eth_price / price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eq,\n                    value: eq_price * price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n            call_chain(\n                client,\n                nonces.clone(),\n                alice_key,\n                SetPriceCall {\n                    asset: Asset::Eos,\n                    value: eos_price / price_q,\n                    _runtime: PhantomData,\n                },\n            ),\n        );\n\n        let iteration_state = TestContext::read_storage(client).await?;\n        let curr_btc = iteration_state.price_points.get(\u0026Asset::Btc).unwrap();\n        let curr_eth = iteration_state.price_points.get(\u0026Asset::Eth).unwrap();\n        let curr_eq = iteration_state.price_points.get(\u0026Asset::Eq).unwrap();\n        let curr_eos = iteration_state.price_points.get(\u0026Asset::Eos).unwrap();\n    \n        assert!(curr_btc == \u0026(btc_price * price_q));\n        assert!(curr_eth == \u0026(eth_price / price_q));\n        assert!(curr_eq == \u0026(eq_price * price_q));\n        assert!(curr_eos == \u0026(eos_price / price_q));\n    }\n\n    // -----------------------------------  -----------------------------------\n\n    println!(\"Assertion successful, test passed\");\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","integration-testing","src","timestamp.rs"],"content":"use codec::Encode;\nuse core::marker::PhantomData;\nuse frame_support::Parameter;\nuse sp_runtime::traits::{AtLeast32Bit, Member, Scale};\nuse std::fmt::Debug;\nuse substrate_subxt::system::{System, SystemEventsDecoder};\nuse substrate_subxt_proc_macro::{module, Store};\n\n#[module]\npub trait Timestamp: System {\n    type Moment: Parameter\n        + Default\n        + AtLeast32Bit\n        + Member\n        + Scale\u003cSelf::BlockNumber, Output = Self::Moment\u003e\n        + Copy;\n}\n\n#[derive(Clone, Debug, Eq, PartialEq, Store, Encode)]\npub struct NowStore\u003cT: Timestamp\u003e {\n    #[store(returns = T::Moment)]\n    /// Runtime marker.\n    pub _runtime: PhantomData\u003cT\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","build.rs"],"content":"use substrate_build_script_utils::{generate_cargo_keys, rerun_if_git_head_changed};\n\nfn main() {\n\tgenerate_cargo_keys();\n\n\trerun_if_git_head_changed();\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","chain_spec.rs"],"content":"use sp_core::{Pair, Public, sr25519};\nuse node_template_runtime::{\n\tAccountId, AuraConfig, BalancesConfig, GenesisConfig, GrandpaConfig,\n\tSudoConfig, SystemConfig, WASM_BINARY, Signature, OracleConfig,\n\tFixedNumber, FinancialConfig,\n};\nuse sp_consensus_aura::sr25519::AuthorityId as AuraId;\nuse sp_finality_grandpa::AuthorityId as GrandpaId;\nuse sp_runtime::traits::{Verify, IdentifyAccount};\nuse sc_service::ChainType;\nuse common::Asset;\nuse substrate_fixed::traits::LossyFrom;\n\n// The URL for the telemetry server.\n// const STAGING_TELEMETRY_URL: \u0026str = \"wss://telemetry.polkadot.io/submit/\";\n\n/// Specialized `ChainSpec`. This is a specialization of the general Substrate ChainSpec type.\npub type ChainSpec = sc_service::GenericChainSpec\u003cGenesisConfig\u003e;\n\n/// Generate a crypto pair from seed.\npub fn get_from_seed\u003cTPublic: Public\u003e(seed: \u0026str) -\u003e \u003cTPublic::Pair as Pair\u003e::Public {\n\tTPublic::Pair::from_string(\u0026format!(\"//{}\", seed), None)\n\t\t.expect(\"static values are valid; qed\")\n\t\t.public()\n}\n\ntype AccountPublic = \u003cSignature as Verify\u003e::Signer;\n\n/// Generate an account ID from seed.\npub fn get_account_id_from_seed\u003cTPublic: Public\u003e(seed: \u0026str) -\u003e AccountId where\n\tAccountPublic: From\u003c\u003cTPublic::Pair as Pair\u003e::Public\u003e\n{\n\tAccountPublic::from(get_from_seed::\u003cTPublic\u003e(seed)).into_account()\n}\n\n/// Generate an Aura authority key.\npub fn authority_keys_from_seed(s: \u0026str) -\u003e (AuraId, GrandpaId) {\n\t(\n\t\tget_from_seed::\u003cAuraId\u003e(s),\n\t\tget_from_seed::\u003cGrandpaId\u003e(s),\n\t)\n}\n\npub fn development_config() -\u003e Result\u003cChainSpec, String\u003e {\n\tlet wasm_binary = WASM_BINARY.ok_or(\"Development wasm binary not available\".to_string())?;\n\n\tOk(ChainSpec::from_genesis(\n\t\t// Name\n\t\t\"Development\",\n\t\t// ID\n\t\t\"dev\",\n\t\tChainType::Development,\n\t\tmove || testnet_genesis(\n\t\t\twasm_binary,\n\t\t\t// Initial PoA authorities\n\t\t\tvec![\n\t\t\t\tauthority_keys_from_seed(\"Alice\"),\n\t\t\t],\n\t\t\t// Sudo account\n\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t// Pre-funded accounts\n\t\t\tvec![\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob//stash\"),\n\t\t\t],\n\t\t\ttrue,\n\t\t\tvec![\n\t\t\t\t(Asset::Usd, 1),\n\t\t\t\t(Asset::Eq, 25),\n\t\t\t\t(Asset::Eth, 250),\n\t\t\t\t(Asset::Btc, 10_000),\n\t\t\t\t(Asset::Eos, 3),\n\t\t\t].into_iter().map(|(a, x)| (a, FixedNumber::lossy_from(x))).collect(),\n\t\t),\n\t\t// Bootnodes\n\t\tvec![],\n\t\t// Telemetry\n\t\tNone,\n\t\t// Protocol ID\n\t\tNone,\n\t\t// Properties\n\t\tNone,\n\t\t// Extensions\n\t\tNone,\n\t))\n}\n\npub fn local_testnet_config() -\u003e Result\u003cChainSpec, String\u003e {\n\tlet wasm_binary = WASM_BINARY.ok_or(\"Development wasm binary not available\".to_string())?;\n\n\tOk(ChainSpec::from_genesis(\n\t\t// Name\n\t\t\"Local Testnet\",\n\t\t// ID\n\t\t\"local_testnet\",\n\t\tChainType::Local,\n\t\tmove || testnet_genesis(\n\t\t\twasm_binary,\n\t\t\t// Initial PoA authorities\n\t\t\tvec![\n\t\t\t\tauthority_keys_from_seed(\"Alice\"),\n\t\t\t\tauthority_keys_from_seed(\"Bob\"),\n\t\t\t],\n\t\t\t// Sudo account\n\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t// Pre-funded accounts\n\t\t\tvec![\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Charlie\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Dave\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Eve\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Ferdie\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Alice//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Bob//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Charlie//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Dave//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Eve//stash\"),\n\t\t\t\tget_account_id_from_seed::\u003csr25519::Public\u003e(\"Ferdie//stash\"),\n\t\t\t],\n\t\t\ttrue,\n\t\t\tvec![\n\t\t\t\t(Asset::Usd, 1),\n\t\t\t\t(Asset::Eq, 25),\n\t\t\t\t(Asset::Eth, 250),\n\t\t\t\t(Asset::Btc, 10_000),\n\t\t\t\t(Asset::Eos, 3),\n\t\t\t].into_iter().map(|(a, x)| (a, FixedNumber::lossy_from(x))).collect(),\n\t\t),\n\t\t// Bootnodes\n\t\tvec![],\n\t\t// Telemetry\n\t\tNone,\n\t\t// Protocol ID\n\t\tNone,\n\t\t// Properties\n\t\tNone,\n\t\t// Extensions\n\t\tNone,\n\t))\n}\n\n/// Configure initial storage state for FRAME modules.\nfn testnet_genesis(\n\twasm_binary: \u0026[u8],\n\tinitial_authorities: Vec\u003c(AuraId, GrandpaId)\u003e,\n\troot_key: AccountId,\n\tendowed_accounts: Vec\u003cAccountId\u003e,\n\t_enable_println: bool,\n\tprices: Vec\u003c(Asset, FixedNumber)\u003e,\n) -\u003e GenesisConfig {\n\tGenesisConfig {\n\t\tframe_system: Some(SystemConfig {\n\t\t\t// Add Wasm runtime to storage.\n\t\t\tcode: wasm_binary.to_vec(),\n\t\t\tchanges_trie_config: Default::default(),\n\t\t}),\n\t\tpallet_balances: Some(BalancesConfig {\n\t\t\t// Configure endowed accounts with initial balance of 1 \u003c\u003c 60.\n\t\t\tbalances: endowed_accounts.iter().cloned().map(|k|(k, 1 \u003c\u003c 60)).collect(),\n\t\t}),\n\t\tpallet_aura: Some(AuraConfig {\n\t\t\tauthorities: initial_authorities.iter().map(|x| (x.0.clone())).collect(),\n\t\t}),\n\t\tpallet_grandpa: Some(GrandpaConfig {\n\t\t\tauthorities: initial_authorities.iter().map(|x| (x.1.clone(), 1)).collect(),\n\t\t}),\n\t\tpallet_sudo: Some(SudoConfig {\n\t\t\t// Assign network admin rights.\n\t\t\tkey: root_key,\n\t\t}),\n\t\toracle: Some(OracleConfig {\n\t\t\tprices: prices.iter().cloned().collect(),\n\t\t}),\n\t\tfinancial_pallet: Some(FinancialConfig {\n\t\t\tprices: prices.iter().cloned().map(|(a, p)| (a, vec![p])).collect(),\n\t\t}),\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","cli.rs"],"content":"use sc_cli::{RunCmd, Subcommand};\nuse structopt::StructOpt;\n\n#[derive(Debug, StructOpt)]\npub struct Cli {\n\t#[structopt(subcommand)]\n\tpub subcommand: Option\u003cSubcommand\u003e,\n\n\t#[structopt(flatten)]\n\tpub run: RunCmd,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","command.rs"],"content":"// This file is part of Substrate.\n\n// Copyright (C) 2017-2020 Parity Technologies (UK) Ltd.\n// SPDX-License-Identifier: Apache-2.0\n\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// \thttp://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::chain_spec;\nuse crate::cli::Cli;\nuse crate::service;\nuse sc_cli::{SubstrateCli, RuntimeVersion, Role, ChainSpec};\nuse sc_service::PartialComponents;\nuse crate::service::new_partial;\n\nimpl SubstrateCli for Cli {\n\tfn impl_name() -\u003e String {\n\t\t\"Substrate Node\".into()\n\t}\n\n\tfn impl_version() -\u003e String {\n\t\tenv!(\"SUBSTRATE_CLI_IMPL_VERSION\").into()\n\t}\n\n\tfn description() -\u003e String {\n\t\tenv!(\"CARGO_PKG_DESCRIPTION\").into()\n\t}\n\n\tfn author() -\u003e String {\n\t\tenv!(\"CARGO_PKG_AUTHORS\").into()\n\t}\n\n\tfn support_url() -\u003e String {\n\t\t\"support.anonymous.an\".into()\n\t}\n\n\tfn copyright_start_year() -\u003e i32 {\n\t\t2017\n\t}\n\n\tfn load_spec(\u0026self, id: \u0026str) -\u003e Result\u003cBox\u003cdyn sc_service::ChainSpec\u003e, String\u003e {\n\t\tOk(match id {\n\t\t\t\"dev\" =\u003e Box::new(chain_spec::development_config()?),\n\t\t\t\"\" | \"local\" =\u003e Box::new(chain_spec::local_testnet_config()?),\n\t\t\tpath =\u003e Box::new(chain_spec::ChainSpec::from_json_file(\n\t\t\t\tstd::path::PathBuf::from(path),\n\t\t\t)?),\n\t\t})\n\t}\n\n\tfn native_runtime_version(_: \u0026Box\u003cdyn ChainSpec\u003e) -\u003e \u0026'static RuntimeVersion {\n\t\t\u0026node_template_runtime::VERSION\n\t}\n}\n\n/// Parse and run command line arguments\npub fn run() -\u003e sc_cli::Result\u003c()\u003e {\n\tlet cli = Cli::from_args();\n\n\tmatch cli.subcommand {\n\t\tSome(ref subcommand) =\u003e {\n\t\t\tlet runner = cli.create_runner(subcommand)?;\n\t\t\trunner.run_subcommand(subcommand, |config| {\n\t\t\t\tlet PartialComponents { client, backend, task_manager, import_queue, .. }\n\t\t\t\t\t= new_partial(\u0026config)?;\n\t\t\t\tOk((client, backend, import_queue, task_manager))\n\t\t\t})\n\t\t}\n\t\tNone =\u003e {\n\t\t\tlet runner = cli.create_runner(\u0026cli.run)?;\n\t\t\trunner.run_node_until_exit(|config| match config.role {\n\t\t\t\tRole::Light =\u003e service::new_light(config),\n\t\t\t\t_ =\u003e service::new_full(config),\n\t\t\t})\n\t\t}\n\t}\n}\n","traces":[{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":20},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","lib.rs"],"content":"pub mod chain_spec;\npub mod service;\npub mod rpc;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","main.rs"],"content":"//! Substrate Node Template CLI library.\n#![warn(missing_docs)]\n\nmod chain_spec;\n#[macro_use]\nmod service;\nmod cli;\nmod command;\nmod rpc;\n\nfn main() -\u003e sc_cli::Result\u003c()\u003e {\n\tcommand::run()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","rpc.rs"],"content":"//! A collection of node-specific RPC methods.\n//! Substrate provides the `sc-rpc` crate, which defines the core RPC layer\n//! used by Substrate nodes. This file extends those RPC definitions with\n//! capabilities that are specific to this project's runtime configuration.\n\n#![warn(missing_docs)]\n\nuse std::sync::Arc;\n\nuse node_template_runtime::{opaque::Block, AccountId, Balance, Index};\nuse sp_api::ProvideRuntimeApi;\nuse sp_blockchain::{Error as BlockChainError, HeaderMetadata, HeaderBackend};\nuse sp_block_builder::BlockBuilder;\npub use sc_rpc_api::DenyUnsafe;\nuse sp_transaction_pool::TransactionPool;\n\n\n/// Full client dependencies.\npub struct FullDeps\u003cC, P\u003e {\n\t/// The client instance to use.\n\tpub client: Arc\u003cC\u003e,\n\t/// Transaction pool instance.\n\tpub pool: Arc\u003cP\u003e,\n\t/// Whether to deny unsafe calls\n\tpub deny_unsafe: DenyUnsafe,\n}\n\n/// Instantiate all full RPC extensions.\npub fn create_full\u003cC, P\u003e(\n\tdeps: FullDeps\u003cC, P\u003e,\n) -\u003e jsonrpc_core::IoHandler\u003csc_rpc::Metadata\u003e where\n\tC: ProvideRuntimeApi\u003cBlock\u003e,\n\tC: HeaderBackend\u003cBlock\u003e + HeaderMetadata\u003cBlock, Error=BlockChainError\u003e + 'static,\n\tC: Send + Sync + 'static,\n\tC::Api: substrate_frame_rpc_system::AccountNonceApi\u003cBlock, AccountId, Index\u003e,\n\tC::Api: pallet_transaction_payment_rpc::TransactionPaymentRuntimeApi\u003cBlock, Balance\u003e,\n\tC::Api: BlockBuilder\u003cBlock\u003e,\n\tP: TransactionPool + 'static,\n{\n\tuse substrate_frame_rpc_system::{FullSystem, SystemApi};\n\tuse pallet_transaction_payment_rpc::{TransactionPayment, TransactionPaymentApi};\n\n\tlet mut io = jsonrpc_core::IoHandler::default();\n\tlet FullDeps {\n\t\tclient,\n\t\tpool,\n\t\tdeny_unsafe,\n\t} = deps;\n\n\tio.extend_with(\n\t\tSystemApi::to_delegate(FullSystem::new(client.clone(), pool, deny_unsafe))\n\t);\n\n\tio.extend_with(\n\t\tTransactionPaymentApi::to_delegate(TransactionPayment::new(client.clone()))\n\t);\n\n\t// Extend this RPC with a custom API by using the following syntax.\n\t// `YourRpcStruct` should have a reference to a client, which is needed\n\t// to call into the runtime.\n\t// `io.extend_with(YourRpcTrait::to_delegate(YourRpcStruct::new(ReferenceToClient, ...)));`\n\n\tio\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","node","src","service.rs"],"content":"//! Service and ServiceFactory implementation. Specialized wrapper over substrate service.\n\nuse std::sync::Arc;\nuse std::time::Duration;\nuse sc_client_api::{ExecutorProvider, RemoteBackend};\nuse node_template_runtime::{self, opaque::Block, RuntimeApi};\nuse sc_service::{error::Error as ServiceError, Configuration, TaskManager};\nuse sp_inherents::InherentDataProviders;\nuse sc_executor::native_executor_instance;\npub use sc_executor::NativeExecutor;\nuse sp_consensus_aura::sr25519::{AuthorityPair as AuraPair};\nuse sc_finality_grandpa::{FinalityProofProvider as GrandpaFinalityProofProvider, SharedVoterState};\n\n// Our native executor instance.\nnative_executor_instance!(\n\tpub Executor,\n\tnode_template_runtime::api::dispatch,\n\tnode_template_runtime::native_version,\n);\n\ntype FullClient = sc_service::TFullClient\u003cBlock, RuntimeApi, Executor\u003e;\ntype FullBackend = sc_service::TFullBackend\u003cBlock\u003e;\ntype FullSelectChain = sc_consensus::LongestChain\u003cFullBackend, Block\u003e;\n\npub fn new_partial(config: \u0026Configuration) -\u003e Result\u003csc_service::PartialComponents\u003c\n\tFullClient, FullBackend, FullSelectChain,\n\tsp_consensus::DefaultImportQueue\u003cBlock, FullClient\u003e,\n\tsc_transaction_pool::FullPool\u003cBlock, FullClient\u003e,\n\t(\n\t\tsc_consensus_aura::AuraBlockImport\u003c\n\t\t\tBlock,\n\t\t\tFullClient,\n\t\t\tsc_finality_grandpa::GrandpaBlockImport\u003cFullBackend, Block, FullClient, FullSelectChain\u003e,\n\t\t\tAuraPair\n\t\t\u003e,\n\t\tsc_finality_grandpa::LinkHalf\u003cBlock, FullClient, FullSelectChain\u003e\n\t)\n\u003e, ServiceError\u003e {\n\tlet inherent_data_providers = sp_inherents::InherentDataProviders::new();\n\n\tlet (client, backend, keystore, task_manager) =\n\t\tsc_service::new_full_parts::\u003cBlock, RuntimeApi, Executor\u003e(\u0026config)?;\n\tlet client = Arc::new(client);\n\n\tlet select_chain = sc_consensus::LongestChain::new(backend.clone());\n\n\tlet transaction_pool = sc_transaction_pool::BasicPool::new_full(\n\t\tconfig.transaction_pool.clone(),\n\t\tconfig.prometheus_registry(),\n\t\ttask_manager.spawn_handle(),\n\t\tclient.clone(),\n\t);\n\n\tlet (grandpa_block_import, grandpa_link) = sc_finality_grandpa::block_import(\n\t\tclient.clone(), \u0026(client.clone() as Arc\u003c_\u003e), select_chain.clone(),\n\t)?;\n\n\tlet aura_block_import = sc_consensus_aura::AuraBlockImport::\u003c_, _, _, AuraPair\u003e::new(\n\t\tgrandpa_block_import.clone(), client.clone(),\n\t);\n\n\tlet import_queue = sc_consensus_aura::import_queue::\u003c_, _, _, AuraPair, _, _\u003e(\n\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\taura_block_import.clone(),\n\t\tSome(Box::new(grandpa_block_import.clone())),\n\t\tNone,\n\t\tclient.clone(),\n\t\tinherent_data_providers.clone(),\n\t\t\u0026task_manager.spawn_handle(),\n\t\tconfig.prometheus_registry(),\n\t\tsp_consensus::CanAuthorWithNativeVersion::new(client.executor().clone()),\n\t)?;\n\n\tOk(sc_service::PartialComponents {\n\t\tclient, backend, task_manager, import_queue, keystore, select_chain, transaction_pool,\n\t\tinherent_data_providers,\n\t\tother: (aura_block_import, grandpa_link),\n\t})\n}\n\n/// Builds a new service for a full client.\npub fn new_full(config: Configuration) -\u003e Result\u003cTaskManager, ServiceError\u003e {\n\tlet sc_service::PartialComponents {\n\t\tclient, backend, mut task_manager, import_queue, keystore, select_chain, transaction_pool,\n\t\tinherent_data_providers,\n\t\tother: (block_import, grandpa_link),\n\t} = new_partial(\u0026config)?;\n\n\tlet finality_proof_provider =\n\t\tGrandpaFinalityProofProvider::new_for_service(backend.clone(), client.clone());\n\n\tlet (network, network_status_sinks, system_rpc_tx, network_starter) =\n\t\tsc_service::build_network(sc_service::BuildNetworkParams {\n\t\t\tconfig: \u0026config,\n\t\t\tclient: client.clone(),\n\t\t\ttransaction_pool: transaction_pool.clone(),\n\t\t\tspawn_handle: task_manager.spawn_handle(),\n\t\t\timport_queue,\n\t\t\ton_demand: None,\n\t\t\tblock_announce_validator_builder: None,\n\t\t\tfinality_proof_request_builder: None,\n\t\t\tfinality_proof_provider: Some(finality_proof_provider.clone()),\n\t\t})?;\n\n\tif config.offchain_worker.enabled {\n\t\tsc_service::build_offchain_workers(\n\t\t\t\u0026config, backend.clone(), task_manager.spawn_handle(), client.clone(), network.clone(),\n\t\t);\n\t}\n\n\tlet role = config.role.clone();\n\tlet force_authoring = config.force_authoring;\n\tlet name = config.network.node_name.clone();\n\tlet enable_grandpa = !config.disable_grandpa;\n\tlet prometheus_registry = config.prometheus_registry().cloned();\n\tlet telemetry_connection_sinks = sc_service::TelemetryConnectionSinks::default();\n\n\tlet rpc_extensions_builder = {\n\t\tlet client = client.clone();\n\t\tlet pool = transaction_pool.clone();\n\n\t\tBox::new(move |deny_unsafe, _| {\n\t\t\tlet deps = crate::rpc::FullDeps {\n\t\t\t\tclient: client.clone(),\n\t\t\t\tpool: pool.clone(),\n\t\t\t\tdeny_unsafe,\n\t\t\t};\n\n\t\t\tcrate::rpc::create_full(deps)\n\t\t})\n\t};\n\n\tsc_service::spawn_tasks(sc_service::SpawnTasksParams {\n\t\tnetwork: network.clone(),\n\t\tclient: client.clone(),\n\t\tkeystore: keystore.clone(),\n\t\ttask_manager: \u0026mut task_manager,\n\t\ttransaction_pool: transaction_pool.clone(),\n\t\ttelemetry_connection_sinks: telemetry_connection_sinks.clone(),\n\t\trpc_extensions_builder: rpc_extensions_builder,\n\t\ton_demand: None,\n\t\tremote_blockchain: None,\n\t\tbackend, network_status_sinks, system_rpc_tx, config,\n\t})?;\n\n\tif role.is_authority() {\n\t\tlet proposer = sc_basic_authorship::ProposerFactory::new(\n\t\t\tclient.clone(),\n\t\t\ttransaction_pool,\n\t\t\tprometheus_registry.as_ref(),\n\t\t);\n\n\t\tlet can_author_with =\n\t\t\tsp_consensus::CanAuthorWithNativeVersion::new(client.executor().clone());\n\n\t\tlet aura = sc_consensus_aura::start_aura::\u003c_, _, _, _, _, AuraPair, _, _, _\u003e(\n\t\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\t\tclient.clone(),\n\t\t\tselect_chain,\n\t\t\tblock_import,\n\t\t\tproposer,\n\t\t\tnetwork.clone(),\n\t\t\tinherent_data_providers.clone(),\n\t\t\tforce_authoring,\n\t\t\tkeystore.clone(),\n\t\t\tcan_author_with,\n\t\t)?;\n\n\t\t// the AURA authoring task is considered essential, i.e. if it\n\t\t// fails we take down the service with it.\n\t\ttask_manager.spawn_essential_handle().spawn_blocking(\"aura\", aura);\n\t}\n\n\t// if the node isn't actively participating in consensus then it doesn't\n\t// need a keystore, regardless of which protocol we use below.\n\tlet keystore = if role.is_authority() {\n\t\tSome(keystore as sp_core::traits::BareCryptoStorePtr)\n\t} else {\n\t\tNone\n\t};\n\n\tlet grandpa_config = sc_finality_grandpa::Config {\n\t\t// FIXME #1578 make this available through chainspec\n\t\tgossip_duration: Duration::from_millis(333),\n\t\tjustification_period: 512,\n\t\tname: Some(name),\n\t\tobserver_enabled: false,\n\t\tkeystore,\n\t\tis_authority: role.is_network_authority(),\n\t};\n\n\tif enable_grandpa {\n\t\t// start the full GRANDPA voter\n\t\t// NOTE: non-authorities could run the GRANDPA observer protocol, but at\n\t\t// this point the full voter should provide better guarantees of block\n\t\t// and vote data availability than the observer. The observer has not\n\t\t// been tested extensively yet and having most nodes in a network run it\n\t\t// could lead to finality stalls.\n\t\tlet grandpa_config = sc_finality_grandpa::GrandpaParams {\n\t\t\tconfig: grandpa_config,\n\t\t\tlink: grandpa_link,\n\t\t\tnetwork,\n\t\t\tinherent_data_providers,\n\t\t\ttelemetry_on_connect: Some(telemetry_connection_sinks.on_connect_stream()),\n\t\t\tvoting_rule: sc_finality_grandpa::VotingRulesBuilder::default().build(),\n\t\t\tprometheus_registry,\n\t\t\tshared_voter_state: SharedVoterState::empty(),\n\t\t};\n\n\t\t// the GRANDPA voter task is considered infallible, i.e.\n\t\t// if it fails we take down the service with it.\n\t\ttask_manager.spawn_essential_handle().spawn_blocking(\n\t\t\t\"grandpa-voter\",\n\t\t\tsc_finality_grandpa::run_grandpa_voter(grandpa_config)?\n\t\t);\n\t} else {\n\t\tsc_finality_grandpa::setup_disabled_grandpa(\n\t\t\tclient,\n\t\t\t\u0026inherent_data_providers,\n\t\t\tnetwork,\n\t\t)?;\n\t}\n\n\tnetwork_starter.start_network();\n\tOk(task_manager)\n}\n\n/// Builds a new service for a light client.\npub fn new_light(config: Configuration) -\u003e Result\u003cTaskManager, ServiceError\u003e {\n\tlet (client, backend, keystore, mut task_manager, on_demand) =\n\t\tsc_service::new_light_parts::\u003cBlock, RuntimeApi, Executor\u003e(\u0026config)?;\n\n\tlet transaction_pool = Arc::new(sc_transaction_pool::BasicPool::new_light(\n\t\tconfig.transaction_pool.clone(),\n\t\tconfig.prometheus_registry(),\n\t\ttask_manager.spawn_handle(),\n\t\tclient.clone(),\n\t\ton_demand.clone(),\n\t));\n\n\tlet grandpa_block_import = sc_finality_grandpa::light_block_import(\n\t\tclient.clone(), backend.clone(), \u0026(client.clone() as Arc\u003c_\u003e),\n\t\tArc::new(on_demand.checker().clone()) as Arc\u003c_\u003e,\n\t)?;\n\tlet finality_proof_import = grandpa_block_import.clone();\n\tlet finality_proof_request_builder =\n\t\tfinality_proof_import.create_finality_proof_request_builder();\n\n\tlet import_queue = sc_consensus_aura::import_queue::\u003c_, _, _, AuraPair, _, _\u003e(\n\t\tsc_consensus_aura::slot_duration(\u0026*client)?,\n\t\tgrandpa_block_import,\n\t\tNone,\n\t\tSome(Box::new(finality_proof_import)),\n\t\tclient.clone(),\n\t\tInherentDataProviders::new(),\n\t\t\u0026task_manager.spawn_handle(),\n\t\tconfig.prometheus_registry(),\n\t\tsp_consensus::NeverCanAuthor,\n\t)?;\n\n\tlet finality_proof_provider =\n\t\tGrandpaFinalityProofProvider::new_for_service(backend.clone(), client.clone());\n\n\tlet (network, network_status_sinks, system_rpc_tx, network_starter) =\n\t\tsc_service::build_network(sc_service::BuildNetworkParams {\n\t\t\tconfig: \u0026config,\n\t\t\tclient: client.clone(),\n\t\t\ttransaction_pool: transaction_pool.clone(),\n\t\t\tspawn_handle: task_manager.spawn_handle(),\n\t\t\timport_queue,\n\t\t\ton_demand: Some(on_demand.clone()),\n\t\t\tblock_announce_validator_builder: None,\n\t\t\tfinality_proof_request_builder: Some(finality_proof_request_builder),\n\t\t\tfinality_proof_provider: Some(finality_proof_provider),\n\t\t})?;\n\n\tif config.offchain_worker.enabled {\n\t\tsc_service::build_offchain_workers(\n\t\t\t\u0026config, backend.clone(), task_manager.spawn_handle(), client.clone(), network.clone(),\n\t\t);\n\t}\n\n\tsc_service::spawn_tasks(sc_service::SpawnTasksParams {\n\t\tremote_blockchain: Some(backend.remote_blockchain()),\n\t\ttransaction_pool,\n\t\ttask_manager: \u0026mut task_manager,\n\t\ton_demand: Some(on_demand),\n\t\trpc_extensions_builder: Box::new(|_, _| ()),\n\t\ttelemetry_connection_sinks: sc_service::TelemetryConnectionSinks::default(),\n\t\tconfig,\n\t\tclient,\n\t\tkeystore,\n\t\tbackend,\n\t\tnetwork,\n\t\tnetwork_status_sinks,\n\t\tsystem_rpc_tx,\n\t })?;\n\n\t network_starter.start_network();\n\n\t Ok(task_manager)\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","lib.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n//! # Financial Pallet Module\n//! ## Overview\n//!\n//! Equilibrium's Financial Pallet is an open-source substrate module that subscribes to external\n//! price feed/oracle, gathers asset prices and calculates financial metrics based on the\n//! information collected.\n//!\n//! ## Genesis Config\n//! \n//! You can provide initial price logs for the assets using [`GenesisConfig`](./struct.GenesisConfig.html).\n\n#![warn(missing_docs)]\n#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse frame_support::{decl_module, decl_storage, decl_event, decl_error, ensure, dispatch};\nuse frame_support::traits::{Get, UnixTime};\nuse frame_support::codec::{Codec, Decode, Encode};\nuse frame_support::dispatch::{DispatchError, Parameter};\nuse frame_system::ensure_signed;\nuse financial_primitives::capvec::CapVec;\nuse financial_primitives::{OnPriceSet, IntoTypeIterator};\nuse core::time::Duration;\nuse sp_std::cmp::min;\nuse sp_std::prelude::Vec;\nuse sp_std::convert::TryInto;\nuse sp_std::iter::Iterator;\nuse sp_std::vec;\nuse substrate_fixed::transcendental::sqrt;\nuse substrate_fixed::traits::{FixedSigned, ToFixed};\nuse core::ops::{AddAssign, BitOrAssign, ShlAssign};\nuse math::{ConstType, MathError, MathResult, diff, squared, decay, last_recurrent_ewma, exp_vola, calc_return_func, calc_return_iter, sum, mean, demeaned, regular_vola, mul, regular_corr, exp_corr};\n\npub use math::{CalcReturnType, CalcVolatilityType, CalcCorrelationType};\n\nmod math;\n\n#[cfg(test)]\nmod mock;\n\n#[cfg(test)]\nmod tests;\n\n/// The module configuration trait.\npub trait Trait: frame_system::Trait {\n    /// The overarching event type.\n\ttype Event: From\u003cEvent\u003cSelf\u003e\u003e + Into\u003c\u003cSelf as frame_system::Trait\u003e::Event\u003e;\n    /// Implementation for the current unix timestamp provider. The \n    /// [`pallet_timestamp`](https://crates.parity.io/pallet_timestamp/index.html) is\n    /// right choice in most cases.\n\ttype UnixTime: UnixTime;\n    /// Number of price data points stored and used for calculations.\n\ttype PriceCount: Get\u003cu32\u003e;\n    /// The period of the collected prices in minutes.\n\ttype PricePeriod: Get\u003cu32\u003e;\n    /// System wide type for representing various assets such as BTC, ETH, EOS, etc.\n\ttype Asset: Parameter + Copy + IntoTypeIterator;\n    /// Primitive integer type that [`FixedNumber`](#associatedtype.FixedNumber) based on.\n\ttype FixedNumberBits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign;\n    /// Fixed point data type with a required precision that used for all financial calculations.\n\ttype FixedNumber: Clone + Copy + Codec + FixedSigned\u003cBits = Self::FixedNumberBits\u003e + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e;\n    /// System wide type for representing price values. It must be convertable to and\n    /// from [`FixedNumber`](#associatedtype.FixedNumber).\n\ttype Price: Parameter + Clone + From\u003cSelf::FixedNumber\u003e + Into\u003cSelf::FixedNumber\u003e;\n}\n\n/// Information about latest price update.\n#[derive(Encode, Decode, Clone, Default, PartialEq, Eq, Debug)]\npub struct PriceUpdate\u003cP\u003e {\n    /// Timestamp of the price period start for the latest price received.\n\tpub period_start: Duration,\n    /// Latest price timestamp.\n\tpub time: Duration,\n    /// Latest price value.\n\tpub price: P,\n}\n\nimpl\u003cP\u003e PriceUpdate\u003cP\u003e {\n\t#[cfg(test)]\n\tfn new(period_start: Duration, time: Duration, price: P) -\u003e PriceUpdate\u003cP\u003e {\n\t\tPriceUpdate {\n\t\t\tperiod_start,\n\t\t\ttime,\n\t\t\tprice,\n\t\t}\n\t}\n}\n\n/// Financial metrics for asset\n#[derive(Encode, Decode, Clone, Default, PartialEq, Eq, Debug)]\npub struct FinancialMetrics\u003cA, P\u003e {\n    /// Timestamp of when last data point was updated\n    timestamp: Duration,\n    /// Log returns\n    log_returns: Vec\u003cP\u003e,\n    /// Volatility\n    volatility: P,\n    /// Correlations for all assets\n    correlations: Vec\u003c(A, P)\u003e,\n}\n\ndecl_storage! {\n\ttrait Store for Module\u003cT: Trait\u003e as FinancialModule {\n        /// Latest price updates on per asset basis.\n\t\tUpdates get(fn updates): map hasher(blake2_128_concat) T::Asset =\u003e Option\u003cPriceUpdate\u003cT::FixedNumber\u003e\u003e;\n        /// Price log on per asset basis.\n\t\tPrices get(fn prices): map hasher(blake2_128_concat) T::Asset =\u003e CapVec\u003cT::FixedNumber\u003e;\n        /// Financial metrics on per asset basis.\n\t\tMetrics get(fn metrics): map hasher(blake2_128_concat) T::Asset =\u003e Option\u003cFinancialMetrics\u003cT::Asset, T::Price\u003e\u003e;\n\t}\n\n\tadd_extra_genesis {\n        /// Initial price logs on per asset basis.\n\t\tconfig(prices): Vec\u003c(T::Asset, Vec\u003cT::Price\u003e)\u003e;\n\n\t\tbuild(|config| {\n\t\t\tlet price_count = T::PriceCount::get();\n\n\t\t\tfor (asset, values) in config.prices.iter() {\n\t\t\t\tlet mut prices = CapVec::\u003cT::FixedNumber\u003e::new(price_count);\n\n\t\t\t\tfor v in values.iter() {\n\t\t\t\t\tprices.push(v.clone().into());\n\t\t\t\t}\n\n\t\t\t\tPrices::\u003cT\u003e::insert(asset, prices);\n\t\t\t}\n\t\t});\n\t}\n}\n\ndecl_event!(\n\tpub enum Event\u003cT\u003e where Asset = \u003cT as Trait\u003e::Asset {\n        /// Financial parameters for the specified asset have been recalculeted\n\t\tRecalculated(Asset),\n\t}\n);\n\ndecl_error! {\n    /// Error for the Financial Pallet module.\n\tpub enum Error for Module\u003cT: Trait\u003e {\n        /// Timestamp of the received price is in the past.\n\t\tPeriodIsInThePast,\n        /// Overflow occured during financial calculation process.\n\t\tOverflow,\n        /// Division by zero occured during financial calculation process.\n\t\tDivisionByZero,\n        /// Price log is not long enough to calculate required value.\n\t\tNotEnoughPoints,\n        /// Required functionality is not implemented.\n\t\tNotImplemented,\n        /// Storage of the pallet is in an unexpected state.\n\t\tInvalidStorage,\n        /// Specified period start timestamp is invalid for current\n        /// [`PricePeriod`](./trait.Trait.html#associatedtype.PricePeriod) value.\n\t\tInvalidPeriodStart,\n        /// An invalid argument was passed to the transcendental function (i.e. log, sqrt, etc.)\n        /// during financial calculation process.\n\t\tTranscendental,\n\t}\n}\n\ndecl_module! {\n    /// Financial Pallet module declaration.\n\tpub struct Module\u003cT: Trait\u003e for enum Call where origin: T::Origin {\n\t\ttype Error = Error\u003cT\u003e;\n\n\t\tfn deposit_event() = default;\n\n\t\tconst PriceCount: u32 = T::PriceCount::get();\n\t\tconst PricePeriod: u32 = T::PricePeriod::get();\n\n        /// Recalculates financial metrics for a given asset\n\t\t#[weight = 10_000 + T::DbWeight::get().writes(1)]\n        pub fn recalc(origin, asset: T::Asset) -\u003e dispatch::DispatchResult {\n\t\t\tensure_signed(origin)?;\n\n            let update = Self::updates(asset);\n\t\t\tensure!(update.is_some(), Error::\u003cT\u003e::NotEnoughPoints);\n            let update = update.unwrap();\n\n            let timestamp = update.time;\n\n            let return_type = CalcReturnType::Log;\n            let log_returns = \u003cModule\u003cT\u003e as Financial\u003e::calc_return(return_type, asset)?;\n            let volatility = \u003cModule\u003cT\u003e as Financial\u003e::calc_vol(return_type, CalcVolatilityType::Regular, asset)?;\n\n            let mut correlations = vec![];\n\n            for asset2 in T::Asset::into_type_iter() {\n                let correlation = \u003cModule\u003cT\u003e as Financial\u003e::calc_corr(return_type, CalcCorrelationType::Regular, asset, asset2)?;\n                correlations.push((asset2, correlation));\n            }\n\n            Metrics::\u003cT\u003e::mutate(\u0026asset, |metrics| {\n                *metrics = Some(FinancialMetrics {\n                    timestamp,\n                    log_returns,\n                    volatility,\n                    correlations,\n                });\n            });\n\n            Ok(())\n        }\n\t}\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum PeriodAction {\n\tRemainsUnchanged,\n\tStartedNew(u32),\n}\n\n#[derive(Debug, Eq, PartialEq)]\nstruct PeriodChange {\n\tperiod_start: Duration,\n\taction: PeriodAction,\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum PricePeriodError {\n\tDivisionByZero,\n\tOverflow,\n\tPeriodIsInThePast,\n\tInvalidPeriodStart,\n}\n\nstruct PricePeriod(u32);\n\nimpl PricePeriod {\n\tfn get_period_id(\u0026self, now: Duration) -\u003e Result\u003cu64, PricePeriodError\u003e {\n\t\tlet seconds = now.as_secs();\n\t\tlet period = self.0 as u64;\n\n\t\tseconds.checked_div(60).and_then(|x| x.checked_div(period)).ok_or(PricePeriodError::DivisionByZero)\n\t}\n\n\tfn get_period_id_start(\u0026self, period_id: u64) -\u003e Result\u003cDuration, PricePeriodError\u003e {\n\t\tlet period = self.0 as u64;\n\t\tlet seconds: Result\u003c_, PricePeriodError\u003e = period_id.checked_mul(60).and_then(|x| x.checked_mul(period)).ok_or(PricePeriodError::Overflow);\n\n\t\tOk(Duration::from_secs(seconds?))\n\t}\n\n\tfn get_period_start(\u0026self, now: Duration) -\u003e Result\u003cDuration, PricePeriodError\u003e {\n\t\tself.get_period_id_start(self.get_period_id(now)?)\n\t}\n\n\tfn get_curr_period_info(\u0026self, prev_start: Duration, now: Duration) -\u003e Result\u003c(Duration, i32), PricePeriodError\u003e {\n\t\tlet prev_period_id = self.get_period_id(prev_start)?;\n\t\tlet curr_period_id = self.get_period_id(now)?;\n\n\t\tlet prev: i32 = prev_period_id.try_into().map_err(|_| PricePeriodError::Overflow)?;\n\t\tlet curr: i32 = curr_period_id.try_into().map_err(|_| PricePeriodError::Overflow)?;\n\t\tlet delta: Result\u003c_, PricePeriodError\u003e = curr.checked_sub(prev).ok_or(PricePeriodError::Overflow);\n\t\tOk((self.get_period_id_start(curr_period_id)?, delta?))\n\t}\n\n\tfn get_period_change(\u0026self, period_start: Option\u003cDuration\u003e, now: Duration) -\u003e Result\u003cPeriodChange, PricePeriodError\u003e {\n\t\tif let Some(period_start) = period_start {\n\t\t\tensure!(period_start == self.get_period_start(period_start)?, PricePeriodError::InvalidPeriodStart);\n\t\t}\n\n\t\tmatch period_start {\n\t\t\tNone =\u003e {\n\t\t\t\tlet period_start = self.get_period_start(now)?;\n\n\t\t\t\tOk(PeriodChange {\n\t\t\t\t\tperiod_start,\n\t\t\t\t\taction: PeriodAction::StartedNew(0),\n\t\t\t\t})\n\t\t\t},\n\t\t\tSome(last_start) =\u003e {\n\t\t\t\tlet (current_start, periods_elapsed) = self.get_curr_period_info(last_start, now)?;\n\n\t\t\t\tif periods_elapsed \u003c 0 {\n\t\t\t\t\t// Current period is in the past\n\n\t\t\t\t\tErr(PricePeriodError::PeriodIsInThePast)\n\t\t\t\t} else if periods_elapsed == 0 {\n\t\t\t\t\t// Period is not changed\n\n\t\t\t\t\tOk(PeriodChange {\n\t\t\t\t\t\tperiod_start: last_start,\n\t\t\t\t\t\taction: PeriodAction::RemainsUnchanged,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\t// Period is changed\n\t\t\t\t\t\n\t\t\t\t\tlet empty_periods = (periods_elapsed - 1) as u32;\n\n\t\t\t\t\tOk(PeriodChange {\n\t\t\t\t\t\tperiod_start: current_start,\n\t\t\t\t\t\taction: PeriodAction::StartedNew(empty_periods),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e From\u003cPricePeriodError\u003e for Error\u003cT\u003e {\n\tfn from(error: PricePeriodError) -\u003e Self {\n\t\tmatch error {\n\t\t\tPricePeriodError::DivisionByZero =\u003e Error::\u003cT\u003e::DivisionByZero,\n\t\t\tPricePeriodError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t\tPricePeriodError::PeriodIsInThePast =\u003e Error::\u003cT\u003e::PeriodIsInThePast,\n\t\t\tPricePeriodError::InvalidPeriodStart =\u003e Error::\u003cT\u003e::InvalidPeriodStart,\n\t\t}\n\t}\n}\n\n#[derive(Debug, Eq, PartialEq)]\nenum GetNewPricesError {\n\tOverflow,\n}\n\nfn get_new_prices\u003cP: Clone\u003e(last_price: Option\u003cP\u003e, new_price: P, empty_periods: u32, max_periods: u32) -\u003e Result\u003cVec\u003cP\u003e, GetNewPricesError\u003e {\n\tmatch last_price {\n\t\tNone =\u003e {\n\t\t\tOk(vec![new_price])\n\t\t},\n\t\tSome(last_price) =\u003e {\n\t\t\t// Calculate how many values to pre-populate the array with\n\t\t\t// We will pre-fill up to `max_periods` elements (leaving out one for the new price)\n\t\t\tlet prices_size = min(empty_periods, max_periods.checked_sub(1).ok_or(GetNewPricesError::Overflow)?) as usize;\n\n\t\t\t// Init the vector filled with last_price\n\t\t\tlet mut new_prices = vec![last_price.clone(); prices_size];\n\n\t\t\tnew_prices.push(new_price);\n\n\t\t\tOk(new_prices)\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e From\u003cGetNewPricesError\u003e for Error\u003cT\u003e {\n\tfn from(error: GetNewPricesError) -\u003e Self {\n\t\tmatch error {\n\t\t\tGetNewPricesError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e OnPriceSet for Module\u003cT\u003e {\n\ttype Asset = T::Asset;\n\ttype Price = T::Price;\n\n\tfn on_price_set(asset: T::Asset, value: T::Price) -\u003e Result\u003c(), DispatchError\u003e {\n\t\tlet value: T::FixedNumber = value.into();\n\t\tlet now = T::UnixTime::now();\n\t\tlet price_count = T::PriceCount::get();\n\n\t\tlet update = Self::updates(asset);\n\t\tlet prices = Self::prices(asset);\n\n\t\tensure!(prices.len_cap() == 0 || prices.len_cap() == price_count, Error::\u003cT\u003e::InvalidStorage);\n\t\tlet init_prices = prices.len_cap() == 0;\n\n\t\tlet period_start = update.map(|x| x.period_start);\n\t\tlet price_period = PricePeriod(T::PricePeriod::get());\n\t\tlet period_change = price_period.get_period_change(period_start, now).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tlet period_start = period_change.period_start;\n\n\t\tmatch period_change.action {\n\t\t\tPeriodAction::RemainsUnchanged =\u003e {\n\t\t\t\tUpdates::\u003cT\u003e::mutate(\u0026asset, |update| {\n\t\t\t\t\t*update = Some(PriceUpdate {\n\t\t\t\t\t\tperiod_start: period_start,\n\t\t\t\t\t\ttime: now,\n\t\t\t\t\t\tprice: value,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tPeriodAction::StartedNew(empty_periods) =\u003e {\n\t\t\t\tlet new_prices = get_new_prices(prices.last().cloned(), value, empty_periods, price_count).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\t\t\tUpdates::\u003cT\u003e::mutate(\u0026asset, |update| {\n\t\t\t\t\t*update = Some(PriceUpdate {\n\t\t\t\t\t\tperiod_start: period_start,\n\t\t\t\t\t\ttime: now,\n\t\t\t\t\t\tprice: value,\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tPrices::\u003cT\u003e::mutate(\u0026asset, |prices| {\n\t\t\t\t\tif init_prices {\n\t\t\t\t\t\t*prices = CapVec::\u003cT::FixedNumber\u003e::new(price_count);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor p in new_prices {\n\t\t\t\t\t\tprices.push(p);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tOk(())\n\t}\n}\n\n/// Important financial functions that uses [`prices`](./struct.Module.html#method.prices) as a data source.\npub trait Financial {\n    /// System wide type for representing various assets such as BTC, ETH, EOS, etc.\n\ttype Asset;\n    /// System wide type for representing price values.\n\ttype Price;\n    /// System wide type for representing account id.\n\ttype AccountId;\n\n    /// Calculates return.\n\tfn calc_return(return_type: CalcReturnType, asset: Self::Asset) -\u003e Result\u003cVec\u003cSelf::Price\u003e, DispatchError\u003e;\n    /// Calculates volatility.\n\tfn calc_vol(return_type: CalcReturnType, volatility_type: CalcVolatilityType, asset: Self::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates pairwise correlation between two specified assets.\n\tfn calc_corr(return_type: CalcReturnType, correlation_type: CalcCorrelationType, asset1: Self::Asset, asset2: Self::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates portfolio volatility.\n\tfn calc_portf_vol(account_id: Self::AccountId) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n    /// Calculates portfolio value at risk.\n\tfn calc_portf_var(account_id: Self::AccountId, return_type: CalcReturnType, z_score: u32) -\u003e Result\u003cSelf::Price, DispatchError\u003e;\n}\n\nfn calc_volatility\u003cF\u003e(return_type: CalcReturnType, volatility_type: CalcVolatilityType, prices: \u0026[F]) -\u003e MathResult\u003cF\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n    match volatility_type {\n        CalcVolatilityType::Regular =\u003e {\n            let return_func = calc_return_func(return_type);\n            let returns: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices, return_func).collect();\n            let returns = returns?;\n\n            let mean_return: F = mean(\u0026returns)?;\n\n            let demeaned_return = demeaned(returns.iter(), mean_return);\n            let squared_demeaned_return = squared(demeaned_return);\n\n            let volatility: F = sqrt(regular_vola(returns.len(), sum(squared_demeaned_return)?)?).map_err(|_| MathError::Transcendental)?;\n\n            Ok(volatility)\n        },\n        CalcVolatilityType::Exponential(ewma_length) =\u003e {\n            let diffs = diff(prices);\n            let squared_diffs = squared(diffs);\n            let decay = decay(ewma_length)?;\n            let var = last_recurrent_ewma(squared_diffs, decay)?;\n            let last_price = prices.last().copied().ok_or(MathError::NotEnoughPoints)?;\n            let vola = exp_vola(var, last_price)?;\n\n            Ok(vola)\n        }\n    }\n}\n\nfn calc_correlation\u003cF\u003e(return_type: CalcReturnType, correlation_type: CalcCorrelationType, prices1: \u0026[F], prices2: \u0026[F]) -\u003e MathResult\u003cF\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tlet return_func = calc_return_func(return_type);\n\n\tlet returns1: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices1, return_func).collect();\n\tlet returns1 = returns1?;\n\n\tlet returns2: MathResult\u003cVec\u003cF\u003e\u003e = calc_return_iter(\u0026prices2, return_func).collect();\n\tlet returns2 = returns2?;\n\n\tlet mean_return1: F = mean(\u0026returns1)?;\n\tlet mean_return2: F = mean(\u0026returns2)?;\n\n\tlet demeaned_returns1: MathResult\u003cVec\u003cF\u003e\u003e = demeaned(returns1.iter(), mean_return1).collect();\n\tlet demeaned_returns1 = demeaned_returns1?;\n\tlet demeaned_returns2: MathResult\u003cVec\u003cF\u003e\u003e = demeaned(returns2.iter(), mean_return2).collect();\n\tlet demeaned_returns2 = demeaned_returns2?;\n\n\tlet demeaned_returns_product = mul(demeaned_returns1.iter().copied(), demeaned_returns2.iter().copied());\n\n    let squared_demeaned_returns1 = squared(demeaned_returns1.iter().map(|\u0026x| Ok(x)));\n    let squared_demeaned_returns2 = squared(demeaned_returns2.iter().map(|\u0026x| Ok(x)));\n\n    let volatility1: F = sqrt(regular_vola(returns1.len(), sum(squared_demeaned_returns1)?)?).map_err(|_| MathError::Transcendental)?;\n    let volatility2: F = sqrt(regular_vola(returns2.len(), sum(squared_demeaned_returns2)?)?).map_err(|_| MathError::Transcendental)?;\n\n    match correlation_type {\n        CalcCorrelationType::Regular =\u003e {\n            let products_sum = sum(demeaned_returns_product)?;\n            let products_len = min(returns1.len(), returns2.len());\n            let result = regular_corr(products_len, products_sum, volatility1, volatility2)?;\n            Ok(result)\n        },\n        CalcCorrelationType::Exponential(ewma_length) =\u003e {\n            let decay = decay(ewma_length)?;\n            let last_covar = last_recurrent_ewma(demeaned_returns_product, decay)?;\n            let result = exp_corr(last_covar, volatility1, volatility2)?;\n            Ok(result)\n        },\n    }\n}\n\nimpl\u003cT: Trait\u003e From\u003cMathError\u003e for Error\u003cT\u003e {\n\tfn from(error: MathError) -\u003e Self {\n\t\tmatch error {\n\t\t\tMathError::NotEnoughPoints =\u003e Error::\u003cT\u003e::NotEnoughPoints,\n\t\t\tMathError::Overflow =\u003e Error::\u003cT\u003e::Overflow,\n\t\t\tMathError::DivisionByZero =\u003e Error::\u003cT\u003e::DivisionByZero,\n\t\t\tMathError::Transcendental =\u003e Error::\u003cT\u003e::Transcendental,\n\t\t}\n\t}\n}\n\nimpl\u003cT: Trait\u003e Financial for Module\u003cT\u003e {\n\ttype Asset = T::Asset;\n\ttype Price = T::Price;\n\ttype AccountId = \u003cT as frame_system::Trait\u003e::AccountId;\n\n\tfn calc_return(return_type: CalcReturnType, asset: T::Asset) -\u003e Result\u003cVec\u003cT::Price\u003e, DispatchError\u003e {\n\t\tlet prices: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset).iter().cloned().collect();\n\n\t\tlet result: MathResult\u003cVec\u003cT::Price\u003e\u003e = calc_return_iter(\u0026prices, calc_return_func(return_type)).map(|x| x.map(|y| y.into())).collect();\n        let result = result.map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n        if result.len() == 0 {\n            Err(Error::\u003cT\u003e::NotEnoughPoints.into())\n        } else {\n            Ok(result)\n        }\n\t}\n\n\tfn calc_vol(return_type: CalcReturnType, volatility_type: CalcVolatilityType, asset: T::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tlet prices: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset).iter().cloned().collect();\n\n\t\tlet result = calc_volatility::\u003cT::FixedNumber\u003e(return_type, volatility_type, \u0026prices).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tOk(result.into())\n\t}\n\n\tfn calc_corr(return_type: CalcReturnType, correlation_type: CalcCorrelationType, asset1: T::Asset, asset2: T::Asset) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tlet prices1: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset1).iter().cloned().collect();\n\t\tlet prices2: Vec\u003c_\u003e = Prices::\u003cT\u003e::get(asset2).iter().cloned().collect();\n\n\t\tlet result = calc_correlation::\u003cT::FixedNumber\u003e(return_type, correlation_type, \u0026prices1, \u0026prices2).map_err(Into::\u003cError\u003cT\u003e\u003e::into)?;\n\n\t\tOk(result.into())\n\t}\n\n\tfn calc_portf_vol(_account_id: Self::AccountId) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tErr(Error::\u003cT\u003e::NotImplemented.into())\n\t}\n\n\tfn calc_portf_var(_account_id: Self::AccountId, _return_type: CalcReturnType, _z_score: u32) -\u003e Result\u003cSelf::Price, DispatchError\u003e {\n\t\tErr(Error::\u003cT\u003e::NotImplemented.into())\n\t}\n}\n","traces":[{"line":94,"address":[4418384],"length":1,"stats":{"Line":1},"fn_name":"new\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":116,"address":[4434768,4433425,4434321,4434540,4434695,4434672,4433456,4434564,4434592,4434352,4434272,4434432,4434560,4434528,4434807,4434448,4434780,4433473,4434880,4434800,4433360,4433377,4434455,4433408,4434688],"length":1,"stats":{"Line":43},"fn_name":"updates\u003cfinancial_pallet::mock::Test,financial_pallet::mock::Asset\u003e"},{"line":130,"address":[4433580,4434284,4433520],"length":1,"stats":{"Line":5},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":131,"address":[4433543],"length":1,"stats":{"Line":4},"fn_name":null},{"line":133,"address":[4433775,4433603,4434203],"length":1,"stats":{"Line":5},"fn_name":null},{"line":134,"address":[4433826],"length":1,"stats":{"Line":4},"fn_name":null},{"line":136,"address":[4434190,4434084,4433869],"length":1,"stats":{"Line":5},"fn_name":null},{"line":137,"address":[4434118],"length":1,"stats":{"Line":4},"fn_name":null},{"line":140,"address":[4434024],"length":1,"stats":{"Line":1},"fn_name":null},{"line":246,"address":[5323120],"length":1,"stats":{"Line":1},"fn_name":"get_period_id"},{"line":247,"address":[5323141],"length":1,"stats":{"Line":1},"fn_name":null},{"line":248,"address":[5323184],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[4418464,4418478],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":253,"address":[5323296],"length":1,"stats":{"Line":2},"fn_name":"get_period_id_start"},{"line":254,"address":[5323322],"length":1,"stats":{"Line":3},"fn_name":null},{"line":255,"address":[4418542,4418528],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}"},{"line":257,"address":[5323429,5323564],"length":1,"stats":{"Line":3},"fn_name":null},{"line":260,"address":[5323600],"length":1,"stats":{"Line":1},"fn_name":"get_period_start"},{"line":261,"address":[5323621,5323753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[5323776],"length":1,"stats":{"Line":1},"fn_name":"get_curr_period_info"},{"line":265,"address":[5323825,5324016,5323964],"length":1,"stats":{"Line":5},"fn_name":null},{"line":266,"address":[5324028,5323930,5324117],"length":1,"stats":{"Line":6},"fn_name":null},{"line":268,"address":[4418596,4418603,4418592],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}"},{"line":269,"address":[4418608,4418619,4418612],"length":1,"stats":{"Line":8},"fn_name":"{{closure}}"},{"line":270,"address":[5324552,5324473],"length":1,"stats":{"Line":6},"fn_name":null},{"line":271,"address":[5324906,5324586],"length":1,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[5324960],"length":1,"stats":{"Line":1},"fn_name":"get_period_change"},{"line":275,"address":[5324994,5325257],"length":1,"stats":{"Line":5},"fn_name":null},{"line":276,"address":[5325056,5325259,5325235],"length":1,"stats":{"Line":3},"fn_name":null},{"line":279,"address":[5325617,5326213,5325391],"length":1,"stats":{"Line":4},"fn_name":null},{"line":280,"address":[5325295],"length":1,"stats":{"Line":1},"fn_name":null},{"line":281,"address":[5325393,5325622],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[5325530],"length":1,"stats":{"Line":3},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[5325508],"length":1,"stats":{"Line":3},"fn_name":null},{"line":288,"address":[5325310],"length":1,"stats":{"Line":1},"fn_name":null},{"line":289,"address":[5325875,5325332,5325672],"length":1,"stats":{"Line":10},"fn_name":null},{"line":291,"address":[5325948,5325855,5326211],"length":1,"stats":{"Line":4},"fn_name":null},{"line":294,"address":[5325941],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[5326084,5325929],"length":1,"stats":{"Line":2},"fn_name":null},{"line":298,"address":[5325992],"length":1,"stats":{"Line":1},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[5325976],"length":1,"stats":{"Line":1},"fn_name":null},{"line":305,"address":[5326248,5326089,5326218,5325957],"length":1,"stats":{"Line":2},"fn_name":null},{"line":307,"address":[5326119],"length":1,"stats":{"Line":1},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[5326096],"length":1,"stats":{"Line":1},"fn_name":null},{"line":318,"address":[4418624],"length":1,"stats":{"Line":1},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":319,"address":[4418678,4418669,4418685],"length":1,"stats":{"Line":1},"fn_name":null},{"line":320,"address":[4418633,4418673],"length":1,"stats":{"Line":1},"fn_name":null},{"line":321,"address":[4418680],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[4418687],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[4418664],"length":1,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[4419456,4418704,4418917,4419686],"length":1,"stats":{"Line":6},"fn_name":"get_new_prices\u003cu32\u003e"},{"line":334,"address":[4420146,4419364,4418837,4418979,4419624,4419754],"length":1,"stats":{"Line":8},"fn_name":null},{"line":335,"address":[4419513,4418745],"length":1,"stats":{"Line":6},"fn_name":null},{"line":336,"address":[4419636,4418948,4418844,4419717],"length":1,"stats":{"Line":11},"fn_name":null},{"line":338,"address":[4419571,4418799],"length":1,"stats":{"Line":2},"fn_name":null},{"line":341,"address":[4419767,4419134,4418819,4419792,4419017,4419909,4419935,4419160,4419606,4418992],"length":1,"stats":{"Line":9},"fn_name":null},{"line":344,"address":[4419185,4419960],"length":1,"stats":{"Line":2},"fn_name":null},{"line":346,"address":[4419224,4420005],"length":1,"stats":{"Line":2},"fn_name":null},{"line":348,"address":[4420038,4419255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":354,"address":[4420240],"length":1,"stats":{"Line":0},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":355,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[4420244],"length":1,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[4420272,4420348],"length":1,"stats":{"Line":1},"fn_name":"on_price_set\u003cfinancial_pallet::mock::Test\u003e"},{"line":366,"address":[4420307],"length":1,"stats":{"Line":1},"fn_name":null},{"line":367,"address":[4420363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":368,"address":[4420377],"length":1,"stats":{"Line":1},"fn_name":null},{"line":370,"address":[4420389],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[4420411],"length":1,"stats":{"Line":1},"fn_name":null},{"line":373,"address":[4420613,4420569,4420539,4420441],"length":1,"stats":{"Line":2},"fn_name":null},{"line":374,"address":[4420672,4420558],"length":1,"stats":{"Line":2},"fn_name":null},{"line":376,"address":[4421809,4421808,4420682],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":377,"address":[4420769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":378,"address":[4420791,4421041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":380,"address":[4420993],"length":1,"stats":{"Line":4},"fn_name":null},{"line":382,"address":[4421142,4421206],"length":1,"stats":{"Line":1},"fn_name":null},{"line":383,"address":[4421023],"length":1,"stats":{"Line":5},"fn_name":null},{"line":384,"address":[4421152,4421824],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":385,"address":[4421871],"length":1,"stats":{"Line":1},"fn_name":null},{"line":386,"address":[4421839,4421846],"length":1,"stats":{"Line":2},"fn_name":null},{"line":387,"address":[4421842,4421853],"length":1,"stats":{"Line":2},"fn_name":null},{"line":388,"address":[4421860],"length":1,"stats":{"Line":1},"fn_name":null},{"line":392,"address":[4421104],"length":1,"stats":{"Line":5},"fn_name":null},{"line":393,"address":[4421216,4421504,4421130,4421568],"length":1,"stats":{"Line":10},"fn_name":null},{"line":395,"address":[4422000,4421450],"length":1,"stats":{"Line":10},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":396,"address":[4422047],"length":1,"stats":{"Line":5},"fn_name":null},{"line":397,"address":[4422022,4422015],"length":1,"stats":{"Line":10},"fn_name":null},{"line":398,"address":[4422029,4422018],"length":1,"stats":{"Line":10},"fn_name":null},{"line":399,"address":[4422036],"length":1,"stats":{"Line":5},"fn_name":null},{"line":402,"address":[4421592,4422176,4422671],"length":1,"stats":{"Line":12},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":403,"address":[4422191,4422666],"length":1,"stats":{"Line":11},"fn_name":null},{"line":404,"address":[4422232,4422584],"length":1,"stats":{"Line":5},"fn_name":null},{"line":407,"address":[4422421,4422487,4422265,4422571],"length":1,"stats":{"Line":7},"fn_name":null},{"line":408,"address":[4422558],"length":1,"stats":{"Line":6},"fn_name":null},{"line":414,"address":[4421697],"length":1,"stats":{"Line":5},"fn_name":null},{"line":439,"address":[4422882,4422784],"length":1,"stats":{"Line":1},"fn_name":"calc_volatility\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":444,"address":[4425187,4422952,4424348],"length":1,"stats":{"Line":2},"fn_name":null},{"line":445,"address":[4422839],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4422961],"length":1,"stats":{"Line":1},"fn_name":null},{"line":447,"address":[4422990],"length":1,"stats":{"Line":1},"fn_name":null},{"line":448,"address":[4423252,4423310,4423048],"length":1,"stats":{"Line":1},"fn_name":null},{"line":450,"address":[4423374,4423518,4423593,4423229],"length":1,"stats":{"Line":2},"fn_name":null},{"line":452,"address":[4423614,4423495],"length":1,"stats":{"Line":2},"fn_name":null},{"line":453,"address":[4423684],"length":1,"stats":{"Line":1},"fn_name":null},{"line":455,"address":[4425300,4423747,4425307,4425296,4424289],"length":1,"stats":{"Line":1},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":457,"address":[4424263],"length":1,"stats":{"Line":1},"fn_name":null},{"line":459,"address":[4422897],"length":1,"stats":{"Line":1},"fn_name":null},{"line":460,"address":[4422911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":461,"address":[4424353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":462,"address":[4424604,4424422],"length":1,"stats":{"Line":1},"fn_name":null},{"line":463,"address":[4424530,4424659,4424785],"length":1,"stats":{"Line":2},"fn_name":null},{"line":464,"address":[4424845,4425025,4424747],"length":1,"stats":{"Line":2},"fn_name":null},{"line":465,"address":[4425080,4425192,4425010],"length":1,"stats":{"Line":2},"fn_name":null},{"line":467,"address":[4425176],"length":1,"stats":{"Line":1},"fn_name":null},{"line":472,"address":[4425446,4425312],"length":1,"stats":{"Line":2},"fn_name":"calc_correlation\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":477,"address":[4425398],"length":1,"stats":{"Line":2},"fn_name":null},{"line":479,"address":[4425461],"length":1,"stats":{"Line":2},"fn_name":null},{"line":480,"address":[4425731,4425790,4425519],"length":1,"stats":{"Line":2},"fn_name":null},{"line":482,"address":[4425692,4425846],"length":1,"stats":{"Line":4},"fn_name":null},{"line":483,"address":[4425853,4426099,4426024],"length":1,"stats":{"Line":2},"fn_name":null},{"line":485,"address":[4426146,4426367,4426290,4426001],"length":1,"stats":{"Line":4},"fn_name":null},{"line":486,"address":[4426267,4426540,4426396],"length":1,"stats":{"Line":4},"fn_name":null},{"line":488,"address":[4426517,4426623],"length":1,"stats":{"Line":4},"fn_name":null},{"line":489,"address":[4426716,4426890],"length":1,"stats":{"Line":2},"fn_name":null},{"line":490,"address":[4426867,4426991],"length":1,"stats":{"Line":4},"fn_name":null},{"line":491,"address":[4427084,4427335,4427258],"length":1,"stats":{"Line":2},"fn_name":null},{"line":493,"address":[4427235,4427374],"length":1,"stats":{"Line":4},"fn_name":null},{"line":495,"address":[4427632,4430704,4430688],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":496,"address":[4430752,4427844,4430768],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":498,"address":[4430816,4428632,4430820,4428056,4428283,4430827],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":499,"address":[4429208,4430843,4430836,4430832,4428721,4428617],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":501,"address":[4429787,4430389,4429301],"length":1,"stats":{"Line":2},"fn_name":null},{"line":502,"address":[4429180],"length":1,"stats":{"Line":2},"fn_name":null},{"line":503,"address":[4429494,4429303],"length":1,"stats":{"Line":1},"fn_name":null},{"line":504,"address":[4429482,4429563],"length":1,"stats":{"Line":2},"fn_name":null},{"line":505,"address":[4429792,4429614],"length":1,"stats":{"Line":1},"fn_name":null},{"line":506,"address":[4429776],"length":1,"stats":{"Line":1},"fn_name":null},{"line":508,"address":[4429267],"length":1,"stats":{"Line":1},"fn_name":null},{"line":509,"address":[4429289,4429867,4430015],"length":1,"stats":{"Line":2},"fn_name":null},{"line":510,"address":[4430219,4429941,4430092],"length":1,"stats":{"Line":2},"fn_name":null},{"line":511,"address":[4430296,4430166,4430391],"length":1,"stats":{"Line":2},"fn_name":null},{"line":512,"address":[4430378],"length":1,"stats":{"Line":1},"fn_name":null},{"line":518,"address":[4430848],"length":1,"stats":{"Line":0},"fn_name":"from\u003cfinancial_pallet::mock::Test\u003e"},{"line":519,"address":[4430902,4430893,4430909],"length":1,"stats":{"Line":0},"fn_name":null},{"line":520,"address":[4430897,4430857],"length":1,"stats":{"Line":0},"fn_name":null},{"line":521,"address":[4430904],"length":1,"stats":{"Line":0},"fn_name":null},{"line":522,"address":[4430911],"length":1,"stats":{"Line":0},"fn_name":null},{"line":523,"address":[4430888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":533,"address":[4431015,4430928],"length":1,"stats":{"Line":1},"fn_name":"calc_return\u003cfinancial_pallet::mock::Test\u003e"},{"line":534,"address":[4430963,4431046],"length":1,"stats":{"Line":3},"fn_name":null},{"line":536,"address":[4431137,4431934,4431920,4431980,4431968],"length":1,"stats":{"Line":15},"fn_name":"{{closure}}\u003cfinancial_pallet::mock::Test\u003e"},{"line":537,"address":[4431274,4431468,4431530,4431555],"length":1,"stats":{"Line":3},"fn_name":null},{"line":539,"address":[4431588,4431698,4431779,4431456],"length":1,"stats":{"Line":7},"fn_name":null},{"line":540,"address":[4431700],"length":1,"stats":{"Line":0},"fn_name":null},{"line":542,"address":[4431594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":546,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":551,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":554,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":555,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":560,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":563,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":564,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":567,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":143,"coverable":170},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","math.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse substrate_fixed::transcendental::{sqrt, ln};\nuse substrate_fixed::traits::{Fixed, FixedSigned, ToFixed};\nuse substrate_fixed::types::I9F23;\nuse core::ops::{AddAssign, BitOrAssign, ShlAssign};\n\n// Type of constants for transcendental operations declared in substrate_fixed crate\npub type ConstType = I9F23;\n\n#[derive(Debug, Eq, PartialEq, Clone, Copy)]\npub enum MathError {\n\tOverflow,\n\tDivisionByZero,\n\tTranscendental,\n\tNotEnoughPoints,\n}\n\npub type MathResult\u003cT\u003e = Result\u003cT, MathError\u003e;\n\n/// Indicates what returns will be used in calculations of volatilities, correlations, and value at\n/// risk: `Regular` or `Log` returns.\n///\n/// The choice of return type also governs the method for Value at Risk (VAR) calculation: \n/// * `Regular` type should be used when arithmetic returns are used and are assumed to be normally\n/// distributed; \n/// * `Log` normal type should be used when geometric returns (log returns) are used\n/// and are assumed to be normally distributed.\n///\n/// We suggest using the latter approach, as it doesn't\n/// lead to losses greater than a portfolio value unlike the normal VaR.\n#[derive(Copy, Clone)]\npub enum CalcReturnType {\n\n    /// Regular returns.\n\tRegular,\n\n    /// Log returns.\n\tLog,\n}\n\n/// Indicates the method for calculating volatility: `Regular` or `Exponential`.\n#[derive(Copy, Clone)]\npub enum CalcVolatilityType {\n\n    /// Regular type is a standard statistical approach of calculating standard deviation of\n    /// returns using simple average.\n\tRegular,\n\n    /// Exponentially weighted type gives more weight to most recent data given the decay value or\n    /// period of exponentially weighted moving average.\n\tExponential(u32),\n}\n\n/// Indicates the method for calculating correlations: `Regular` or `Exponential`.\n///\n/// * `Regular` type is a standard statistical approach of calculating Pearson correlation coefficient between\n/// two return series;\n/// * `Exponential` type uses exponentially weighted moving average\n/// to give more weights to most recent observations of pair of returns.\n///\n/// Note: correlations on lower periods are more susceptible to data noise and reflect actual\n/// dependencies between returns poorly. For robustness we recommend to use daily or weekly periods\n/// for correlations.\n#[derive(Copy, Clone)]\npub enum CalcCorrelationType {\n    /// Regular correlation type.\n\tRegular,\n    /// Exponentially weighted correlation type.\n\tExponential(u32),\n}\n\npub fn calc_return\u003cF: Fixed\u003e(x1: F, x2: F) -\u003e Result\u003cF, MathError\u003e {\n\tlet ratio = x2.checked_div(x1).ok_or(MathError::DivisionByZero)?;\n\n\tratio.checked_sub(F::from_num(1)).ok_or(MathError::Overflow)\n}\n\npub fn calc_log_return\u003cF\u003e(x1: F, x2: F) -\u003e Result\u003cF, MathError\u003e\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tlet ratio = x2.checked_div(x1).ok_or(MathError::DivisionByZero)?;\n\tln(ratio).map_err(|_| MathError::Transcendental)\n}\n\npub fn calc_return_func\u003cF\u003e(return_type: CalcReturnType) -\u003e impl Fn(F, F) -\u003e MathResult\u003cF\u003e + Copy\nwhere\n\tF: FixedSigned + PartialOrd\u003cConstType\u003e + From\u003cConstType\u003e,\n\tF::Bits: Copy + ToFixed + AddAssign + BitOrAssign + ShlAssign,\n{\n\tmatch return_type {\n\t\tCalcReturnType::Regular =\u003e calc_return,\n\t\tCalcReturnType::Log =\u003e calc_log_return,\n\t}\n}\n\npub fn calc_return_iter\u003c'a, T: Copy, F: 'a + Fn(T, T) -\u003e MathResult\u003cT\u003e\u003e(items: \u0026'a [T], return_func: F) -\u003e impl Iterator\u003cItem = MathResult\u003cT\u003e\u003e + 'a {\n\titems.windows(2).map(move |x| return_func(x[0], x[1]))\n}\n\npub fn diff\u003c'a, T: Fixed\u003e(items: \u0026'a [T]) -\u003e impl Iterator\u003cItem = MathResult\u003cT\u003e\u003e + 'a {\n\titems.windows(2).map(move |x| x[1].checked_sub(x[0]).ok_or(MathError::Overflow))\n}\n\npub fn decay\u003cF: Fixed\u003e(ewma_length: u32) -\u003e MathResult\u003cF\u003e {\n    let nom = F::from_num(2);\n    let denom = F::from_num(1).checked_add(F::from_num(ewma_length)).ok_or(MathError::Overflow)?;\n    \n    nom.checked_div(denom).ok_or(MathError::DivisionByZero)\n}\n\nfn recurrent_ewma_step\u003cF: Fixed\u003e(diff: MathResult\u003cF\u003e, decay: F, prev_var: MathResult\u003cF\u003e) -\u003e MathResult\u003cF\u003e {\n    let diff = diff?;\n    let prev_var = prev_var?;\n\n    let a = diff.checked_mul(decay).ok_or(MathError::Overflow)?;\n    let b = F::from_num(1).checked_sub(decay).ok_or(MathError::Overflow)?;\n    let c = b.checked_mul(prev_var).ok_or(MathError::Overflow)?;\n\n    a.checked_add(c).ok_or(MathError::Overflow)\n}\n\npub fn last_recurrent_ewma\u003cF: Fixed, I: Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(diffs: I, decay: F) -\u003e MathResult\u003cF\u003e {\n    diffs.fold(None, move |state, diff| {\n        if let Some(prev_var) = state {\n            let var = recurrent_ewma_step(diff, decay, prev_var);\n            Some(var)\n        } else {\n            Some(diff)\n        }\n    }).ok_or(MathError::NotEnoughPoints).and_then(|x| x)\n}\n\npub fn sum\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(mut iter: I) -\u003e MathResult\u003cF\u003e {\n\tOk(iter.try_fold(F::from_num(0), |acc, x| {let x = x?; acc.checked_add(x).ok_or(MathError::Overflow)})?)\n}\n\npub fn mean\u003cF: Fixed\u003e(items: \u0026[F]) -\u003e MathResult\u003cF\u003e {\n\tlet sum = sum(items.iter().map(|\u0026x| Ok(x)))?;\n\tsum.checked_div(F::from_num(items.len())).ok_or(MathError::DivisionByZero)\n}\n\npub fn demeaned\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = \u0026'a F\u003e\u003e(iter: I, mean: F) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer.map(move |\u0026x| x.checked_sub(mean).ok_or(MathError::Overflow))\n}\n\npub fn squared\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = MathResult\u003cF\u003e\u003e\u003e(iter: I) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer.map(|x| x.and_then(|y| y.checked_mul(y).ok_or(MathError::Overflow)))\n}\n\npub fn regular_vola\u003cF: Fixed\u003e(n: usize, sum: F) -\u003e MathResult\u003cF\u003e {\n\tlet a = n.checked_sub(1).ok_or(MathError::Overflow)?;\n\tlet b = F::from_num(1).checked_div(F::from_num(a)).ok_or(MathError::DivisionByZero)?;\n\tlet c = b.checked_mul(sum).ok_or(MathError::Overflow)?;\n\tOk(c)\n}\n\npub fn exp_vola\u003cF\u003e(var: F, price: F) -\u003e MathResult\u003cF\u003e\nwhere\n    F: Fixed + PartialOrd\u003cConstType\u003e,\n{\n    let a: F = sqrt(var).map_err(|_| MathError::Transcendental)?;\n    a.checked_div(price).ok_or(MathError::DivisionByZero)\n}\n\npub fn mul\u003c'a, F: 'a + Fixed, I: 'a + Iterator\u003cItem = F\u003e\u003e(iter1: I, iter2: I) -\u003e impl Iterator\u003cItem = MathResult\u003cF\u003e\u003e + 'a {\n\titer1.zip(iter2).map(|(x1, x2)| x1.checked_mul(x2).ok_or(MathError::Overflow))\n}\n\npub fn regular_corr\u003cF: Fixed\u003e(n: usize, sum: F, vol1: F, vol2: F) -\u003e MathResult\u003cF\u003e {\n\tlet a = n.checked_sub(1).ok_or(MathError::Overflow)?;\n\tlet b = F::from_num(1).checked_div(F::from_num(a)).ok_or(MathError::DivisionByZero)?;\n\tlet c = b.checked_mul(sum).ok_or(MathError::Overflow)?;\n\tlet d = c.checked_div(vol1).ok_or(MathError::DivisionByZero)?;\n\tlet e = d.checked_div(vol2).ok_or(MathError::DivisionByZero)?;\n\tOk(e)\n}\n\npub fn exp_corr\u003cF: Fixed\u003e(covariance: F, vol1: F, vol2: F) -\u003e MathResult\u003cF\u003e {\n\tlet d = covariance.checked_div(vol1).ok_or(MathError::DivisionByZero)?;\n\tlet e = d.checked_div(vol2).ok_or(MathError::DivisionByZero)?;\n\tOk(e)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use substrate_fixed::types::I64F64;\n    use frame_support::assert_ok;\n    use substrate_fixed::traits::LossyInto;\n    use approx::assert_abs_diff_eq;\n\n    pub type FixedNumber = I64F64;\n\n    #[test]\n    fn diff_example() {\n        let prices: Vec\u003c_\u003e = vec![\n            7_117.21, 7_429.72, 7_550.90, 7_569.94, 7_679.87, 7_795.60, 7_807.06, 8_801.04, 8_658.55, 8_864.77, 8_988.60, 8_897.47, 8_912.65, 9_003.07, 9_268.76, 9_951.52, 9_842.67, 9_593.90, 8_756.43, 8_601.80, 8_804.48, 9_269.99, 9_733.72, 9_328.20, 9_377.01, 9_670.74, 9_726.57, 9_729.04, 9_522.98, 9_081.76,\n        ].into_iter().map(FixedNumber::from_num).collect();\n\n        let actual: MathResult\u003cVec\u003c_\u003e\u003e = diff(\u0026prices).collect();\n        assert_ok!(\u0026actual);\n        let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n        let expected: Vec\u003c_\u003e = vec![\n            312.51, 121.18, 19.04, 109.93, 115.73, 11.46, 993.98, -142.49, 206.22, 123.83, -91.13, 15.18, 90.42, 265.69, 682.76, -108.85, -248.77, -837.47, -154.63, 202.68, 465.51, 463.73, -405.52, 48.81, 293.73, 55.83, 2.47, -206.06, -441.22,\n        ];\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n    }\n\n    #[test]\n    fn squared_example() {\n        let diffs: Vec\u003c_\u003e = vec![\n            312.51, 121.18, 19.04, 109.93, 115.73, 11.46, 993.98, -142.49, 206.22, 123.83, -91.13, 15.18, 90.42, 265.69, 682.76, -108.85, -248.77, -837.47, -154.63, 202.68, 465.51, 463.73, -405.52, 48.81, 293.73, 55.83, 2.47, -206.06, -441.22,\n        ].into_iter().map(|x| Ok(FixedNumber::from_num(x))).collect();\n\n        let actual: MathResult\u003cVec\u003c_\u003e\u003e = squared(diffs.into_iter()).collect();\n        assert_ok!(\u0026actual);\n        let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n        let expected: Vec\u003c_\u003e = vec![\n            97662.5001000001, 14684.5923999999, 362.5216000000, 12084.6049000001, 13393.4329000001, 131.3316000000, 987996.2404000010, 20303.4001000005, 42526.6884000005, 15333.8689000000, 8304.6769000002, 230.4324000000, 8175.7764000000, 70591.1761000003, 466161.2176000000, 11848.3225000001, 61886.5129000002, 701356.0008999990, 23910.4369000003, 41079.1824000001, 216699.5601000000, 215045.5129000000, 164446.4703999990, 2382.4161000000, 86277.3128999997, 3116.9889000000, 6.1009000000, 42460.7236000005, 194675.0883999990,\n        ];\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n    }\n\n    #[test]\n    fn decay_expample() {\n        let actual = decay(36);\n        assert_ok!(actual);\n        let actual: FixedNumber = actual.unwrap();\n        let actual: f64 = actual.lossy_into();\n        let expected = 0.05405405405;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn last_recurrent_ewma_example() {\n        let squared_diffs: Vec\u003c_\u003e = vec![\n            97662.50010000010000, 14684.59239999990000, 362.52159999999900, 12084.60490000010000, 13393.43290000010000, 131.33160000000100, 987996.24040000100000, 20303.40010000050000, 42526.68840000050000, 15333.86890000000000, 8304.67690000019000, 230.43240000000900, 8175.77640000001000, 70591.17610000030000, 466161.21760000000000, 11848.32250000010000, 61886.51290000020000, 701356.00089999900000, 23910.43690000030000, 41079.18240000010000, 216699.56010000000000, 215045.51290000000000, 164446.47039999900000, 2382.41609999995000, 86277.31289999970000, 3116.98889999999000, 6.10090000000575, 42460.72360000050000, 194675.08839999900000,\n        ].into_iter().map(|x| Ok(FixedNumber::from_num(x))).collect();\n        let decay = FixedNumber::from_num(0.0540540540540541);\n\n        let actual = last_recurrent_ewma(squared_diffs.into_iter(), decay);\n        assert_ok!(\u0026actual);\n        let actual: f64 = actual.unwrap().lossy_into();\n\n        let expected = 114954.3177623650;\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn recurrent_ewma_step_example() {\n        let diff = Ok(FixedNumber::from_num(14684.59239999990000));\n        let decay = FixedNumber::from_num(0.0540540540540541);\n        let prev_var = Ok(FixedNumber::from_num(97662.5001000001));\n        let actual = recurrent_ewma_step(diff, decay, prev_var);\n        assert_ok!(\u0026actual);\n        let actual: f64 = actual.unwrap().lossy_into();\n        let expected = 93177.2077918920;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[test]\n    fn exp_vola_expample() {\n        let variance = FixedNumber::from_num(114954.3177623650);\n        let price = FixedNumber::from_num(9_081.76);\n        let actual = exp_vola(variance, price);\n        assert_ok!(actual);\n        let actual: FixedNumber = actual.unwrap();\n        let actual: f64 = actual.lossy_into();\n        let expected = 0.0373329770530381;\n\n        assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n    }\n\n    #[cfg(test)]\n    mod calc_return {\n        use super::super::*;\n        use super::FixedNumber;\n        use substrate_fixed::traits::LossyInto;\n        use approx::assert_abs_diff_eq;\n        use frame_support::assert_ok;\n\n        #[test]\n        fn calc_return_valid() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_return(x1, x2);\n            let expected = Ok(FixedNumber::from_num(-0.25));\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_valid_positive() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(10);\n            let actual = calc_return(x1, x2);\n            let expected = Ok(FixedNumber::from_num(0.25));\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_x1_is_zero() {\n            let x1 = FixedNumber::from_num(0);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_return(x1, x2);\n            let expected = Err(MathError::DivisionByZero);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_log_return_valid() {\n            let x1 = FixedNumber::from_num(8);\n            let x2 = FixedNumber::from_num(6);\n            let actual: f64 = calc_log_return(x1, x2).unwrap().lossy_into();\n            let expected = -0.287682072452;\n\n            assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n        }\n\n        #[test]\n        fn calc_log_return_x1_is_zero() {\n            let x1 = FixedNumber::from_num(0);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_log_return(x1, x2);\n            let expected = Err(MathError::DivisionByZero);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_log_return_x1_is_negative() {\n            let x1 = FixedNumber::from_num(-3);\n            let x2 = FixedNumber::from_num(6);\n            let actual = calc_log_return(x1, x2);\n            let expected = Err(MathError::Transcendental);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_iter_empty() {\n            let prices: Vec\u003cFixedNumber\u003e = Vec::new();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            let expected = Ok(vec![]);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_vec_one_item() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![1.5].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            let expected = Ok(vec![]);\n\n            assert_eq!(actual, expected);\n        }\n\n        #[test]\n        fn calc_return_vec_regular_valid() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![\n                7_117.21,\n                7_429.72,\n                7_550.90,\n                7_569.94,\n                7_679.87,\n                7_795.60,\n                7_807.06,\n                8_801.04,\n                8_658.55,\n                8_864.77,\n            ].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Regular);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            assert_ok!(\u0026actual);\n            let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n            let expected: Vec\u003cf64\u003e = vec![\n                0.04390906,\n                0.01631017,\n                0.00252155,\n                0.01452191,\n                0.01506927,\n                0.00147006,\n                0.12731809,\n                -0.01619013,\n                0.02381692,\n            ];\n\n            assert_eq!(actual.len(), expected.len());\n            for (a, e) in actual.into_iter().zip(expected.into_iter()) {\n                assert_abs_diff_eq!(a, e, epsilon = 1e-8);\n            }\n        }\n\n        #[test]\n        fn calc_return_vec_log_valid() {\n            let prices: Vec\u003cFixedNumber\u003e = vec![\n                7_117.21,\n                7_429.72,\n                7_550.90,\n                7_569.94,\n                7_679.87,\n                7_795.60,\n                7_807.06,\n                8_801.04,\n                8_658.55,\n                8_864.77,\n            ].into_iter().map(FixedNumber::from_num).collect();\n            let func = calc_return_func(CalcReturnType::Log);\n\n            let actual: MathResult\u003cVec\u003cFixedNumber\u003e\u003e = calc_return_iter(\u0026prices, func).collect();\n            assert_ok!(\u0026actual);\n            let actual: Vec\u003cf64\u003e = actual.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\n            let expected: Vec\u003cf64\u003e = vec![\n                0.042972378,\n                0.016178588,\n                0.002518380,\n                0.014417479,\n                0.014956852,\n                0.001468981,\n                0.119841444,\n                -0.016322624,\n                0.023537722,\n            ];\n\n            assert_eq!(actual.len(), expected.len());\n            for (a, e) in actual.into_iter().zip(expected.into_iter()) {\n                assert_abs_diff_eq!(a, e, epsilon = 1e-8);\n            }\n        }\n    }\n}\n","traces":[{"line":86,"address":[4959136],"length":1,"stats":{"Line":3},"fn_name":"calc_return\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":87,"address":[4959391,4959183,4959443],"length":1,"stats":{"Line":4},"fn_name":null},{"line":89,"address":[4959473,4959359],"length":1,"stats":{"Line":4},"fn_name":null},{"line":92,"address":[4959536],"length":1,"stats":{"Line":1},"fn_name":"calc_log_return\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":97,"address":[4959769,4959818,4959583],"length":1,"stats":{"Line":2},"fn_name":null},{"line":98,"address":[4959860,4959867,4959856,4959848,4959741],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":101,"address":[4959872],"length":1,"stats":{"Line":4},"fn_name":"calc_return_func\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":106,"address":[4959911],"length":1,"stats":{"Line":1},"fn_name":null},{"line":107,"address":[4959915,4959885],"length":1,"stats":{"Line":7},"fn_name":null},{"line":108,"address":[4959899],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[4960022,4959952],"length":1,"stats":{"Line":3},"fn_name":"calc_return_iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,fn(substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e) -\u003e core::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e"},{"line":113,"address":[4960140,4959974,4960112,4960034],"length":1,"stats":{"Line":11},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,fn(substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, substrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e) -\u003e core::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e"},{"line":116,"address":[4960384],"length":1,"stats":{"Line":1},"fn_name":"diff\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":117,"address":[4960464,4960401,4960486],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":120,"address":[4960720],"length":1,"stats":{"Line":1},"fn_name":"decay\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":121,"address":[4960750],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[4961031,4961086,4960798],"length":1,"stats":{"Line":1},"fn_name":null},{"line":124,"address":[4961125,4961006],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[4961136],"length":1,"stats":{"Line":1},"fn_name":"recurrent_ewma_step\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":128,"address":[4961413,4961162,4961477],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[4961641,4961339,4961489],"length":1,"stats":{"Line":2},"fn_name":null},{"line":131,"address":[4961599,4961737,4961862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":132,"address":[4962126,4961943,4961830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":133,"address":[4962082,4962207,4962335],"length":1,"stats":{"Line":4},"fn_name":null},{"line":135,"address":[4962310,4962414],"length":1,"stats":{"Line":2},"fn_name":null},{"line":138,"address":[4962624,4962432,4962800],"length":1,"stats":{"Line":3},"fn_name":"last_recurrent_ewma\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::zip::Zip\u003ccore::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e, core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":139,"address":[4963744,4962976,4962650,4962458,4962826,4963360],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::zip::Zip\u003ccore::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e, core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":140,"address":[4963000,4963384,4963768,4963900,4963132,4963516],"length":1,"stats":{"Line":6},"fn_name":null},{"line":141,"address":[4963164,4963548,4963932],"length":1,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[4963254,4963638,4964022],"length":1,"stats":{"Line":3},"fn_name":null},{"line":144,"address":[4963825,4963057,4963441],"length":1,"stats":{"Line":3},"fn_name":null},{"line":146,"address":[4963730,4964164,4964192,4964160,4964128,4963722,4964106,4964132,4963338,4963346,4964114,4964196],"length":1,"stats":{"Line":9},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,alloc::vec::IntoIter\u003ccore::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e\u003e"},{"line":149,"address":[4965043,4965294,4964782,4964480,4964992,4964224,4964275,4965248,4964531,4964736],"length":1,"stats":{"Line":8},"fn_name":"sum\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-1\u003e, closure-0\u003e\u003e"},{"line":150,"address":[4966080,4966111,4965412,4964393,4965504,4965458,4965326,4964307,4964695,4965345,4966687,4965094,4964582,4964563,4964946,4966368,4965823,4966399,4965792,4964251,4964900,4965265,4964326,4964649,4964814,4965207,4966656,4965019,4965161,4964833,4965535,4964507,4964439,4965075,4964753],"length":1,"stats":{"Line":40},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-0\u003e, closure-0\u003e\u003e"},{"line":153,"address":[4966944],"length":1,"stats":{"Line":2},"fn_name":"mean\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":154,"address":[4967237,4967182,4966978,4967360,4967344],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":155,"address":[4967252,4967170],"length":1,"stats":{"Line":4},"fn_name":null},{"line":158,"address":[4967408],"length":1,"stats":{"Line":2},"fn_name":"demeaned\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e"},{"line":159,"address":[4967435,4967505,4967488],"length":1,"stats":{"Line":6},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e"},{"line":162,"address":[4967616,4967888,4967808,4967664,4967728],"length":1,"stats":{"Line":7},"fn_name":"squared\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Map\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e, closure-0\u003e\u003e"},{"line":163,"address":[4967735,4968704,4967815,4968832,4967958,4968844,4968448,4968342,4967936,4968768,4968780,4968652,4967630,4967671,4968588,4968086,4968214,4967902,4968192,4968640,4968716,4968470,4968576,4968320,4968064],"length":1,"stats":{"Line":35},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,alloc::vec::IntoIter\u003ccore::result::Result\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e, financial_pallet::math::MathError\u003e\u003e\u003e"},{"line":166,"address":[4968896],"length":1,"stats":{"Line":2},"fn_name":"regular_vola\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":167,"address":[4969098,4968938,4969153],"length":1,"stats":{"Line":2},"fn_name":null},{"line":168,"address":[4969170,4969071,4969391],"length":1,"stats":{"Line":4},"fn_name":null},{"line":169,"address":[4969472,4969589,4969347],"length":1,"stats":{"Line":4},"fn_name":null},{"line":170,"address":[4969573],"length":1,"stats":{"Line":2},"fn_name":null},{"line":173,"address":[4969648],"length":1,"stats":{"Line":1},"fn_name":"exp_vola\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":177,"address":[4969921,4969872,4969968,4969972,4969695,4969979],"length":1,"stats":{"Line":1},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":178,"address":[4969957,4969834],"length":1,"stats":{"Line":2},"fn_name":null},{"line":181,"address":[4969984],"length":1,"stats":{"Line":2},"fn_name":"mul\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e"},{"line":182,"address":[4970064,4970011,4970096],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e,core::iter::adapters::Copied\u003ccore::slice::Iter\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e\u003e\u003e"},{"line":185,"address":[4970208],"length":1,"stats":{"Line":1},"fn_name":"regular_corr\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":186,"address":[4970562,4970282,4970498],"length":1,"stats":{"Line":1},"fn_name":null},{"line":187,"address":[4970815,4970582,4970462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":188,"address":[4970771,4970896,4971033],"length":1,"stats":{"Line":2},"fn_name":null},{"line":189,"address":[4971254,4970989,4971117],"length":1,"stats":{"Line":2},"fn_name":null},{"line":190,"address":[4971210,4971338,4971455],"length":1,"stats":{"Line":2},"fn_name":null},{"line":191,"address":[4971439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":194,"address":[4971520],"length":1,"stats":{"Line":1},"fn_name":"exp_corr\u003csubstrate_fixed::FixedI128\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UInt\u003ctypenum::uint::UTerm, typenum::bit::B1\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e, typenum::bit::B0\u003e\u003e\u003e"},{"line":195,"address":[4971780,4971829,4971591],"length":1,"stats":{"Line":1},"fn_name":null},{"line":196,"address":[4971870,4971742,4971984],"length":1,"stats":{"Line":2},"fn_name":null},{"line":197,"address":[4971968],"length":1,"stats":{"Line":1},"fn_name":null},{"line":211,"address":[4874288,4873504],"length":1,"stats":{"Line":3},"fn_name":"diff_example"},{"line":212,"address":[4874303,4873516],"length":1,"stats":{"Line":2},"fn_name":null},{"line":216,"address":[4874374,4874462],"length":1,"stats":{"Line":2},"fn_name":null},{"line":217,"address":[4874681,4874477],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[4874819,4874600],"length":1,"stats":{"Line":4},"fn_name":null},{"line":220,"address":[4875381,4874890],"length":1,"stats":{"Line":2},"fn_name":null},{"line":223,"address":[4875641,4875389],"length":1,"stats":{"Line":1},"fn_name":null},{"line":224,"address":[4876259,4876224,4876010,4877485,4875575,4876498],"length":1,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[4876503,4876341],"length":1,"stats":{"Line":1},"fn_name":null},{"line":230,"address":[4878398,4877648],"length":1,"stats":{"Line":3},"fn_name":"squared_example"},{"line":231,"address":[4878413,4877660],"length":1,"stats":{"Line":2},"fn_name":null},{"line":235,"address":[4878476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[4878799,4878595],"length":1,"stats":{"Line":1},"fn_name":null},{"line":237,"address":[4436016,4436035],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":239,"address":[4879499,4879008],"length":1,"stats":{"Line":2},"fn_name":null},{"line":242,"address":[4879507,4879759],"length":1,"stats":{"Line":1},"fn_name":null},{"line":243,"address":[4880377,4880342,4879693,4881584,4880128,4880616],"length":1,"stats":{"Line":4},"fn_name":null},{"line":244,"address":[4880621,4880459],"length":1,"stats":{"Line":1},"fn_name":null},{"line":249,"address":[4436064,4436069],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":250,"address":[4881742],"length":1,"stats":{"Line":1},"fn_name":null},{"line":251,"address":[4882012,4881760],"length":1,"stats":{"Line":1},"fn_name":null},{"line":252,"address":[4881909],"length":1,"stats":{"Line":1},"fn_name":null},{"line":253,"address":[4882169],"length":1,"stats":{"Line":1},"fn_name":null},{"line":254,"address":[4882191],"length":1,"stats":{"Line":1},"fn_name":null},{"line":256,"address":[4882200,4882381],"length":1,"stats":{"Line":1},"fn_name":null},{"line":260,"address":[4883734,4883008],"length":1,"stats":{"Line":3},"fn_name":"last_recurrent_ewma_example"},{"line":261,"address":[4883749,4883020],"length":1,"stats":{"Line":2},"fn_name":null},{"line":264,"address":[4883828],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[4883883],"length":1,"stats":{"Line":1},"fn_name":null},{"line":267,"address":[4883985,4884189],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[4884327,4884108],"length":1,"stats":{"Line":2},"fn_name":null},{"line":270,"address":[4884371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[4884565,4884387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":275,"address":[4436208,4436213],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":276,"address":[4885478],"length":1,"stats":{"Line":1},"fn_name":null},{"line":277,"address":[4885547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":278,"address":[4885598],"length":1,"stats":{"Line":1},"fn_name":null},{"line":279,"address":[4885659],"length":1,"stats":{"Line":1},"fn_name":null},{"line":280,"address":[4885800,4886020],"length":1,"stats":{"Line":1},"fn_name":null},{"line":281,"address":[4885927,4886177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":282,"address":[4886199],"length":1,"stats":{"Line":1},"fn_name":null},{"line":284,"address":[4886208,4886389],"length":1,"stats":{"Line":1},"fn_name":null},{"line":288,"address":[4436245,4436240],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":289,"address":[4887046],"length":1,"stats":{"Line":1},"fn_name":null},{"line":290,"address":[4887097],"length":1,"stats":{"Line":1},"fn_name":null},{"line":291,"address":[4887180],"length":1,"stats":{"Line":1},"fn_name":null},{"line":292,"address":[4887437,4887185],"length":1,"stats":{"Line":1},"fn_name":null},{"line":293,"address":[4887334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":294,"address":[4887594],"length":1,"stats":{"Line":1},"fn_name":null},{"line":295,"address":[4887616],"length":1,"stats":{"Line":1},"fn_name":null},{"line":297,"address":[4887806,4887625],"length":1,"stats":{"Line":1},"fn_name":null},{"line":309,"address":[4796448,4796453],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":310,"address":[5328556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":311,"address":[5328601],"length":1,"stats":{"Line":1},"fn_name":null},{"line":312,"address":[5328669],"length":1,"stats":{"Line":1},"fn_name":null},{"line":313,"address":[5328682],"length":1,"stats":{"Line":1},"fn_name":null},{"line":315,"address":[5328835,5328731],"length":1,"stats":{"Line":1},"fn_name":null},{"line":319,"address":[4796480,4796485],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":320,"address":[5329148],"length":1,"stats":{"Line":1},"fn_name":null},{"line":321,"address":[5329193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":322,"address":[5329261],"length":1,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[5329274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[5329323,5329427],"length":1,"stats":{"Line":1},"fn_name":null},{"line":329,"address":[4796512,4796517],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":330,"address":[5329737],"length":1,"stats":{"Line":1},"fn_name":null},{"line":331,"address":[5329779],"length":1,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[5329841],"length":1,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[5329846],"length":1,"stats":{"Line":1},"fn_name":null},{"line":335,"address":[5329966,5329862],"length":1,"stats":{"Line":1},"fn_name":null},{"line":339,"address":[4796544,4796549],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":340,"address":[5330275],"length":1,"stats":{"Line":1},"fn_name":null},{"line":341,"address":[5330323],"length":1,"stats":{"Line":1},"fn_name":null},{"line":342,"address":[5330406],"length":1,"stats":{"Line":1},"fn_name":null},{"line":343,"address":[5330488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":345,"address":[5330678,5330497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":349,"address":[4796576,4796581],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":350,"address":[5331321],"length":1,"stats":{"Line":1},"fn_name":null},{"line":351,"address":[5331363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":352,"address":[5331425],"length":1,"stats":{"Line":1},"fn_name":null},{"line":353,"address":[5331430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":355,"address":[5331550,5331446],"length":1,"stats":{"Line":1},"fn_name":null},{"line":359,"address":[4796613,4796608],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":360,"address":[5331852],"length":1,"stats":{"Line":1},"fn_name":null},{"line":361,"address":[5331894],"length":1,"stats":{"Line":1},"fn_name":null},{"line":362,"address":[5331956],"length":1,"stats":{"Line":1},"fn_name":null},{"line":363,"address":[5331961],"length":1,"stats":{"Line":1},"fn_name":null},{"line":365,"address":[5332081,5331977],"length":1,"stats":{"Line":1},"fn_name":null},{"line":369,"address":[4796640,4796645],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":370,"address":[5332375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":371,"address":[5332404],"length":1,"stats":{"Line":1},"fn_name":null},{"line":373,"address":[5332434,5332486],"length":1,"stats":{"Line":2},"fn_name":null},{"line":374,"address":[5332524],"length":1,"stats":{"Line":1},"fn_name":null},{"line":376,"address":[5332725,5332684,5332579],"length":1,"stats":{"Line":2},"fn_name":null},{"line":380,"address":[4796672,4796677],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":381,"address":[5333212,5333143],"length":1,"stats":{"Line":2},"fn_name":null},{"line":382,"address":[5333274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":384,"address":[5333304,5333359],"length":1,"stats":{"Line":2},"fn_name":null},{"line":385,"address":[5333397],"length":1,"stats":{"Line":1},"fn_name":null},{"line":387,"address":[5333557,5333452,5333598],"length":1,"stats":{"Line":2},"fn_name":null},{"line":391,"address":[4796704,4796709],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":392,"address":[5334233,5334012],"length":1,"stats":{"Line":2},"fn_name":null},{"line":404,"address":[5334298],"length":1,"stats":{"Line":1},"fn_name":null},{"line":406,"address":[5334410,5334337],"length":1,"stats":{"Line":2},"fn_name":null},{"line":407,"address":[5334652,5334448],"length":1,"stats":{"Line":1},"fn_name":null},{"line":408,"address":[4796755,4796736],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":410,"address":[5334861,5335033],"length":1,"stats":{"Line":2},"fn_name":null},{"line":422,"address":[5335041,5335293],"length":1,"stats":{"Line":1},"fn_name":null},{"line":423,"address":[5335662,5335876,5335911,5335227,5337137,5336150],"length":1,"stats":{"Line":4},"fn_name":null},{"line":424,"address":[5336155,5335993],"length":1,"stats":{"Line":1},"fn_name":null},{"line":429,"address":[4796789,4796784],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":430,"address":[5337529,5337308],"length":1,"stats":{"Line":2},"fn_name":null},{"line":442,"address":[5337597],"length":1,"stats":{"Line":1},"fn_name":null},{"line":444,"address":[5337709,5337636],"length":1,"stats":{"Line":2},"fn_name":null},{"line":445,"address":[5337747,5337951],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4796835,4796816],"length":1,"stats":{"Line":4},"fn_name":"{{closure}}"},{"line":448,"address":[5338332,5338160],"length":1,"stats":{"Line":2},"fn_name":null},{"line":460,"address":[5338592,5338340],"length":1,"stats":{"Line":1},"fn_name":null},{"line":461,"address":[5339210,5339175,5338961,5339449,5338526,5340436],"length":1,"stats":{"Line":4},"fn_name":null},{"line":462,"address":[5339292,5339454],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":181,"coverable":181},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","mock.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::{Module, Trait};\nuse sp_core::H256;\nuse frame_support::{impl_outer_origin, parameter_types, weights::Weight};\nuse frame_support::traits::UnixTime;\nuse frame_support::codec::{Decode, Encode};\nuse sp_runtime::{\n\ttraits::{BlakeTwo256, IdentityLookup}, testing::Header, Perbill,\n};\nuse frame_system as system;\nuse core::time::Duration;\nuse substrate_fixed::types::I64F64;\nuse std::cell::RefCell;\nuse financial_primitives::IntoTypeIterator;\n\nimpl_outer_origin! {\n\tpub enum Origin for Test {}\n}\n\nthread_local! {\n\tpub static NOW: RefCell\u003cDuration\u003e = RefCell::new(Duration::from_secs(0));\n}\n\npub fn set_now(now: Duration) {\n\tNOW.with(|n| *n.borrow_mut() = now);\n}\n\n#[derive(Clone, Eq, PartialEq)]\npub struct Test;\nparameter_types! {\n\tpub const BlockHashCount: u64 = 250;\n\tpub const MaximumBlockWeight: Weight = 1024;\n\tpub const MaximumBlockLength: u32 = 2 * 1024;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n}\n\nimpl system::Trait for Test {\n\ttype BaseCallFilter = ();\n\ttype Origin = Origin;\n\ttype Call = ();\n\ttype Index = u64;\n\ttype BlockNumber = u64;\n\ttype Hash = H256;\n\ttype Hashing = BlakeTwo256;\n\ttype AccountId = u64;\n\ttype Lookup = IdentityLookup\u003cSelf::AccountId\u003e;\n\ttype Header = Header;\n\ttype Event = ();\n\ttype BlockHashCount = BlockHashCount;\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\ttype DbWeight = ();\n\ttype BlockExecutionWeight = ();\n\ttype ExtrinsicBaseWeight = ();\n\ttype MaximumExtrinsicWeight = MaximumBlockWeight;\n\ttype MaximumBlockLength = MaximumBlockLength;\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\ttype Version = ();\n\ttype ModuleToIndex = ();\n\ttype AccountData = ();\n\ttype OnNewAccount = ();\n\ttype OnKilledAccount = ();\n\ttype SystemWeightInfo = ();\n}\n\npub type FixedNumber = I64F64;\n\nparameter_types! {\n\tpub const PriceCount: u32 = 10;\n\tpub const PricePeriod: u32 = 60;\n}\n\npub struct TestUnixTime;\n\nimpl UnixTime for TestUnixTime {\n\tfn now() -\u003e Duration {\n\t\tNOW.with(|n| *n.borrow())\n\t}\n}\n\nimpl Trait for Test {\n\ttype Event = ();\n\ttype PriceCount = PriceCount;\n\ttype PricePeriod = PricePeriod;\n\ttype UnixTime = TestUnixTime;\n\ttype Asset = Asset;\n\ttype FixedNumberBits = i128;\n\ttype FixedNumber = FixedNumber;\n\ttype Price = FixedNumber;\n}\n\npub type FinancialModule = Module\u003cTest\u003e;\n\n#[derive(Clone, Copy, Debug, Eq, PartialEq, Encode, Decode)]\npub enum Asset {\n\tBtc,\n\tEos,\n}\n\nimpl IntoTypeIterator for Asset {\n    type Iterator = sp_std::vec::IntoIter\u003cSelf\u003e;\n\n    fn into_type_iter() -\u003e Self::Iterator {\n        vec![\n            Asset::Btc,\n            Asset::Eos,\n        ].into_iter()\n    }\n}\n\npub fn initial_btc_prices() -\u003e Vec\u003cf64\u003e {\n\tvec![\n\t\t7_117.21,\n\t\t7_429.72,\n\t\t7_550.90,\n\t\t7_569.94,\n\t\t7_679.87,\n\t\t7_795.60,\n\t\t7_807.06,\n\t\t8_801.04,\n\t\t8_658.55,\n\t\t8_864.77,\n\t]\n}\n\npub fn initial_eos_prices() -\u003e Vec\u003cf64\u003e {\n\tvec![\n\t\t2.62,\n\t\t2.67,\n\t\t2.72,\n\t\t2.72,\n\t\t2.74,\n\t\t2.75,\n\t\t2.78,\n\t\t3.02,\n\t\t2.83,\n\t\t2.89,\n\t]\n}\n\npub fn new_test_ext() -\u003e sp_io::TestExternalities {\n\tlet mut t = system::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap();\n\n\tcrate::GenesisConfig::\u003cTest\u003e {\n\t\tprices: vec![\n\t\t\t(Asset::Btc, initial_btc_prices().into_iter().map(FixedNumber::from_num).collect()),\n\t\t\t(Asset::Eos, initial_eos_prices().into_iter().map(FixedNumber::from_num).collect()),\n\t\t],\n\t}\n\t\t.assimilate_storage(\u0026mut t)\n\t\t.unwrap();\n\n\tt.into()\n}\n\npub fn new_test_ext_empty_storage() -\u003e sp_io::TestExternalities {\n\tsystem::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap().into()\n}\n","traces":[{"line":30,"address":[4248032,4248103,4248065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[4859792],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4855696],"length":1,"stats":{"Line":1},"fn_name":"set_now"},{"line":39,"address":[4247710,4247696],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":48,"address":[4860017],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[4855744],"length":1,"stats":{"Line":1},"fn_name":"now"},{"line":90,"address":[4247840,4247849],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":116,"address":[4855792],"length":1,"stats":{"Line":0},"fn_name":"into_type_iter"},{"line":117,"address":[4855799],"length":1,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[4855888],"length":1,"stats":{"Line":1},"fn_name":"initial_btc_prices"},{"line":125,"address":[4855895],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[4856096],"length":1,"stats":{"Line":1},"fn_name":"initial_eos_prices"},{"line":140,"address":[4856103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[4856335,4856288],"length":1,"stats":{"Line":1},"fn_name":"new_test_ext"},{"line":155,"address":[4856298,4856363],"length":1,"stats":{"Line":2},"fn_name":null},{"line":158,"address":[4856599,4857077,4856726,4856447],"length":1,"stats":{"Line":5},"fn_name":null},{"line":166,"address":[4856924],"length":1,"stats":{"Line":4},"fn_name":null},{"line":169,"address":[4857200,4857239],"length":1,"stats":{"Line":6},"fn_name":"new_test_ext_empty_storage"},{"line":170,"address":[4857210,4857267,4857324],"length":1,"stats":{"Line":12},"fn_name":null}],"covered":15,"coverable":21},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","financial","src","tests.rs"],"content":"// Copyright (C) 2020 equilibrium.\n// SPDX-License-Identifier: Apache-2.0\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n// http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nuse crate::mock::*;\nuse frame_support::assert_ok;\nuse frame_support::dispatch::DispatchError;\nuse crate::{Financial, CalcReturnType, CalcVolatilityType, CalcCorrelationType, PriceUpdate, Error};\nuse crate::{calc_volatility, calc_correlation};\nuse financial_primitives::OnPriceSet;\nuse approx::assert_abs_diff_eq;\nuse substrate_fixed::traits::LossyInto;\nuse chrono::prelude::*;\nuse core::time::Duration;\n\nfn create_duration(year: i32, month: u32, day: u32, hour: u32, minute: u32, second: u32) -\u003e Duration {\n\tlet timestamp = Utc.ymd(year, month, day).and_hms(hour, minute, second).timestamp();\n\tDuration::from_secs(timestamp as u64)\n}\n\n#[cfg(test)]\nmod price_period {\n\tuse crate::*;\n\tuse crate::tests::create_duration;\n\n\t#[test]\n\tfn period_id_are_same_within_period() {\n\t\tlet time1 = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet time2 = create_duration(2020, 9, 14, 12, 54, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet period_id_1 = period.get_period_id(time1);\n\t\tlet period_id_2 = period.get_period_id(time2);\n\n\t\tassert!(period_id_1.is_ok());\n\t\tassert!(period_id_2.is_ok());\n\t\tassert_eq!(period_id_1, period_id_2);\n\t}\n\n\t#[test]\n\tfn period_id_are_different_for_different_periods() {\n\t\tlet time1 = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet time2 = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet period_id_1 = period.get_period_id(time1);\n\t\tlet period_id_2 = period.get_period_id(time2);\n\n\t\tassert!(period_id_1.is_ok());\n\t\tassert!(period_id_2.is_ok());\n\t\tassert!(period_id_1 != period_id_2);\n\t}\n\n\t#[test]\n\tfn info_for_neighbour_periods() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_curr_period_info(period_start, now);\n\t\tlet expected = Ok((create_duration(2020, 9, 14, 13, 0, 0), 1));\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn info_for_distant_periods() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_curr_period_info(period_start, now);\n\t\tlet expected = Ok((create_duration(2020, 9, 15, 7, 0, 0), 19));\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn invalid_period_start() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 42, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::InvalidPeriodStart);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_remains_unchanged() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 42, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start,\n\t\t\taction: PeriodAction::RemainsUnchanged,\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_changed_slightly() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 13, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start: create_duration(2020, 9, 14, 13, 0, 0),\n\t\t\taction: PeriodAction::StartedNew(0),\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_changed_significantly() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Ok(PeriodChange {\n\t\t\tperiod_start: create_duration(2020, 9, 15, 7, 0, 0),\n\t\t\taction: PeriodAction::StartedNew(18),\n\t\t});\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn period_is_in_the_past() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 12, 16, 27, 10);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::PeriodIsInThePast);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn zero_period() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 15, 7, 2, 0);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(0);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::DivisionByZero);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn elapsed_period_count_is_too_large() {\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = Duration::from_secs(u64::MAX);\n\n\t\t// period is one hour\n\t\tlet period = PricePeriod(60);\n\n\t\tlet actual = period.get_period_change(Some(period_start), now);\n\t\tlet expected = Err(PricePeriodError::Overflow);\n\n\t\tassert_eq!(actual, expected);\n\t}\n}\n\n#[cfg(test)]\nmod new_prices {\n\tuse crate::*;\n\n\t#[test]\n\tfn no_last_price_no_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(None, 123, 0, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn no_last_price_some_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(None, 123, 3, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_no_empty_periods() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 0, 5);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_less_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 3, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_equal_to_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 4, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_slightly_more_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 5, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn some_last_price_some_empty_periods_significantly_more_than_max() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 27, 5);\n\t\tlet expected = Ok(vec![555, 555, 555, 555, 123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn max_periods_is_zero() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 27, 0);\n\t\tlet expected = Err(GetNewPricesError::Overflow);\n\n\t\tassert_eq!(actual, expected);\n\t}\n\n\t#[test]\n\tfn max_periods_is_one() {\n\t\tlet actual = get_new_prices::\u003cu32\u003e(Some(555), 123, 3, 1);\n\t\tlet expected = Ok(vec![123]);\n\n\t\tassert_eq!(actual, expected);\n\t}\n}\n\n#[test]\nfn calc_linear_return_for_btc_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.04390906,\n\t\t\t0.01631017,\n\t\t\t0.00252155,\n\t\t\t0.01452191,\n\t\t\t0.01506927,\n\t\t\t0.00147006,\n\t\t\t0.12731809,\n\t\t\t-0.01619013,\n\t\t\t0.02381692,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_log_return_for_btc_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Log, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.042972378,\n\t\t\t0.016178588,\n\t\t\t0.002518380,\n\t\t\t0.014417479,\n\t\t\t0.014956852,\n\t\t\t0.001468981,\n\t\t\t0.119841444,\n\t\t\t-0.016322624,\n\t\t\t0.023537722,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_linear_return_for_eos_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Eos)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.01908397,\n\t\t\t0.01872659,\n\t\t\t0.00000000,\n\t\t\t0.00735294,\n\t\t\t0.00364964,\n\t\t\t0.01090909,\n\t\t\t0.08633094,\n\t\t\t-0.06291391,\n\t\t\t0.02120141,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_log_return_for_eos_using_only_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Log, Asset::Eos)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.018904155,\n\t\t\t0.018553408,\n\t\t\t0.000000000,\n\t\t\t0.007326040,\n\t\t\t0.003642991,\n\t\t\t0.010850016,\n\t\t\t0.082805904,\n\t\t\t-0.064980120,\n\t\t\t0.020979790,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn calc_linear_return_for_btc_using_some_oracle_prices() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet prices: Vec\u003c_\u003e = vec![\n\t\t\t8_988.60,\n\t\t\t8_897.47,\n\t\t\t8_912.65,\n\t\t\t9_003.07,\n\t\t].into_iter().map(FixedNumber::from_num).collect();\n \n\t\tlet mut now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tfor p in prices.into_iter() {\n\t\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(Asset::Btc, p);\n\n\t\t\tassert_ok!(result);\n\n\t\t\tnow = now + Duration::from_secs(60 * 60);\n\t\t\tset_now(now);\n\t\t}\n\n\t\tlet actual: Vec\u003cf64\u003e = \u003cFinancialModule as Financial\u003e::calc_return(CalcReturnType::Regular, Asset::Btc)\n\t\t\t.unwrap().into_iter().map(|x| x.lossy_into()).collect();\n\t\tlet expected = vec![\n\t\t\t0.01506927,\n\t\t\t0.00147006,\n\t\t\t0.12731809,\n\t\t\t-0.01619013,\n\t\t\t0.02381692,\n\t\t\t0.01396878,\n\t\t\t-0.01013840,\n\t\t\t0.00170610,\n\t\t\t0.01014513,\n\t\t];\n\n\t\tassert_eq!(actual.len(), expected.len());\n\t\tfor (a, e) in actual.into_iter().zip(expected.into_iter()) {\n\t\t\tassert_abs_diff_eq!(a, e, epsilon = 1e-8);\n\t\t}\n\t});\n}\n\n#[test]\nfn initial_prices_state_with_empty_genesis() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = None;\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = 0;\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn initial_prices_state_with_nonempty_genesis() {\n\tnew_test_ext().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = None;\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = initial_btc_prices()\n\t\t\t.into_iter().map(FixedNumber::from_num).collect();\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn first_price_with_empty_genesis() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(period_start, now, price));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_the_past() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet past_price = FixedNumber::from_num(7_300);\n\t\tlet past_now = create_duration(2020, 9, 13, 0, 3, 0);\n\t\tset_now(past_now);\n\n\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, past_price);\n\t\tlet expected_result: Result\u003c(), DispatchError\u003e = Err(Error::\u003cTest\u003e::PeriodIsInThePast.into());\n\t\tassert_eq!(result, expected_result);\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(period_start, now, price));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_current_period() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet same_period_price = FixedNumber::from_num(9_100);\n\t\tlet same_period_now = create_duration(2020, 9, 14, 12, 48, 0);\n\t\tset_now(same_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, same_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tperiod_start,\n\t\t\tsame_period_now,\n\t\t\tsame_period_price\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_in_next_period() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet next_period_start = create_duration(2020, 9, 14, 13, 0, 0);\n\t\tlet next_period_price = FixedNumber::from_num(9_100);\n\t\tlet next_period_now = create_duration(2020, 9, 14, 13, 27, 0);\n\t\tset_now(next_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, next_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnext_period_start,\n\t\t\tnext_period_now,\n\t\t\tnext_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price, next_period_price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_a_few_periods_ahead() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet new_period_start = create_duration(2020, 9, 14, 16, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(9_100);\n\t\tlet new_period_now = create_duration(2020, 9, 14, 16, 27, 0);\n\t\tset_now(new_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnew_period_now,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tprice,\n\t\t\tnew_period_price,\n\t\t];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_is_many_periods_ahead() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet new_period_start = create_duration(2020, 10, 3, 22, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(9_100);\n\t\tlet new_period_now = create_duration(2020, 10, 3, 22, 27, 0);\n\t\tset_now(new_period_now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnew_period_now,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet mut expected_prices: Vec\u003cFixedNumber\u003e = vec![price; PriceCount::get() as usize - 1];\n\t\texpected_prices.push(new_period_price);\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn wrong_now_in_the_distant_future() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet price = FixedNumber::from_num(9_000);\n\n\t\tlet period_start = create_duration(2020, 9, 14, 12, 0, 0);\n\t\tlet now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, price));\n\n\t\tlet distant_future_price = FixedNumber::from_num(9_100);\n\t\tlet distant_future_now = Duration::from_secs(u64::MAX);\n\t\tset_now(distant_future_now);\n\n\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, distant_future_price);\n\t\tlet expected_result: Result\u003c(), DispatchError\u003e = Err(Error::\u003cTest\u003e::Overflow.into());\n\t\tassert_eq!(result, expected_result);\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tperiod_start,\n\t\t\tnow,\n\t\t\tprice,\n\t\t));\n\n\t\tlet prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet expected_prices: Vec\u003cFixedNumber\u003e = vec![price];\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\n#[test]\nfn new_price_has_arravied_while_prices_countainer_is_full() {\n\tnew_test_ext_empty_storage().execute_with(|| {\n\t\tlet asset = Asset::Btc;\n\n\t\tlet prices: Vec\u003c_\u003e = vec![\n\t\t\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10,\n\t\t].into_iter().map(FixedNumber::from_num).collect();\n \n\t\tlet mut now = create_duration(2020, 9, 14, 12, 31, 0);\n\t\tset_now(now);\n\n\t\tfor \u0026p in prices.iter() {\n\t\t\tlet result = \u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, p);\n\n\t\t\tassert_ok!(result);\n\n\t\t\tnow = now + Duration::from_secs(60 * 60);\n\t\t\tset_now(now);\n\t\t}\n\n\t\tlet new_period_start = create_duration(2020, 9, 14, 22, 0, 0);\n\t\tlet new_period_price = FixedNumber::from_num(11);\n\n\t\tassert_ok!(\u003cFinancialModule as OnPriceSet\u003e::on_price_set(asset, new_period_price));\n\n\t\tlet updates = FinancialModule::updates(asset);\n\t\tlet expected_updates = Some(PriceUpdate::new(\n\t\t\tnew_period_start,\n\t\t\tnow,\n\t\t\tnew_period_price,\n\t\t));\n\n\t\tlet actual_prices: Vec\u003c_\u003e = FinancialModule::prices(asset).iter().copied().collect();\n\t\tlet mut expected_prices: Vec\u003c_\u003e = prices[1..].iter().copied().collect();\n\t\texpected_prices.push(new_period_price);\n\n\t\tlet prices_cap = FinancialModule::prices(asset).len_cap();\n\t\tlet expected_price_cap = PriceCount::get();\n\n\t\tassert_eq!(updates, expected_updates);\n\t\tassert_eq!(actual_prices, expected_prices);\n\t\tassert_eq!(prices_cap, expected_price_cap);\n\t});\n}\n\nfn btc_prices() -\u003e Vec\u003cFixedNumber\u003e {\n    vec![\n        7_117.21, 7_429.72, 7_550.90, 7_569.94, 7_679.87, 7_795.60, 7_807.06, 8_801.04, 8_658.55, 8_864.77, 8_988.60, 8_897.47, 8_912.65, 9_003.07, 9_268.76, 9_951.52, 9_842.67, 9_593.90, 8_756.43, 8_601.80, 8_804.48, 9_269.99, 9_733.72, 9_328.20, 9_377.01, 9_670.74, 9_726.57, 9_729.04, 9_522.98, 9_081.76,\n    ].into_iter().map(FixedNumber::from_num).collect()\n}\n\n#[test]\nfn calc_volatility_btc_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Regular;\n    let prices = btc_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.03897272754;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\nfn eos_prices() -\u003e Vec\u003cFixedNumber\u003e {\n    vec![\n        2.62, 2.67, 2.72, 2.72, 2.74, 2.75, 2.78, 3.02, 2.83, 2.89, 2.95, 2.84, 2.78, 2.77, 2.69, 2.76, 2.76, 2.76, 2.45, 2.41, 2.44, 2.53, 2.61, 2.59, 2.63, 2.62, 2.66, 2.63, 2.6, 2.47,\n    ].into_iter().map(FixedNumber::from_num).collect()\n}\n\n#[test]\nfn calc_volatility_eos_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Regular;\n    let prices = eos_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.03608986052;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_correlation_btc_eos_log_regular() {\n    let return_type = CalcReturnType::Log;\n    let corr_type = CalcCorrelationType::Regular;\n    let btc_prices = btc_prices();\n    let eos_prices = eos_prices();\n\n    let actual = calc_correlation(return_type, corr_type, \u0026btc_prices, \u0026eos_prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.83127977977;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_volatility_btc_log_exponential() {\n    let return_type = CalcReturnType::Log;\n    let vol_type = CalcVolatilityType::Exponential(36);\n    let prices = btc_prices();\n\n    let actual = calc_volatility(return_type, vol_type, \u0026prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.0373329770530;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n\n#[test]\nfn calc_correlation_btc_eos_log_exponential() {\n    let return_type = CalcReturnType::Log;\n    let corr_type = CalcCorrelationType::Exponential(36);\n    let btc_prices = btc_prices();\n    let eos_prices = eos_prices();\n\n    let actual = calc_correlation(return_type, corr_type, \u0026btc_prices, \u0026eos_prices);\n    assert_ok!(actual);\n    let actual: f64 = actual.unwrap().lossy_into();\n\n    let expected = 0.726633137678748;\n\n    assert_abs_diff_eq!(actual, expected, epsilon = 1e-8);\n}\n","traces":[{"line":27,"address":[4920752],"length":1,"stats":{"Line":1},"fn_name":"create_duration"},{"line":28,"address":[4920783],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4920904],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4628416],"length":1,"stats":{"Line":3},"fn_name":"period_id_are_same_within_period"},{"line":39,"address":[4628426],"length":1,"stats":{"Line":1},"fn_name":null},{"line":40,"address":[4628484],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[4628539],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[4628547],"length":1,"stats":{"Line":1},"fn_name":null},{"line":46,"address":[4628571],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[4628598,4628641],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[4628622,4628769,4628675],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4628681,4628803,4628817],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4629104],"length":1,"stats":{"Line":3},"fn_name":"period_id_are_different_for_different_periods"},{"line":55,"address":[4629111],"length":1,"stats":{"Line":1},"fn_name":null},{"line":56,"address":[4629163],"length":1,"stats":{"Line":1},"fn_name":null},{"line":59,"address":[4629212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":61,"address":[4629220],"length":1,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[4629244],"length":1,"stats":{"Line":1},"fn_name":null},{"line":64,"address":[4629268,4629308],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[4629292,4629369,4629342],"length":1,"stats":{"Line":2},"fn_name":null},{"line":66,"address":[4629444,4629348,4629414,4629403],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[4629456],"length":1,"stats":{"Line":3},"fn_name":"info_for_neighbour_periods"},{"line":71,"address":[4629466],"length":1,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[4629527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[4629582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":77,"address":[4629593],"length":1,"stats":{"Line":1},"fn_name":null},{"line":78,"address":[4629638],"length":1,"stats":{"Line":1},"fn_name":null},{"line":80,"address":[4629873,4629769],"length":1,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[4630160],"length":1,"stats":{"Line":3},"fn_name":"info_for_distant_periods"},{"line":85,"address":[4630170],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[4630231],"length":1,"stats":{"Line":1},"fn_name":null},{"line":89,"address":[4630286],"length":1,"stats":{"Line":1},"fn_name":null},{"line":91,"address":[4630297],"length":1,"stats":{"Line":1},"fn_name":null},{"line":92,"address":[4630342],"length":1,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[4630473,4630577],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[4630864],"length":1,"stats":{"Line":3},"fn_name":"invalid_period_start"},{"line":99,"address":[4630874],"length":1,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[4630932],"length":1,"stats":{"Line":1},"fn_name":null},{"line":103,"address":[4630987],"length":1,"stats":{"Line":1},"fn_name":null},{"line":105,"address":[4631000],"length":1,"stats":{"Line":1},"fn_name":null},{"line":106,"address":[4631073],"length":1,"stats":{"Line":1},"fn_name":null},{"line":108,"address":[4631196,4631089],"length":1,"stats":{"Line":1},"fn_name":null},{"line":112,"address":[4631488],"length":1,"stats":{"Line":3},"fn_name":"period_remains_unchanged"},{"line":113,"address":[4631497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":114,"address":[4631555],"length":1,"stats":{"Line":1},"fn_name":null},{"line":117,"address":[4631610],"length":1,"stats":{"Line":1},"fn_name":null},{"line":119,"address":[4631623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":120,"address":[4631712],"length":1,"stats":{"Line":1},"fn_name":null},{"line":122,"address":[4631696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":125,"address":[4631815,4631919],"length":1,"stats":{"Line":1},"fn_name":null},{"line":129,"address":[4632208],"length":1,"stats":{"Line":3},"fn_name":"period_changed_slightly"},{"line":130,"address":[4632217],"length":1,"stats":{"Line":1},"fn_name":null},{"line":131,"address":[4632278],"length":1,"stats":{"Line":1},"fn_name":null},{"line":134,"address":[4632333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":136,"address":[4632352],"length":1,"stats":{"Line":1},"fn_name":null},{"line":137,"address":[4632497],"length":1,"stats":{"Line":1},"fn_name":null},{"line":138,"address":[4632430],"length":1,"stats":{"Line":1},"fn_name":null},{"line":139,"address":[4632470],"length":1,"stats":{"Line":1},"fn_name":null},{"line":142,"address":[4632704,4632600],"length":1,"stats":{"Line":1},"fn_name":null},{"line":146,"address":[4632992],"length":1,"stats":{"Line":3},"fn_name":"period_changed_significantly"},{"line":147,"address":[4633001],"length":1,"stats":{"Line":1},"fn_name":null},{"line":148,"address":[4633062],"length":1,"stats":{"Line":1},"fn_name":null},{"line":151,"address":[4633117],"length":1,"stats":{"Line":1},"fn_name":null},{"line":153,"address":[4633136],"length":1,"stats":{"Line":1},"fn_name":null},{"line":154,"address":[4633281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":155,"address":[4633214],"length":1,"stats":{"Line":1},"fn_name":null},{"line":156,"address":[4633254],"length":1,"stats":{"Line":1},"fn_name":null},{"line":159,"address":[4633384,4633488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":163,"address":[4633776],"length":1,"stats":{"Line":3},"fn_name":"period_is_in_the_past"},{"line":164,"address":[4633785],"length":1,"stats":{"Line":1},"fn_name":null},{"line":165,"address":[4633840],"length":1,"stats":{"Line":1},"fn_name":null},{"line":168,"address":[4633901],"length":1,"stats":{"Line":1},"fn_name":null},{"line":170,"address":[4633914],"length":1,"stats":{"Line":1},"fn_name":null},{"line":171,"address":[4633987],"length":1,"stats":{"Line":1},"fn_name":null},{"line":173,"address":[4634003,4634110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":177,"address":[4634400],"length":1,"stats":{"Line":3},"fn_name":"zero_period"},{"line":178,"address":[4634409],"length":1,"stats":{"Line":1},"fn_name":null},{"line":179,"address":[4634467],"length":1,"stats":{"Line":1},"fn_name":null},{"line":182,"address":[4634522],"length":1,"stats":{"Line":1},"fn_name":null},{"line":184,"address":[4634535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[4634608],"length":1,"stats":{"Line":1},"fn_name":null},{"line":187,"address":[4634731,4634624],"length":1,"stats":{"Line":1},"fn_name":null},{"line":191,"address":[4635024],"length":1,"stats":{"Line":3},"fn_name":"elapsed_period_count_is_too_large"},{"line":192,"address":[4635033],"length":1,"stats":{"Line":1},"fn_name":null},{"line":193,"address":[4635088],"length":1,"stats":{"Line":1},"fn_name":null},{"line":196,"address":[4635124],"length":1,"stats":{"Line":1},"fn_name":null},{"line":198,"address":[4635137],"length":1,"stats":{"Line":1},"fn_name":null},{"line":199,"address":[4635210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":201,"address":[4635226,4635333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":210,"address":[5304672,5304721],"length":1,"stats":{"Line":3},"fn_name":"no_last_price_no_empty_periods"},{"line":211,"address":[5304682],"length":1,"stats":{"Line":1},"fn_name":null},{"line":212,"address":[5304741,5304797],"length":1,"stats":{"Line":2},"fn_name":null},{"line":214,"address":[5304834,5304965],"length":1,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[5305328,5305380],"length":1,"stats":{"Line":3},"fn_name":"no_last_price_some_empty_periods"},{"line":219,"address":[5305335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":220,"address":[5305456,5305400],"length":1,"stats":{"Line":2},"fn_name":null},{"line":222,"address":[5305624,5305493],"length":1,"stats":{"Line":1},"fn_name":null},{"line":226,"address":[5306057,5306000],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_no_empty_periods"},{"line":227,"address":[5306010],"length":1,"stats":{"Line":1},"fn_name":null},{"line":228,"address":[5306077,5306133],"length":1,"stats":{"Line":2},"fn_name":null},{"line":230,"address":[5306170,5306301],"length":1,"stats":{"Line":1},"fn_name":null},{"line":234,"address":[5306672,5306732],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_less_than_max"},{"line":235,"address":[5306679],"length":1,"stats":{"Line":1},"fn_name":null},{"line":236,"address":[5306836,5306757],"length":1,"stats":{"Line":2},"fn_name":null},{"line":238,"address":[5307004,5306873],"length":1,"stats":{"Line":1},"fn_name":null},{"line":242,"address":[5307436,5307376],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_equal_to_max"},{"line":243,"address":[5307383],"length":1,"stats":{"Line":1},"fn_name":null},{"line":244,"address":[5307539,5307461],"length":1,"stats":{"Line":2},"fn_name":null},{"line":246,"address":[5307707,5307576],"length":1,"stats":{"Line":1},"fn_name":null},{"line":250,"address":[5308139,5308080],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_slightly_more_than_max"},{"line":251,"address":[5308087],"length":1,"stats":{"Line":1},"fn_name":null},{"line":252,"address":[5308164,5308242],"length":1,"stats":{"Line":2},"fn_name":null},{"line":254,"address":[5308279,5308410],"length":1,"stats":{"Line":1},"fn_name":null},{"line":258,"address":[5308844,5308784],"length":1,"stats":{"Line":3},"fn_name":"some_last_price_some_empty_periods_significantly_more_than_max"},{"line":259,"address":[5308791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":260,"address":[5308947,5308869],"length":1,"stats":{"Line":2},"fn_name":null},{"line":262,"address":[5309115,5308984],"length":1,"stats":{"Line":1},"fn_name":null},{"line":266,"address":[5309488,5309545],"length":1,"stats":{"Line":3},"fn_name":"max_periods_is_zero"},{"line":267,"address":[5309498],"length":1,"stats":{"Line":1},"fn_name":null},{"line":268,"address":[5309560],"length":1,"stats":{"Line":1},"fn_name":null},{"line":270,"address":[5309720,5309577],"length":1,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[5310156,5310096],"length":1,"stats":{"Line":3},"fn_name":"max_periods_is_one"},{"line":275,"address":[5310103],"length":1,"stats":{"Line":1},"fn_name":null},{"line":276,"address":[5310232,5310176],"length":1,"stats":{"Line":2},"fn_name":null},{"line":278,"address":[5310400,5310269],"length":1,"stats":{"Line":1},"fn_name":null},{"line":283,"address":[4586005,4586000],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":284,"address":[4586137,4586080],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":285,"address":[4586159,4586094],"length":1,"stats":{"Line":2},"fn_name":null},{"line":286,"address":[4586246,4586051,4586032],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":287,"address":[4586264,4586436],"length":1,"stats":{"Line":2},"fn_name":null},{"line":299,"address":[4586444,4586696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":300,"address":[4586630,4587314,4588467,4587065,4587553,4587279],"length":1,"stats":{"Line":4},"fn_name":null},{"line":301,"address":[4587396,4587558],"length":1,"stats":{"Line":1},"fn_name":null},{"line":307,"address":[4588592,4588597],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":308,"address":[4588672,4588730],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":309,"address":[4588686,4588752],"length":1,"stats":{"Line":2},"fn_name":null},{"line":310,"address":[4588643,4588624,4588839],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":311,"address":[4589029,4588857],"length":1,"stats":{"Line":2},"fn_name":null},{"line":323,"address":[4589289,4589037],"length":1,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[4589658,4589872,4589907,4591060,4590146,4589223],"length":1,"stats":{"Line":4},"fn_name":null},{"line":325,"address":[4590151,4589989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":331,"address":[4591189,4591184],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":332,"address":[4591322,4591264],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":333,"address":[4591278,4591344],"length":1,"stats":{"Line":2},"fn_name":null},{"line":334,"address":[4591235,4591431,4591216],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":335,"address":[4591449,4591615],"length":1,"stats":{"Line":2},"fn_name":null},{"line":347,"address":[4591875,4591623],"length":1,"stats":{"Line":1},"fn_name":null},{"line":348,"address":[4592493,4591809,4592458,4592732,4593646,4592244],"length":1,"stats":{"Line":4},"fn_name":null},{"line":349,"address":[4592737,4592575],"length":1,"stats":{"Line":1},"fn_name":null},{"line":355,"address":[4593765,4593760],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":356,"address":[4593840,4593900],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":357,"address":[4593922,4593852],"length":1,"stats":{"Line":2},"fn_name":null},{"line":358,"address":[4594009,4593811,4593792],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":359,"address":[4594193,4594027],"length":1,"stats":{"Line":2},"fn_name":null},{"line":371,"address":[4594453,4594201],"length":1,"stats":{"Line":1},"fn_name":null},{"line":372,"address":[4594822,4594387,4595310,4595036,4596224,4595071],"length":1,"stats":{"Line":4},"fn_name":null},{"line":373,"address":[4595315,4595153],"length":1,"stats":{"Line":1},"fn_name":null},{"line":379,"address":[4596341,4596336],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":380,"address":[4596552,4596416],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":381,"address":[4596567,4596428],"length":1,"stats":{"Line":2},"fn_name":null},{"line":386,"address":[4596630],"length":1,"stats":{"Line":1},"fn_name":null},{"line":388,"address":[4596667],"length":1,"stats":{"Line":1},"fn_name":null},{"line":389,"address":[4596719],"length":1,"stats":{"Line":1},"fn_name":null},{"line":391,"address":[4596956,4596741,4597584,4597031],"length":1,"stats":{"Line":3},"fn_name":null},{"line":392,"address":[4597107],"length":1,"stats":{"Line":1},"fn_name":null},{"line":394,"address":[4597121,4597354],"length":1,"stats":{"Line":1},"fn_name":null},{"line":396,"address":[4597283,4597476],"length":1,"stats":{"Line":2},"fn_name":null},{"line":397,"address":[4597562],"length":1,"stats":{"Line":1},"fn_name":null},{"line":400,"address":[4597599],"length":1,"stats":{"Line":1},"fn_name":null},{"line":401,"address":[4596387,4597709,4596368],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":402,"address":[4597727,4597899],"length":1,"stats":{"Line":2},"fn_name":null},{"line":414,"address":[4598159,4597907],"length":1,"stats":{"Line":1},"fn_name":null},{"line":415,"address":[4599016,4598093,4598528,4598742,4599984,4598777],"length":1,"stats":{"Line":4},"fn_name":null},{"line":416,"address":[4598859,4599021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":422,"address":[4600144,4600149],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":423,"address":[4600208,4600176],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":424,"address":[4600185],"length":1,"stats":{"Line":1},"fn_name":null},{"line":426,"address":[4600193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":427,"address":[4600225],"length":1,"stats":{"Line":1},"fn_name":null},{"line":429,"address":[4600237],"length":1,"stats":{"Line":1},"fn_name":null},{"line":430,"address":[4600375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":432,"address":[4600392,4600443],"length":1,"stats":{"Line":2},"fn_name":null},{"line":433,"address":[4600480],"length":1,"stats":{"Line":1},"fn_name":null},{"line":435,"address":[4600707,4600499],"length":1,"stats":{"Line":1},"fn_name":null},{"line":436,"address":[4601074,4601187,4600612],"length":1,"stats":{"Line":2},"fn_name":null},{"line":437,"address":[4601523,4601080],"length":1,"stats":{"Line":1},"fn_name":null},{"line":442,"address":[4601957,4601952],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":443,"address":[4602016,4601984],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":444,"address":[4601993],"length":1,"stats":{"Line":1},"fn_name":null},{"line":446,"address":[4602001],"length":1,"stats":{"Line":1},"fn_name":null},{"line":447,"address":[4602033],"length":1,"stats":{"Line":1},"fn_name":null},{"line":449,"address":[4602045],"length":1,"stats":{"Line":1},"fn_name":null},{"line":450,"address":[4602183],"length":1,"stats":{"Line":1},"fn_name":null},{"line":453,"address":[4602323,4602269],"length":1,"stats":{"Line":2},"fn_name":null},{"line":454,"address":[4602360],"length":1,"stats":{"Line":1},"fn_name":null},{"line":456,"address":[4602604,4602396],"length":1,"stats":{"Line":1},"fn_name":null},{"line":457,"address":[4602509,4602971,4603084],"length":1,"stats":{"Line":2},"fn_name":null},{"line":458,"address":[4602977,4603414],"length":1,"stats":{"Line":1},"fn_name":null},{"line":463,"address":[4603840,4603845],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":464,"address":[4603937,4603872],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":465,"address":[4603879],"length":1,"stats":{"Line":1},"fn_name":null},{"line":467,"address":[4603892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":469,"address":[4603954],"length":1,"stats":{"Line":1},"fn_name":null},{"line":470,"address":[4604018],"length":1,"stats":{"Line":1},"fn_name":null},{"line":471,"address":[4604094],"length":1,"stats":{"Line":1},"fn_name":null},{"line":473,"address":[4604134,4604279],"length":1,"stats":{"Line":1},"fn_name":null},{"line":475,"address":[4604253],"length":1,"stats":{"Line":1},"fn_name":null},{"line":476,"address":[4604420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":478,"address":[4604545],"length":1,"stats":{"Line":1},"fn_name":null},{"line":479,"address":[4604695],"length":1,"stats":{"Line":1},"fn_name":null},{"line":481,"address":[4604810,4604756],"length":1,"stats":{"Line":2},"fn_name":null},{"line":482,"address":[4604847],"length":1,"stats":{"Line":1},"fn_name":null},{"line":484,"address":[4604883,4605091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":485,"address":[4604996,4605571,4605458],"length":1,"stats":{"Line":2},"fn_name":null},{"line":486,"address":[4605913,4605464],"length":1,"stats":{"Line":1},"fn_name":null},{"line":491,"address":[4606341,4606336],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":492,"address":[4606433,4606368],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":493,"address":[4606375],"length":1,"stats":{"Line":1},"fn_name":null},{"line":495,"address":[4606388],"length":1,"stats":{"Line":1},"fn_name":null},{"line":497,"address":[4606450],"length":1,"stats":{"Line":1},"fn_name":null},{"line":498,"address":[4606514],"length":1,"stats":{"Line":1},"fn_name":null},{"line":499,"address":[4606590],"length":1,"stats":{"Line":1},"fn_name":null},{"line":501,"address":[4606630,4606808],"length":1,"stats":{"Line":1},"fn_name":null},{"line":503,"address":[4606752],"length":1,"stats":{"Line":1},"fn_name":null},{"line":504,"address":[4606951],"length":1,"stats":{"Line":1},"fn_name":null},{"line":505,"address":[4607027],"length":1,"stats":{"Line":1},"fn_name":null},{"line":507,"address":[4607067],"length":1,"stats":{"Line":1},"fn_name":null},{"line":508,"address":[4607072],"length":1,"stats":{"Line":1},"fn_name":null},{"line":509,"address":[4607138,4607269],"length":1,"stats":{"Line":1},"fn_name":null},{"line":511,"address":[4607251],"length":1,"stats":{"Line":1},"fn_name":null},{"line":512,"address":[4607604],"length":1,"stats":{"Line":1},"fn_name":null},{"line":514,"address":[4607729],"length":1,"stats":{"Line":1},"fn_name":null},{"line":515,"address":[4607879],"length":1,"stats":{"Line":1},"fn_name":null},{"line":517,"address":[4607994,4607940],"length":1,"stats":{"Line":2},"fn_name":null},{"line":518,"address":[4608031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":520,"address":[4608275,4608067],"length":1,"stats":{"Line":1},"fn_name":null},{"line":521,"address":[4608642,4608180,4608755],"length":1,"stats":{"Line":2},"fn_name":null},{"line":522,"address":[4608648,4609091],"length":1,"stats":{"Line":1},"fn_name":null},{"line":527,"address":[4609520,4609525],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":528,"address":[4609552,4609617],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":529,"address":[4609559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":531,"address":[4609572],"length":1,"stats":{"Line":1},"fn_name":null},{"line":533,"address":[4609634],"length":1,"stats":{"Line":1},"fn_name":null},{"line":534,"address":[4609698],"length":1,"stats":{"Line":1},"fn_name":null},{"line":535,"address":[4609774],"length":1,"stats":{"Line":1},"fn_name":null},{"line":537,"address":[4609814,4609992],"length":1,"stats":{"Line":1},"fn_name":null},{"line":539,"address":[4609936],"length":1,"stats":{"Line":1},"fn_name":null},{"line":540,"address":[4610136],"length":1,"stats":{"Line":1},"fn_name":null},{"line":541,"address":[4610212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":543,"address":[4610397,4610252],"length":1,"stats":{"Line":1},"fn_name":null},{"line":545,"address":[4610371],"length":1,"stats":{"Line":1},"fn_name":null},{"line":546,"address":[4610538],"length":1,"stats":{"Line":1},"fn_name":null},{"line":552,"address":[4610663],"length":1,"stats":{"Line":1},"fn_name":null},{"line":553,"address":[4610813],"length":1,"stats":{"Line":1},"fn_name":null},{"line":555,"address":[4610874,4610928],"length":1,"stats":{"Line":2},"fn_name":null},{"line":556,"address":[4610965],"length":1,"stats":{"Line":1},"fn_name":null},{"line":558,"address":[4611001,4611209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":559,"address":[4611689,4611114,4611576],"length":1,"stats":{"Line":2},"fn_name":null},{"line":560,"address":[4612031,4611582],"length":1,"stats":{"Line":1},"fn_name":null},{"line":565,"address":[4612464,4612469],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":566,"address":[4612561,4612496],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":567,"address":[4612503],"length":1,"stats":{"Line":1},"fn_name":null},{"line":569,"address":[4612516],"length":1,"stats":{"Line":1},"fn_name":null},{"line":571,"address":[4612579],"length":1,"stats":{"Line":1},"fn_name":null},{"line":572,"address":[4612655],"length":1,"stats":{"Line":1},"fn_name":null},{"line":574,"address":[4612695,4612888],"length":1,"stats":{"Line":1},"fn_name":null},{"line":576,"address":[4612814],"length":1,"stats":{"Line":1},"fn_name":null},{"line":577,"address":[4613034],"length":1,"stats":{"Line":1},"fn_name":null},{"line":578,"address":[4613080],"length":1,"stats":{"Line":1},"fn_name":null},{"line":579,"address":[4613156],"length":1,"stats":{"Line":1},"fn_name":null},{"line":581,"address":[4613196,4613341],"length":1,"stats":{"Line":1},"fn_name":null},{"line":583,"address":[4613315],"length":1,"stats":{"Line":1},"fn_name":null},{"line":584,"address":[4613482],"length":1,"stats":{"Line":1},"fn_name":null},{"line":590,"address":[4613607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":591,"address":[4613757],"length":1,"stats":{"Line":1},"fn_name":null},{"line":593,"address":[4613896,4613842],"length":1,"stats":{"Line":2},"fn_name":null},{"line":594,"address":[4613933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":596,"address":[4613969,4614177],"length":1,"stats":{"Line":1},"fn_name":null},{"line":597,"address":[4614544,4614082,4614657],"length":1,"stats":{"Line":2},"fn_name":null},{"line":598,"address":[4614550,4614999],"length":1,"stats":{"Line":1},"fn_name":null},{"line":603,"address":[4615424,4615429],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":604,"address":[4615521,4615456],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":605,"address":[4615463],"length":1,"stats":{"Line":1},"fn_name":null},{"line":607,"address":[4615476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":609,"address":[4615539],"length":1,"stats":{"Line":1},"fn_name":null},{"line":610,"address":[4615615],"length":1,"stats":{"Line":1},"fn_name":null},{"line":612,"address":[4615848,4615655],"length":1,"stats":{"Line":1},"fn_name":null},{"line":614,"address":[4615774],"length":1,"stats":{"Line":1},"fn_name":null},{"line":615,"address":[4615994],"length":1,"stats":{"Line":1},"fn_name":null},{"line":616,"address":[4616040],"length":1,"stats":{"Line":1},"fn_name":null},{"line":617,"address":[4616116],"length":1,"stats":{"Line":1},"fn_name":null},{"line":619,"address":[4616156,4616301],"length":1,"stats":{"Line":1},"fn_name":null},{"line":621,"address":[4616275],"length":1,"stats":{"Line":1},"fn_name":null},{"line":622,"address":[4616442],"length":1,"stats":{"Line":1},"fn_name":null},{"line":628,"address":[4616567],"length":1,"stats":{"Line":1},"fn_name":null},{"line":629,"address":[4616717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":637,"address":[4616880,4616826],"length":1,"stats":{"Line":2},"fn_name":null},{"line":638,"address":[4616917],"length":1,"stats":{"Line":1},"fn_name":null},{"line":640,"address":[4617161,4616953],"length":1,"stats":{"Line":1},"fn_name":null},{"line":641,"address":[4617528,4617641,4617066],"length":1,"stats":{"Line":2},"fn_name":null},{"line":642,"address":[4617534,4617983],"length":1,"stats":{"Line":1},"fn_name":null},{"line":647,"address":[4618421,4618416],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":648,"address":[4618513,4618448],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":649,"address":[4618455],"length":1,"stats":{"Line":1},"fn_name":null},{"line":651,"address":[4618468],"length":1,"stats":{"Line":1},"fn_name":null},{"line":653,"address":[4618531],"length":1,"stats":{"Line":1},"fn_name":null},{"line":654,"address":[4618607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":656,"address":[4618840,4618647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":658,"address":[4618766],"length":1,"stats":{"Line":1},"fn_name":null},{"line":659,"address":[4618986],"length":1,"stats":{"Line":1},"fn_name":null},{"line":660,"address":[4619032],"length":1,"stats":{"Line":1},"fn_name":null},{"line":661,"address":[4619108],"length":1,"stats":{"Line":1},"fn_name":null},{"line":663,"address":[4619293,4619148],"length":1,"stats":{"Line":1},"fn_name":null},{"line":665,"address":[4619267],"length":1,"stats":{"Line":1},"fn_name":null},{"line":666,"address":[4619434],"length":1,"stats":{"Line":1},"fn_name":null},{"line":672,"address":[4619559],"length":1,"stats":{"Line":1},"fn_name":null},{"line":673,"address":[4621363,4619699],"length":1,"stats":{"Line":1},"fn_name":null},{"line":674,"address":[4619816],"length":1,"stats":{"Line":1},"fn_name":null},{"line":676,"address":[4619866,4619833],"length":1,"stats":{"Line":2},"fn_name":null},{"line":677,"address":[4619924],"length":1,"stats":{"Line":1},"fn_name":null},{"line":679,"address":[4620168,4619960],"length":1,"stats":{"Line":1},"fn_name":null},{"line":680,"address":[4620535,4620648,4620073],"length":1,"stats":{"Line":2},"fn_name":null},{"line":681,"address":[4620541,4620984],"length":1,"stats":{"Line":1},"fn_name":null},{"line":686,"address":[4621445,4621440],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":687,"address":[4621472,4621537],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":688,"address":[4621479],"length":1,"stats":{"Line":1},"fn_name":null},{"line":690,"address":[4621492],"length":1,"stats":{"Line":1},"fn_name":null},{"line":692,"address":[4621554],"length":1,"stats":{"Line":1},"fn_name":null},{"line":693,"address":[4621618],"length":1,"stats":{"Line":1},"fn_name":null},{"line":694,"address":[4621694],"length":1,"stats":{"Line":1},"fn_name":null},{"line":696,"address":[4621912,4621734],"length":1,"stats":{"Line":1},"fn_name":null},{"line":698,"address":[4621856],"length":1,"stats":{"Line":1},"fn_name":null},{"line":699,"address":[4622053],"length":1,"stats":{"Line":1},"fn_name":null},{"line":700,"address":[4622110],"length":1,"stats":{"Line":1},"fn_name":null},{"line":702,"address":[4622150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":703,"address":[4622155],"length":1,"stats":{"Line":1},"fn_name":null},{"line":704,"address":[4622221,4622352],"length":1,"stats":{"Line":1},"fn_name":null},{"line":706,"address":[4622334],"length":1,"stats":{"Line":1},"fn_name":null},{"line":707,"address":[4622687],"length":1,"stats":{"Line":1},"fn_name":null},{"line":713,"address":[4622812],"length":1,"stats":{"Line":1},"fn_name":null},{"line":714,"address":[4622962],"length":1,"stats":{"Line":1},"fn_name":null},{"line":716,"address":[4623023,4623077],"length":1,"stats":{"Line":2},"fn_name":null},{"line":717,"address":[4623114],"length":1,"stats":{"Line":1},"fn_name":null},{"line":719,"address":[4623358,4623150],"length":1,"stats":{"Line":1},"fn_name":null},{"line":720,"address":[4623838,4623725,4623263],"length":1,"stats":{"Line":2},"fn_name":null},{"line":721,"address":[4624174,4623731],"length":1,"stats":{"Line":1},"fn_name":null},{"line":726,"address":[4624608,4624613],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":727,"address":[4624640,4624765],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":728,"address":[4624647],"length":1,"stats":{"Line":1},"fn_name":null},{"line":730,"address":[4624780,4624655],"length":1,"stats":{"Line":2},"fn_name":null},{"line":734,"address":[4624872],"length":1,"stats":{"Line":1},"fn_name":null},{"line":735,"address":[4624924],"length":1,"stats":{"Line":1},"fn_name":null},{"line":737,"address":[4625222,4625761,4624972],"length":1,"stats":{"Line":2},"fn_name":null},{"line":738,"address":[4625281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":740,"address":[4625531,4625298],"length":1,"stats":{"Line":1},"fn_name":null},{"line":742,"address":[4625460,4625653],"length":1,"stats":{"Line":2},"fn_name":null},{"line":743,"address":[4625739],"length":1,"stats":{"Line":1},"fn_name":null},{"line":746,"address":[4625191,4625789],"length":1,"stats":{"Line":2},"fn_name":null},{"line":747,"address":[4625831],"length":1,"stats":{"Line":1},"fn_name":null},{"line":749,"address":[4625896,4626049],"length":1,"stats":{"Line":1},"fn_name":null},{"line":751,"address":[4626031],"length":1,"stats":{"Line":1},"fn_name":null},{"line":752,"address":[4626187],"length":1,"stats":{"Line":1},"fn_name":null},{"line":754,"address":[4626171],"length":1,"stats":{"Line":1},"fn_name":null},{"line":758,"address":[4626316],"length":1,"stats":{"Line":1},"fn_name":null},{"line":759,"address":[4626443],"length":1,"stats":{"Line":1},"fn_name":null},{"line":760,"address":[4626619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":762,"address":[4626669,4626636],"length":1,"stats":{"Line":2},"fn_name":null},{"line":763,"address":[4626727],"length":1,"stats":{"Line":1},"fn_name":null},{"line":765,"address":[4626763,4626971],"length":1,"stats":{"Line":1},"fn_name":null},{"line":766,"address":[4626876,4627451,4627338],"length":1,"stats":{"Line":2},"fn_name":null},{"line":767,"address":[4627344,4627787],"length":1,"stats":{"Line":1},"fn_name":null},{"line":771,"address":[4920944],"length":1,"stats":{"Line":2},"fn_name":"btc_prices"},{"line":772,"address":[4920954],"length":1,"stats":{"Line":2},"fn_name":null},{"line":778,"address":[4628256,4628261],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":779,"address":[4923772],"length":1,"stats":{"Line":1},"fn_name":null},{"line":780,"address":[4923780],"length":1,"stats":{"Line":1},"fn_name":null},{"line":781,"address":[4923791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":783,"address":[4923821],"length":1,"stats":{"Line":1},"fn_name":null},{"line":784,"address":[4923948,4924181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":785,"address":[4924100,4924319],"length":1,"stats":{"Line":2},"fn_name":null},{"line":787,"address":[4924363],"length":1,"stats":{"Line":1},"fn_name":null},{"line":789,"address":[4924554,4924379],"length":1,"stats":{"Line":1},"fn_name":null},{"line":792,"address":[4921696],"length":1,"stats":{"Line":2},"fn_name":"eos_prices"},{"line":793,"address":[4921706],"length":1,"stats":{"Line":2},"fn_name":null},{"line":799,"address":[4628288,4628293],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":800,"address":[4925420],"length":1,"stats":{"Line":1},"fn_name":null},{"line":801,"address":[4925428],"length":1,"stats":{"Line":1},"fn_name":null},{"line":802,"address":[4925439],"length":1,"stats":{"Line":1},"fn_name":null},{"line":804,"address":[4925469],"length":1,"stats":{"Line":1},"fn_name":null},{"line":805,"address":[4925829,4925596],"length":1,"stats":{"Line":1},"fn_name":null},{"line":806,"address":[4925748,4925967],"length":1,"stats":{"Line":2},"fn_name":null},{"line":808,"address":[4926011],"length":1,"stats":{"Line":1},"fn_name":null},{"line":810,"address":[4926027,4926202],"length":1,"stats":{"Line":1},"fn_name":null},{"line":814,"address":[4628320,4628325],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":815,"address":[4927068],"length":1,"stats":{"Line":1},"fn_name":null},{"line":816,"address":[4927076],"length":1,"stats":{"Line":1},"fn_name":null},{"line":817,"address":[4927087],"length":1,"stats":{"Line":1},"fn_name":null},{"line":818,"address":[4927125],"length":1,"stats":{"Line":1},"fn_name":null},{"line":820,"address":[4927246,4927284,4927132],"length":1,"stats":{"Line":3},"fn_name":null},{"line":821,"address":[4927607,4927374],"length":1,"stats":{"Line":1},"fn_name":null},{"line":822,"address":[4927745,4927526],"length":1,"stats":{"Line":2},"fn_name":null},{"line":824,"address":[4927789],"length":1,"stats":{"Line":1},"fn_name":null},{"line":826,"address":[4927805,4927980],"length":1,"stats":{"Line":1},"fn_name":null},{"line":830,"address":[4628352,4628357],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":831,"address":[4928892],"length":1,"stats":{"Line":1},"fn_name":null},{"line":832,"address":[4928900],"length":1,"stats":{"Line":1},"fn_name":null},{"line":833,"address":[4928922],"length":1,"stats":{"Line":1},"fn_name":null},{"line":835,"address":[4928952],"length":1,"stats":{"Line":1},"fn_name":null},{"line":836,"address":[4929079,4929312],"length":1,"stats":{"Line":1},"fn_name":null},{"line":837,"address":[4929450,4929231],"length":1,"stats":{"Line":2},"fn_name":null},{"line":839,"address":[4929494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":841,"address":[4929685,4929510],"length":1,"stats":{"Line":1},"fn_name":null},{"line":845,"address":[4628384,4628389],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":846,"address":[4930556],"length":1,"stats":{"Line":1},"fn_name":null},{"line":847,"address":[4930564],"length":1,"stats":{"Line":1},"fn_name":null},{"line":848,"address":[4930586],"length":1,"stats":{"Line":1},"fn_name":null},{"line":849,"address":[4930624],"length":1,"stats":{"Line":1},"fn_name":null},{"line":851,"address":[4930783,4930631,4930745],"length":1,"stats":{"Line":3},"fn_name":null},{"line":852,"address":[4930873,4931106],"length":1,"stats":{"Line":1},"fn_name":null},{"line":853,"address":[4931244,4931025],"length":1,"stats":{"Line":2},"fn_name":null},{"line":855,"address":[4931288],"length":1,"stats":{"Line":1},"fn_name":null},{"line":857,"address":[4931304,4931479],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":422,"coverable":422},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse financial_primitives::OnPriceSet;\nuse frame_support::{decl_error, decl_event, decl_module, decl_storage, dispatch, traits::Get};\nuse frame_system::ensure_signed;\nuse frame_support::codec::Codec;\nuse frame_support::dispatch::Parameter;\n\n#[cfg(test)]\nmod mock;\n\n#[cfg(test)]\nmod tests;\n\npub trait Trait: frame_system::Trait {\n\ttype Event: From\u003cEvent\u003cSelf\u003e\u003e + Into\u003c\u003cSelf as frame_system::Trait\u003e::Event\u003e;\n\ttype Asset: Codec + Parameter + Default + Copy;\n\ttype Price: Codec + Parameter + Default + Copy;\n\ttype OnPriceSet: OnPriceSet\u003cPrice = Self::Price, Asset = Self::Asset\u003e;\n}\n\ndecl_storage! {\n\ttrait Store for Module\u003cT: Trait\u003e as OracleModule {\n\t\tPricePoints get(fn price_points): map hasher(identity) T::Asset =\u003e T::Price;\n\t}\n\tadd_extra_genesis {\n\t\tconfig(prices): Vec\u003c(T::Asset, T::Price)\u003e;\n\n        build(|config| {\n            for \u0026(asset, value) in config.prices.iter() {\n                PricePoints::\u003cT\u003e::insert(asset, value);\n            }\n        });\n    }\n}\n\ndecl_event!(\n\tpub enum Event\u003cT\u003e\n\twhere\n\t\tAccountId = \u003cT as frame_system::Trait\u003e::AccountId,\n\t\tAsset = \u003cT as Trait\u003e::Asset,\n\t\tPrice = \u003cT as Trait\u003e::Price,\n\t{\n\t\tPriceSet(Asset, Price, AccountId),\n\t}\n);\n\ndecl_error! {\n    pub enum Error for Module\u003cT: Trait\u003e {}\n}\n\ndecl_module! {\n    pub struct Module\u003cT: Trait\u003e for enum Call where origin: T::Origin {\n        type Error = Error\u003cT\u003e;\n\n        fn deposit_event() = default;\n\n\t\t#[weight = 10_000 + T::DbWeight::get().writes(1)]\n\t\tpub fn set_price(origin, asset: T::Asset, value: T::Price) -\u003e dispatch::DispatchResult {\n\t\t\tlet who = ensure_signed(origin)?;\n\n\t\t\tPricePoints::\u003cT\u003e::insert(asset, value);\n\n\t\t\tlet _ = T::OnPriceSet::on_price_set(asset, value);\n\t\t\tSelf::deposit_event(RawEvent::PriceSet(asset, value, who));\n\t\t\tOk(())\n\t\t}\n\t}\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","mock.rs"],"content":"use crate::{Module, Trait};\nuse sp_core::H256;\nuse frame_support::{impl_outer_origin, parameter_types, weights::Weight};\nuse sp_runtime::{\n\ttraits::{BlakeTwo256, IdentityLookup}, testing::Header, Perbill,\n};\nuse frame_system as system;\nuse common::Asset;\nuse financial_primitives::OnPriceSet;\nuse frame_support::dispatch::DispatchError;\n\nimpl_outer_origin! {\n\tpub enum Origin for Test {}\n}\n\n// Configure a mock runtime to test the pallet.\n\n#[derive(Clone, Eq, PartialEq)]\npub struct Test;\nparameter_types! {\n\tpub const BlockHashCount: u64 = 250;\n\tpub const MaximumBlockWeight: Weight = 1024;\n\tpub const MaximumBlockLength: u32 = 2 * 1024;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n}\n\nimpl system::Trait for Test {\n\ttype BaseCallFilter = ();\n\ttype Origin = Origin;\n\ttype Call = ();\n\ttype Index = u64;\n\ttype BlockNumber = u64;\n\ttype Hash = H256;\n\ttype Hashing = BlakeTwo256;\n\ttype AccountId = u64;\n\ttype Lookup = IdentityLookup\u003cSelf::AccountId\u003e;\n\ttype Header = Header;\n\ttype Event = ();\n\ttype BlockHashCount = BlockHashCount;\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\ttype DbWeight = ();\n\ttype BlockExecutionWeight = ();\n\ttype ExtrinsicBaseWeight = ();\n\ttype MaximumExtrinsicWeight = MaximumBlockWeight;\n\ttype MaximumBlockLength = MaximumBlockLength;\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\ttype Version = ();\n\ttype ModuleToIndex = ();\n\ttype AccountData = ();\n\ttype OnNewAccount = ();\n\ttype OnKilledAccount = ();\n\ttype SystemWeightInfo = ();\n}\n\nimpl Trait for Test {\n\ttype Event = ();\n\ttype Asset = Asset;\n\ttype Price = u32;\n\ttype OnPriceSet = TestOnPriceSet;\n}\n\npub struct TestOnPriceSet;\n\nimpl OnPriceSet for TestOnPriceSet {\n\ttype Asset = Asset;\n\ttype Price = u32;\n\tfn on_price_set(_asset: Asset, _value: u32) -\u003e Result\u003c(), DispatchError\u003e {\n\t\tOk(())\n\t}\n}\n\npub type OracleModule = Module\u003cTest\u003e;\n\n// Build genesis storage according to the mock runtime.\npub fn new_test_ext() -\u003e sp_io::TestExternalities {\n\tsystem::GenesisConfig::default().build_storage::\u003cTest\u003e().unwrap().into()\n}\n","traces":[{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":2},{"path":["/","home","rotor","work","src","polka","financial-pallet","pallets","oracle","src","tests.rs"],"content":"use crate::mock::*;\nuse frame_support::{assert_ok};\nuse common::Asset;\n\n#[test]\nfn set_price_is_visible_through_storage() {\n\tnew_test_ext().execute_with(|| {\n\t\tassert_ok!(OracleModule::set_price(Origin::signed(1), Asset::Btc, 42));\n\t\tassert_eq!(OracleModule::price_points(Asset::Btc), 42);\n\t});\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","runtime","build.rs"],"content":"use wasm_builder_runner::WasmBuilder;\n\nfn main() {\n\tWasmBuilder::new()\n\t\t.with_current_project()\n\t\t.with_wasm_builder_from_crates(\"2.0.0\")\n\t\t.export_heap_base()\n\t\t.import_memory()\n\t\t.build()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","rotor","work","src","polka","financial-pallet","runtime","src","lib.rs"],"content":"#![cfg_attr(not(feature = \"std\"), no_std)]\n// `construct_runtime!` does a lot of recursion and requires us to increase the limit to 256.\n#![recursion_limit=\"256\"]\n\n// Make the WASM binary available.\n#[cfg(feature = \"std\")]\ninclude!(concat!(env!(\"OUT_DIR\"), \"/wasm_binary.rs\"));\n\nuse sp_std::prelude::*;\nuse sp_core::{crypto::KeyTypeId, OpaqueMetadata};\nuse sp_runtime::{\n\tApplyExtrinsicResult, generic, create_runtime_str, impl_opaque_keys, MultiSignature,\n\ttransaction_validity::{TransactionValidity, TransactionSource},\n};\nuse sp_runtime::traits::{\n\tBlakeTwo256, Block as BlockT, IdentityLookup, Verify, IdentifyAccount, NumberFor, Saturating,\n};\nuse sp_api::impl_runtime_apis;\nuse sp_consensus_aura::sr25519::AuthorityId as AuraId;\nuse pallet_grandpa::{AuthorityId as GrandpaId, AuthorityList as GrandpaAuthorityList};\nuse pallet_grandpa::fg_primitives;\nuse sp_version::RuntimeVersion;\n#[cfg(feature = \"std\")]\nuse sp_version::NativeVersion;\nuse common::Asset;\n\n// A few exports that help ease life for downstream crates.\n#[cfg(any(feature = \"std\", test))]\npub use sp_runtime::BuildStorage;\npub use pallet_timestamp::Call as TimestampCall;\npub use pallet_balances::Call as BalancesCall;\npub use sp_runtime::{Permill, Perbill};\npub use frame_support::{\n\tconstruct_runtime, parameter_types, StorageValue,\n\ttraits::{KeyOwnerProofSystem, Randomness},\n\tweights::{\n\t\tWeight, IdentityFee,\n\t\tconstants::{BlockExecutionWeight, ExtrinsicBaseWeight, RocksDbWeight, WEIGHT_PER_SECOND},\n\t},\n};\n\n/// Import the financial pallet.\npub use financial_pallet;\n\n/// Import the oracle pallet.\npub use oracle;\n\n/// An index to a block.\npub type BlockNumber = u32;\n\n/// Alias to 512-bit hash when used in the context of a transaction signature on the chain.\npub type Signature = MultiSignature;\n\n/// Some way of identifying an account on the chain. We intentionally make it equivalent\n/// to the public key of our transaction signing scheme.\npub type AccountId = \u003c\u003cSignature as Verify\u003e::Signer as IdentifyAccount\u003e::AccountId;\n\n/// The type for looking up accounts. We don't expect more than 4 billion of them, but you\n/// never know...\npub type AccountIndex = u32;\n\n/// Balance of an account.\npub type Balance = u128;\n\n/// Index of a transaction in the chain.\npub type Index = u32;\n\n/// A hash of some data used by the chain.\npub type Hash = sp_core::H256;\n\n/// Digest item type.\npub type DigestItem = generic::DigestItem\u003cHash\u003e;\n\n/// Opaque types. These are used by the CLI to instantiate machinery that don't need to know\n/// the specifics of the runtime. They can then be made to be agnostic over specific formats\n/// of data like extrinsics, allowing for them to continue syncing the network through upgrades\n/// to even the core data structures.\npub mod opaque {\n\tuse super::*;\n\n\tpub use sp_runtime::OpaqueExtrinsic as UncheckedExtrinsic;\n\n\t/// Opaque block header type.\n\tpub type Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n\t/// Opaque block type.\n\tpub type Block = generic::Block\u003cHeader, UncheckedExtrinsic\u003e;\n\t/// Opaque block identifier type.\n\tpub type BlockId = generic::BlockId\u003cBlock\u003e;\n\n\timpl_opaque_keys! {\n\t\tpub struct SessionKeys {\n\t\t\tpub aura: Aura,\n\t\t\tpub grandpa: Grandpa,\n\t\t}\n\t}\n}\n\npub const VERSION: RuntimeVersion = RuntimeVersion {\n\tspec_name: create_runtime_str!(\"node-template\"),\n\timpl_name: create_runtime_str!(\"node-template\"),\n\tauthoring_version: 1,\n\tspec_version: 1,\n\timpl_version: 1,\n\tapis: RUNTIME_API_VERSIONS,\n\ttransaction_version: 1,\n};\n\npub const MILLISECS_PER_BLOCK: u64 = 6000;\n\npub const SLOT_DURATION: u64 = MILLISECS_PER_BLOCK;\n\n// Time is measured by number of blocks.\npub const MINUTES: BlockNumber = 60_000 / (MILLISECS_PER_BLOCK as BlockNumber);\npub const HOURS: BlockNumber = MINUTES * 60;\npub const DAYS: BlockNumber = HOURS * 24;\n\n/// The version information used to identify this runtime when compiled natively.\n#[cfg(feature = \"std\")]\npub fn native_version() -\u003e NativeVersion {\n\tNativeVersion {\n\t\truntime_version: VERSION,\n\t\tcan_author_with: Default::default(),\n\t}\n}\n\nparameter_types! {\n\tpub const BlockHashCount: BlockNumber = 2400;\n\t/// We allow for 2 seconds of compute with a 6 second average block time.\n\tpub const MaximumBlockWeight: Weight = 2 * WEIGHT_PER_SECOND;\n\tpub const AvailableBlockRatio: Perbill = Perbill::from_percent(75);\n\t/// Assume 10% of weight for average on_initialize calls.\n\tpub MaximumExtrinsicWeight: Weight = AvailableBlockRatio::get()\n\t\t.saturating_sub(Perbill::from_percent(10)) * MaximumBlockWeight::get();\n\tpub const MaximumBlockLength: u32 = 5 * 1024 * 1024;\n\tpub const Version: RuntimeVersion = VERSION;\n}\n\n// Configure FRAME pallets to include in runtime.\n\nimpl frame_system::Trait for Runtime {\n\t/// The basic call filter to use in dispatchable.\n\ttype BaseCallFilter = ();\n\t/// The identifier used to distinguish between accounts.\n\ttype AccountId = AccountId;\n\t/// The aggregated dispatch type that is available for extrinsics.\n\ttype Call = Call;\n\t/// The lookup mechanism to get account ID from whatever is passed in dispatchers.\n\ttype Lookup = IdentityLookup\u003cAccountId\u003e;\n\t/// The index type for storing how many extrinsics an account has signed.\n\ttype Index = Index;\n\t/// The index type for blocks.\n\ttype BlockNumber = BlockNumber;\n\t/// The type for hashing blocks and tries.\n\ttype Hash = Hash;\n\t/// The hashing algorithm used.\n\ttype Hashing = BlakeTwo256;\n\t/// The header type.\n\ttype Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n\t/// The ubiquitous event type.\n\ttype Event = Event;\n\t/// The ubiquitous origin type.\n\ttype Origin = Origin;\n\t/// Maximum number of block number to block hash mappings to keep (oldest pruned first).\n\ttype BlockHashCount = BlockHashCount;\n\t/// Maximum weight of each block.\n\ttype MaximumBlockWeight = MaximumBlockWeight;\n\t/// The weight of database operations that the runtime can invoke.\n\ttype DbWeight = RocksDbWeight;\n\t/// The weight of the overhead invoked on the block import process, independent of the\n\t/// extrinsics included in that block.\n\ttype BlockExecutionWeight = BlockExecutionWeight;\n\t/// The base weight of any extrinsic processed by the runtime, independent of the\n\t/// logic of that extrinsic. (Signature verification, nonce increment, fee, etc...)\n\ttype ExtrinsicBaseWeight = ExtrinsicBaseWeight;\n\t/// The maximum weight that a single extrinsic of `Normal` dispatch class can have,\n\t/// idependent of the logic of that extrinsics. (Roughly max block weight - average on\n\t/// initialize cost).\n\ttype MaximumExtrinsicWeight = MaximumExtrinsicWeight;\n\t/// Maximum size of all encoded transactions (in bytes) that are allowed in one block.\n\ttype MaximumBlockLength = MaximumBlockLength;\n\t/// Portion of the block weight that is available to all normal transactions.\n\ttype AvailableBlockRatio = AvailableBlockRatio;\n\t/// Version of the runtime.\n\ttype Version = Version;\n\t/// Converts a module to the index of the module in `construct_runtime!`.\n\t///\n\t/// This type is being generated by `construct_runtime!`.\n\ttype ModuleToIndex = ModuleToIndex;\n\t/// What to do if a new account is created.\n\ttype OnNewAccount = ();\n\t/// What to do if an account is fully reaped from the system.\n\ttype OnKilledAccount = ();\n\t/// The data to be stored in an account.\n\ttype AccountData = pallet_balances::AccountData\u003cBalance\u003e;\n\t/// Weight information for the extrinsics of this pallet.\n\ttype SystemWeightInfo = ();\n}\n\nimpl pallet_aura::Trait for Runtime {\n\ttype AuthorityId = AuraId;\n}\n\nimpl pallet_grandpa::Trait for Runtime {\n\ttype Event = Event;\n\ttype Call = Call;\n\n\ttype KeyOwnerProofSystem = ();\n\n\ttype KeyOwnerProof =\n\t\t\u003cSelf::KeyOwnerProofSystem as KeyOwnerProofSystem\u003c(KeyTypeId, GrandpaId)\u003e\u003e::Proof;\n\n\ttype KeyOwnerIdentification = \u003cSelf::KeyOwnerProofSystem as KeyOwnerProofSystem\u003c(\n\t\tKeyTypeId,\n\t\tGrandpaId,\n\t)\u003e\u003e::IdentificationTuple;\n\n\ttype HandleEquivocation = ();\n}\n\nparameter_types! {\n\tpub const MinimumPeriod: u64 = SLOT_DURATION / 2;\n}\n\nimpl pallet_timestamp::Trait for Runtime {\n\t/// A timestamp: milliseconds since the unix epoch.\n\ttype Moment = u64;\n\ttype OnTimestampSet = Aura;\n\ttype MinimumPeriod = MinimumPeriod;\n\ttype WeightInfo = ();\n}\n\nparameter_types! {\n\tpub const ExistentialDeposit: u128 = 500;\n}\n\nimpl pallet_balances::Trait for Runtime {\n\t/// The type for recording an account's balance.\n\ttype Balance = Balance;\n\t/// The ubiquitous event type.\n\ttype Event = Event;\n\ttype DustRemoval = ();\n\ttype ExistentialDeposit = ExistentialDeposit;\n\ttype AccountStore = System;\n\ttype WeightInfo = ();\n}\n\nparameter_types! {\n\tpub const TransactionByteFee: Balance = 1;\n}\n\nimpl pallet_transaction_payment::Trait for Runtime {\n\ttype Currency = Balances;\n\ttype OnTransactionPayment = ();\n\ttype TransactionByteFee = TransactionByteFee;\n\ttype WeightToFee = IdentityFee\u003cBalance\u003e;\n\ttype FeeMultiplierUpdate = ();\n}\n\nimpl pallet_sudo::Trait for Runtime {\n\ttype Event = Event;\n\ttype Call = Call;\n}\n\nparameter_types! {\n\tpub const PriceCount: u32 = 30;\n\tpub const PricePeriod: u32 = 1440;\n}\n\npub type FixedNumber = substrate_fixed::types::I64F64;\n\n/// Configure the pallet financial in pallets/financial.\nimpl financial_pallet::Trait for Runtime {\n\ttype Event = Event;\n\ttype UnixTime = pallet_timestamp::Module\u003cRuntime\u003e;\n\ttype PriceCount = PriceCount;\n\ttype PricePeriod = PricePeriod;\n\ttype FixedNumberBits = i128;\n\ttype FixedNumber = FixedNumber;\n\ttype Price = FixedNumber;\n\ttype Asset = Asset;\n}\n\n/// Configure the pallet oracle in pallets/oracle.\nimpl oracle::Trait for Runtime {\n\ttype Event = Event;\n\ttype Price = FixedNumber;\n\ttype OnPriceSet = financial_pallet::Module\u003cRuntime\u003e;\n\ttype Asset = Asset;\n}\n\n// Create the runtime by composing the FRAME pallets that were previously configured.\nconstruct_runtime!(\n\tpub enum Runtime where\n\t\tBlock = Block,\n\t\tNodeBlock = opaque::Block,\n\t\tUncheckedExtrinsic = UncheckedExtrinsic\n\t{\n\t\tSystem: frame_system::{Module, Call, Config, Storage, Event\u003cT\u003e},\n\t\tRandomnessCollectiveFlip: pallet_randomness_collective_flip::{Module, Call, Storage},\n\t\tTimestamp: pallet_timestamp::{Module, Call, Storage, Inherent},\n\t\tAura: pallet_aura::{Module, Config\u003cT\u003e, Inherent},\n\t\tGrandpa: pallet_grandpa::{Module, Call, Storage, Config, Event},\n\t\tBalances: pallet_balances::{Module, Call, Storage, Config\u003cT\u003e, Event\u003cT\u003e},\n\t\tTransactionPayment: pallet_transaction_payment::{Module, Storage},\n\t\tSudo: pallet_sudo::{Module, Call, Config\u003cT\u003e, Storage, Event\u003cT\u003e},\n\n\t\tFinancial: financial_pallet::{Module, Call, Storage, Event\u003cT\u003e, Config\u003cT\u003e},\n\t\tOracle: oracle::{Module, Call, Storage, Event\u003cT\u003e, Config\u003cT\u003e},\n\t}\n);\n\n/// The address format for describing accounts.\npub type Address = AccountId;\n/// Block header type as expected by this runtime.\npub type Header = generic::Header\u003cBlockNumber, BlakeTwo256\u003e;\n/// Block type as expected by this runtime.\npub type Block = generic::Block\u003cHeader, UncheckedExtrinsic\u003e;\n/// A Block signed with a Justification\npub type SignedBlock = generic::SignedBlock\u003cBlock\u003e;\n/// BlockId type as expected by this runtime.\npub type BlockId = generic::BlockId\u003cBlock\u003e;\n/// The SignedExtension to the basic transaction logic.\npub type SignedExtra = (\n\tframe_system::CheckSpecVersion\u003cRuntime\u003e,\n\tframe_system::CheckTxVersion\u003cRuntime\u003e,\n\tframe_system::CheckGenesis\u003cRuntime\u003e,\n\tframe_system::CheckEra\u003cRuntime\u003e,\n\tframe_system::CheckNonce\u003cRuntime\u003e,\n\tframe_system::CheckWeight\u003cRuntime\u003e,\n\tpallet_transaction_payment::ChargeTransactionPayment\u003cRuntime\u003e\n);\n/// Unchecked extrinsic type as expected by this runtime.\npub type UncheckedExtrinsic = generic::UncheckedExtrinsic\u003cAddress, Call, Signature, SignedExtra\u003e;\n/// Extrinsic type that has already been checked.\npub type CheckedExtrinsic = generic::CheckedExtrinsic\u003cAccountId, Call, SignedExtra\u003e;\n/// Executive: handles dispatch to the various modules.\npub type Executive = frame_executive::Executive\u003c\n\tRuntime,\n\tBlock,\n\tframe_system::ChainContext\u003cRuntime\u003e,\n\tRuntime,\n\tAllModules,\n\u003e;\n\nimpl_runtime_apis! {\n\timpl sp_api::Core\u003cBlock\u003e for Runtime {\n\t\tfn version() -\u003e RuntimeVersion {\n\t\t\tVERSION\n\t\t}\n\n\t\tfn execute_block(block: Block) {\n\t\t\tExecutive::execute_block(block)\n\t\t}\n\n\t\tfn initialize_block(header: \u0026\u003cBlock as BlockT\u003e::Header) {\n\t\t\tExecutive::initialize_block(header)\n\t\t}\n\t}\n\n\timpl sp_api::Metadata\u003cBlock\u003e for Runtime {\n\t\tfn metadata() -\u003e OpaqueMetadata {\n\t\t\tRuntime::metadata().into()\n\t\t}\n\t}\n\n\timpl sp_block_builder::BlockBuilder\u003cBlock\u003e for Runtime {\n\t\tfn apply_extrinsic(extrinsic: \u003cBlock as BlockT\u003e::Extrinsic) -\u003e ApplyExtrinsicResult {\n\t\t\tExecutive::apply_extrinsic(extrinsic)\n\t\t}\n\n\t\tfn finalize_block() -\u003e \u003cBlock as BlockT\u003e::Header {\n\t\t\tExecutive::finalize_block()\n\t\t}\n\n\t\tfn inherent_extrinsics(data: sp_inherents::InherentData) -\u003e Vec\u003c\u003cBlock as BlockT\u003e::Extrinsic\u003e {\n\t\t\tdata.create_extrinsics()\n\t\t}\n\n\t\tfn check_inherents(\n\t\t\tblock: Block,\n\t\t\tdata: sp_inherents::InherentData,\n\t\t) -\u003e sp_inherents::CheckInherentsResult {\n\t\t\tdata.check_extrinsics(\u0026block)\n\t\t}\n\n\t\tfn random_seed() -\u003e \u003cBlock as BlockT\u003e::Hash {\n\t\t\tRandomnessCollectiveFlip::random_seed()\n\t\t}\n\t}\n\n\timpl sp_transaction_pool::runtime_api::TaggedTransactionQueue\u003cBlock\u003e for Runtime {\n\t\tfn validate_transaction(\n\t\t\tsource: TransactionSource,\n\t\t\ttx: \u003cBlock as BlockT\u003e::Extrinsic,\n\t\t) -\u003e TransactionValidity {\n\t\t\tExecutive::validate_transaction(source, tx)\n\t\t}\n\t}\n\n\timpl sp_offchain::OffchainWorkerApi\u003cBlock\u003e for Runtime {\n\t\tfn offchain_worker(header: \u0026\u003cBlock as BlockT\u003e::Header) {\n\t\t\tExecutive::offchain_worker(header)\n\t\t}\n\t}\n\n\timpl sp_consensus_aura::AuraApi\u003cBlock, AuraId\u003e for Runtime {\n\t\tfn slot_duration() -\u003e u64 {\n\t\t\tAura::slot_duration()\n\t\t}\n\n\t\tfn authorities() -\u003e Vec\u003cAuraId\u003e {\n\t\t\tAura::authorities()\n\t\t}\n\t}\n\n\timpl sp_session::SessionKeys\u003cBlock\u003e for Runtime {\n\t\tfn generate_session_keys(seed: Option\u003cVec\u003cu8\u003e\u003e) -\u003e Vec\u003cu8\u003e {\n\t\t\topaque::SessionKeys::generate(seed)\n\t\t}\n\n\t\tfn decode_session_keys(\n\t\t\tencoded: Vec\u003cu8\u003e,\n\t\t) -\u003e Option\u003cVec\u003c(Vec\u003cu8\u003e, KeyTypeId)\u003e\u003e {\n\t\t\topaque::SessionKeys::decode_into_raw_public_keys(\u0026encoded)\n\t\t}\n\t}\n\n\timpl fg_primitives::GrandpaApi\u003cBlock\u003e for Runtime {\n\t\tfn grandpa_authorities() -\u003e GrandpaAuthorityList {\n\t\t\tGrandpa::grandpa_authorities()\n\t\t}\n\n\t\tfn submit_report_equivocation_unsigned_extrinsic(\n\t\t\t_equivocation_proof: fg_primitives::EquivocationProof\u003c\n\t\t\t\t\u003cBlock as BlockT\u003e::Hash,\n\t\t\t\tNumberFor\u003cBlock\u003e,\n\t\t\t\u003e,\n\t\t\t_key_owner_proof: fg_primitives::OpaqueKeyOwnershipProof,\n\t\t) -\u003e Option\u003c()\u003e {\n\t\t\tNone\n\t\t}\n\n\t\tfn generate_key_ownership_proof(\n\t\t\t_set_id: fg_primitives::SetId,\n\t\t\t_authority_id: GrandpaId,\n\t\t) -\u003e Option\u003cfg_primitives::OpaqueKeyOwnershipProof\u003e {\n\t\t\t// NOTE: this is the only implementation possible since we've\n\t\t\t// defined our key owner proof type as a bottom type (i.e. a type\n\t\t\t// with no values).\n\t\t\tNone\n\t\t}\n\t}\n\t\n\timpl frame_system_rpc_runtime_api::AccountNonceApi\u003cBlock, AccountId, Index\u003e for Runtime {\n\t\tfn account_nonce(account: AccountId) -\u003e Index {\n\t\t\tSystem::account_nonce(account)\n\t\t}\n\t}\n\n\timpl pallet_transaction_payment_rpc_runtime_api::TransactionPaymentApi\u003cBlock, Balance\u003e for Runtime {\n\t\tfn query_info(\n\t\t\tuxt: \u003cBlock as BlockT\u003e::Extrinsic,\n\t\t\tlen: u32,\n\t\t) -\u003e pallet_transaction_payment_rpc_runtime_api::RuntimeDispatchInfo\u003cBalance\u003e {\n\t\t\tTransactionPayment::query_info(uxt, len)\n\t\t}\n\t}\n}\n","traces":[],"covered":0,"coverable":0}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, pathToString(file.path)),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('div', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('pre', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>